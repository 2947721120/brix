<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>brix tmpl test</title>
    <link type="text/css" rel="stylesheet" href="../../src/style/brix-min.css" charset="utf-8">
    <link type="text/css" rel="stylesheet" href="../../src/gallery/calendar/index.css" charset="utf-8">
    <link rel="stylesheet" href="../assets/doc.css">
    <script src="http://a.tbcdn.cn/s/kissy/1.3.0/seed.js" data-config="{combine:true}"></script>
    <script src="../../src/core/brix.js"></script>
</head>
<body>
    <div class="container" >
    </div>
    <script type="text/javascript">
        KISSY.add("components/brixtest/index", function(S, Brick) {
            var BrixTest = Brick.extend({
                initializer: function() {
                    S.log('initializer');
                    S.log(this.get('b'));
                },
                bindUI: function() {
                    //和老版本的initialize作用相同
                    S.log('bindUI');
                }
            }, {
                ATTRS: {
                    b: {
                        value: 4
                    }
                },
                EVENTS: {
                    '#input1': {
                        click: function(e) {
                            var self = this;
                            //self.pagelet.setChunkData('a', 'aaa' + S.guid());
                            self.pagelet.setChunkData({a:'aaaa'+S.guid(),c:'ccc'+S.guid()});
                            

                            self.fire('myfire');
                        }
                    },
                    '#input2': {
                        click: function(e) {
                            var self = this;
                            self.pagelet.setChunkData('b', 'bbb' + S.guid(),{renderType:'prepend'});
                        }
                    },
                    '#input3': {
                        click: function(e) {
                            var self = this;
                            self.pagelet.setChunkData('c', 'ccc' + S.guid(),{renderType:'append'});
                        }
                    },
                    '#input4': {
                        click: function(e) {
                            var self = this;
                            self.pagelet.setChunkData('d', [{
                                d1: S.guid()
                            }, {
                                d1: S.guid()
                            }, {
                                d1: S.guid()
                            }]);
                        }
                    },
                    '#input5': {
                        click: function(e) {
                            var self = this;
                            self.pagelet.setChunkData('e', !self.pagelet.get('dataset').get('data').e);
                        }
                    }
                },
                METHODS: {
                    testMethod: function() {
                        return 'test'
                    }
                }
            },'BrixTest');
            S.augment(BrixTest, BrixTest.METHODS);
            return BrixTest;
        }, {
            requires: ["brix/core/brick"]
        });

        var list = {
            a: 'a',
            b: 'b',
            c: 'c',
            d: [{
                d1: '1'
            }, {
                d1: '2'
            }, {
                d1: '3'
            }, {
                d1: function() {
                    return '4';
                }
            }],
            e: true, //ie6、7有兼容性问题
            f: function() {
                return 'xx';
            },
            g:[5,6,7]
        }
        KISSY.ready(function(S){
            S.use('brix/core/pagelet', function(S, Pagelet) {
                window.pagelet = new Pagelet({
                    container: '.container',
                    tmpl: '#tmpl',
                    data: list,
                    config: {
                        brixtest: {
                            b: 2,
                            listeners: {
                                myfire: function(e) {
                                    S.log(1)
                                }
                            }
                        }
                    }
                });
                pagelet.ready(function() {
                    var brixtest = pagelet.getBrick('brixtest');
                    S.log(brixtest.testMethod());
                })
            });
        });
    </script>
    <script type="text/tmpl" id="tmpl">
        <div id="brixtest" bx-name="brixtest" bx-path="components/brixtest/">
            <input id="input1" type="button" class="btn btn-red btn-size25" value="局部刷新a">
            <input id="input2" type="button" class="btn btn-red btn-size25" value="局部刷新b">
            <input id="input3" type="button" class="btn btn-red btn-size25" value="局部刷新c">
            <input id="input4" type="button" class="btn btn-red btn-size25" value="局部刷新d">
            <input id="input5" type="button" class="btn btn-red btn-size25" value="局部刷新e">
            <div id="xx" bx-tmpl="tmpl_a" class="hahah" bx-datakey="a" name="xx">
                <span>{{a}}</span>
            </div>
            <div bx-tmpl="tmpl_b" bx-datakey="b">
                <span>{{b}}</span>
                <div bx-name="calendar" class="calendar" bx-config="{popup:false,autoRender:true,showTime:true}">
                </div>
            </div>
            <div bx-tmpl="tmpl_c" bx-datakey="a,c">
                <span>{{a}}-{{c}}</span>
            </div>
            <div bx-tmpl="tmpl_d" bx-datakey="d">
                <table>
                    <tbody>
                    {{#d}}
                        <tr>
                            <td>{{d1}}<td>
                        </tr>
                    {{/d}}
                    </tbody>
                </table>
            </div>
            <div bx-tmpl="tmpl_e" bx-datakey="e" >
            {{^e}}
            <input type="text" value="{{e}}" />
            {{/e}}
            </div>
            <p>function：</p>
            <p>{{f}}</p>
            <p>mustache Array “.”测试</p>
            <table>
                <tbody>
                {{#g}}
                    <tr>
                        <td>{{.}}<td>
                    </tr>
                {{/g}}
                </tbody>
            </table>
        </div>
    </script>
</body>
</html>