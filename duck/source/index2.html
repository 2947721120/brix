<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">﻿;(function(doc, undefined) {

    var anti_ie6 = {

        //template
        template: ['&lt;div class=&quot;fuck-ie6-info fuck-ie6-info{r}&quot;&gt;',
                    '&lt;div class=&quot;fuck-ie6-container&quot; id=&quot;fieContainer&quot;&gt;',
                        '&lt;div class=&quot;fuck-ie6-why&quot; id=&quot;fieWhy&quot; &gt;&lt;/div&gt;',
                        '&lt;div class=&quot;fuck-ie6-show&quot; id=&quot;fieWhyBack&quot;&gt;&lt;/div&gt;',
                    '&lt;/div&gt;',
                '&lt;/div&gt;',
                '&lt;div class=&quot;fuck-ie6-update&quot;&gt;',
                    '&lt;div class=&quot;fuck-ie6-suggest&quot;&gt;建议您...&lt;/div&gt;',
                    '&lt;ul id=&quot;fieUpdates&quot;&gt;',
                        '&lt;li&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://windows.microsoft.com/zh-CN/internet-explorer/downloads/ie&quot;&gt;&lt;/a&gt;',
                            '&lt;i class=&quot;b-ie&quot;&gt;&lt;/i&gt;',
                            '&lt;span&gt;升级到IE新版本&lt;/span&gt;',
                        '&lt;/li&gt;',
                        '&lt;li class=&quot;fie-or&quot;&gt;或者&lt;/li&gt;',
                        '&lt;li&gt;&lt;a href=&quot;http://download.taobaocdn.com/client/browser/download.php?pid=0080_2010&quot;&gt;&lt;/a&gt;',
                            '&lt;i class=&quot;b-taobao&quot;&gt;&lt;/i&gt;',
                            '&lt;span&gt;下载淘宝浏览器&lt;/span&gt;',
                        '&lt;/li&gt;',
                        '&lt;li&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://www.google.cn/intl/zh-CN/chrome/browser/&quot;&gt;&lt;/a&gt;',
                            '&lt;i class=&quot;b-chrome&quot;&gt;&lt;/i&gt;',
                            '&lt;span&gt;下载chrome&lt;/span&gt;',
                        '&lt;/li&gt;',
                        '&lt;li&gt;&lt;a target=&quot;_blank&quot;  href=&quot;http://chrome.360.cn/&quot;&gt;&lt;/a&gt;',
                            '&lt;i class=&quot;b-browser360&quot;&gt;&lt;/i&gt;',
                            '&lt;span&gt;下载360浏览器&lt;/span&gt;',
                        '&lt;/li&gt;',
                    '&lt;/ul&gt;',
                    '&lt;div class=&quot;fuck-ie6-keep&quot;&gt;&lt;a href=&quot;javascript:;&quot; id=&quot;fieKeepIE6&quot; &gt;不，我要继续用这个悲催的方式浏览&lt;/a&gt;&lt;/div&gt;',
                '&lt;/div&gt;',
                '&lt;a href=&quot;javascript:;&quot; class=&quot;fuck-ie6-close&quot; id=&quot;fieClose&quot; title=&quot;close&quot;&gt;&lt;/a&gt;'].join(''),

        //css
        style: &quot;.fuck-ie6-why,.fuck-ie6-show,.fuck-ie6-update ul li.fie-or,.fuck-ie6-update ul li span,.fuck-ie6-update ul li i,.fuck-ie6-suggest,.fuck-ie6-keep a,.fuck-ie6-close,.fuck-ie6{background:url(http://img02.taobaocdn.com/tps/i2/T1RwDWXnNXXXbXZK.q-576-1660.png) no-repeat 0 0}.fuck-ie6{background-position:0 -1262px;position:absolute;width:576px;height:376px;top:100px;left:25%;overflow:hidden;z-index:999999}.fuck-ie6-update{position:absolute;width:540px;left:30px;bottom:20px;height:187px}.fuck-ie6-update ul{margin:0 0 15px;padding:0;list-style:none;zoom:1;overflow:hidden}.fuck-ie6-update ul li{float:left;width:110px;height:115px;position:relative;margin:0 6px;display:inline}.fuck-ie6-update ul li.fie-or{width:45px;height:30px;background-position:0 -1182px;text-indent:-9999px;margin:40px 0 0}.fuck-ie6-update ul li span{font-family:'Microsoft YaHei';position:absolute;width:110px;height:25px;background-position:0 -1090px;font-size:14px;text-align:center;padding-top:20px;font-weight:bold;left:0;bottom:0;color:#06c}.fuck-ie6-update ul li a{display:block;width:110px;height:115px;cursor:pointer;color:#06c;text-decoration:none;position:absolute;z-index:10;left:0;top:0;background-color:white;filter:alpha(opacity=0);opacity:0}.fuck-ie6-update ul li a span{text-decoration:none}.fuck-ie6-update ul li a:hover span{text-decoration:underline}.fuck-ie6-update ul li i{position:absolute;width:110px;height:80px;background-position:0 -1010px;left:0;bottom:0}.fuck-ie6-update ul li.fie-hover span{text-decoration:underline}.fuck-ie6-update ul li i.b-ie{background-position:-110px -1010px}.fuck-ie6-update ul li i.b-browser360{background-position:-220px -1010px}.fuck-ie6-update ul li i.b-chrome{background-position:-330px -1010px}.fuck-ie6-suggest{background-position:0 -1150px;width:82px;height:32px;text-indent:-9999px}.fuck-ie6-keep{height:25px}.fuck-ie6-keep a{display:block;text-indent:-9999px;height:25px;width:325px;zoom:1;background-position:0 -1212px}.fuck-ie6-keep a:hover{background-position:0 -1237px}.fuck-ie6-close{position:absolute;top:25px;right:25px;width:26px;height:24px;background-position:0 -21px;cursor:pointer}.fuck-ie6-close:hover{background-position:-26px -21px}.fuck-ie6-info{position:absolute;width:520px;height:150px;left:30px;top:20px;overflow:hidden}.fuck-ie6-container{width:1040px;position:relative}.fuck-ie6-why,.fuck-ie6-show{float:left;width:520px;height:150px;cursor:pointer}.fuck-ie6-why{background-position:0 -97px;cursor:pointer}.fuck-ie6-show{background-position:0 -247px}.fuck-ie6-info2 .fuck-ie6-why{background-position:0 -397px}.fuck-ie6-info2 .fuck-ie6-show{background-position:0 -547px}.fuck-ie6-info3 .fuck-ie6-why{background-position:0 -697px}.fuck-ie6-info3 .fuck-ie6-show{background-position:0 -847px}&quot;,

        init: function() {

            //非ie6退出
            if (!this.isIE6()) {
                return;
            }

            //cookie检测
            if (document.cookie.indexOf('anti_ie6') &gt; -1) {
                return;
            }

            var tmpl = this.template;
            var styleString = this.style;
            var ran = (Math.round(Math.random()*10)%3+1).toString();
            var body = doc.body;
            var head = doc.getElementsByTagName('head')[0];
            var docWidth = body.offsetWidth;


            //create style
            var style = doc.createElement('style');
            style.type = &quot;text/css&quot;;
            style.media = &quot;screen&quot;;

            if (style.styleSheet) { //for ie
                style.styleSheet.cssText = styleString;
            } else {
                style.appendChild(doc.createTextNode(styleString));
            }
            head.appendChild(style);

            //create wrapper
            this.div = doc.createElement('div');
            this.div.className = 'fuck-ie6';
            this.div.style.left = (docWidth - 580)/2 + 'px';//居中
            tmpl = tmpl.replace('{r}', ran);
            this.div.innerHTML = tmpl;
            body.appendChild(this.div);

            //bind events
            this.bindEvents();
        },

        bindEvents: function () {
            var fieWhy = doc.getElementById('fieWhy');
            var fieContainer = doc.getElementById('fieContainer');
            var fieClose = doc.getElementById('fieClose');
            var _this = this;
            var updates = doc.getElementById('fieUpdates');
            var fieKeepIE6 = doc.getElementById('fieKeepIE6');
            var lis = updates.getElementsByTagName('a');
            var fieWhyBack = doc.getElementById('fieWhyBack');


            fieWhy.onclick = function() {
                _this.whyNoIe6Anim(0, -520, 30);
            };

            fieWhyBack.onclick = function() {
                _this.whyNoIe6Anim(-520, 520, 30);
            };

            fieClose.onclick = function () {
                _this.div.parentNode.removeChild(_this.div);
            };

            //
            for (var i = 0, len = lis.length; i &lt; len; i++) {

                lis[i].onmouseover = function(e) {
                    var prev = this.nextSibling;
                    prev.isOver = true;
                    prev.isOut = false;

                    this.parentNode.className = 'fie-hover';

                    if (!prev.animRunningRise &amp;&amp; !prev.animRunningFall) {
                        _this.riseBrowser(prev, function() {
                            if (prev.isOut) {
                                _this.fallBrowser(prev);
                            }
                        });
                    }
                };

                lis[i].onmouseout = function(e) {
                    var prev = this.nextSibling;
                    prev.isOver = false;
                    prev.isOut = true;

                    this.parentNode.className = '';

                    if (!prev.animRunningRise &amp;&amp; !prev.animRunningFall) {
                        _this.fallBrowser(prev);
                    }
                };

            }

            // updates.onmouseover = function(e) {
            //     var evt = e || event;
            //     var t = evt.target || evt.srcElement;
            //     var prev;

            //     if (t.tagName.toLowerCase() === 'li') {
            //         prev = t.firstChild;
            //         alert(prev.nodeType);
            //         prev.isOver = true;
            //         prev.isOut = false;

            //         if (!prev.animRunningRise &amp;&amp; !prev.animRunningFall) {
            //             _this.riseBrowser(prev, function() {
            //                 if (prev.isOut) {
            //                     _this.fallBrowser(prev);
            //                 }
            //             });
            //         }
            //     }
            // };

            // updates.onmouseout = function(e) {

            //     var evt = e || event;
            //     var t = evt.target || evt.srcElement;
            //     var prev;

            //     if (t.tagName.toLowerCase() === 'a') {
            //         prev = t.previousSibling;
            //         prev.isOver = false;
            //         prev.isOut = true;

            //         if (!prev.animRunningRise &amp;&amp; !prev.animRunningFall) {
            //             _this.fallBrowser(prev);
            //         }
            //     }
            // };

            fieKeepIE6.onclick = function(e) {
                var d = new Date();
                d.setTime(d.getTime() + 7*60*60*24*1000); //十天后过期

                document.cookie = 'anti_ie6=1; path=/; expires=' + d.toGMTString();
                _this.div.parentNode.removeChild(_this.div);
            };

        },

        whyNoIe6Anim: function(b, c, d, callback, _t) {
            var t = _t || 0;
            // var b = 0, c = -520, d = 30;
            var fn = arguments.callee;
            var fieContainer = doc.getElementById('fieContainer');
            var _this = this;

            fieContainer.style.left = _this.easeOut(t, b, c, d) + 'px';
            if (t &lt; d) {
                t++;
                setTimeout(function() {
                    fn.call(_this, b, c, d, callback, t);
                }, 10);
            } else {
                callback &amp;&amp; callback();
            }
        },



        // animBrowser: function(el, _b, _c, _d, direction, callback, _t) {
        //     var t = _t || 0;
        //     var b = _b, c = _c, d = _d;
        //     var fn = arguments.callee;
        //     var _this = this;

        //     //动画中不执行
        //     if ( t === 0 &amp;&amp; el['animRunning' + direction]) return;

        //     //设动画进行中标识
        //     (t === 0) &amp;&amp; (el['animRunning' + direction] = true);

        //     el.style.bottom = _this.backOut(t, b, c, d) + 'px';
        //     if (t &lt; d) {
        //         t++;
        //         setTimeout(function() {
        //             fn.call(_this, el, _b, _c, _d, direction, callback, t);
        //         }, 10);
        //     } else {
        //         callback &amp;&amp; callback();
        //         el['animRunning' + direction] = false; //动画结束
        //     }
        // },

        riseBrowser: function(el, callback, _t) {
            var t = _t || 0;
            var b = 0, c = 35, d = 25;
            var fn = arguments.callee;
            var _this = this;

            //动画中不执行
            // if ( t === 0 &amp;&amp; (el['animRunningRise'] || el['animRunningFall']) ) return;

            //设动画进行中标识
            (t === 0) &amp;&amp; (el['animRunningRise'] = true);

            el.style.bottom = _this.backOut(t, b, c, d, 2) + 'px';
            if (t &lt; d) {
                t++;
                setTimeout(function() {
                    fn.call(_this, el, callback, t);
                }, 10);
            } else {
                callback &amp;&amp; callback();
                el['animRunningRise'] = false; //动画结束
            }


        },

        fallBrowser: function(el, callback, _t) {
            var t = _t || 0;
            var b = 35, c = -35, d = 20;
            var fn = arguments.callee;
            var _this = this;

            //动画中不执行
            // if ( t === 0 &amp;&amp; (el['animRunningRise'] || el['animRunningFall']) ) return;

            //设动画进行中标识
            (t === 0) &amp;&amp; (el['animRunningFall'] = true);

            el.style.bottom = _this.easeOut(t, b, c, d) + 'px';
            if (t &lt; d) {
                t++;
                setTimeout(function() {
                    fn.call(_this, el, callback, t);
                }, 10);
            } else {
                callback &amp;&amp; callback();
                el['animRunningFall'] = false; //动画结束
            }
        },

        easeOut: function(t,b,c,d){
            return -c *(t/=d)*(t-2) + b;
        },

        backOut: function(t,b,c,d,s){
            if (s == undefined) s = 1.70158;
            return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
        },

        // bounceOut: function(t,b,c,d){
        //     if ((t/=d) &lt; (1/2.75)) {
        //         return c*(7.5625*t*t) + b;
        //     } else if (t &lt; (2/2.75)) {
        //         return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
        //     } else if (t &lt; (2.5/2.75)) {
        //         return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
        //     } else {
        //         return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
        //     }
        // },

        isIE6: function() {
            return /msie 6/i.test(navigator.userAgent);
        }
    };

    //excute
    anti_ie6.init();

})(document);
</pre>
</body>
</html>
