<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">KISSY.add('brix/gallery/charts/js/e/line/view/group',function(S,Base,node,Global,SVGElement,SVGRenderer,SVGGraphics){
	
	function Group(){
		
		var self = this

		Group.superclass.constructor.apply(self,arguments);
	}

	Group.ATTRS = {
		index:{
			value:0              //索引
		},
		data:{
			value:[]             //[{x:0,y:-100,no_node:1[1=不显示节点]},{}]
		},
		element:{
			value:null
		},
		node:{
			value:0              //是否有节点
		},
		area:{
			value:0              //是否有区域
		},
		shape:{
			value:0              //线条样式[0 = 直线 | 1 = 曲线]
		},
		line:{
			value:1              //是否有线条
		},
		fill:{
			value:'#666666'      //初始颜色[线色 + 圆轮廓色]
		},
		fill_over:{
			value:'#000000'      //鼠标划入颜色[线色 + 圆轮廓色]
		},
		circle:{                 //圆
			value:{ 
				radius:3,        //半径
				thickness:2,     //轮廓粗线
				fill:'#FFFFFF'   //填充色
			}
		},

		_circlesArr:{
			value:[]             //circle对象集合
		},

		_lines:{
			value:null           //线集合g
		},
		_circles:{
			value:null           //圆集合g
		},
		_linesCrude:{
			value:null           //粗线集合g
		},
		_circlesCrude:{
			value:null           //粗圆集合g(当this.node=1时才看的到)
		},
		_fill:{
			value:null           //区域
		},		

		
		_line_thickness:{
			value:2              //线条粗线
		},
		_line_thickness_over:{
			value:3              //鼠标划入线条粗线
		},	

		_linearGradientIndex:{
			value:'linearGradient'//线性渐变索引	
		}
	}	

	S.extend(Group,Base,{
		init:function(){
			var self = this
			Group.superclass.constructor.apply(self,arguments);
			self.set('element', new SVGElement('g'))//, self.get('element').set('id',self.get('index'))
			self.get('parent').appendChild(self.get('element').element)

			if(self.get('area')){
				self.set('_linearGradientIndex', self.get('_linearGradientIndex') + '_' + self.get('index'))
				self._linearGradient({'id':self.get('_linearGradientIndex'),'top_fill':self.get('fill'),'top_opacity':0.25,'down_fill':self.get('fill'),'down_opacity':0.05})
			}
			self._widget()

		},
		induce:function($b){
			var self = this
			self._induce($b)
		},
		getNodeInfoAt:function($index){
			var self = this
			var o = {}
			var circle = self.get('_circlesArr')[$index]
			if(circle){
				o.index = self.get('index'), o.id = Number(circle.get('_index'))
				o.x = Number(circle.get('_x')), o.y = Number(circle.get('_y'))
				o.fill = self.get('fill'), o.fill_over = self.get('fill_over')
				return o
			}else{
				return ''
			}
		},

		_widget:function(){
			// S.log('-------------------------')
			// S.log(S.now())
			var self = this
			if(self.get('area')){
				// S.log('1')
				self.set('_fill', new SVGElement('g')), self.get('_fill').set('id','J_fill')
				self.get('element').appendChild(self.get('_fill').element)
				var fill
				var o = {'lines':self.get('data'),'stroke':'none','fill':'url(#' + self.get('_linearGradientIndex') + ')'}
				if(self.get('shape') == 0){
					fill = self._fillLine(o)
				}else{
					fill = self._fillCurveLine(o)
				}
				self.get('_fill').element.appendChild(fill.element)
			}
			if(self.get('line')){
				// S.log('2')
				self.set('_lines', new SVGElement('g')), self.get('_lines').set('class','lines')
				self.get('element').appendChild(self.get('_lines').element)
				
				self.set('_circles', new SVGElement('g')), self.get('_circles').set('class','circles')
				self.get('element').appendChild(self.get('_circles').element)

				self.set('_linesCrude', new SVGElement('g')), self.get('_circles').set('class','linesCrude')
				self.get('element').appendChild(self.get('_linesCrude').element)
				

				self.set('_circlesCrude', new SVGElement('g')), self.get('_circles').set('class','circlesCrude')
				self.get('element').appendChild(self.get('_circlesCrude').element)

				//线组
				var line
				if(self.get('shape') == 0){
					line = SVGGraphics.lines({'lines':self.get('data'),'stroke':self.get('fill'),'stroke_width':self.get('_line_thickness')})
					
				}else{
					line = SVGGraphics.curveLines({'lines':self.get('data'),'stroke':self.get('fill'),'stroke_width':self.get('_line_thickness')})
				}
				self.get('_lines').element.appendChild(line.element)
				

				//圆点
				if(self.get('node') == 0){
					self.get('_circles').set('visibility','hidden')
				}
				
				var _df = document.createDocumentFragment();
				for (var a = 0, al = self.get('data').length; a &lt; al; a++ ) {
					var circle = SVGGraphics.circle({'r':self.get('circle').radius,'fill':self.get('circle').fill,'stroke':self.get('fill'),'stroke_width':self.get('circle').thickness})
					// self.get('_circles').element.appendChild(circle.element), self.get('_circlesArr').push(circle)
					var x = self.get('data')[a].x , y = self.get('data')[a].y
					circle.transformXY(x,y)
					circle.set('_index', a)
					circle.set('_x',x)
					circle.set('_y',y)
					_df.appendChild(circle.element), self.get('_circlesArr').push(circle)
					if(self.get('data')[a].no_node){
						 circle.set('visibility','hidden')
					}
				}
				self.get('_circles').element.appendChild(_df)

				//鼠标划入时
				//粗线
				self.get('_linesCrude').set('visibility','hidden')
				var line
				if(self.get('shape') == 0){
					line = SVGGraphics.lines({'lines':self.get('data'),'stroke':self.get('fill_over'),'stroke_width':self.get('_line_thickness_over')})
				}else{
					line = SVGGraphics.curveLines({'lines':self.get('data'),'stroke':self.get('fill_over'),'stroke_width':self.get('_line_thickness_over')})
				}
				self.get('_linesCrude').element.appendChild(line.element)	

				//粗圆点
				self.get('_circlesCrude').set('visibility','hidden')
				var _df = document.createDocumentFragment();
				for (var a = 0, al = self.get('data').length; a &lt; al; a++ ) {
					var circle = SVGGraphics.circle({'r':self.get('circle').radius,'fill':self.get('circle').fill,'stroke':self.get('fill_over'),'stroke_width':self.get('circle').thickness})
					circle.transformXY(self.get('data')[a].x,self.get('data')[a].y)
					_df.appendChild(circle.element)
					if(self.get('data')[a].no_node){
						circle.set('visibility','hidden')
					}
				}
				self.get('_circlesCrude').element.appendChild(_df)
			}
			// S.log(S.now())
		},

		_induce:function($b){
			var self = this
			var visibility
			if($b){
				visibility = 'visible'
			}else{
				visibility = 'hidden'
			}
			self.get('_linesCrude').set('visibility',visibility)

			if(self.get('node') == 1){
				self.get('_circlesCrude').set('visibility',visibility)
			}
		},

		//填充直线
		_fillLine:function($o){
			var self = this
			var $o = $o ? $o : {}
			var arr = $o.lines
			var fill = $o.fill ? $o.fill : 'none'
			var stroke = $o.stroke ? $o.stroke : '#000000'
			var stroke_width = $o.stroke_width ? $o.stroke_width : 1
			var d = SVGRenderer.symbol('lines','','','','',arr)
			d += ' ' + SVGRenderer.actions.L + ' ' + arr[arr.length - 1].x + ' ' + 0
			d += ' ' + SVGRenderer.actions.L + ' ' + (Number(arr[0].x)) + ' ' + 0
			d += ' ' + SVGRenderer.actions.L + ' ' + (Number(arr[0].x)) + ' ' + (Number(arr[0].y))

			var path = new SVGElement('path')
			path.attr({'d':d,'fill':fill, 'stroke':stroke,'stroke-width':stroke_width})
			return path
		},
		//填充曲线
		_fillCurveLine:function($o){
			var self = this
			var $o = $o ? $o : {}
			var arr = $o.lines
			var fill = $o.fill ? $o.fill : 'none'
			var stroke = $o.stroke ? $o.stroke : '#000000'
			var stroke_width = $o.stroke_width ? $o.stroke_width : 1
			var d = SVGRenderer.symbol('curveLines','','','','',arr)
			d += ' ' + SVGRenderer.actions.L + ' ' + arr[arr.length - 1].x + ' ' + 0
			d += ' ' + SVGRenderer.actions.L + ' ' + (Number(arr[0].x)) + ' ' + 0
			d += ' ' + SVGRenderer.actions.L + ' ' + (Number(arr[0].x)) + ' ' + (Number(arr[0].y))

			var path = new SVGElement('path')
			path.attr({'d':d,'fill':fill, 'stroke':stroke,'stroke-width':stroke_width})
			return path
		},

		//线性填充
		_linearGradient:function($o){
			var self = this
			var $o = $o ? $o : {}
			var id = $o.id ? $o.id : 'linearGradient'
			var top_fill = $o.top_fill ? $o.top_fill : '#000000'
			var top_opacity = $o.top_opacity ? $o.top_opacity : 1
			var down_fill = $o.down_fill ? $o.down_fill : '#000000'
			var down_opacity = $o.down_opacity ? $o.down_opacity : 1
			var defs = new SVGElement('defs')
			self.get('element').appendChild(defs.element)

			var linearGradient = new SVGElement('linearGradient')
			linearGradient.attr({'id':id,'x1':'0%','y1':'0%','x2':'0%','y2':'100%'})
			defs.appendChild(linearGradient.element)

			var stop = new SVGElement('stop')
			stop.attr({'stop-color':top_fill,'stop-opacity':top_opacity,'offset':'0'})
			linearGradient.appendChild(stop.element)

			var stop = new SVGElement('stop')
			stop.attr({'stop-color':down_fill,'stop-opacity':down_opacity,'offset':'1'})
			linearGradient.appendChild(stop.element)
		}
	});

	return Group;

	}, {
	    requires:['base','node','../../../pub/utils/global','../../../pub/utils/svgelement','../../../pub/utils/svgrenderer','../../../pub/views/svggraphics']
	}
);</pre>
</body>
</html>
