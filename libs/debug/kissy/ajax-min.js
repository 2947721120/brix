/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Nov 28 12:38
*/
KISSY.add("ajax/base",function(i,l,m,k){function d(j){j=i.mix(i.clone(u),j||{},undefined,undefined,true);if(!i.isBoolean(j.crossDomain)){var o=f.exec(j.url.toLowerCase());j.crossDomain=!!(o&&(o[1]!=r[1]||o[2]!=r[2]||(o[3]||(o[1]==="http:"?g:n))!=(r[3]||(r[1]==="http:"?g:n))))}if(j.processData&&j.data&&!i.isString(j.data))j.data=i.param(j.data,undefined,undefined,j.serializeArray);j.type=j.type.toUpperCase();j.hasContent=!q.test(j.type);if(!j.hasContent){if(j.data)j.url+=(/\?/.test(j.url)?"&":"?")+
j.data;if(j.cache===false)j.url+=(/\?/.test(j.url)?"&":"?")+"_ksTS="+(i.now()+"_"+i.guid())}j.dataType=i.trim(j.dataType||"*").split(a);j.context=j.context||j;return j}function b(j,o){e.fire(j,{ajaxConfig:o.config,xhr:o})}function c(j){var o=this.config;j=j.type;this.timeoutTimer&&clearTimeout(this.timeoutTimer);o[j]&&o[j].call(o.context,this.responseData,this.statusText,this);b(j,this)}function e(j){if(j.url){j=d(j);var o=new k(j);b("start",o);var x=new (s[j.dataType[0]]||s["*"])(o);o.transport=
x;j.contentType&&o.setRequestHeader("Content-Type",j.contentType);var v=j.dataType[0],w=j.accepts;o.setRequestHeader("Accept",v&&w[v]?w[v]+(v==="*"?"":", */*; q=0.01"):w["*"]);for(var y in j.headers)o.setRequestHeader(y,j.headers[y]);o.on("complete success error",c);o.readyState=1;b("send",o);if(j.async&&j.timeout>0)o.timeoutTimer=setTimeout(function(){o.abort("timeout")},j.timeout*1E3);try{o.state=1;x.send()}catch(z){o.status<2&&o.callback(-1,z)}return o}}var a=/\s+/,f=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,
h=function(j){return j},g=80,n=443,q=/^(?:GET|HEAD)$/,p,r;try{p=location.href}catch(t){p=document.createElement("a");p.href="";p=p.href}r=f.exec(p);p=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(r[1]);var s={},u={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:l.parse,
html:h,text:h,xml:i.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};u.converters.html=u.converters.text;i.mix(e,m.Target);i.mix(e,{isLocal:p,setupConfig:function(j){i.mix(u,j,undefined,undefined,true)},setupTransport:function(j,o){s[j]=o},getTransport:function(j){return s[j]},getConfig:function(){return u}});return e},{requires:["json","event","./xhrobject"]});
KISSY.add("ajax/form-serializer",function(i,l){var m=/^(?:select|textarea)/i,k=/\r?\n/g,d=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return{serialize:function(b){var c=[],e={};l.query(b).each(function(a){a=a.elements?i.makeArray(a.elements):[a];c.push.apply(c,a)});c=i.filter(c,function(a){return a.name&&!a.disabled&&(a.checked||m.test(a.nodeName)||d.test(a.type))});i.each(c,function(a){var f=l.val(a);f=i.map(i.makeArray(f),function(h){return h.replace(k,
"\r\n")});a=e[a.name]=e[a.name]||[];a.push.apply(a,f)});return i.param(e,undefined,undefined,false)}}},{requires:["dom"]});
KISSY.add("ajax/form",function(i,l,m,k){l.on("start",function(d){d=d.xhr.config;if(d.form){var b=m.get(d.form);if((b.encoding||b.enctype).toLowerCase()!="multipart/form-data"){if(b=k.serialize(b))if(d.hasContent){d.data=d.data||"";if(d.data)d.data+="&";d.data+=b}else d.url+=(/\?/.test(d.url)?"&":"?")+b}else{b=d.dataType[0];if(b=="*")b="text";d.dataType.length=2;d.dataType[0]="iframe";d.dataType[1]=b}}});return l},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-upload",function(i,l,m,k){function d(c){this.xhr=c}var b=document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(c){return c}}}});i.augment(d,{send:function(){var c=this.xhr,e=c.config,a,f=l.get(e.form);this.attrs={target:l.attr(f,"target")||"",action:l.attr(f,"action")||""};this.form=f;var h=i.guid("ajax-iframe");c.iframe=l.create("<iframe  id='"+h+"' name='"+h+"' style='position:absolute;left:-9999px;top:-9999px;'/>");c.iframeId=h;l.prepend(c.iframe,
b.body||b.documentElement);l.attr(f,{target:c.iframeId,action:e.url});if(e.data){a=e.data;e=e.serializeArray;a=i.unparam(a);h=[];for(var g in a)for(var n=i.isArray(a[g]),q=i.makeArray(a[g]),p=0;p<q.length;p++){var r=b.createElement("input");r.type="hidden";r.name=g+(n&&e?"[]":"");r.value=q[p];l.append(r,f);h.push(r)}a=h}this.fields=a;m.on(c.iframe,"load error",this._callback,this);f.submit()},_callback:function(c){var e=this.xhr;c=c.type;var a=e.iframe;if(a){l.attr(this.form,this.attrs);if(c=="load"){c=
a.contentWindow.document;e.responseXML=c;e.responseText=l.text(c.body);e.callback(200,"success")}else c=="error"&&e.callback(500,"error");l.remove(this.fields);m.detach(a);setTimeout(function(){l.remove(a)},30);e.iframe=null}},abort:function(){this._callback(0,1)}});k.setupTransport("iframe",d);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(i,l){l.setupConfig({jsonp:"callback",jsonpCallback:function(){return i.guid("jsonp")}});l.on("start",function(m){m=m.xhr;var k=m.config;if(k.dataType[0]=="jsonp"){var d,b=k.jsonpCallback,c=i.isFunction(b)?b():b,e=window[c];k.url+=(/\?/.test(k.url)?"&":"?")+k.jsonp+"="+c;window[c]=function(a){if(arguments.length>1)a=i.makeArray(arguments);d=[a]};m.on("complete",function(){window[c]=e;if(e===undefined)try{delete window[c]}catch(a){}else d&&e(d[0])});m.converters=m.converters||
{};m.converters.script=m.converters.script||{};m.converters.script.json=function(){return d[0]};k.dataType.length=2;k.dataType[0]="script";k.dataType[1]="json"}});return l},{requires:["./base"]});
KISSY.add("ajax/script",function(i,l){function m(d){if(!d.config.crossDomain&&!d.config.forceScript)return new (l.getTransport("*"))(d);this.xhrObj=d;return 0}var k=document;l.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){i.globalEval(d);return d}}}});i.augment(m,{send:function(){var d=this,b,c=this.xhrObj.config,e=k.head||k.getElementsByTagName("head")[0]||
k.documentElement;d.head=e;b=k.createElement("script");d.script=b;b.async="async";if(c.scriptCharset)b.charset=c.scriptCharset;b.src=c.url;b.onerror=b.onload=b.onreadystatechange=function(a){a=a||window.event;d._callback((a.type||"error").toLowerCase())};e.insertBefore(b,e.firstChild)},_callback:function(d,b){var c=this.script,e=this.xhrObj,a=this.head;if(c)if(b||!c.readyState||/loaded|complete/.test(c.readyState)||d=="error"){c.onerror=c.onload=c.onreadystatechange=null;a&&c.parentNode&&a.removeChild(c);
this.head=this.script=undefined;if(!b&&d!="error")e.callback(200,"success");else d=="error"&&e.callback(500,"scripterror")}},abort:function(){this._callback(0,1)}});l.setupTransport("script",m);return l},{requires:["./base","./xhr"]});
KISSY.add("ajax/subdomain",function(i,l,m,k){function d(f){var h=f.config;this.xhrObj=f;f=h.url.match(c);this.__hostname=f[2];this.__protocol=f[1];h.crossDomain=false}function b(){var f=a[this.__hostname];f.ready=1;m.detach(f.iframe,"load",b,this);this.send()}var c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,e=document,a={};i.augment(d,l.proto,{send:function(){var f=this.xhrObj.config,h=this.__hostname,g=a[h],n="/sub_domain_proxy.html";if(f.xdr&&f.xdr.subDomain&&f.xdr.subDomain.proxy)n=f.xdr.subDomain.proxy;
if(g&&g.ready)(this.xhr=l.xhr(0,g.iframe.contentWindow))&&this.sendInternal();else{if(g)f=g.iframe;else{g=a[h]={};f=g.iframe=document.createElement("iframe");k.css(f,{position:"absolute",left:"-9999px",top:"-9999px"});k.prepend(f,e.body||e.documentElement);f.src=this.__protocol+"//"+h+n}m.on(f,"load",b,this)}}});return d},{requires:["./xhrbase","event","dom"]});
KISSY.add("ajax/xdr",function(i,l,m){function k(h,g,n){if(!f){f=true;h='<object id="'+c+'" type="application/x-shockwave-flash" data="'+h+'" width="0" height="0"><param name="movie" value="'+h+'" /><param name="FlashVars" value="yid='+g+"&uid="+n+'&host=KISSY.io" /><param name="allowScriptAccess" value="always" /></object>';g=a.createElement("div");m.prepend(g,a.body||a.documentElement);g.innerHTML=h}}function d(h){this.xhrObj=h}var b={},c="io_swf",e,a=document,f=false;i.augment(d,{send:function(){var h=
this,g=h.xhrObj.config;k((g.xdr||{}).src||i.Config.base+"ajax/io.swf",1,1);if(e){h._uid=i.guid();b[h._uid]=h;e.send(g.url,{id:h._uid,uid:h._uid,method:g.type,data:g.hasContent&&g.data||{}})}else setTimeout(function(){h.send()},200)},abort:function(){e.abort(this._uid)},_xdrResponse:function(h,g){var n,q=this.xhrObj;q.responseText=decodeURI(g.c.responseText);switch(h){case "success":n={status:200,statusText:"success"};delete b[g.id];break;case "abort":delete b[g.id];break;case "timeout":case "transport error":case "failure":delete b[g.id];
n={status:500,statusText:h}}n&&q.callback(n.status,n.statusText)}});l.applyTo=function(h,g,n){h=g.split(".");var q=i;i.each(h,function(p){q=q[p]});q.apply(null,n)};l.xdrReady=function(){e=a.getElementById(c)};l.xdrResponse=function(h,g,n){var q=b[g.uid];q&&q._xdrResponse(h,g,n)};i.io=l;return d},{requires:["./base","dom"]});
KISSY.add("ajax/xhr",function(i,l,m,k,d){var b=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,c=window.XDomainRequest,e=m.xhr();if(e){var a=function(h){h=h.split(".");return h.length<2?h.join("."):h.reverse().slice(0,2).reverse().join(".")},f=function(h){var g=h.config,n=g.xdr||{};if(g.crossDomain){g=g.url.match(b);if(a(location.hostname)==a(g[2]))return new k(h);if(!("withCredentials"in e)&&(String(n.use)==="flash"||!c))return new d(h)}this.xhrObj=h};i.augment(f,m.proto,{send:function(){this.xhr=
m.xhr(this.xhrObj.config.crossDomain);this.sendInternal()}});l.setupTransport("*",f)}return l},{requires:["./base","./xhrbase","./subdomain","./xdr"]});
KISSY.add("ajax/xhrbase",function(i,l){function m(c,e){try{return new (e||k).XMLHttpRequest}catch(a){}}var k=window,d=k.XDomainRequest,b={proto:{}};b.xhr=k.ActiveXObject?function(c,e){if(c&&d)return new d;var a;if(!(a=!l.isLocal&&m(c,e)))a:{try{a=new (e||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(f){}a=void 0}return a}:m;i.mix(b.proto,{sendInternal:function(){var c=this,e=c.xhrObj,a=e.config,f=c.xhr,h,g;a.username?f.open(a.type,a.url,a.async,a.username,a.password):f.open(a.type,a.url,a.async);
if(h=a.xhrFields)for(g in h)f[g]=h[g];e.mimeType&&f.overrideMimeType&&f.overrideMimeType(e.mimeType);if(!a.crossDomain&&!e.requestHeaders["X-Requested-With"])e.requestHeaders["X-Requested-With"]="XMLHttpRequest";try{if(!a.crossDomain)for(g in e.requestHeaders)f.setRequestHeader(g,e.requestHeaders[g])}catch(n){}f.send(a.hasContent&&a.data||null);if(!a.async||f.readyState==4)c._callback();else if(d&&f instanceof d){f.onload=function(){f.readyState=4;f.status=200;c._callback()};f.onerror=function(){f.readyState=
4;f.status=500;c._callback()}}else f.onreadystatechange=function(){c._callback()}},abort:function(){this._callback(0,1)},_callback:function(c,e){try{var a=this.xhr,f=this.xhrObj,h=f.config;if(e||a.readyState==4){if(d&&a instanceof d){a.onerror=i.noop;a.onload=i.noop}else a.onreadystatechange=i.noop;if(e)a.readyState!==4&&a.abort();else{var g=a.status;if(!(d&&a instanceof d))f.responseHeadersString=a.getAllResponseHeaders();var n=a.responseXML;if(n&&n.documentElement)f.responseXML=n;f.responseText=
a.responseText;try{var q=a.statusText}catch(p){q=""}if(!g&&l.isLocal&&!h.crossDomain)g=f.responseText?200:404;else if(g===1223)g=204;f.callback(g,q)}}}catch(r){a.onreadystatechange=i.noop;e||f.callback(-1,r)}}});return b},{requires:["./base"]});
KISSY.add("ajax/xhrobject",function(i,l){function m(b){var c=b.responseText,e=b.responseXML,a=b.config,f=a.converters,h=b.converters||{},g,n,q=a.contents,p=a.dataType;if(c||e){for(a=b.mimeType||b.getResponseHeader("Content-Type");p[0]=="*";)p.shift();if(!p.length)for(g in q)if(q[g].test(a)){p[0]!=g&&p.unshift(g);break}p[0]=p[0]||"text";if(p[0]=="text"&&c!==undefined)n=c;else if(p[0]=="xml"&&e!==undefined)n=e;else i.each(["text","xml"],function(t){var s=p[0];if(h[t]&&h[t][s]||f[t]&&f[t][s]){p.unshift(t);
n=t=="text"?c:e;return false}})}q=p[0];for(a=1;a<p.length;a++){g=p[a];var r=h[q]&&h[q][g]||f[q]&&f[q][g];if(!r)throw"no covert for "+q+" => "+g;n=r(n);q=g}b.responseData=n}function k(b){i.mix(this,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null})}var d=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;i.augment(k,l.Target,{setRequestHeader:function(b,c){this.requestHeaders[b]=
c;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(b){var c;if(this.state===2){if(!this.responseHeaders)for(this.responseHeaders={};c=d.exec(this.responseHeadersString);)this.responseHeaders[c[1]]=c[2];c=this.responseHeaders[b]}return c===undefined?null:c},overrideMimeType:function(b){if(!this.state)this.mimeType=b;return this},abort:function(b){b=b||"abort";this.transport&&this.transport.abort(b);this.callback(0,b);return this},
callback:function(b,c){if(this.state!=2){this.state=2;this.readyState=4;var e;if(b>=200&&b<300||b==304)if(b==304){c="notmodified";e=true}else try{m(this);c="success";e=true}catch(a){c="parsererror : "+a}else if(b<0)b=0;this.status=b;this.statusText=c;e?this.fire("success"):this.fire("error");this.fire("complete");this.transport=undefined}}});return k},{requires:["event"]});
KISSY.add("ajax",function(i,l,m){i.mix(m,{serialize:l.serialize,get:function(k,d,b,c,e){if(i.isFunction(d)){c=b;b=d;d=undefined}return m({type:e||"get",url:k,data:d,success:b,dataType:c})},post:function(k,d,b,c){if(i.isFunction(d)){c=b;b=d;d=undefined}return m.get(k,d,b,c,"post")},jsonp:function(k,d,b){if(i.isFunction(d)){b=d;d=undefined}return m.get(k,d,b,"jsonp")},getScript:i.getScript,getJSON:function(k,d,b){if(i.isFunction(d)){b=d;d=undefined}return m.get(k,d,b,"json")},upload:function(k,d,b,
c,e){if(i.isFunction(b)){e=c;c=b;b=undefined}return m({url:k,type:"post",dataType:e,form:d,data:b,success:c})}});return m},{requires:["ajax/form-serializer","ajax/base","ajax/xhrobject","ajax/xhr","ajax/script","ajax/jsonp","ajax/form","ajax/iframe-upload"]});
