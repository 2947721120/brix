/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Dec 1 20:08
*/
KISSY.add("htmlparser/Parser",function(k,o,n,m,g,f,q){function e(j,h){this.lexer=new g(j);this.opts=h||{};this.document=new f}e.prototype={elements:function(){var j,h=this.lexer;do if(j=h.nextNode()){this.document.appendChild(j);j.nodeType==1&&!j.isEndTag()&&q.getScanner(j.tagName).scan(j,h,this.opts)}while(j);if(this.opts.autoParagraph){j=this.document;h=j.childNodes;var a,c,b=o.p,d=0;for(c=0;c<h.length;c++){a=h[c];if(a.nodeType==3||a.nodeType==1&&b[a.nodeName]){d=1;break}}if(d){d=[];var i=new n;
i.nodeName=i.tagName="p";for(c=0;c<h.length;c++){a=h[c];if(a.nodeType==3||a.nodeType==1&&b[a.nodeName])i.appendChild(a);else{if(i.childNodes.length){d.push(i);i=i.clone()}d.push(a)}}i.childNodes.length&&d.push(i);j.empty();for(c=0;c<d.length;c++)j.appendChild(d[c])}}j=this.document;h=[].concat(j.childNodes);for(a=0;a<h.length;a++)if(h[a].nodeName=="html"){c=h[a];for(b=0;b<a;b++)h[b].nodeType==3&&!k.trim(h[b].toHtml())&&j.removeChild(h[b]);for(;c.firstChild&&c.firstChild.nodeType==3&&!k.trim(c.firstChild.toHtml());)c.removeChild(c.firstChild);
break}return this.document.childNodes},parse:function(){return this.elements()}};return e},{requires:["./dtd","./nodes/Tag","./lexer/Cursor","./lexer/Lexer","./nodes/Document","./Scanner"]});KISSY.add("htmlparser/Scanner",function(k,o,n){return{getScanner:function(m){return n[m]||o}}},{requires:["./scanners/TagScanner","./scanners/SpecialScanners","./scanners/QuoteCdataScanner","./scanners/TextareaScanner"]});
KISSY.add("htmlparser/Utils",function(){return{collapseWhitespace:function(k){return k.replace(/[\s\xa0]+/g," ")},isLetter:function(k){return"a"<=k&&"z">=k||"A"<=k&&"Z">=k},isValidAttributeNameStartChar:function(k){return!this.isWhitespace(k)&&k!='"'&&k!="'"&&k!=">"&&k!="<"&&k!="/"&&k!="="},isWhitespace:function(k){return/^[\s\xa0]$/.test(k)}}});
KISSY.add("htmlparser/dtd",function(k){k=k.merge;var o={isindex:1,fieldset:1},n={input:1,button:1,select:1,textarea:1,label:1},m=k({a:1},n),g=k({iframe:1},m),f={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},q={ins:1,del:1,script:1,style:1},e=k({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},q),j=k({sub:1,img:1,object:1,sup:1,
basefont:1,map:1,applet:1,font:1,big:1,small:1},e),h=k({p:1},j);n=k({iframe:1},j,n);j={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,
address:1,q:1,pre:1,p:1,em:1,dfn:1};var a=k({a:1},n),c={tr:1},b={"#":1},d=k({param:1},j),i=k({form:1},o,g,f,h),p={li:1},l={base:1,link:1,meta:1,title:1},t=k(l,{style:1,script:1}),r={head:1,body:1},s={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},u={$nonBodyContent:k({html:1},r,l),$block:s,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:a,$body:k({script:1,style:1},s),$cdata:{script:1,
style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},
$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:r,head:t,style:b,body:i,base:{},link:{},meta:{},title:b,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:i,td:i,br:{},th:i,center:i,kbd:a,button:k(h,f),basefont:{},h5:a,h4:a,samp:a,h6:a,ol:p,h1:a,h3:a,option:b,h2:a,form:k(o,g,f,h),select:{optgroup:1,option:1},font:a,ins:a,menu:p,abbr:a,label:a,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:a,script:b,tfoot:c,cite:a,li:i,input:{},iframe:i,
strong:a,textarea:b,noframes:i,big:a,small:a,span:a,hr:{},dt:a,sub:a,optgroup:{option:1},param:{},bdo:a,"var":a,div:i,object:d,sup:a,dd:i,strike:a,area:{},dir:p,map:k({area:1,form:1,p:1},o,q,f),applet:d,dl:{dt:1,dd:1},del:a,isindex:{},fieldset:k({legend:1},j),thead:c,ul:p,acronym:a,b:a,a:n,blockquote:i,caption:a,i:a,u:a,tbody:c,s:a,address:k(g,h),tt:a,legend:a,q:a,pre:k(e,m),p:a,em:a,dfn:a};(function(){var v,w=["article","figure","nav","aside","section","footer"],x;for(x in u)for(var y in u[x])if(y==
"div")for(v=0;v<w.length;v++)u[x][w[v]]=u[x][y];for(v=0;v<w.length;v++)u[w[v]]=u.div;u.$empty["!doctype"]=1})();return u});KISSY.add("htmlparser/lexer/Cursor",function(){function k(o){this.position=o||0}k.prototype={advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return k});
KISSY.add("htmlparser/lexer/Index",function(){function k(){this.lineCursors=[]}function o(m,g){for(var f=0;f<m.length;f++)if(m[f].position===g.position)return f;return-1}function n(m,g){for(var f=0;f<m.length;f++)if(m[f].position>g.position)break;return f}k.prototype={add:function(m){o(this.lineCursors,m)==-1&&this.lineCursors.splice(n(this.lineCursors,m),0,m)},remove:function(m){var g=this.lineCursors;m=o(this.lineCursors,m);m!=-1&&g.splice(m,1)},row:function(m){return n(this.lineCursors,m)-1},col:function(m){var g=
n(this.lineCursors,m)-1;return m.position-this.lineCursors[g]}};return k});
KISSY.add("htmlparser/lexer/Lexer",function(k,o,n,m,g,f,q,e,j){function h(a){this.page=new n(a);this.cursor=new o;this.nodeFactory=this}h.prototype={setPosition:function(a){this.cursor.position=a},getPosition:function(){return this.cursor.position},nextNode:function(a){var c,b,d=this.cursor,i=this.page;c=d.position;b=i.getChar(d);switch(b){case -1:a=null;break;case "<":b=i.getChar(d);if(b==-1)a=this.makeString(c,d.position);else if(b=="/"||f.isLetter(b)){i.ungetChar(d);a=this.parseTag(c)}else if("!"==
b){b=i.getChar(d);if(b==-1)a=this.makeString(c,d.position);else if(">"==b)a=this.makeComment(c,d.position);else{i.ungetChar(d);if("-"==b)a=this.parseComment(c,a);else{i.ungetChar(d);a=this.parseTag(c)}}}else{i.ungetChar(d);a=this.parseString(c,a)}break;default:i.ungetChar(d);a=this.parseString(c,a)}return a},makeComment:function(a,c){var b;b=c-a;if(0!=b){if(2>b)return this.makeString(a,c);b=this.nodeFactory.createCommentNode(this.page,a,c)}else b=null;return b},makeString:function(a,c){var b=null;
if(c-a>0)b=this.nodeFactory.createStringNode(this.page,a,c);return b},makeCData:function(a,c){var b=null;if(c-a>0)b=this.nodeFactory.createCDataNode(this.page,a,c);return b},makeTag:function(a,c,b){var d;d=c-a;if(0!=d){if(2>d)return this.makeString(a,c);a=this.nodeFactory.createTagNode(this.page,a,c,b)}else a=null;return a},createTagNode:function(a,c,b,d){return new e(a,c,b,d)},createStringNode:function(a,c,b){return new m(a,c,b)},createCDataNode:function(a,c,b){return new g(a,c,b)},createCommentNode:function(a,
c,b){return new j(a,c,b)},parseTag:function(a){var c,b=[],d=[],i,p=this.page,l=0,t=this.cursor;for(b[0]=t.position;!c;){b[l+1]=t.position;i=p.getChar(t);switch(l){case 0:if(i==-1||">"==i||"<"==i){if("<"==i){p.ungetChar(t);b[l+1]=t.position}c=true}else if(d.length){if(f.isValidAttributeNameStartChar(i))l=1}else if(i=="/"||f.isValidAttributeNameStartChar(i))l=1;break;case 1:if(-1==i||">"==i||"<"==i){if("<"==i){p.ungetChar(t);b[l+1]=t.getPosition}this.standalone(d,b);c=true}else if(f.isWhitespace(i)){b[6]=
b[2];l=6}else if("="==i)l=2;break;case 2:if(-1==i||">"==i){this.standalone(d,b);c=true}else if("'"==i){l=4;b[4]=b[3]}else if('"'==i){l=5;b[5]=b[3]}else f.isWhitespace(i)||(l=3);break;case 3:if(-1==i||">"==i){this.naked(d,b);c=true}else if(f.isWhitespace(i)){this.naked(d,b);b[0]=b[4];l=0}break;case 4:if(-1==i){this.single_quote(d,b);c=true}else if("'"==i){this.single_quote(d,b);b[0]=b[5]+1;l=0}break;case 5:if(-1==i){this.double_quote(d,b);c=true}else if('"'==i){this.double_quote(d,b);b[0]=b[6]+1;l=
0}break;case 6:if(-1==i){this.standalone(d,b);b[0]=b[6];p.ungetChar(t);l=0}else if(!f.isWhitespace(i))if("="==i){b[2]=b[6];b[3]=b[7];l=2}else{this.standalone(d,b);b[0]=b[6];p.ungetChar(t);l=0}break;default:throw Error("how ** did we get in state "+l);}}return this.makeTag(a,t.position,d)},parseComment:function(a,c){var b,d,i=this.page,p=this.cursor,l;b=false;for(l=0;!b;){d=i.getChar(p);if(-1==d)b=true;else switch(l){case 0:if(">"==d)b=true;if("-"==d)l=1;else return this.parseString(a,c);break;case 1:if("-"==
d){d=i.getChar(p);if(-1==d)b=true;else if(">"==d)b=true;else{i.ungetChar(p);l=2}}else return this.parseString(a,c);break;case 2:if("-"==d)l=3;else if(-1==d)return this.parseString(a,c);break;case 3:l="-"==d?4:2;break;case 4:if(">"==d)b=true;else f.isWhitespace(d)||(l=2);break;default:throw Error("how ** did we get in state "+l);}}return this.makeComment(a,p.position)},parseString:function(a,c){for(var b=0,d,i=this.page,p=this.cursor,l=0;!b;){d=i.getChar(p);if(-1==d)b=1;else if(c&&0==l&&("'"==d||'"'==
d))l=d;else if(c&&0!=l&&"\\"==d){d=i.getChar(p);-1!=d&&"\\"!=d&&d!=l&&i.ungetChar(p)}else if(c&&d==l)l=0;else if(c&&0==l&&d=="/"){d=i.getChar(p);if(-1==d)b=1;else if("/"==d){do d=i.getChar(p);while(-1!=d&&"\n"!=d)}else if("*"==d){do{do d=i.getChar(p);while(-1!=d&&"*"!=d);d=i.getChar(p);d=="*"&&i.ungetChar(p)}while(-1!=d&&"/"!=d)}else i.ungetChar(p)}else if(0==l&&"<"==d){d=i.getChar(p);if(-1==d)b=1;else{if("/"==d||f.isLetter(d)||"!"==d){b=1;i.ungetChar(p)}i.ungetChar(p)}}}return this.makeString(a,
p.position)},parseCDATA:function(a,c){var b,d,i,p,l,t,r=this.cursor,s=this.page;b=r.position;d=0;i=false;p="";for(t=false;!i;){l=s.getChar(r);switch(d){case 0:switch(l){case -1:i=true;break;case "'":if(a&&!t)if(""==p)p="'";else if("'"==p)p="";break;case '"':if(a&&!t)if(""==p)p='"';else if('"'==p)p="";break;case "\\":if(a)if(""!=p){l=s.getChar(r);if(-1==l)i=true;else l!="\\"&&l!=p&&s.ungetChar(r)}break;case "/":if(a)if(""==p){l=s.getChar(r);if(-1==l)i=true;else if("/"==l)t=true;else if("*"==l){do{do l=
s.getChar(r);while(-1!=l&&"*"!=l);l=s.getChar(r);l=="*"&&s.ungetChar(r)}while(-1!=l&&"/"!=l)}else s.ungetChar(r)}break;case "\n":t=false;break;case "<":if(a){if(""==p)d=1}else d=1}break;case 1:switch(l){case -1:i=true;break;case "/":d=!c||s.getText(r.position,r.position+c.length)===c&&!s.getText(r.position+c.length,r.position+c.length+1).match(/\w/)?2:0;break;case "!":l=s.getChar(r);if(-1==l)i=true;else if("-"==l){l=s.getChar(r);if(-1==l)i=true;else d="-"==l?3:0}else d=0;break;default:d=0}break;case 2:t=
false;if(-1==l)i=true;else if(f.isLetter(l)){i=true;s.ungetChar(r);s.ungetChar(r);s.ungetChar(r)}else d=0;break;case 3:t=false;if(-1==l)i=true;else if("-"==l){l=s.getChar(r);if(-1==l)i=true;else if("-"==l){l=s.getChar(r);if(-1==l)i=true;else if(">"==l)d=0;else{s.ungetChar(r);s.ungetChar(r)}}else s.ungetChar(r)}break;default:throw Error("unexpected "+d);}}return this.makeCData(b,r.position)},single_quote:function(a,c){var b=this.page;a.push(new q(b.getText(c[1],c[2]),"=",b.getText(c[4]+1,c[5]),"'"))},
double_quote:function(a,c){var b=this.page;a.push(new q(b.getText(c[1],c[2]),"=",b.getText(c[5]+1,c[6]),'"'))},standalone:function(a,c){a.push(new q(this.page.getText(c[1],c[2])))},naked:function(a,c){var b=this.page;a.push(new q(b.getText(c[1],c[2]),"=",b.getText(c[3],c[4])))}};return h},{requires:["./Cursor","./Page","../nodes/Text","../nodes/CData","../Utils","../nodes/Attribute","../nodes/Tag","../nodes/Comment"]});
KISSY.add("htmlparser/lexer/Page",function(k,o){function n(m){this.source=m;this.lineIndex=new o}n.prototype={getChar:function(m){var g=this.source,f=m.position;if(f>=g.length)return-1;var q=g.charAt(f);m.advance();if("\r"===q){q="\n";f=m.position;g.charAt(f)==="\n"&&m.advance()}"\n"===q&&this.lineIndex.add(m);return q},ungetChar:function(m){var g=this.source;m.retreat();var f=m.position,q=g.charAt(f);if(q==="\n"&&0!=f){q=g.charAt(f-1);"\r"===q&&m.retreat()}},getText:function(m,g){return this.source.slice(m,
g)},row:function(m){return this.lineIndex.row(m)},col:function(m){return this.lineIndex.col(m)}};return n},{requires:["./Index"]});KISSY.add("htmlparser/nodes/Attribute",function(k){function o(n,m,g,f){this.nodeType=2;this.name=n;this.assignMent=m;this.value=g;this.quote=f}k.augment(o,{clone:function(){var n=new o;k.mix(n,this);return n},equals:function(n){return this.name==n.name&&this.value==n.value&&this.nodeType==n.nodeType}});o.prototype.clone=function(){var n=new o;k.mix(n,this);return n};return o});
KISSY.add("htmlparser/nodes/CData",function(k,o){function n(){n.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}k.extend(n,o,{writeHtml:function(m,g){var f=this.toHtml();if(!g||g.onCData(this)!==false)m.cdata(f)}});return n},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Comment",function(k,o){function n(){n.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}k.extend(n,o,{writeHtml:function(m,g){var f=this.toHtml();if(!g||g.onComment(this)!==false)m.comment(f)}});return n},{requires:["./Tag"]});KISSY.add("htmlparser/nodes/Document",function(k,o){function n(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}k.extend(n,o,{writeHtml:function(m,g){this._writeChildrenHtml(m,g)}});return n},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Node",function(k){function o(n,m,g){this.parentNode=null;this.page=n;this.startPosition=m;this.endPosition=g;this.nextSibling=this.previousSibling=this.nodeName=null;if(k.Config.debug)this.toHtmlContent=this.toHtml()}o.prototype={toHtml:function(){if(this.page&&this.page.getText)return this.page.getText(this.startPosition,this.endPosition)},toString:function(){var n=[];n.push(this.nodeName+"  ["+this.startPosition+":"+this.endPosition+"]\n");n.push(this.toHtml());return n.join("")}};
return o});
KISSY.add("htmlparser/nodes/Tag",function(k,o,n,m){function g(e,j,h,a){g.superclass.constructor.apply(this,arguments);this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=a||[];this.nodeType=1;a=this.attributes;if(a[0]){this.nodeName=a[0].name.toLowerCase();this.tagName=this.nodeName.replace(/\//,"");this.isSelfClosed=!!m.$empty[this.nodeName];if(!this.isSelfClosed)this.isSelfClosed=/\/$/.test(this.nodeName);a.splice(0,1)}var c=a[a.length-1];if(c=!!(c&&/\/$/.test(c.name)))a.length-=1;
this.closed=this.isSelfClosed=this.isSelfClosed||c;this.closedEndPosition=this.closedStartPosition=-1}function f(e){var j=e.childNodes;e.firstChild=j[0];e.lastChild=j[j.length-1];if(j.length>=1){j[0].nextSibling=j[0].nextSibling=null;j[0].parentNode=e}if(j.length>1){for(var h=0;h<j.length-1;h++){j[h].nextSibling=j[h+1];j[h+1].previousSibling=j[h];j[h+1].parentNode=e}j[j.length-1].nextSibling=null}}function q(e,j){for(var h=0;h<e.length;h++)if(e[h].name==j)return e[h];return null}k.extend(g,o,{clone:function(){var e=
new g,j=[];k.each(this.attributes,function(h){j.push(h.clone())});k.mix(e,{childNodes:[],firstChild:null,lastChild:null,attributes:j,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return e},equals:function(e){if(!e||this.nodeName!=e.nodeName)return 0;if(this.nodeType!=e.nodeType)return 0;if(this.attributes.length!=e.attributes.length)return 0;
for(var j=0;j<this.attributes.length;j++)if(!this.attributes[j].equals(e.attributes[j]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(e){this.childNodes.push(e);f(this)},insertBefore:function(e){var j=e.parentNode.childNodes,h=k.indexOf(e,j);j.splice(h,0,this);f(e.parentNode)},insertAfter:function(e){var j=e.parentNode.childNodes,h=k.indexOf(e,j);h==j.length-1?e.parentNode.appendChild(this):this.insertBefore(e.parentNode.childNodes[[h+1]])},empty:function(){this.childNodes=
[];f(this)},removeChild:function(e){var j=e.parentNode.childNodes,h=k.indexOf(e,j);j.splice(h,1);f(e.parentNode)},getAttribute:function(e){return(e=q(this.attributes,e))&&e.value},setAttribute:function(e,j){var h=q(this.attributes,e);if(h)h.value=j;else this.attributes.push(new n(e,"=",j,'"'))},removeAttribute:function(e){(e=q(this.attributes,e))&&this.attributes.splice(k.indexOf(e,this.attributes),1)},writeHtml:function(e,j){var h=this,a;a=h.tagName;if(a=="!doctype")e.append(this.toHtml()+"\n");
else{if(j){if(!(a=j.onTagName(a)))return;h.tagName=a;a=j.onTag(h);if(a===false)return;if(a)h=a;if(h.nodeType!==1){h.writeHtml(e,j);return}if(!h.tagName){k.each(h.childNodes,function(i){i.writeHtml(e,j)});return}}e.openTag(h);for(var c=h.attributes,b=0;b<c.length;b++){var d=c[b];a=d.name;if(j){if(!(a=j.onAttributeName(a)))continue;if(j.onAttribute(d)===false)continue}e.attribute(d,h)}e.openTagClose(h);if(!h.isSelfClosed){this._writeChildrenHtml(e,j);e.closeTag(h)}}},_writeChildrenHtml:function(e,j){k.each(this.childNodes,
function(h){h.writeHtml(e,j)})}});return g},{requires:["./Node","./Attribute","../dtd"]});KISSY.add("htmlparser/nodes/Text",function(k,o){function n(){n.superclass.constructor.apply(this,arguments);this.nodeType=3;this.nodeName="#text"}k.extend(n,o,{writeHtml:function(m,g){var f=this.toHtml();if(!g||g.onText(this)!==false)m.text(f)}});return n},{requires:["./Node"]});
KISSY.add("htmlparser/scanners/CdataScanner",function(){return{scan:function(k,o,n){n=o.parseCDATA(n.quoteSmart,k.nodeName);var m=o.getPosition(),g=o.nextNode();if(g)if(g.nodeType!=1||!(g.isEndTag()&&g.tagName==k.tagName))o.setPosition(m);k.closed=true;n&&k.appendChild(n)}}});KISSY.add("htmlparser/scanners/QuoteCdataScanner",function(k,o,n,m){k={scan:function(f,q,e){e=e||{};e.quoteSmart=1;o.scan(f,q,e);e.quoteSmart=0}};for(var g in n.$cdata)m[g]=k;return k},{requires:["./CdataScanner","../dtd","./SpecialScanners"]});
KISSY.add("htmlparser/scanners/SpecialScanners",function(){return{}});
KISSY.add("htmlparser/scanners/TagScanner",function(k,o,n,m){function g(e,j){function h(){if(b.childNodes.length){b.insertAfter(d);d=b;b=e.clone()}}e.closed=1;if(!j.fixByDtd)return 0;var a=1,c=[].concat(e.childNodes);k.each(c,function(s){if(!f(e,s)){a=0;return false}});if(a)return 0;for(var b=e.clone(),d=e,i=[],p=0;p<c.length;p++){var l=c[p];if(f(b,l))b.appendChild(l);else if(l.nodeType==1){var t=l.tagName;if(o.$listItem[t]){h();l=q[l.tagName];var r=new n;for(r.nodeName=r.tagName=l;p<c.length;){if(c[p].tagName==
t)r.appendChild(c[p]);else if(!(c[p].nodeType==3&&!k.trim(c[p].toHtml())))if(c[p].nodeType==3)break;p++}r.insertAfter(d);d=r;p--}else if(o.$inline[e.tagName]){h();if(l.equals(b)){l.insertAfter(d);d=l}else if(f(l,b)){b=e.clone();k.each(l.childNodes,function(s){b.appendChild(s)});l.empty();l.insertAfter(d);d=l;l.appendChild(b);i.push(b);b=e.clone()}else{l.insertAfter(d);d=l}}}}b.childNodes.length&&b.insertAfter(d);e.parentNode.removeChild(e);k.each(i,function(s){g(s,j)});return 1}function f(e,j){if(e.nodeType==
9)return 1;if(j.nodeType==8)return 1;var h=j.tagName||j.nodeName;if(j.nodeType==3)h="#";return!!o[e.tagName][h]}var q={li:"ul",dt:"dl",dd:"dl"};return{scan:function(e,j,h){var a,c,b;b=h.stack=h.stack||[];if(e.isSelfClosed)e.closed=true;else{do{if(a=j.nextNode())if(a.nodeType===1)if(a.isEndTag()&&a.tagName==e.tagName)a=null;else if(a.isEndTag()){if(a.isEndTag()){var d=-1;for(c=b.length-1;c>=0;c--)if(b[c].tagName===a.tagName){d=c;break}if(d!=-1){b[b.length-1].appendChild(e);g(e,h);for(c=b.length-1;c>
d;c--){e=b[c];b[c-1].appendChild(e);g(e,h)}e=b[d];b.length=d;a=null}}}else if(m[a.tagName]){m[a.tagName].scan(a,j,h);e.appendChild(a)}else if(a.isSelfClosed)e.appendChild(a);else{b.push(e);e=a}else e.appendChild(a);if(a==null)if(b.length>0){a=b[b.length-1];if(a.nodeType==1)if(m[a.tagName])a=null;else{b.length-=1;a.appendChild(e);g(e,h);e=a}else a=null}}while(a);g(e,h)}}}},{requires:["../dtd","../nodes/Tag","./SpecialScanners"]});
KISSY.add("htmlparser/scanners/TextareaScanner",function(k,o,n){return n.textarea={scan:function(m,g,f){f=f||{};o.scan(m,g,f)}}},{requires:["./CdataScanner","./SpecialScanners"]});
KISSY.add("htmlparser/writer/basic",function(){function k(){this.output=[]}k.prototype={append:function(){for(var o=this.output,n=arguments,m,g=0;g<n.length;g++){m=n[g];if(m.length>1)for(var f=0;f<m.length;f++)o.push(m.charAt(f));else o.push(m)}return this},openTag:function(o){this.append("<",o.tagName)},openTagClose:function(o){o.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(o){this.append("</",o.tagName,">")},attribute:function(o){this.append(" ",o.name,'="',(o.value||o.name).replace(/"/g,
"&quote;"),'"')},text:function(o){this.append(o)},cdata:function(o){this.append(o)},comment:function(o){this.append(o)},getHtml:function(){return this.output.join("")}};return k});
KISSY.add("htmlparser/writer/beautify",function(k,o,n,m){function g(){g.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var f in k.merge(n.$nonBodyContent,n.$block,n.$listItem,n.$tableContent,{select:1,script:1,style:1}))this.setRules(f,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}k.extend(g,o,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var f=this.output;if(!this.inPre&&f.length){for(var q=f.length-1;q>=0;q--)if(!/[\r\n\t ]/.test(f[q]))break;f.length=q+1;this.append("\n")}this.allowIndent=1},setRules:function(f,q){this.rules[f]||(this.rules[f]=
{});k.mix(this.rules[f],q)},openTag:function(f){var q=this.rules[f.tagName]||{};if(this.allowIndent)this.indentation();else if(q.breakBeforeOpen){this.lineBreak();this.indentation()}g.superclass.openTag.apply(this,arguments)},openTagClose:function(f){var q=f.tagName,e=this.rules[q]||{};if(f.isSelfClosed)this.append(" />");else{this.append(">");e.allowIndent&&this.indentLevel++}e.breakAfterOpen&&this.lineBreak();if(q==="pre")this.inPre=1},closeTag:function(f){var q=f.tagName,e=this.rules[q]||{};e.allowIndent&&
this.indentLevel--;if(this.allowIndent)this.indentation();else if(e.breakBeforeClose){this.lineBreak();this.indentation()}g.superclass.closeTag.apply(this,arguments);if(q==="pre")this.inPre=0;e.breakAfterClose&&this.lineBreak()},text:function(f){this.allowIndent&&this.indentation();this.inPre||(f=m.collapseWhitespace(f));this.append(f)},comment:function(f){this.allowIndent&&this.indentation();this.append(f)},cdata:function(f){this.allowIndent&&this.indentation();this.append(f)}});return g},{requires:["./basic",
"../dtd","../Utils"]});
KISSY.add("htmlparser/writer/filter",function(k){function o(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comments=[];this.texts=[];this.cdatas=[];this.attributes=[]}function n(g,f){for(var q=0;q<g.length;q++)k.each(g[q].value,function(e){f=f.replace(e[0],e[1])});return f}function m(g,f,q){for(var e=0;e<g.length;e++)if(g[e].value.apply(null,f)===false)return false;return q}o.prototype={addRules:function(g,f){f=f||10;for(var q in g){var e=this[q],j;a:{for(j=0;j<e.length;j++)if(e[j].priority>
f){j=j;break a}j=e.length}e.splice(j,0,{value:g[q],priority:f})}},onTagName:function(g){return n(this.tagNames,g)},onAttributeName:function(g){return n(this.attributeNames,g)},onText:function(g){return m(this.texts,[g.toHtml(),g],g)},onCData:function(g){return m(this.cdatas,[g.toHtml(),g],g)},onAttribute:function(g,f){return m(this.attributes,[f,g],f)},onComment:function(g){return m(this.comments,[g.toHtml(),g],g)},onNode:function(g){var f=g.nodeType;if(f===1)return this.onTag(g);else if(f===3)return this.onText(g.toHtml(),
g);else if(f===8)return this.onComment(g.toHtml(),g)},onTag:function(g){for(var f=["^",g.tagName,"$"],q=this.tags,e,j=0;j<f.length;j++)for(var h=f[j],a=0;a<q.length;a++){var c=q[a].value;if(c[h]){if((e=c[h](g))===false)return false;if(e&&e!=c)return this.onNode(e);if(!g.name)return g}}return g}};return o});
KISSY.add("htmlparser/writer/minify",function(k,o,n){function m(h){return h.replace(/"/g,"&quote;")}function g(h,a){var c=h.nodeName,b=a.name,d=a.value||"";if(/^on[a-z]+/.test(b))d=q(d).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,"");else if(b==="class")d=e(q(d));else if(/^(?:a|area|link|base)$/.test(c)&&b==="href"||c==="img"&&/^(?:src|longdesc|usemap)$/.test(b)||c==="object"&&/^(?:classid|codebase|data|usemap)$/.test(b)||c==="q"&&b==="cite"||c==="blockquote"&&b==="cite"||(c==="ins"||
c==="del")&&b==="cite"||c==="form"&&b==="action"||c==="input"&&(b==="src"||b==="usemap")||c==="head"&&b==="profile"||c==="script"&&(b==="src"||b==="for")||/^(?:a|area|object|button)$/.test(c)&&b==="tabindex"||c==="input"&&(b==="maxlength"||b==="tabindex")||c==="select"&&(b==="size"||b==="tabindex")||c==="textarea"&&/^(?:rows|cols|tabindex)$/.test(b)||c==="colgroup"&&b==="span"||c==="col"&&b==="span"||(c==="th"||c=="td")&&(b==="rowspan"||b==="colspan"))d=q(d);else if(b==="style")d=q(d).replace(/[\s\xa0]*;[\s\xa0]*$/,
"");return d}function f(){f.superclass.constructor.apply(this,arguments);this.inPre=0}var q=k.trim,e=n.collapseWhitespace,j=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");k.extend(f,o,{comment:function(h){if(/\[if[^\]]+\]/.test(h)){h=h.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1");f.superclass.comment.call(this,h)}},openTag:function(h){if(h.tagName=="pre")this.inPre=1;f.superclass.openTag.apply(this,
arguments)},closeTag:function(h){if(h.tagName=="pre")this.inPre=0;f.superclass.closeTag.apply(this,arguments)},cdata:function(h){h=q(h).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");f.superclass.cdata.call(this,h)},attribute:function(h,a){var c=h.name,b=h.value||"",d;d=h.name;d=q(h.value||"")?0:a==="input"&&d==="value"||j.test(d);if(!(d=d)){d=a.nodeName;var i=h.name,
p=h.value||"";p=q(p.toLowerCase());d=d==="script"&&i==="language"&&p==="javascript"||d==="form"&&i==="method"&&p==="get"||d==="input"&&i==="type"&&p==="text"||d==="script"&&i==="type"&&p==="text/javascript"||d==="style"&&i==="type"&&p==="text/css"||d==="area"&&i==="shape"&&p==="rect"}if(!d)if(/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(c))this.append(" ",c);else!/[ "'=<>`]/.test(b)?this.append(" ",c,"=",m(g(a,h))):this.append(" ",c,
'="',m(g(a,h)),'"')},text:function(h){this.inPre||this.append(e(h))}});return f},{requires:["./basic","../Utils"]});KISSY.add("htmlparser",function(k,o,n,m,g,f,q){return{Lexer:o,Parser:n,BasicWriter:m,BeautifyWriter:g,MinifyWriter:f,Filter:q}},{requires:["htmlparser/lexer/Lexer","htmlparser/Parser","htmlparser/writer/basic","htmlparser/writer/beautify","htmlparser/writer/minify","htmlparser/writer/filter"]});
