KISSY.add("brix/gallery/searchbox/index",function(e,t){function i(){i.superclass.constructor.apply(this,arguments)}return i.ATTRS={el:{value:"#J_searchbox"},currentCls:{value:"selected"},suggestApi:{value:"data-suggest-api"},curItem:{value:{},getter:function(){return e.one(this.get("el")).one("."+this.get("currentCls"))}},menu:{value:{}},form:{value:{}},suggest:{value:{}}},i.DOCEVENTS={"":{click:function(t){var i=this,a=e.one(t.target);i.get("el").contains(a)||(i.hideTabs(),i.fire("afterBlur"))}}},i.EVENTS={".s-menu":{mouseenter:function(t){t.preventDefault();var i=e.one(t.currentTarget);i.one(".s-menu-list"),i.addClass("expand")},mouseleave:function(t){t.preventDefault();var i=e.one(t.currentTarget);i.one(".s-menu-list"),i.removeClass("expand")}},".s-menu-list li":{click:function(t){var i=this,a=e.one(t.currentTarget),n=i.get("currentCls");if(i.fire("beforeTabChange",{eventData:t.currentTarget}),!a.hasClass(n)){var r=i.get("el").all("li"),o=i.get("el").one(".s-menu-selected span");r.removeClass(n),a.addClass(n),o.html(a.one("a").html()),i.menu.removeClass("expand"),""!==i.ipt.getDOMNode().value&&i._fireEvent(i.form.getDOMNode(),"submit")}}},".searchbox-input":{focus:function(t){var i=this,a=t.currentTarget,n=i.get("curItem").attr(i.get("suggestApi"));i.suggestApi&&i.suggestApi!==n&&(i.detach(t.type,arguments.callee),i.suggest.on("beforeStart",function(){return!1}),i.suggest=void 0),!n||i.suggestApi&&i.suggestApi===n||e.use("suggest",function(){i._initSuggest(a,n)}),i.suggestApi=n,i.showTabs(),i.fire("afterFocus",{eventData:a})}},form:{submit:function(e){var t=this;t.fire("beforeSubmit",{eventData:e.target});var i=t.get("curItem").one("a");if(""===t.ipt.getDOMNode().value)e.halt(!0),t.focusInput();else{var a=i.attr("href"),n=e.target;n.action=a,t._parseAction(n,a)}}}},i.METHODS={showTabs:function(){var e=this;e.form.addClass("s-focus")},hideTabs:function(){var e=this;e.form.removeClass("s-focus")},focusInput:function(){var e=this;e.ipt.getDOMNode().focus()}},i.FIRES={afterLoad:"afterLoad",beforeTabChange:"beforeTabChange",beforeSubmit:"beforeSubmit",afterFocus:"aferFocus",afterBlur:"afterBlur"},e.extend(i,t,{initialize:function(){var e=this;e.menu=e.get("el").one(".s-menu"),e.form=e.get("el").one("form"),e.ipt=e.get("el").one(".searchbox-input"),e.fire("afterLoad")},destructor:function(){},_parseAction:function(t,i){if(-1!==i.indexOf("?"))for(var a=i.substring(i.indexOf("?")+1,i.length).split("&"),n=0,r=a.length;r>n;n++)if(""!==e.trim(a[n])){var o=a[n].split("=");this._writeHiddenInput(t,o[0],o[1])}},_writeHiddenInput:function(t,i,a){var n=t[i];return n?n.value=a:(n=e.DOM.create('<input type="hidden" name="'+i+'" value="'+a+'" />'),t.appendChild(n)),n},_initSuggest:function(t,i){var a=this;a.suggest=new e.Suggest(t,i,{resultFormat:"%result%",offset:0}),a.suggest.on("beforeShow",function(){a._keyword()}),a.suggest.on("itemSelect",function(){var t=e.DOM,i=this.selectedItem,n=t.query("li",this.containers),r=e.get("form",a.get("el"));a._writeHiddenInput(r,"wq",t.attr(i,"key")),a._writeHiddenInput(r,"suggest","0_"+e.indexOf(i,n))}),a.suggest.on("beforeSubmit",function(){return""===t.value?!1:void 0})},_keyword:function(){var t=e.DOM,i=this,a=i.suggest,n=a.query,r=n.length;e.each(t.query("li",a.content),function(e){var i=t.get(".ks-suggest-key",e),a=t.html(i);0===a.indexOf(n)&&t.html(i,a.substring(0,r)+"<b>"+a.substring(r,a.length)+"</b>")})},_fireEvent:function(e,t){if(document.createEvent){var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!0),e.dispatchEvent(i)}else if(document.createEventObject){var i=document.createEventObject();e.fireEvent("on"+t,i)}}}),e.augment(i,i.METHODS),i},{requires:["brix/core/brick"]});