(function(){if(top!==self&&!top.ETao.needRefresh)try{top.ETao.loginSuccess&&top.ETao.loginSuccess()}catch(e){}})(),KISSY.add("brix/gallery/login/index",function(e,t,i,a){var n=e.DOM,r=e.Event,o=a.extend({bindUI:function(){var e=this,t=e.get("panel");r.delegate(t?t:"body",e.get("triggerType"),e.get("trigger"),function(t){var i=e.get("redirect_url"),a=e.get("needRefresh");if(!(e.checkTrueLogin()||e.get("isCheckLongOrTrueLogin")&&e.checkLongOrTrueLogin())){t.preventDefault();var n=e.get("isRedirectToA")?t.currentTarget.href:i;e.show({redirect_url:n,needRefresh:a})}})},destructor:function(){}});return o.ATTRS={trigger:{value:".J-EtaoLogin"},triggerType:{value:"click"},panel:{value:"body"},redirect_url:{value:window.location.href},loginType:{value:"taobao"},isRedirectToA:{value:!1},isCheckLongOrTrueLogin:{value:!0},needRefresh:{value:!0},mask:{value:!0}},o.EVENTS={},o.METHODS={checkTrueLogin:function(){var e="true"==t.get("login"),i=t.get("_nk_"),a=t.get("a_nk");return e&&(i||a)},checkLongOrTrueLogin:function(){var e=this,i=t.get("tracknick"),a=t.get("ck1");return e.checkTrueLogin()||i&&a},eHandler:function(){},show:function(){var t=this,a=t.get("loginType"),o=t.get("redirect_url");if(t.get("needRefresh"),t.login){KISSY.ChangeIframeSrc(o,a);var s=n.viewportHeight()/2-200+n.scrollTop(),l=n.viewportWidth()/2-171+n.scrollLeft();n.css(".etaologin-overlay",{top:0>s?0:s,left:0>l?0:l}),t.login.show(),e.Stat&&e.Stat("click="+n.attr("#J_LoginPopup","login-stat")+pre)}else{var c=(-1===window.location.href.indexOf("etao.net")?"login.etao.com":"i.daily.etao.net","http://zixi.etao.com/brix/demo/gallery/login/popup.php");e.getScript(c,function(){var a=new i({prefixCls:"etaologin-",width:342,height:500,mask:t.get("mask"),zIndex:10001});a.render(),a.get("contentEl").html(window.LoginPopupHtml,!0);var o=n.viewportHeight()/2-200+n.scrollTop(),s=n.viewportWidth()/2-171+n.scrollLeft();n.css(".etaologin-overlay",{top:0>o?0:o,left:0>s?0:s}),a.show(),t.login=a;var l=e.guid();t.id=l,a.get("el")[0].id=l,r.on(".J_CloseLoginBtn","click",function(){a.hide(),n.css(".etaologin-overlay",{top:"-9999px"})}),e.Stat&&e.Stat("click="+n.attr("#J_LoginPopup","login-stat")+pre),r.delegate("#"+l,"click","a",function(t){t.preventDefault();var i=t.currentTarget;e.LoginChange(i),e.Stat&&("J_TaobaoMember"===i.id?e.Stat("click="+n.attr("#J_TaobaoMember","login-stat")+pre):e.Stat("click="+n.attr("#J_AlipayMember","login-stat")+pre))})},"utf-8")}}},e.augment(o,o.METHODS),o},{requires:["cookie","overlay","brix/core/brick"]});