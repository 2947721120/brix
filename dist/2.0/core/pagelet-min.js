KISSY.add("brix/core/pagelet",function(a,b){function c(b){if(!b.attr("id")){var c;while((c=a.guid("brix_brick_"))&&a.one("#"+c));b.attr("id",c)}return b.attr("id")}var d=b.extend({initializer:function(){var a=this;a.isReady=!1,a.readyList=[],a.bricks=[],a.isAddBehavior=!1,a.destroyed=!1},bindUI:function(){var a=this,b=a.get("callback");b&&typeof b=="function"&&a.ready(b),a.get("autoBehavior")&&a.addBehavior()},getBrick:function(b){var c=this,d;return a.each(c.bricks,function(a){if(a.id===b)return d=a.brick,!1}),d||null},destroyBrick:function(a){var b=this;for(var c=0;c<b.bricks.length;c++){var d=b.bricks[c];if(a===d.id)return b._bx_destroyBrick(d),b.bricks.splice(c,1),!1}},_bx_destroyBrick:function(a){a.destroyed=!0,a.brick&&(a.brick.destroy&&a.brick.destroy(),a.brick=null)},addBehavior:function(){var a=this;if(a.get("rendered")&&!a.isAddBehavior){a.isAddBehavior=!0;var b=a.get("el"),c=b.all("[bx-name]");b.hasAttr("bx-name")&&(c=b.add(c)),a._bx_addBehavior(c,function(b){a.bricks=b},function(){a._bx_fireReady(),a.on("beforeRefreshTmpl",function(b){b.node.all("[bx-name]").each(function(b){a.destroyBrick(b.attr("id"))})}),a.on("afterRefreshTmpl",function(b){a._bx_addBehavior(b.node.all("[bx-name]"),function(b){b.length>0&&(a.bricks=a.bricks.concat(b))})})})}},_bx_addBehavior:function(b,d,e){var f=this,g=f.get("config"),h=[];b.each(function(b){var d=c(b),e=b.attr("bx-name"),f=b.attr("bx-path"),i=b.attr("bx-config");i=i?(new Function("return "+i))():{},g&&g[d]&&a.mix(i,g[d]),h.push({id:d,name:e,path:f,config:i})});if(h.length>0){var i=[];a.each(h,function(b){b.path||(b.path="brix/gallery/"+b.name+"/"),a.inArray(i,b.path)||i.push(b.path)}),f.fire("beforeAddBehavior",{useList:i}),d&&d(h),a.use(i.join(","),function(a){if(f.destroyed)return;var b=arguments;a.each(h,function(c){if(!c.destroyed){var d=c.id,e=a.merge({container:"#"+d,el:"#"+d,pagelet:f},c.config),g=b[a.indexOf(c.path,i)+1],h=new g(e);c.brick=h}}),b=null,e&&e()})}else d&&d(h),e&&e()},ready:function(a){this.isReady?a.call(window,this):this.readyList.push(a)},_bx_fireReady:function(){var a=this;if(a.isReady)return;a.isReady=!0;if(a.readyList){var b,c=0;while(b=a.readyList[c++])b.call(a);a.readyList=null}},destructor:function(){var b=this;a.each(b.bricks,function(a,c){b._bx_destroyBrick(a)}),b.bricks=null;if(b.get("rendered")){var c=b.get("destroyAction"),d=b.get("el");switch(c){case"remove":d.remove();break;case"empty":d.empty()}d=null}b.destroyed=!0}},{ATTRS:{autoBehavior:{value:!0},callback:{value:null},config:{value:{}}}},"Pagelet");return d},{requires:["./chunk"]});