KISSY.add("brix/core/mustache",function(){var e="undefined"!=typeof module&&module.exports||{};return function(e){function n(e){return v.test(e)}function t(e){return(e+"").replace(/&(?!\w+;)|[<>"']/g,function(e){return k[e]||e})}function r(e,n,t,r){r=r||"<template>";for(var a,i=n.split("\n"),o=Math.max(t-3,0),c=Math.min(i.length,t+3),u=i.slice(o,c),f=0,l=u.length;l>f;++f)a=f+o+1,u[f]=(a===t?" >> ":"    ")+u[f];return e.template=n,e.line=t,e.file=r,e.message=[r+":"+t,u.join("\n"),"",e.message].join("\n"),e}function a(e,n,t){if("."===e)return n[n.length-1];for(var r,a,i,o,c=e.split("."),u=c.length-1,f=c[u],l=n.length;l;){for(o=n.slice(0),a=n[--l],i=0;u>i&&(a=a[c[i++]],null!=a);)o.push(a);if(a&&"object"==typeof a&&f in a){r=a[f];break}}return"function"==typeof r&&(r=r.call(o[o.length-1])),null==r?t:r}function i(e,n,t,r){var i="",o=a(e,n);if(r)(null==o||o===!1||s(o)&&0===o.length)&&(i+=t());else if(s(o))m(o,function(e){n.push(e),i+=t(),n.pop()});else if("object"==typeof o)n.push(o),i+=t(),n.pop();else if("function"==typeof o){var c=n[n.length-1],u=function(e){return l(e,c)};i+=o.call(c,t(),u)||""}else o&&(i+=t());return i}function o(t,a){a=a||{};for(var i,o,c,u,f,l=a.tags||e.tags,s=l[0],p=l[l.length-1],h=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],g=[],b=!1,m=!1,v=function(){if(!b||m||a.space)g=[];else for(;g.length;)h.splice(g.pop(),1);b=!1,m=!1},x=[],y=function(e){l=d(e).split(/\s+/),o=l[0],c=l[l.length-1]},k=function(e){h.push('";',i,'\nvar partial = partials["'+d(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},S=function(e,n){var o=d(e);if(""===o)throw r(Error("Section name may not be empty"),t,$,a.file);x.push({name:o,inverted:n}),h.push('";',i,'\nvar name = "'+o+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},w=function(e){S(e,!0)},j=function(e){var n=d(e),i=0!=x.length&&x[x.length-1].name;if(!i||n!=i)throw r(Error('Section named "'+n+'" was never opened'),t,$,a.file);var o=x.pop();h.push('";',"\n    return buffer;","\n  };","\n})();"),o.inverted?h.push("\nbuffer += renderSection(name,stack,callback,true);"):h.push("\nbuffer += renderSection(name,stack,callback);"),h.push('\nbuffer += "')},E=function(e){h.push('";',i,'\nbuffer += lookup("'+d(e)+'",stack,"");','\nbuffer += "')},P=function(e){h.push('";',i,'\nbuffer += escapeHTML(lookup("'+d(e)+'",stack,""));','\nbuffer += "')},$=1,A=0,_=t.length;_>A;++A)if(t.slice(A,A+s.length)===s){switch(A+=s.length,u=t.substr(A,1),i="\nline = "+$+";",o=s,c=p,b=!0,u){case"!":A++,f=null;break;case"=":A++,p="="+p,f=y;break;case">":A++,f=k;break;case"#":A++,f=S;break;case"^":A++,f=w;break;case"/":A++,f=j;break;case"{":p="}"+p;case"&":A++,m=!0,f=E;break;default:m=!0,f=P}var O=t.indexOf(p,A);if(-1===O)throw r(Error('Tag "'+s+'" was not closed properly'),t,$,a.file);var T=t.substring(A,O);f&&f(T);for(var R=0;~(R=T.indexOf("\n",R));)$++,R++;A=O+p.length-1,s=o,p=c}else switch(u=t.substr(A,1)){case'"':case"\\":m=!0,h.push("\\"+u);break;case"\r":break;case"\n":g.push(h.length),h.push("\\n"),v(),$++;break;default:n(u)?g.push(h.length):m=!0,h.push(u)}if(0!=x.length)throw r(Error('Section "'+x[x.length-1].name+'" was not closed properly'),t,$,a.file);v(),h.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var I=h.join("").replace(/buffer \+= "";\n/g,"");return a.debug&&("undefined"!=typeof console&&console.log?console.log(I):"function"==typeof print&&print(I)),I}function c(e,n){var c="view,partials,stack,lookup,escapeHTML,renderSection,render",u=o(e,n),f=Function(c,u);return function(o,c){c=c||{};var u=[o];try{return f(o,c,u,a,t,i,l)}catch(s){throw r(s.error,e,s.line,n.file)}}}function u(){S={}}function f(e,n){return n=n||{},n.cache!==!1?(S[e]||(S[e]=c(e,n)),S[e]):c(e,n)}function l(e,n,t){return f(e)(n,t)}e.name="mustache.js",e.version="0.5.0-dev",e.tags=["{{","}}"],e.parse=o,e.compile=f,e.render=l,e.clearCache=u,e.to_html=function(e,n,t,r){var a=l(e,n,t);return"function"!=typeof r?a:(r(a),void 0)};var s,p=Object.prototype.toString,h=Array.isArray,g=Array.prototype.forEach,b=String.prototype.trim;s=h?h:function(e){return"[object Array]"===p.call(e)};var m;m=g?function(e,n,t){return g.call(e,n,t)}:function(e,n,t){for(var r=0,a=e.length;a>r;++r)n.call(t,e[r],r,e)};var d,v=/^\s*$/;if(b)d=function(e){return null==e?"":b.call(e)};else{var x,y;n("\u00a0")?(x=/^\s+/,y=/\s+$/):(x=/^[\s\xA0]+/,y=/[\s\xA0]+$/),d=function(e){return null==e?"":(e+"").replace(x,"").replace(y,"")}}var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},S={}}(e),e});