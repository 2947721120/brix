KISSY.add("brix/core/demolet",function(e,t,r,n){function a(e){return s[e]?!1:(s[e]=!0,r({url:e,dataType:"text",async:!1,complete:function(e,t){"success"==t&&o("<style>"+e+"</style>").appendTo("head")}}),void 0)}function i(t,n,a){a=a||"@",n=n||{};var i=RegExp("\\{\\{"+a+"(.+)?\\}\\}","ig");return t=t.replace(i,function(t,a){e.log(a);var i="",o=a.replace(/\//gi,"_").replace(/\./gi,"_");return n[o]=n[o]||{},r({url:a+"template.html",dataType:"html",async:!1,success:function(e){i="{{#"+o+"}}"+e+"{{/"+o+"}}"}}),r({url:a+"data.json",async:!1,dataType:"json",success:function(e){for(var t in e)n[o][t]=e[t]}}),i}),{tmpl:t,data:n}}var o=n.all,s={},c=t.extend({initializer:function(){var t=this;t.on("beforeAddBehavior",function(r){e.each(t.get("projectCSS"),function(e){a(e)});var n=r.useList;e.each(n,function(t){if(e.startsWith(t,"brix/"))e.use(t+"index.css");else{var r=3;e.startsWith(t,"imports/")&&(r=5);var n=t.split("/");n.length>r&&(n.splice(n.length-2),a(n.join("/")+"/index.css")),a(t.substring(0,t.lastIndexOf("/"))+"/index.css")}})})}},{ATTRS:{projectCSS:{value:[],setter:function(t){return e.isArray(t)?t:[t]}},s:{value:"@"},tmpl:{setter:function(e){var t=this,r=t.get("data")||{},n=i(e,r,t.get("s"));return t.set("data",n.data),n.tmpl}}}},"Demolet");return c},{requires:["./pagelet","ajax","node"]});