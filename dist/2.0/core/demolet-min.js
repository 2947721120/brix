KISSY.add("brix/core/demolet",function(e,t,r,n){function i(e){return o[e]?!1:(o[e]=!0,r({url:e,dataType:"text",async:!1,complete:function(e,t){"success"==t&&s("<style>"+e+"</style>").appendTo("head")}}),void 0)}function a(t,n,i){i=i||"@",n=n||{};var a=RegExp("\\{\\{"+i+"(.+)?\\}\\}","ig");return t=t.replace(a,function(t,i){e.log(i);var a="",s=i.replace(/\//gi,"_").replace(/\./gi,"_");return n[s]=n[s]||{},r({url:i+"template.html",dataType:"html",async:!1,success:function(e){a="{{#"+s+"}}"+e+"{{/"+s+"}}"}}),r({url:i+"data.json",async:!1,dataType:"json",success:function(e){for(var t in e)n[s][t]=e[t]}}),a}),{tmpl:t,data:n}}var s=n.all,o={},c=t.extend({initializer:function(){var t=this;t.on("beforeAddBehavior",function(r){e.each(t.get("projectCSS"),function(e){i(e)});var n=r.useList;e.each(n,function(t){if(e.startsWith(t,"brix/"))e.use(t+"index.css");else{var r=3;e.startsWith(t,"imports/")&&(r=5);var n=t.split("/");n.length>r&&(n.splice(n.length-2),i(n.join("/")+"/index.css")),i(t.substring(0,t.lastIndexOf("/"))+"/index.css")}})})}},{ATTRS:{projectCSS:{value:[],setter:function(t){return e.isArray(t)?t:[t]}},s:{value:"@"},tmpl:{setter:function(e){var t=this,r=t.get("data")||{},n=a(e,r,t.get("s"));return t.set("data",n.data),n.tmpl}}}},"Demolet");return c},{requires:["./pagelet","ajax","node"]});