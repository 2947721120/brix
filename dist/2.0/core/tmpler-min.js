KISSY.add("brix/core/tmpler",function(a,b,c){function e(a,b){this.tmpls=[],a&&b!==!1?this._praseTmpl(a,b):this.tmpl=a}var d=c.all;return a.augment(e,{_praseTmpl:function(a,b){var c=this,e=!1,f,g;if(typeof a=="string"){if(a.charAt(0)==="."||a.charAt(0)==="#"||a==="body")f=d(a)}else f=a;f&&(f.item(0)[0].nodeName.toUpperCase()=="SCRIPT"?a=f.item(0).html():e=!0);if(!e){var h="<([\\w]+)\\s+[^>]*?bx-tmpl=[\"']?([^\"'\\s]+)[\"']?\\s+[^>]*?bx-datakey=[\"']?([^\"'\\s]+)[\"']?[^>]*?>(@brix@)</\\1>";while(b--)h=h.replace("@brix@","(?:<\\1[^>]*>@brix@</\\1>|[\\s\\S])*?");h=h.replace("@brix@","(?:[\\s\\S]*?)"),c.reg=h,c.tmpl=a,c._buildTmpls(c.tmpl)}c.inDom=e},_buildTmpls:function(a){var b=this,c=new RegExp(b.reg,"ig"),d;while((d=c.exec(a))!==null)b.tmpls.push({name:d[2],datakey:d[3],tmpler:new e(d[4],!1)}),b._buildTmpls(d[4])},addTmpl:function(a,b,c){var d=this;d.tmpls.push({name:a,datakey:b,tmpler:new e(c,!1)})},getTmpl:function(){return this.tmpl},to_html:function(a){return(new b(this.getTmpl())).render(a)}}),e},{requires:["xtemplate","node","sizzle"]});