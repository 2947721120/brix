KISSY.add("brix/core/tmpler",function(e,n,t){function r(e,n){this.tmpls=[],e&&n!==!1?this._bx_praseTmpl(e,n):this.tmpl=e}var a=t.all;return e.augment(r,{_bx_praseTmpl:function(e,n){var t,r=this,i=!1;if("string"==typeof e?("."===e.charAt(0)||"#"===e.charAt(0)||"body"===e)&&(t=a(e)):t=e,t&&("SCRIPT"==t.item(0)[0].nodeName.toUpperCase()?e=t.item(0).html():i=!0),!i){for(var o="<([\\w]+)\\s+[^>]*?bx-tmpl=[\"']?([^\"'\\s]+)[\"']?\\s+[^>]*?bx-datakey=[\"']?([^\"'\\s]+)[\"']?[^>]*?>(@brix@)</\\1>";n--;)o=o.replace("@brix@","(?:<\\1[^>]*>@brix@</\\1>|[\\s\\S])*?");o=o.replace("@brix@","(?:[\\s\\S]*?)"),r.reg=o,r.tmpl=e,r._bx_buildTmpls(r.tmpl)}r.inDom=i},_bx_buildTmpls:function(e){for(var n,t=this,a=RegExp(t.reg,"ig");null!==(n=a.exec(e));)t.tmpls.push({name:n[2],datakey:n[3],tmpler:new r(n[4],!1)}),t._bx_buildTmpls(n[4])},addTmpl:function(e,n,t){var a=this;a.tmpls.push({name:e,datakey:n,tmpler:new r(t,!1)})},getTmpl:function(){return this.tmpl},render:function(e){return"function"==typeof n?new n(this.getTmpl()).render(e):n.render(this.getTmpl(),e)}}),r},{requires:[Brix.templateEngine,"node","sizzle"]});