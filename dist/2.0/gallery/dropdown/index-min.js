KISSY.add("brix/gallery/dropdown/index",function(e,t){function i(){i.superclass.constructor.apply(this,arguments)}return i.ATTRS={mode:{value:1},autoResize:{value:!0},setDefault:{value:!1}},i.FIRES={beforeFocus:"beforeFocus",focus:"focus",beforeBlur:"beforeBlur",blur:"blur",selected:"selected"},i.METHODS={focus:function(){var e=this.get("mode"),t=this.get("el"),n=t.one(".dropdown-list");if("none"===n.css("display")){if(this.fire(i.FIRES.beforeFocus),1==e&&t.one(".dropdown-hd").addClass("dropdown-hd-active"),n.css({display:"block"}),this.get("autoResize")){var a=t.one(".dropdown-hd").outerWidth();t.one(".dropdown-list").css({width:a+"px"})}this.fire(i.FIRES.focus)}},blur:function(){var e=this.get("mode"),t=this.get("el"),n=t.one(".dropdown-list");"none"!==n.css("display")&&(t.all(".dropdown-item").removeClass(".dropdown-itemover"),this.fire(i.FIRES.beforeBlur),1==e&&t.one(".dropdown-hd").removeClass("dropdown-hd-active"),n.css("display","none"),this.fire(i.FIRES.blur))},select:function(e){var t,i=this,n=this.get("el"),a=n.all(".dropdown-item");a.each(function(i){var n=i.one("span"),a=n.attr("value")||"";return a==e?(t=i,!1):void 0}),t&&i._select(t)}},i.DOCEVENTS={"":{click:function(e){var t=this,i=t.get("el");t.__show||i.contains(e.target)||(i.all(".dropdown-list").css("display","none"),i.all(".dropdown-hd").removeClass("dropdown-hd-active")),t.__show=!1}}},i.EVENTS={"":{mouseleave:function(){var e=this.get("mode");1!=e&&this.blur()},keydown:function(e){var t=this,i=t.get("el");switch(e.keyCode){case 9:case 27:t.blur();break;case 13:t.__show=!0;var n=i.one(".dropdown-itemover");if(t.blur(),!n||n.hasClass("dropdown-itemselected"))return;t._select(n);break;case 38:e.preventDefault(),t.focus();var a,r=i.one(".dropdown-itemover")||i.one(".dropdown-itemselected")||i.one(".dropdown-item");if(r.prev())a=r.prev();else{var o=i.all(".dropdown-item");a=o.item(o.length-1)}t._hover(a,!0);break;case 40:e.preventDefault(),t.focus();var a,r=i.one(".dropdown-itemover")||i.one(".dropdown-itemselected")||i.one(".dropdown-item");a=r.next()?r.next():i.one(".dropdown-item"),t._hover(a,!0);break;default:var s=e.keyCode;if(s>=48&&57>=s||s>=65&&90>=s){var l=String.fromCharCode(s).toLowerCase();e.preventDefault(),t.focus();var a,r=i.one(".dropdown-itemover")||i.one(".dropdown-itemselected");r&&r.one("span").text().charAt(0).toLowerCase()==l&&(r=r.next(),r&&r.one("span").text().charAt(0).toLowerCase()==l&&(a=r)),a||i.all(".dropdown-item").each(function(e){return!e||e.hasClass(".dropdown-itemover")||e.hasClass(".dropdown-itemselected")||e.one("span").text().charAt(0).toLowerCase()!=l?void 0:(a=e,!1)}),a&&t._hover(a,!0)}}}},".dropdown-hd":{click:function(){var e=this.get("mode");if(1==e){var t=this.get("el").one(".dropdown-list");this.__show=!0,"block"==t.css("display")?this.blur():this.focus()}},mouseenter:function(){var e=this.get("mode");1!=e&&this.focus()}},".dropdown-item":{click:function(t){var i=this;i.__show=!0,i.get("el");var n=e.one(t.currentTarget);i.blur(),n.hasClass("dropdown-itemselected")||i._select(n)},mouseenter:function(t){var i=e.one(t.currentTarget);this._hover(i)},mouseleave:function(t){var i=e.one(t.currentTarget);i.removeClass("dropdown-itemover")}}},e.extend(i,t,{initialize:function(){var e=this,t=this.get("el");if(t.attr("tabindex",0),e.get("setDefault")){var i=t.one(".dropdown-itemselected")||t.one(".dropdown-item");e._select(i,!0)}},_select:function(e,t){var n=this,a=this.get("el");a.all(".dropdown-item").removeClass(".dropdown-itemover").removeClass("dropdown-itemselected"),e.addClass("dropdown-itemselected");var r=a.one(".dropdown-text"),o=e.one("span"),s={value:o.attr("value")||"",text:o.text()},l=a.one("input");l&&l.val(s.value);var c=r.attr("value")||"";c!=s.value&&(r.attr("value",s.value),r.text(s.text),t||n.fire(i.FIRES.selected,s))},_hover:function(e,t){var i=this.get("el");i.all(".dropdown-item").removeClass(".dropdown-itemover"),e.addClass(".dropdown-itemover"),t&&e.scrollIntoView(i.one(".dropdown-list"))}}),e.augment(i,i.METHODS),i},{requires:["brix/core/brick"]});