KISSY.add("brix/gallery/starrating/index",function(e,t,i,a){function n(){n.superclass.constructor.apply(this,arguments)}var r=i.all;if(6==a.ie)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(o){}return n.ATTRS={split:{value:2},maxValue:{value:5},length:{value:10},defaultValue:{value:!1},readOnly:{value:!1},starWidth:{value:18},inputs:{},current:{},mode:{value:!0}},n.EVENTS={".starrating-star":{mouseenter:function(t){if(!this.get("readOnly")){var i,a=e.one(t.currentTarget);this._fill(a),i=this.get("mode")?a.data("input").val():a.data("input"),this.fire("focus",{value:i})}},mouseleave:function(t){if(!this.get("readOnly")){var i,a=e.one(t.currentTarget);this._draw(),i=this.get("mode")?a.data("input").val():a.data("input"),this.fire("blur",{value:i})}},click:function(t){if(!this.get("readOnly")){var i=e.one(t.currentTarget);this.select(i)}}}},n.METHODS={select:function(t){var i=this;if("number"==typeof t){if(t=i.get("el").all(".starrating-star").item(t))return i.select(t);throw"\u6ca1\u6709\u627e\u5230\u8282\u70b9"}if("string"==typeof t){if(i.get("mode"))i.get("inputs").each(function(e,a){return e.val()==t?(t=i.get("el").all(".starrating-star").item(a),!1):void 0});else{var a=e.indexOf(t,i.get("inputs"));t=i.get("el").all(".starrating-star").item(a)}return i.select(t)}i.set("current",t),i._draw();var n;n=i.get("mode")?t.data("input").val():t.data("input"),i.fire("selected",{value:n})},readOnly:function(e,t){var i=this;i.set("readOnly",e||void 0==e?!0:!1);var a=i.get("readOnly");a?i.get("el").all(".starrating-star").addClass("starrating-star-readonly"):i.get("el").all(".starrating-star").removeClass("starrating-star-readonly"),i.get("mode")&&(t?i.get("inputs").attr("disabled","disabled"):i.get("inputs").removeAttr("disabled")),i._draw()},disable:function(){this.readOnly(!0,!0)},enable:function(){this.readOnly(!1,!1)}},e.extend(n,t,{initialize:function(){var t=this,i=t.get("inputs");if(i||(i=t.get("el").all("input[type=radio].star")),0==i.length){t.set("mode",!1);var a=t.get("length"),n=t.get("maxValue");i=[],flg=n/a;for(var r=1;a>=r;r++){var o=r*n/a;flg>=1?i.push(""+Math.round(o)):flg>.1?i.push(""+o.toFixed(1)):i.push(""+o.toFixed(2))}}t.set("inputs",i),t.get("mode")?i.each(function(e,i){var a=e.val(),n=e.attr("title")||a;t._creat(a,n,e,i)}):e.each(i,function(e,i){t._creat(e,e,e,i)}),rater=null;var s=t.get("defaultValue");s&&t.select(s)},_creat:function(e,t,i,a){var n=this,o=n.get("el"),s=n.get("split"),l=n.get("readOnly"),c=n.get("starWidth"),u=r('<div class="starrating-star"><a title="'+t+'">'+e+"</a></div>");if(o.append(u),s>1){var d=u.width()||c,p=a%s,f=Math.floor(d/s);u.css({width:f}).one("a").css({"margin-left":"-"+p*f+"px"}),0!=a&&0!=a%s&&u.css({"margin-right":"1px"})}else u.css({"margin-right":"1px"});u.data("input",i),l&&u.addClass("starrating-star-readonly"),n.get("mode")&&i.hide()},_fill:function(e){this._drain(),e.addClass("starrating-star-hover");for(var t=e;t.prev();)t.prev().addClass("starrating-star-hover"),t=t.prev()},_drain:function(){this.get("el").all(".starrating-star").removeClass("starrating-star-hover").removeClass("starrating-star-on")},_draw:function(){this._drain(),this.get("mode")&&this.get("inputs").removeAttr("checked");var e=this.get("current");if(e){this.get("mode")&&e.data("input").attr("checked","checked"),e.addClass("starrating-star-on");for(var t=e;t.prev();)t.prev().addClass("starrating-star-on"),t=t.prev()}},destructor:function(){}}),e.augment(n,n.METHODS),n},{requires:["brix/core/brick","node","ua"]});