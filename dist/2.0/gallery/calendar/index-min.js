KISSY.add("brix/gallery/calendar/index",function(e,t,i,a,n){function r(){r.superclass.constructor.apply(this,arguments);var t=this,i=t.get("popup"),a=e.one(t.get("trigger"));if(i&&a){var n=t.get("triggerType");e.each(n,function(e){a.on(e,t.toggle,t)})}}var o='<div class="calendar-pages"></div><div bx-tmpl="calendar" bx-datakey="notLimited,multiSelect,showTime,op_html" class="calendar-operator"> {{{op_html}}}</div>';return r.Date=n,r.ATTRS={date:{value:new Date,setter:function(e){return e||(e=new Date),e}},selected:{value:null},startDay:{value:0},pages:{value:1},closable:{value:!1},rangeSelect:{value:!1},minDate:{value:!1},maxDate:{value:!1},multiSelect:{value:!1},multi:{value:null,setter:function(e){for(var t=0;e.length>t;t++)e[t]instanceof Date&&(e[t]=n.format(e[t],"isoDate"));return e}},navigator:{value:!0},popup:{value:!0},showTime:{value:!1},trigger:{value:!1},triggerType:{value:["click"]},disabled:{value:!1},range:{value:!1},rangeLinkage:{value:!0},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},notLimited:{value:!1},tmpl:{getter:function(e){if(!e){var t=this;e=o,t.get("el")||(e='<div class="calendar">'+e+"</div>")}return e}},autoRender:{value:!1}},r.FIRES={select:"select",monthChange:"monthChange",timeSelect:"timeSelect",rangeSelect:"rangeSelect",multiSelect:"multiSelect",show:"show",hide:"hide"},r.RENDERERS={op:{html:function(e){var t=e,i=t.get("notLimited"),a=t.get("showTime"),n=t.get("multiSelect"),r="";return(a||n)&&(r+='<a class="btn btn-size25 btn-calendar-confirm">\u786e\u5b9a</a>'),i&&(r+='<a class="btn btn-size25 btn-calendar-notlimited">\u4e0d\u9650</a>'),r}}},r.DOCEVENTS={"":{click:function(t){var i=this,a=i.get("el"),n=e.one(t.target),r=e.one(i.get("trigger"));a.equals(n)||a.contains(n)||!r||r.contains(n)||n[0]==r[0]||i.hide()}}},r.EVENTS={".btn-calendar-confirm":{click:function(){var t=this,i=t.get("selected"),a=t.get("showTime"),o=t.get("multiSelect");if(o){var s=e.clone(t.get("multi"));s.sort(function(e,t){return e>t?1:-1});for(var l=0;s.length>l;l++)s[l]=n.parse(s[l]);e.log(s),t.fire(r.FIRES.multiSelect,{multi:s})}else if(a){var c=new Date;i&&(c=i);var d=t.pageBricks[0].timeBrick.get("time");c.setHours(d.getHours()),c.setMinutes(d.getMinutes()),c.setSeconds(d.getSeconds()),e.log(c),t.fire(r.FIRES.timeSelect,{date:c})}t.hide()}},".btn-calendar-notlimited":{click:function(){var e=this,t=e.get("notLimited");t&&(e.fire(r.FIRES.select,{date:null}),e.hide())}}},r.METHODS={show:function(){var t=this;if(t.get("rendered")||t.render(),t.overlay){var i=e.clone(t.get("align"));i.node||(i.node=t.get("trigger")),t.overlay.set("align",i),t.overlay.show(),t.fire(r.FIRES.show)}},hide:function(){var e=this;e.overlay&&(e.overlay.hide(),e.fire(r.FIRES.hide))},toggle:function(e){var t=this;e&&e.preventDefault();var t=this;t.overlay?"hidden"==t.overlay.get("el").css("visibility")?t.show():t.hide():t.show()}},e.extend(r,t,{initialize:function(){var t=this,n=t.get("popup"),o=t.get("closable"),s=t.get("pages"),l=t.get("rangeLinkage"),c=t.get("el"),d=t.get("date"),u=d.getMonth(),p=d.getFullYear(),f=t.get("trigger");if(n){var h=e.clone(t.get("align"));h.node||(h.node=f),t.overlay=new i({srcNode:t.get("el"),align:h}),t.overlay.render()}else c.css({position:"static",visibility:"visible"});var g=c.one(".calendar-pages");t.pageBricks=[],c.addClass(".calendar-"+s);for(var m,v,b=0;s>b;b++)l?(m=0==b,v=b==s-1):(m=!0,v=!0),function(e){var i=new a({index:e,prev:m,next:v,year:p,month:u,father:t,destroyAction:t.get("destroyAction"),container:g});t.pageBricks.push(i),i.on("itemClick",function(e){var i=t.get("rangeSelect");i?t._handleRange(e.date):e.date&&(t.set("selected",e.date),t.fire(r.FIRES.select,{date:e.date}),n&&o&&!t.get("showTime")&&t.hide())}),i.on("itemMouseDown",function(e){var i=t.get("multiSelect");i&&t._handleMultiSelectStart(e.date)}),i.on("itemMouseUp",function(e){var i=t.get("multiSelect");i&&t._handleMultiSelectEnd(e.date)}),i.on("monthChange",function(e){t._bindDateValueChange(e.date,e.index)})}(b),11==u?(p++,u=0):u++;t._bindDataChange("range"),t._bindDataChange("multi"),t._bindDataChange("disabled"),t._bindDataChange("minDate"),t._bindDataChange("maxDate"),t._bindDataChange("selected"),t._bindDataChange("startDay"),t.on("afterDateChange",function(){t._bindDateValueChange(t.get("date"))})},destructor:function(){var t=this;if(trigger=e.one(t.get("trigger")),t.get("popup")&&trigger){var i=t.get("triggerType");e.each(i,function(e){trigger.detach(e,t.toggle,t)})}t.pageBricks&&(e.each(t.pageBricks,function(e){e.destroy()}),t.pageBricks=null),t.overlay&&t.overlay.destroy()},_bindDataChange:function(e,t){var i=this,t=e.replace(/\b(\w)|\s(\w)/g,function(e){return e.toUpperCase()});i.on("after"+t+"Change",function(){for(var t=i.get(e),a=0;i.pageBricks.length>a;a++)i.pageBricks[a].setChunkData(e,t)})},_bindDateValueChange:function(e,t){t=t||0;var i=this,a=i.get("rangeLinkage"),n=e.getFullYear(),o=e.getMonth();if(a){for(var s=0;i.pageBricks.length>s;s++){var l=o-t+s,c=n;0>l?(c--,l+=12):l>11&&(c++,l-=12),i.pageBricks[s].set("year",c),i.pageBricks[s].set("month",l)}var d=n,u=o-t;0>u&&(d--,u+=12),i.fire(r.FIRES.monthChange,{date:new Date(d,u,1)})}else i.pageBricks[t].set("year",n),i.pageBricks[t].set("month",o),i.fire(r.FIRES.monthChange,{date:new Date(n,o,1)})},_handleRange:function(t){var i,a=this,n=e.clone(a.get("range"))||{};if(!n.start&&!n.end||n.start&&n.end)n.start=t,n.end=null,a.set("range",n);else{n.end=t,n.start.getTime()>n.end.getTime()&&(i=n.start,n.start=n.end,n.end=i),a.set("range",n),a.fire(r.FIRES.rangeSelect,n);var o=a.get("popup"),s=a.get("closable");o&&s&&a.hide()}},_handleMultiSelectStart:function(e){this.multiStartDate=e},_handleMultiSelectEnd:function(t){if(this.multiStartDate){var i,a=this,r=e.clone(a.get("multi"))||[],o=a.multiStartDate,s=(a.get("minDate"),a.get("maxDate"),a.get("disabled"));for(o>t?(i=o,o=t):i=t;i>=o;)if(!n.isDisabled(s,o)){var l=n.format(o,"isoDate");e.inArray(l,r)?r.splice(e.indexOf(l,r),1):r.push(l),o.setDate(o.getDate()+1)}delete a.multiStartDate,a.set("multi",r)}}}),e.augment(r,r.METHODS),r},{requires:["brix/core/brick","overlay","./page","./date"]}),KISSY.add("brix/gallery/calendar/date",function(){function e(e,t){var i=null;if(t=t||"-",e instanceof Date)return e;if(i=new Date(e),i instanceof Date&&"Invalid Date"!=i&&!isNaN(i))return i;var a=(""+e).split(t);return 3==a.length&&(i=new Date(a[0],parseInt(a[1],10)-1,a[2]),i instanceof Date&&"Invalid Date"!=i&&!isNaN(i))?i:null}var t=function(){var t=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,n=function(e,t){for(e+="",t=t||2;t>e.length;)e="0"+e;return e},r={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},o={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(s,l,c){if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(s)||/\d/.test(s)||(l=s,s=void 0),s=s?e(s):new Date,isNaN(s))throw SyntaxError("invalid date");l=(r[l]||l||r["default"])+"","UTC:"==l.slice(0,4)&&(l=l.slice(4),c=!0);var d=c?"getUTC":"get",u=s[d+"Date"](),p=s[d+"Day"](),f=s[d+"Month"](),h=s[d+"FullYear"](),g=s[d+"Hours"](),m=s[d+"Minutes"](),v=s[d+"Seconds"](),b=s[d+"Milliseconds"](),x=c?0:s.getTimezoneOffset(),y={d:u,dd:n(u,void 0),ddd:o.dayNames[p],dddd:o.dayNames[p+7],w:o.dayNames[p+14],m:f+1,mm:n(f+1,void 0),mmm:o.monthNames[f],mmmm:o.monthNames[f+12],yy:(h+"").slice(2),yyyy:h,h:g%12||12,hh:n(g%12||12,void 0),H:g,HH:n(g,void 0),M:m,MM:n(m,void 0),s:v,ss:n(v,void 0),l:n(b,3),L:n(b>99?Math.round(b/10):b,void 0),t:12>g?"a":"p",tt:12>g?"am":"pm",T:12>g?"A":"P",TT:12>g?"AM":"PM",Z:c?"UTC":((s+"").match(i)||[""]).pop().replace(a,""),o:(x>0?"-":"+")+n(100*Math.floor(Math.abs(x)/60)+Math.abs(x)%60,4),S:["th","st","nd","rd"][u%10>3?0:(10!=u%100-u%10)*u%10]};return l.replace(t,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}}();return{format:function(e,i,a){return t(e,i,a)},parse:function(t,i){return e(t,i)},isMinMax:function(e,i,a){return a=t(a,"isoDate"),e&&(e=Brix_Date.format(e,"isoDate"),e>a)?!1:i&&(i=Brix_Date.format(i,"isoDate"),a>i)?!1:!0},isDisabled:function(e,i){if(i=t(i,"isoDate"),e)for(var a=0;e.length>a;a++)if(t(e[a],"isoDate")==i)return!0;return!1},isInMulit:function(e,i){if(i=t(i,"isoDate"),e)for(var a=0;e.length>a;a++)if(t(e[a],"isoDate")==i)return!0;return!1},isInRang:function(e,i){if(i=t(i,"isoDate"),e)if(e.start&&e.end){if(i>=t(e.start,"isoDate")&&t(e.end,"isoDate")>=i)return!0}else if(e.start&&i==t(e.start,"isoDate"))return!0;return!1},isYear:function(e){return/^\d+$/i.test(e)?(e=Number(e),!(100>e||e>1e4)):!1}}}),KISSY.add("brix/gallery/calendar/page",function(e,t,i,a){function n(e){for(var t=[],i=0;7>i;i++)t[i]=l[(i+e)%7];return t}function r(e,t){return 32-new Date(e,t,32).getDate()}function o(){o.superclass.constructor.apply(this,arguments)}var s='<div class="calendar-page"><div class="calendar-page-hd"><div bx-mpl="page" bx-datakey="prev"> {{#prev}} <a href="javascript:void(0);" class="calendar-prev-year"><i class="iconfont">&#403</i><i class="iconfont icon-yp">&#403</i></a><a href="javascript:void(0);" class="calendar-prev-month"><i class="iconfont">&#403</i></a> {{/prev}} </div><a bx-tmpl="yearmonth" bx-datakey="year,month" href="javascript:void(0);" class="calendar-year-month"> {{year}}\u5e74{{month}}\u6708 </a><div bx-tmpl="next" bx-datakey="next"> {{#next}} <a href="javascript:void(0);" class="calendar-next-month "><i class="iconfont">&#402</i></a><a href="javascript:void(0);" class="calendar-next-year "><i class="iconfont icon-yn">&#402</i><i class="iconfont">&#402</i></a> {{/next}} </div><div class="calendar-year-month-pupop" ><p bx-tmpl="select" bx-datakey="month,select_html">{{{select_html}}}</p><p bx-tmpl="year" bx-datakey="year">\u5e74:<input type="text" value="{{year}}" onfocus="this.select()"></p><p><a class="btn btn-size25 btn-pupop-confirm">\u786e\u5b9a</a><a class="btn-pupop-cancel" href="#">\u53d6\u6d88</a></p></div></div><div bx-tmpl="pagewbd" bx-datakey="startDay,days_html" class="calendar-page-wbd"> {{{days_html}}} </div><div bx-tmpl="pagedbd" bx-datakey="startDay,year,month,selected,range,multi,disabled,minDate,maxDate,da_html" class="calendar-page-dbd"> {{{da_html}}} </div><div class="calendar-page-fd"></div></div>',l=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];return o.ATTRS={father:{value:!1},index:{value:0},year:{value:2012},month:{value:7},prev:{value:!0},next:{value:!0},autoRender:{value:!0},tmpl:{value:s},data:{valueFn:function(){var e=this,t=(e.get("father"),e.get("year")),i=e.get("month"),a=e.get("prev"),n=e.get("next");return{prev:a,next:n,month:i+1,year:t}}}},o.RENDERERS={da:{html:function(e){var t=e,i=t.get("father"),n=t.get("year"),o=t.get("month"),s=i.get("selected"),l=i.get("minDate"),c=i.get("maxDate"),d=i.get("disabled"),u=i.get("multi"),p=i.get("range"),f=(7-i.get("startDay")+new Date(n,o,1).getDay())%7,h=r(n,o),g=a.format(new Date,"isoDate"),m="";s&&(s=a.format(s,"isoDate")),l&&(l=a.format(l,"isoDate")),c&&(c=a.format(c,"isoDate"));for(var v=0;f>v;v++)m+='<a href="javascript:void(0);" class="calendar-hidden">0</a>';for(var v=1;h>=v;v++){var b='class="calendar-item',x=a.format(new Date(n,o,v),"isoDate");l>x||x>c||a.isDisabled(d,x)?b+=" calendar-disabled":a.isInRang(p,x)?b+=" calendar-range":s==x?b+=" calendar-selected":a.isInMulit(u,x)&&(b+=" calendar-multi"),g==x&&(b+=" calendar-today"),m+="<a "+b+'" href="javascript:void(0);">'+v+"</a>"}return m}},select:{html:function(){for(var e="\u6708:<select>",t=1;12>=t;t++)e+="<option"+(t==this.month?" selected":"")+' value="'+(t-1)+'">'+(10>t?"0"+t:t)+"</option>";return e+="</select>"}},days:{html:function(t){var i=t.get("father"),a=n(i.get("startDay")),r="";return e.each(a,function(e){r+="<span>"+e+"</span>"}),r}}},o.EVENTS={".calendar-prev-year":{click:function(){var e=this,t=e.get("year"),i=e.get("month"),a=e.get("index");t--,date=new Date(t,i,1),e.fire(o.FIRES.monthChange,{date:date,index:a})}},".calendar-prev-month":{click:function(){var e=this,t=e.get("year"),i=e.get("month"),a=e.get("index");i--,0>i&&(t--,i+=12),date=new Date(t,i,1),e.fire(o.FIRES.monthChange,{date:date,index:a})}},".calendar-next-year":{click:function(){var e=this,t=e.get("year"),i=e.get("month"),a=e.get("index");t++,date=new Date(t,i,1),e.fire(o.FIRES.monthChange,{date:date,index:a})}},".calendar-next-month":{click:function(){var e=this,t=e.get("year"),i=e.get("month"),a=e.get("index");i++,i>11&&(t++,i-=12),date=new Date(t,i,1),e.fire(o.FIRES.monthChange,{date:date,index:a})}},".calendar-year-month":{click:function(){var e=this,t=e.get("father").get("navigator");t&&(popupNode=e.get("el").one(".calendar-year-month-pupop").show())}},".btn-pupop-confirm":{click:function(e){e.preventDefault();var t=this,i=t.get("index");if(popupNode=t.get("el").one(".calendar-year-month-pupop"),year=popupNode.one("input").val(),month=popupNode.one("select").val(),a.isYear(year)){year=Number(year),month=Number(month);var n=new Date(year,month,1);popupNode.hide(),t.fire(o.FIRES.monthChange,{date:n,index:i})}}},".btn-pupop-cancel":{click:function(e){e.preventDefault();var t=this,i=t.get("el").one(".calendar-year-month-pupop");i.hide()}},".calendar-item":{click:function(t){t.preventDefault();var i=this,a=e.one(t.currentTarget);if(!a.hasClass("calendar-disabled")){var n=!1,r=i.get("year"),s=i.get("month");if(n=new Date(r,s,Number(a.html())),i.timeBrick){var l=i.timeBrick.get("time");n.setHours(l.getHours()),n.setMinutes(l.getMinutes()),n.setSeconds(l.getSeconds())}e.later(function(){i.fire(o.FIRES.itemClick,{date:n})},0)}},mousedown:function(t){t.preventDefault();var i=this,a=e.one(t.currentTarget);if(!a.hasClass("calendar-disabled")){var n=i.get("year"),r=i.get("month"),s=new Date(n,r,Number(a.html()));i.fire(o.FIRES.itemMouseDown,{date:s})}},mouseup:function(t){t.preventDefault();var i=this,a=e.one(t.currentTarget);if(!a.hasClass("calendar-disabled")){var n=i.get("year"),r=i.get("month"),s=new Date(n,r,Number(a.html()));i.fire(o.FIRES.itemMouseUp,{date:s})}}}},o.METHODS={},o.FIRES={itemClick:"itemClick",itemMouseDown:"itemMouseDown",itemMouseUp:"itemMouseUp",monthChange:"monthChange"},e.extend(o,t,{initialize:function(){var e=this,t=e.get("el"),a=e.get("father"),n=a.get("showTime");n&&(e.timeBrick=new i({destroyAction:e.get("destroyAction"),container:t.one(".calendar-page-fd")})),e.on("afterYearChange",function(){e.setChunkData("year",e.get("year"))}),e.on("afterMonthChange",function(){e.setChunkData("month",e.get("month")+1)})},destructor:function(){var e=this;e.timeBrick&&e.timeBrick.destroy()}}),e.augment(o,o.METHODS),o},{requires:["brix/core/brick","./time","./date"]}),KISSY.add("brix/gallery/calendar/time",function(e,t){var i={h:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],m:["00","10","20","30","40","50"],s:["00","10","20","30","40","50"]},a='<div tabIndex="1"><div class="calendar-time"> \u65f6\u95f4\uff1a<span bx-tmpl="h" bx-datakey="h" class="h">{{h}}</span>:<span bx-tmpl="m" bx-datakey="m" class="m">{{m}}</span>:<span bx-tmpl="s" bx-datakey="s" class="s">{{s}}</span><div class="calendar-time-updown"><i class="iconfont u">&#456</i><i class="iconfont d">&#459</i></div></div><div class="calendar-time-popup"><div bx-tmpl="time" bx-datakey="list" class="calendar-time-popup-bd"> {{#list}} <a class="item">{{.}}</a> {{/list}} </div><i class="iconfont icon-close">&#223</i></div></div>',n=t.extend({_setTime:function(e,t){var i=this,a=i.get("time");switch(i.get("el"),t=Number(t),e){case"h":a.setHours(t);break;case"m":a.setMinutes(t);break;case"s":a.setSeconds(t)}i.setChunkData("h",a.getHours()),i.setChunkData("m",a.getMinutes()),i.setChunkData("s",a.getSeconds())},_getTime:function(e){var t=this,i=t.get("time");switch(e){case"h":return i.getHours();case"m":return i.getMinutes();case"s":return i.getSeconds()}},_hideTimePopup:function(){var e=this,t=e.get("el");t.one(".calendar-time-popup").css({display:"none"})}},{ATTRS:{time:{value:new Date},status:{value:"s"},autoRender:{value:!0},tmpl:{value:a},data:{valueFn:function(){var e=this,t=e.get("time");return{h:t.getHours(),m:t.getMinutes(),s:t.getSeconds()}}}},EVENTS:{span:{click:function(t){var a=this,n=e.one(t.currentTarget);n.parent().all("span").removeClass("on"),n.addClass("on"),n.hasClass("h")?a.set("status","h"):n.hasClass("m")?a.set("status","m"):a.set("status","s");var r=a.get("status");a.setChunkData("list",i[r]),a.get("el").one(".calendar-time-popup").css({display:"block"})}},".icon-close":{click:function(){var e=this;e._hideTimePopup()}},".item":{click:function(t){var i=this,a=e.one(t.currentTarget),n=i.get("status");i._setTime(n,a.html()),i._hideTimePopup()}},".u":{click:function(){var e=this,t=e.get("status"),i=e._getTime(t);i++,e._setTime(t,i)}},".d":{click:function(){var e=this,t=e.get("status"),i=e._getTime(t);i--,e._setTime(t,i)}},"":{keyup:function(e){var t=this,i=t.get("status"),a=t._getTime(i);(38==e.keyCode||37==e.keyCode)&&(e.preventDefault(),a++,t._setTime(i,a)),(40==e.keyCode||39==e.keyCode)&&(e.preventDefault(),a--,t._setTime(i,a))}}},FIRES:{timeSelect:"timeSelect"}},"Time");return n},{requires:["brix/core/brick"]});