KISSY.add("brix/gallery/visibility/index",function(t,e){function n(){var e=this;t.one(/blur$/.test(s)?window:document).on(s,function(t){var n=t.type,r=t.originalEvent,a=r.toElement;if(!/^focus./.test(n)||void 0==a&&void 0==r.fromElement&&void 0==r.relatedTarget){var s=/^(?:blur|focusout)$/.test(n);o||(s?(document.hidden=!0,document.visibilityState="hidden"):(document.hidden=!1,document.visibilityState="visible")),e.fire(i&&document[i]||s?"hidden":"visible")}})}for(var r,i,a,o,s=("onfocusin"in document&&"hasFocus"in document?"focusin focusout":"focus blur"),u=["o","ms","moz","webkit",""];void 0!=(r=u.pop());)if(i=(r?r+"H":"h")+"idden",o="boolean"==typeof document[i]){a=(r?r+"V":"v")+"isibilityState",s=r+"visibilitychange";break}return o||(document.hidden=!1,document.visibilityState="visible",i="hidden",a="visibilityState"),n.isSupported=o,n.hidden=function(){return document[i]},n.visibilityState=function(){return document[a]},t.extend(n,e),n},{requires:["base","node"]});