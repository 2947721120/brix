KISSY.add("brix/gallery/pagination/index",function(e,t){function i(t){if(!e.isPlainObject(t))return"";var i,n,a="&",r="=",o=[];for(i in t)if(t.hasOwnProperty(i))if(n=t[i],e.isArray(n)){if(e.isArray(n)&&n.length)for(var s=0,l=n.length;l>s;++s)o.push(i,r,n[s],a)}else o.push(i,r,n,a);return o.pop(),o.join("")}function n(t){if("string"!=typeof t||0===(t=e.trim(t)).length)return{};for(var i,n,a,r="&",o="=",s={},l=t.split(r),c=0,u=l.length;u>c;++c)i=l[c].split(o),n=i[0],a=i[1]||"",Object.prototype.hasOwnProperty.call(s,n)?e.isArray(s[n])?s[n].push(a):s[n]=[s[n],a]:s[n]=a;return s}function a(){a.superclass.constructor.apply(this,arguments)}return a.ATTRS={mode:{value:"p"},offset:{value:0},simplify:{value:!1},step:{value:7},index:{value:1},size:{value:15},sizeChange:{value:!1},count:{value:350},hascount:{value:!0},max:{value:!1},hasmax:{value:!1},statistics:{value:!1},pageCount:{value:!0},jump:{value:!1},goTo:{value:!0},goToUrl:{value:null},pageName:{value:"page"},pageSizeName:{value:"pagesize"},params:{value:!1},defaultUI:{value:!0},sizes:{value:[10,15,20,25,30]},urlInfo:{value:{}},formatUrl:{value:!1},isText:{value:!1}},a.EVENTS={".page-num":{keydown:function(e){13===e.keyCode&&(e.preventDefault(),this._jumpPage())}},".btn-jump":{click:function(e){e.preventDefault(),this._jumpPage()}},a:{click:function(t){var i=this,n=e.one(t.currentTarget);if(n.hasClass("page"))t.preventDefault(),i.goToPage(parseInt(n.html(),10));else if(n.hasClass("page-prev")){t.preventDefault();var a=i.get("index");i.goToPage(a-1)}else if(n.hasClass("page-next")){t.preventDefault();var a=i.get("index");i.goToPage(a+1)}}}},a.FIRES={beforeGotoPage:"beforeGotoPage",goToPage:"goToPage",gotoPage:"gotoPage",sizeChange:"sizeChange"},a.METHODS={goToPage:function(e){var t,i=this;t=i.fire("beforeGotoPage",{newIndex:e,prevIndex:i.get("index")}),t!==!1&&(i.set("index",e),i.setConfig({index:e})||(i.fire("goToPage",{index:e}),i.fire("gotoPage",{index:e})))},setConfig:function(e){var t=this,i=t.get("size");for(var n in e)t.set(n,e[n]);if(e.goToUrl&&t._setUrlInfo(),t.get("goTo")){var a=t.doUrl();return location.href=a,!0}return e.size&&e.size!=i&&t.fire("sizeChange",{size:e.size}),t._destroyDropdown(),t._resizeConfig(),t.renderUI(),t._getDropDown(),!1},parseUrl:function(e){var t=document.createElement("a");return t.href=e,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){return n(t.search.replace(/^\?/,""))}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}},doUrl:function(){var e=this,t=e.get("urlInfo"),n=e.get("index"),a=e.get("size"),r=e.get("pageName"),o=e.get("pageSizeName"),s="";return t.params[r]=e._offset(n),o?t.params[o]=a:t.params[o]&&delete t.params[o],t.protocol&&(s=t.protocol+"://"+t.host,0!=t.port&&80!=t.port&&(s+=":"+t.port)),s+=t.path+"?",s+=i(t.params),""!=t.hash&&(s+="#"+t.hash),s}},e.extend(a,t,{initialize:function(){var e=this;e._setUrlInfo();var t=e.get("urlInfo"),i=e.get("mode"),n=e.get("offset"),a=e.get("pageName"),r=e.get("pageSizeName");if(r&&t.params[r]&&e.set("size",parseInt(t.params[r],10)),t.params[a])switch(i){case"p":e.set("index",parseInt(t.params[a],10)-n);break;case"s":var o=e.get("size");e.set("index",(parseInt(t.params[a],10)-n*o)/o)}e._resizeConfig(),e.get("defaultUI")&&e.renderUI(),e._getDropDown()},destructor:function(){this._destroyDropdown()},renderUI:function(){var t=this,i=(t.get("mode"),t.get("formatUrl")),n=t.get("index"),a=t.get("max"),r=Math.min(t.get("step"),a),o=t.get("size"),s=t.get("count"),l=t.get("hascount"),c=t.get("pageCount"),u=t.get("isText"),d=[];if(t.get("statistics")){if(d.push('<div class="pagination-info"><span>\u5f53\u524d</span><span class="b">'+(0==s?0:(n-1)*o+1)+"-"+Math.min(n*o,s)+'</span><span>\u6761</span><span class="mr">\u5171</span><span class="b">'+s+'</span><span>\u6761</span><span class="mr">\u6bcf\u9875\u5c55\u73b0</span>'),t.get("sizeChange")){var p=t.get("sizes");d.push('<div class="dropdown"><span class="dropdown-hd"><span class="dropdown-text" value="'+e.indexOf(o,p)+'">'+o+"</span>"+"</span>"+'<ul class="dropdown-list dropdown-list-noicon">'),e.each(p,function(e,t){d.push('<li class="dropdown-item'+(e==o?" dropdown-itemselected":"")+'"><span value="'+t+'">'+e+"</span></li>")}),d.push("</ul></div>")}else d.push('<span class="b">'+o+"</span>");d.push("<span>\u6761</span></div>")}if(d.push('<div class="pagination-pages"><div class="pagination-page">'),n>1&&d.push('<a title="\u4e0a\u4e00\u9875" href="'+i.replace("{$p}",t._offset(n-1))+'" class="page-prev"><i class="iconfont">&#403</i>'+(u?"<span>\u4e0a\u4e00\u9875</span>":"")+"</a>"),t.get("simplify"))d.push('<span class="page-simply">'+n+"/"+a+"</span>");else{var f=Math.max(1,n-parseInt(r/2)),h=Math.min(a,f+r-1);f=Math.max(1,h-r+1),f>=3?(d.push('<a class="page" href="'+i.replace("{$p}",t._offset(1))+'" title="\u7b2c1\u9875">1</a>'),d.push('<a class="page" href="'+i.replace("{$p}",t._offset(2))+'" title="\u7b2c2\u9875">2</a>'),f>3&&d.push('<span class="page-split">...</span>')):2==f&&d.push('<a class="page" href="'+i.replace("{$p}",t._offset(1))+'" title="\u7b2c1\u9875">1</a>');for(var g=f;h>=g;g++)g===n?d.push('<span class="page-cur">'+g+"</span>"):d.push('<a class="page" href="'+i.replace("{$p}",t._offset(g))+'" title="\u7b2c'+g+'\u9875">'+g+"</a>");a>=h+2?(d.push('<span class="page-split">...</span>'),l&&d.push('<a class="page" href="'+i.replace("{$p}",t._offset(a))+'" title="\u7b2c'+a+'\u9875">'+a+"</a>")):a>h&&d.push('<a class="page" href="'+i.replace("{$p}",t._offset(a))+'" title="\u7b2c'+a+'\u9875">'+a+"</a>")}n!=a&&d.push('<a title="\u4e0b\u4e00\u9875" href="'+i.replace("{$p}",t._offset(n+1))+'" class="page-next">'+(u?"<span>\u4e0b\u4e00\u9875</span>":"")+'<i class="iconfont">&#402</i></a>'),d.push("</div>"),l&&c&&d.push('<div class="pagination-count"><span>\u5171</span><span class="b">'+a+"</span><span>\u9875</span></div>"),t.get("jump")&&d.push('<div class="pagination-form"><span>\u5411\u7b2c</span><input class="page-num" value="'+Math.min(a,n+1)+'" name="page" type="text"><span>\u9875</span><a class="btn-jump btn btn-size25">\u8df3\u8f6c</a></div>'),d.push("</div>"),t.get("el").html(d.join(""))},_offset:function(e){var t=this,i=t.get("mode"),n=t.get("offset");switch(i){case"p":return e+n;case"s":var a=t.get("size");return a*(e+n);default:return e+n}},_getDropDown:function(){var e=this;if(e.get("sizeChange")&&e.get("statistics")){var t=e.get("el").one(".dropdown");if(t){var i=t?t.attr("id"):!1;i&&e.pagelet?e.pagelet.ready(function(){e.dropdown=e.pagelet.getBrick(i),e.dropdown?e._bindDropdownSizeChange():e._createDropdown()}):e._createDropdown()}}},_createDropdown:function(){var t=this;e.use("brix/gallery/dropdown/",function(e,i){t.dropdown=new i({tmpl:t.get("el").one(".dropdown")}),t._bindDropdownSizeChange()})},_bindDropdownSizeChange:function(){var e=this;e.dropdown.on("selected",function(t){e.setConfig({index:1,size:t.text})})},_destroyDropdown:function(){var e=this;e.dropdown&&(e.dropdown.destroy(),e.dropdown=null)},_jumpPage:function(){var e=this,t=this.get("el").one(".page-num"),i=parseInt(t.val(),10),n=e.get("max"),a=e.get("index");return isNaN(i)||1>i||i>n||i==a?(t[0].select(),void 0):(this.goToPage(i),void 0)},_setUrlInfo:function(){var t=this,i=t.get("params");t.get("goToUrl")||t.set("goToUrl",location.href);var n=t.parseUrl(t.get("goToUrl"));i&&e.each(i,function(e,t){n.params[t]=e}),e.log(n.params.s),t.set("urlInfo",n),e.log(n.params.s)},_resizeConfig:function(){var e=this,t=e.get("index"),i=e.get("hascount"),n=e.get("size"),a=e.get("count"),r=e.get("max"),o=e.get("hasmax"),s=e.get("pageName");if(e.get("pageSizeName"),!i){var l=e.get("step");a=t>=l?n*(t+1):n*l,e.set("count",a)}r=o?Math.min(Math.ceil(a/n),r):Math.ceil(a/n),e.set("max",r),t=Math.min(t,r),e.set("index",t),0===a&&(e.set("max",1),e.set("index",1)),e.set("formatUrl",e.doUrl().replace(s+"="+e._offset(t),s+"={$p}"))}}),e.augment(a,a.METHODS),a},{requires:["brix/core/brick"]});