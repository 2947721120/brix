(function(){if(top!==self&&!top.ETao.needRefresh)try{top.ETao.loginSuccess&&top.ETao.loginSuccess()}catch(t){}})(),KISSY.add("brix/gallery/login/index",function(t,e,n,r){function i(){var t=this;i.superclass.constructor.apply(t,arguments)}var a=t.DOM,o=t.Event;return i.ATTRS={trigger:{value:".J-EtaoLogin"},triggerType:{value:"click"},panel:{value:"body"},redirect_url:{value:window.location.href},loginType:{value:"taobao"},isRedirectToA:{value:!1},isCheckLongOrTrueLogin:{value:!0},needRefresh:{value:!0},mask:{value:!0}},i.EVENTS={},i.METHODS={checkTrueLogin:function(){var t="true"==e.get("login"),n=e.get("_nk_"),r=e.get("a_nk");return t&&(n||r)},checkLongOrTrueLogin:function(){var t=this,n=e.get("tracknick"),r=e.get("ck1");return t.checkTrueLogin()||n&&r},eHandler:function(){},show:function(){var e=this,r=e.get("loginType"),i=e.get("redirect_url");if(e.get("needRefresh"),e.login){KISSY.ChangeIframeSrc(i,r);var u=a.viewportHeight()/2-200+a.scrollTop(),s=a.viewportWidth()/2-171+a.scrollLeft();a.css(".etaologin-overlay",{top:0>u?0:u,left:0>s?0:s}),e.login.show(),t.Stat&&t.Stat("click="+a.attr("#J_LoginPopup","login-stat")+pre)}else{var c=(-1===window.location.href.indexOf("etao.net")?"login.etao.com":"i.daily.etao.net","http://zixi.etao.com/brix/demo/gallery/login/popup.php");t.getScript(c,function(){var r=new n({prefixCls:"etaologin-",width:342,height:500,mask:e.get("mask"),zIndex:10001});r.render(),r.get("contentEl").html(window.LoginPopupHtml,!0);var i=a.viewportHeight()/2-200+a.scrollTop(),u=a.viewportWidth()/2-171+a.scrollLeft();a.css(".etaologin-overlay",{top:0>i?0:i,left:0>u?0:u}),r.show(),e.login=r;var s=t.guid();e.id=s,r.get("el")[0].id=s,o.on(".J_CloseLoginBtn","click",function(){r.hide(),a.css(".etaologin-overlay",{top:"-9999px"})}),t.Stat&&t.Stat("click="+a.attr("#J_LoginPopup","login-stat")+pre),o.delegate("#"+s,"click","a",function(e){e.preventDefault();var n=e.currentTarget;t.LoginChange(n),t.Stat&&("J_TaobaoMember"===n.id?t.Stat("click="+a.attr("#J_TaobaoMember","login-stat")+pre):t.Stat("click="+a.attr("#J_AlipayMember","login-stat")+pre))})},"utf-8")}}},t.extend(i,r,{initialize:function(){var t=this,e=t.get("panel");o.delegate(e?e:"body",t.get("triggerType"),t.get("trigger"),function(e){var n=t.get("redirect_url"),r=t.get("needRefresh");if(!(t.checkTrueLogin()||t.get("isCheckLongOrTrueLogin")&&t.checkLongOrTrueLogin())){e.preventDefault();var i=t.get("isRedirectToA")?e.currentTarget.href:n;t.show({redirect_url:i,needRefresh:r})}})},destructor:function(){}}),t.augment(i,i.METHODS),i},{requires:["cookie","overlay","brix/core/brick"]});