(function(){if(top!==self&&!top.ETao.needRefresh)try{top.ETao.loginSuccess&&top.ETao.loginSuccess()}catch(a){}})(),KISSY.add("brix/gallery/login/index",function(a,b,c,d){function g(){var a=this;g.superclass.constructor.apply(a,arguments)}var e=a.DOM,f=a.Event;return g.ATTRS={trigger:{value:".J-EtaoLogin"},triggerType:{value:"click"},panel:{value:"body"},redirect_url:{value:window.location.href},loginType:{value:"taobao"},isRedirectToA:{value:!1},isCheckLongOrTrueLogin:{value:!0},needRefresh:{value:!0},mask:{value:!0}},g.EVENTS={},g.METHODS={checkTrueLogin:function(){var a=b.get("login")=="true",c=b.get("_nk_"),d=b.get("a_nk");return a&&(c||d)},checkLongOrTrueLogin:function(){var a=this,c=b.get("tracknick"),d=b.get("ck1");return a.checkTrueLogin()||c&&d},eHandler:function(a,b){},show:function(b){var d=this,g=d.get("loginType"),h=d.get("redirect_url"),i=d.get("needRefresh");if(d.login){KISSY.ChangeIframeSrc(h,g);var j=e.viewportHeight()/2-200+e.scrollTop(),k=e.viewportWidth()/2-171+e.scrollLeft();e.css(".etaologin-overlay",{top:j<0?0:j,left:k<0?0:k}),d.login.show(),a.Stat&&a.Stat("click="+e.attr("#J_LoginPopup","login-stat")+pre)}else{var l=window.location.href.indexOf("etao.net")===-1?"login.etao.com":"i.daily.etao.net",m="http://zixi.etao.com/brix/demo/gallery/login/popup.php";a.getScript(m,function(){var b=new c({prefixCls:"etaologin-",width:342,height:500,mask:d.get("mask"),zIndex:10001});b.render(),b.get("contentEl").html(window.LoginPopupHtml,!0);var g=e.viewportHeight()/2-200+e.scrollTop(),h=e.viewportWidth()/2-171+e.scrollLeft();e.css(".etaologin-overlay",{top:g<0?0:g,left:h<0?0:h}),b.show(),d.login=b;var i=a.guid();d.id=i,b.get("el")[0].id=i,f.on(".J_CloseLoginBtn","click",function(){b.hide(),e.css(".etaologin-overlay",{top:"-9999px"})}),a.Stat&&a.Stat("click="+e.attr("#J_LoginPopup","login-stat")+pre),f.delegate("#"+i,"click","a",function(b){b.preventDefault();var c=b.currentTarget;a.LoginChange(c),a.Stat&&(c.id==="J_TaobaoMember"?a.Stat("click="+e.attr("#J_TaobaoMember","login-stat")+pre):a.Stat("click="+e.attr("#J_AlipayMember","login-stat")+pre))})},"utf-8")}}},a.extend(g,d,{initialize:function(){var a=this,b=a.get("panel");f.delegate(b?b:"body",a.get("triggerType"),a.get("trigger"),function(b){var c=a.get("redirect_url"),d=a.get("needRefresh");if(a.checkTrueLogin())return;if(a.get("isCheckLongOrTrueLogin")&&a.checkLongOrTrueLogin())return;b.preventDefault();var e=a.get("isRedirectToA")?b.currentTarget.href:c;a.show({redirect_url:e,needRefresh:d})})},destructor:function(){}}),a.augment(g,g.METHODS),g},{requires:["cookie","overlay","brix/core/brick"]});