KISSY.add("brix/gallery/datepicker/index",function(t,e,n,r){function i(t){var e=864e5,n=new Date,r=n.getTime();return n.setTime(r+e*t),n}function a(){a.superclass.constructor.apply(this,arguments);var e=this,n=t.one(e.get("trigger"));if(n){var r=e.get("triggerType");t.each(r,function(t){n.on(t,e.toggle,e)})}var i=e.get("isCompare");i&&e.on("afterCompareTextChange",function(){e.setChunkData("compareText",e.get("compareText"))})}var o='<div class="datepicker-bd"> {{^isCompare}} <label>\u65e5\u671f\u8303\u56f4\uff1a</label><div class="range" bx-tmpl="datapickRange1" bx-datakey="start,end"><input class="input" input_type="Start" value="{{start}}"><span class="input-split">-</span><input class="input" input_type="End" value="{{end}}"></div> {{/isCompare}} {{#isCompare}} <label>\u5f53\u524d\u65e5\u671f\uff1a</label><div bx-tmpl="datepicker" bx-datakey="compareText" class="range">{{compareText}} </div><label>\u4e0e\u5176\u4ed6\u65e5\u671f\u6bd4\u8f83\uff1a(\u987b\u540c\u6837\u5929\u6570)</label><div class="range" bx-tmpl="datapickRange2" bx-datakey="start,end"><input class="input" input_type="Start" value="{{start}}"><span class="input-split">-</span><input class="input" input_type="End" value="{{end}}"></div> {{/isCompare}} {{#isQuick}} {{{quick_html}}} {{/isQuick}} <div class="operator"><a class="btn btn-size25 btn-confirm" href="#">\u786e\u5b9a</a><a class="btn-cancel" href="#">\u53d6\u6d88</a></div></div>',u=new Date,s=i(-1),c={today:{text:"\u4eca\u5929",dateRange:[u,u]},yestoday:{text:"\u6628\u5929",dateRange:[s,s]},days7before:{text:"\u8fc7\u53bb7\u5929",dateRange:[i(-7),s]},days14before:{text:"\u8fc7\u53bb15\u5929",dateRange:[i(-15),s]}},l="\u4e0d\u9650";return a.Date=r.Date,a.ATTRS={trigger:{value:!1},triggerType:{value:["click"]},quickDates:{value:c},dates:{value:{start:null,end:null}},isQuick:{value:!0},isCompare:{value:!1},compareText:{value:"\u8fc7\u53bb7\u5929"},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},notLimited:{value:!1},pages:{value:2},minDateStart:{value:!1},minDateEnd:{value:!1},maxDateStart:{value:!1},maxDateEnd:{value:!1},disabledStart:{value:!1},disabledEnd:{value:!1},tmpl:{valueFn:function(){var t=this,e=o;return t.get("el")||(e='<div class="datepicker">'+e+"</div>"),e}},data:{valueFn:function(){var t=this,e=t.get("isQuick"),n=t.get("isCompare"),i=t.get("compareText"),a=t.get("dates"),o=a.start?r.Date.format(a.start,"isoDate"):l,u=a.end?r.Date.format(a.end,"isoDate"):l;return{start:o,end:u,isQuick:e,isCompare:n,compareText:i}}},autoRender:{value:!1}},a.RENDERERS={quick:{html:function(t){var e=t.get("quickDates"),n='<label>\u5feb\u6377\u65e5\u671f:</label><ul class="quick-list">';for(var r in e)n+='<li><a class="quick-item" key="'+r+'" href="#">'+e[r].text+"</a></li>";return n+="</ul>"}}},a.DOCEVENTS={"":{click:function(e){var n=this,r=n.get("el"),i=t.one(e.target),a=t.one(n.get("trigger"));r.equals(i)||r.contains(i)||!a||a.contains(i)||i[0]==a[0]||n.calendar&&n.calendar.get("el").contains(i)||n.hide()}}},a.EVENTS={input:{click:function(e){var n=this,i=t.one(e.currentTarget),o=r.Date.parse(i.val())||new Date,u=r.Date.parse(i.val()),s=t.clone(n.get("align"));s.node=i[0],n.calendar||(n.calendar=new r({date:o,selected:u,popup:!0,closable:!0,notLimited:n.get("notLimited"),pages:n.get("pages"),align:s}),n.calendar.on("select",function(t){var e=n.calendar.get("trigger");t.date?e.val(r.Date.format(t.date,"isoDate")):e.val(l)})),n.calendar.set("date",o),n.calendar.set("selected",u),n.calendar.set("trigger",i),n.calendar.set("align",s);var c=i.attr("input_type");n.calendar.set("minDate",n.get("minDate"+c)),n.calendar.set("maxDate",n.get("maxDate"+c)),n.calendar.set("disabled",n.get("disabled"+c)),n.fire(a.FIRES.inputClick,{type:c}),n.calendar.show()}},".btn-confirm":{click:function(t){t.preventDefault();var e=this,n=e.get("el"),i=n.one(".quick-list"),o={isQuick:!1},u=n.all("input");i&&i.all("a").removeClass("quick-current");var s=u.item(0).val(),c=u.item(1).val();if(e.get("isQuick")){var l=e.get("quickDates");for(var f in l){var h=l[f];if(r.Date.format(h.dateRange[0],"isoDate")==s&&r.Date.format(h.dateRange[1],"isoDate")==c){var d=n.one(".quick-list").one('[key="'+f+'"]');d.addClass("quick-current");break}}}o.start=r.Date.parse(s),o.end=r.Date.parse(c),e.fire(a.FIRES.selected,o)!==!1&&e.hide()}},".btn-cancel":{click:function(t){t.preventDefault(),this.hide()}},".quick-item":{click:function(e){e.preventDefault();var n=this,i=t.one(e.currentTarget),o=n.get("el"),u=n.get("quickDates"),s=t.one(e.currentTarget).attr("key"),c=u[s],l={isQuick:!0};o.one(".quick-list").all("a").removeClass("quick-current"),i.addClass("quick-current"),l.start=c.dateRange[0],l.end=c.dateRange[1],l.quickDate=c;var f=o.all("input");f.each(function(t,e){t.val(r.Date.format(c.dateRange[e],"isoDate"))}),n.fire(a.FIRES.selected,l),n.hide()}}},a.METHODS={show:function(){var e=this;if(e.get("rendered")||e.render(),e.overlay){var n=t.clone(e.get("align"));n.node||(n.node=e.get("trigger")),e.overlay.set("align",n),e.overlay.show(),e.fire(a.FIRES.show)}},hide:function(){var t=this;t.overlay&&(t.overlay.hide(),t.fire(a.FIRES.hide))},toggle:function(t){var e=this;t&&t.preventDefault(),e.overlay?"hidden"==e.overlay.get("el").css("visibility")?e.show():e.hide():e.show()}},a.FIRES={selected:"selected",inputClick:"inputClick",show:"show",hide:"hide"},t.extend(a,e,{initialize:function(){var t=this;t.overlay=new n({srcNode:t.get("el")}),t.overlay.render()},destructor:function(){var e=this,n=t.one(e.get("trigger"));if(n){var r=e.get("triggerType");t.each(r,function(t){n.detach(t,e.toggle,e)})}e.calendar&&(e.calendar.destroy(),e.calendar=null),e.overlay&&(e.overlay.destroy(),e.overlay=null)}}),t.augment(a,a.METHODS),a},{requires:["brix/core/brick","overlay","../calendar/index"]});