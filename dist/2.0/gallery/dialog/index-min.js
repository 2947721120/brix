KISSY.add("brix/gallery/dialog/index",function(e,t,i){function n(){var t=this;n.superclass.constructor.apply(this,arguments);var t=this,i=e.one(t.get("trigger"));if(i){var a=t.get("triggerType");e.each(a,function(e){i.on(e,t.toggle,t)})}}return n.ATTRS={trigger:{value:!1},triggerType:{value:["click"]},start:{},end:{},elCls:{value:"dialog"},prefixCls:{value:"dialog-"},x:{getter:function(){var e=this;return e.get("start")?e.get("start").left:!1}},y:{getter:function(){var e=this;return e.get("start")?e.get("start").top:!1}},dir:{getter:function(){var e=this,t="",i=e.get("start"),n=e.get("end");return i.left===n.left&&i.top===n.top?!1:t=i.left===n.left&&(i.top<n.top?"down":"up")||i.top===n.top&&(i.left<n.left?"right":"left")||"left"}},duration:{value:.3},easing:{value:"easeNone"},closable:{value:!0},mask:{value:!1},tmpl:{value:null},data:{}},e.extend(n,i,{initializer:function(){var e=this;e.on("afterRenderUI",function(){var i=e.get("el").one(".dialog-ext-close");i.one(".dialog-ext-close-x").html("&#223"),i.on("mouseenter",function(){i.one(".dialog-ext-close-x").html("&#378")}),i.on("mouseleave",function(){i.one(".dialog-ext-close-x").html("&#223")}),e.get("tmpl")&&(e.pagelet=new t({container:e.get("contentEl"),tmpl:e.get("tmpl"),data:e.get("data")}))})},_visibilityChange:function(t,i){var n=this,a=n.get("el"),r=e.one("body"),o=e.one("html"),s="start";n.get("dir"),a.stop(),r.css({width:r.width(),height:r.height(),overflow:"hidden"}),o.css({width:r.width(),height:r.height(),overflow:"hidden"}),a.css("visibility","visible"),t?(a.css(n.get("start")),s="end"):(a.css(n.get("end")),s="start"),a.animate(n.get(s),n.get("duration"),n.get("easing"),function(){a.css("visibility",t?"visible":"hidden"),t||a.css({left:"-99999px",top:"-99999px"}),r.css({width:"",height:"",overflow:""}),o.css({width:"",height:"",overflow:""}),i&&i.call(n)})},bindUI:function(){var e=this,t=e.get("el");e.on("beforeVisibleChange",function(i){if(!e.get("start"))return!0;var n=i.newVal,a=e.get("dir");return t.removeClass("dialog-left").removeClass("dialog-right").removeClass("dialog-up").removeClass("dialog-down"),a&&t.addClass("dialog-"+a),n?void 0:(e._visibilityChange(n,function(){t.css("visibility","hidden"),e.set("visible",!1,{silent:!0}),e.fire("hide")}),!1)}),e.on("afterVisibleChange",function(t){if(!e.get("start"))return!0;var i=t.newVal;i&&e._visibilityChange(i)})},destructor:function(){var t=this,i=e.one(t.get("trigger"));if(i){var n=t.get("triggerType");e.each(n,function(e){i.detach(e,t.toggle,t)})}t.pagelet&&(t.pagelet.destroy(),t.pagelet=null)},toggle:function(e){var t=this;e&&e.preventDefault();var t=this,i=t.get("el");i?"hidden"==i.css("visibility")?t.show():t.hide():t.show()}}),n},{requires:["brix/core/pagelet","overlay"]});