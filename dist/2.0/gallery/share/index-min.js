KISSY.add("brix/gallery/share/index",function(t,e){function n(){n.superclass.constructor.apply(this,arguments)}return n.ATTRS={name:{value:"Share"},isFord:{value:!1},hastips:{value:""},duration:{value:.3}},n.METHODS={clearTimer:function(t){t.timer&&(clearTimeout(t.timer),t.timer=0)},turn:function(t,e,n,r,i,a,o){"Function"==typeof a&&a(),"animate"==e?t.animate(o,n,r,i):t[e](n,i,r)},unfold:function(t){var e=this;"popup"==e.get("type")?e.show(t):e.expand(t)},fold:function(t){var e=this;"popup"==e.get("type")?e.hide(t):e.shrink(t)},expand:function(e){var n=t.all,r=this,i=r.get("el"),a=n(".ext",i),o=n(".icon-arrow",i),s=r.get("duration");a.css(r.initProp),r.turn(a,"animate",s,"easeOut",function(){e(),o.filter(".icon-arrow-l").html("&#402;"),o.filter(".icon-arrow-r").html("&#403;"),o.filter(".icon-arrow-d").html("&#404;"),a.css({overflow:"visible"})},void 0,r.expendProp)},shrink:function(e){var n=t.all,r=this,i=r.get("el"),a=n(".ext",i),o=n(".icon-arrow",i),s=r.get("duration");a.css({overflow:"hidden"}),r.turn(a,"animate",s,"easeIn",function(){e(),o.filter(".icon-arrow-l").html("&#403;"),o.filter(".icon-arrow-r").html("&#402;"),o.filter(".icon-arrow-d").html("&#405;"),a.css(r.initProp)},void 0,r.shrinkProp)},show:function(e){var n=t.all,r=this,i=r.get("el"),a=" popup-share-active",o=t.one(".panel-popup",i),s=r.get("duration");n(i).addClass(a),r.turn(o,"fadeIn",s,"easeOut",e)},hide:function(e){var n=t.all,r=this,i=r.get("el"),a="popup-share-active",o=t.one(".panel-popup",i),s=r.get("duration");r.turn(o,"fadeOut",s,"easeIn",function(){e(),n(i).removeClass(a)})},showTips:function(e,n){var r=this,i=t.one(".tips",e),a=t.one(".angle",i),o=e.offset().left+Math.round(e.width()/2),s=Math.round(i.width()/2)+Math.round(e.width()/2),u={"margin-left":0-s+"px"},l=3;i&&(i.hasClass("tips-up")&&(l>o-s&&(u={"margin-left":0-(o-l)+"px"},0==e.offset().left?i.hasClass(".tips-up-left")||i.addClass(".tips-up-left"):a.css({"margin-left":o-s-l-5+"px"})),o+s+l>=t.DOM.viewportWidth()&&(u={"margin-left":0-(s+o+s+l-t.DOM.viewportWidth())+"px"},e.offset().left+e.outerWidth()+l>=t.DOM.viewportWidth()?(i.hasClass(".tips-up-right")||i.addClass(".tips-up-right"),a.css({left:s+Math.floor(i.width()/2)-3+"px"})):a.css({"margin-left":o+s+l-t.DOM.viewportWidth()-5+"px"})),i.css(u)),r.turn(i,"fadeIn",.3,"easeNone",n))},hideTips:function(e,n){var r=this,i=t.one(".tips",e);i&&r.turn(i,"fadeOut",.3,"easeNone",n)}},n.EVENTS={"":{mouseenter:function(){t.all;var e=this,n=e.get("isFord"),r=e.dispatcher,i=300;r&&e.clearTimer(r),n||(r.timer=setTimeout(function(){e.unfold(function(){e.set("isFord",!0)})},i))},mouseleave:function(){t.all;var e=this,n=e.get("isFord"),r=e.dispatcher,i=300;r&&e.clearTimer(r),n&&(r.timer=setTimeout(function(){e.fold(function(){e.set("isFord",!1)})},i))}},".btn-share":{mouseenter:function(e){var n=t.all,r=this,i=300,a=e.currentTarget.dispatcher,o=n(e.currentTarget);r.clearTimer(a),a.isTipsShow&&(a.timer=setTimeout(function(){r.get("hastips")&&(n(".btn-share",r.get("el")).each(function(t){t.children(".tips").hide(),t[0].dispatcher.isTipsShow=!0}),r.showTips(o,function(){a.isTipsShow=!1}))},i))},mouseleave:function(e){var n=t.all,r=this,i=300,a=e.currentTarget.dispatcher,o=n(e.currentTarget);r.clearTimer(a),a.isTipsShow||(a.timer=setTimeout(function(){r.get("hastips")&&r.hideTips(o,function(){a.isTipsShow=!0})},i))}}},t.extend(n,e,{initialize:function(){var e=t.all,n=this,r=n.get("el"),i=t.one(".ext",r);if(n.dispatcher={timer:0},i){n.initProp={opacity:0,overflow:"hidden"},n.expendProp={opacity:1},n.shrinkProp={opacity:0};var a="width";e(r).hasClass("share-vertical")&&(a="height"),n.initProp[a]=0,n.expendProp[a]=i[a]()+"px",n.shrinkProp[a]=0,i.css({display:""}),i.css(n.initProp)}e(".btn-share",n.get("el")).each(function(t){t[0].dispatcher={isTipsShow:!0,timer:0}})}}),t.augment(n,n.METHODS),n},{requires:["brix/core/brick"]});