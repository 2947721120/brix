KISSY.add("brix/gallery/searchbox/index",function(e,t){function i(){i.superclass.constructor.apply(this,arguments)}return i.ATTRS={el:{value:"#J_searchbox"},currentCls:{value:"selected"},suggestApi:{value:"data-suggest-api"},curItem:{value:{},getter:function(){return e.one(this.get("el")).one("."+this.get("currentCls"))}},menu:{value:{}},form:{value:{}},suggest:{value:{}}},i.DOCEVENTS={"":{click:function(t){var i=this,n=e.one(t.target);i.get("el").contains(n)||(i.hideTabs(),i.fire("afterBlur"))}}},i.EVENTS={".s-menu":{mouseenter:function(t){t.preventDefault();var i=e.one(t.currentTarget);i.one(".s-menu-list"),i.addClass("expand")},mouseleave:function(t){t.preventDefault();var i=e.one(t.currentTarget);i.one(".s-menu-list"),i.removeClass("expand")}},".s-menu-list li":{click:function(t){var i=this,n=e.one(t.currentTarget),a=i.get("currentCls");if(i.fire("beforeTabChange",{eventData:t.currentTarget}),!n.hasClass(a)){var r=i.get("el").all("li"),o=i.get("el").one(".s-menu-selected span");r.removeClass(a),n.addClass(a),o.html(n.one("a").html()),i.menu.removeClass("expand"),""!==i.ipt.getDOMNode().value&&i._fireEvent(i.form.getDOMNode(),"submit")}}},".searchbox-input":{focus:function(t){var i=this,n=t.currentTarget,a=i.get("curItem").attr(i.get("suggestApi"));i.suggestApi&&i.suggestApi!==a&&(i.detach(t.type,arguments.callee),i.suggest.on("beforeStart",function(){return!1}),i.suggest=void 0),!a||i.suggestApi&&i.suggestApi===a||e.use("suggest",function(){i._initSuggest(n,a)}),i.suggestApi=a,i.showTabs(),i.fire("afterFocus",{eventData:n})}},form:{submit:function(e){var t=this;t.fire("beforeSubmit",{eventData:e.target});var i=t.get("curItem").one("a");if(""===t.ipt.getDOMNode().value)e.halt(!0),t.focusInput();else{var n=i.attr("href"),a=e.target;a.action=n,t._parseAction(a,n)}}}},i.METHODS={showTabs:function(){var e=this;e.form.addClass("s-focus")},hideTabs:function(){var e=this;e.form.removeClass("s-focus")},focusInput:function(){var e=this;e.ipt.getDOMNode().focus()}},i.FIRES={afterLoad:"afterLoad",beforeTabChange:"beforeTabChange",beforeSubmit:"beforeSubmit",afterFocus:"aferFocus",afterBlur:"afterBlur"},e.extend(i,t,{initialize:function(){var e=this;e.menu=e.get("el").one(".s-menu"),e.form=e.get("el").one("form"),e.ipt=e.get("el").one(".searchbox-input"),e.fire("afterLoad")},destructor:function(){},_parseAction:function(t,i){if(-1!==i.indexOf("?"))for(var n=i.substring(i.indexOf("?")+1,i.length).split("&"),a=0,r=n.length;r>a;a++)if(""!==e.trim(n[a])){var o=n[a].split("=");this._writeHiddenInput(t,o[0],o[1])}},_writeHiddenInput:function(t,i,n){var a=t[i];return a?a.value=n:(a=e.DOM.create('<input type="hidden" name="'+i+'" value="'+n+'" />'),t.appendChild(a)),a},_initSuggest:function(t,i){var n=this;n.suggest=new e.Suggest(t,i,{resultFormat:"%result%",offset:0}),n.suggest.on("beforeShow",function(){n._keyword()}),n.suggest.on("itemSelect",function(){var t=e.DOM,i=this.selectedItem,a=t.query("li",this.containers),r=e.get("form",n.get("el"));n._writeHiddenInput(r,"wq",t.attr(i,"key")),n._writeHiddenInput(r,"suggest","0_"+e.indexOf(i,a))}),n.suggest.on("beforeSubmit",function(){return""===t.value?!1:void 0})},_keyword:function(){var t=e.DOM,i=this,n=i.suggest,a=n.query,r=a.length;e.each(t.query("li",n.content),function(e){var i=t.get(".ks-suggest-key",e),n=t.html(i);0===n.indexOf(a)&&t.html(i,n.substring(0,r)+"<b>"+n.substring(r,n.length)+"</b>")})},_fireEvent:function(e,t){if(document.createEvent){var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!0),e.dispatchEvent(i)}else if(document.createEventObject){var i=document.createEventObject();e.fireEvent("on"+t,i)}}}),e.augment(i,i.METHODS),i},{requires:["brix/core/brick"]});