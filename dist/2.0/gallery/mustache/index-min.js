KISSY.add("brix/gallery/mustache/index",function(){function e(e,t){return b.call(e,t)}function t(t){return!e(f,t)}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return k[e]})}function n(e){this.string=e,this.tail=e,this.pos=0}function r(e,t){this.view=e,this.parent=t,this._cache={}}function o(){this.clearCache()}function s(e,t,i,a){for(var n,r,o,l="",c=0,d=e.length;d>c;++c)switch(n=e[c],r=n[1],n[0]){case"#":if(o=i.lookup(r),"object"==typeof o)if(y(o))for(var p=0,h=o.length;h>p;++p)l+=s(n[4],t,i.push(o[p]),a);else o&&(l+=s(n[4],t,i.push(o),a));else if("function"==typeof o){var f=null==a?null:a.slice(n[3],n[5]);o=o.call(i.view,f,function(e){return t.render(e,i)}),null!=o&&(l+=o)}else o&&(l+=s(n[4],t,i,a));break;case"^":o=i.lookup(r),(!o||y(o)&&0===o.length)&&(l+=s(n[4],t,i,a));break;case">":o=t.getPartial(r),"function"==typeof o&&(l+=o(i));break;case"&":o=i.lookup(r),null!=o&&(l+=o);break;case"name":o=i.lookup(r),null!=o&&(l+=u.escape(o));break;case"text":l+=r}return l}function l(e){for(var t,i=[],a=i,n=[],r=0,o=e.length;o>r;++r)switch(t=e[r],t[0]){case"#":case"^":n.push(t),a.push(t),a=t[4]=[];break;case"/":var s=n.pop();s[5]=t[2],a=n.length>0?n[n.length-1][4]:i;break;default:a.push(t)}return i}function c(e){for(var t,i,a=[],n=0,r=e.length;r>n;++n)t=e[n],t&&("text"===t[0]&&i&&"text"===i[0]?(i[1]+=t[1],i[3]=t[3]):(i=t,a.push(t)));return a}function d(e){return[RegExp(i(e[0])+"\\s*"),RegExp("\\s*"+i(e[1]))]}var u={};u.name="mustache.js",u.version="0.7.2",u.tags=["{{","}}"],u.Scanner=n,u.Context=r,u.Writer=o;var p=/\s*/,h=/\s+/,f=/\S/,g=/\s*=/,v=/\s*\}/,m=/#|\^|\/|>|\{|&|=|!/,b=RegExp.prototype.test,x=Object.prototype.toString,y=Array.isArray||function(e){return"[object Array]"===x.call(e)},k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};u.escape=a,n.prototype.eos=function(){return""===this.tail},n.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},n.prototype.scanUntil=function(e){var t,i=this.tail.search(e);switch(i){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,i),this.tail=this.tail.substring(i),this.pos+=i}return t},r.make=function(e){return e instanceof r?e:new r(e)},r.prototype.push=function(e){return new r(e,this)},r.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."==e)t=this.view;else for(var i=this;i;){if(e.indexOf(".")>0){t=i.view;for(var a=e.split("."),n=0;t&&a.length>n;)t=t[a[n++]]}else t=i.view[e];if(null!=t)break;i=i.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},o.prototype.clearCache=function(){this._cache={},this._partialCache={}},o.prototype.compile=function(e,t){var i=this._cache[e];if(!i){var a=u.parse(e,t);i=this._cache[e]=this.compileTokens(a,e)}return i},o.prototype.compilePartial=function(e,t,i){var a=this.compile(t,i);return this._partialCache[e]=a,a},o.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},o.prototype.compileTokens=function(e,t){var i=this;return function(a,n){if(n)if("function"==typeof n)i._loadPartial=n;else for(var o in n)i.compilePartial(o,n[o]);return s(e,i,r.make(a),t)}},o.prototype.render=function(e,t,i){return this.compile(e)(t,i)},u.parse=function(e,a){function r(){if(S&&!D)for(;T.length;)delete _[T.pop()];else T=[];S=!1,D=!1}if(e=e||"",a=a||u.tags,"string"==typeof a&&(a=a.split(h)),2!==a.length)throw Error("Invalid tags: "+a.join(", "));for(var o,s,f,b,x,y=d(a),k=new n(e),w=[],_=[],T=[],S=!1,D=!1;!k.eos();){if(o=k.pos,f=k.scanUntil(y[0]))for(var E=0,C=f.length;C>E;++E)b=f.charAt(E),t(b)?T.push(_.length):D=!0,_.push(["text",b,o,o+1]),o+=1,"\n"==b&&r();if(!k.scan(y[0]))break;if(S=!0,s=k.scan(m)||"name",k.scan(p),"="===s?(f=k.scanUntil(g),k.scan(g),k.scanUntil(y[1])):"{"===s?(f=k.scanUntil(RegExp("\\s*"+i("}"+a[1]))),k.scan(v),k.scanUntil(y[1]),s="&"):f=k.scanUntil(y[1]),!k.scan(y[1]))throw Error("Unclosed tag at "+k.pos);if(x=[s,f,o,k.pos],_.push(x),"#"===s||"^"===s)w.push(x);else if("/"===s){if(0===w.length)throw Error('Unopened section "'+f+'" at '+o);var R=w.pop();if(R[1]!==f)throw Error('Unclosed section "'+R[1]+'" at '+o)}else if("name"===s||"{"===s||"&"===s)D=!0;else if("="===s){if(a=f.split(h),2!==a.length)throw Error("Invalid tags at "+o+": "+a.join(", "));y=d(a)}}var R=w.pop();if(R)throw Error('Unclosed section "'+R[1]+'" at '+k.pos);return _=c(_),l(_)};var w=new o;return u.clearCache=function(){return w.clearCache()},u.compile=function(e,t){return w.compile(e,t)},u.compilePartial=function(e,t,i){return w.compilePartial(e,t,i)},u.compileTokens=function(e,t){return w.compileTokens(e,t)},u.render=function(e,t,i){return w.render(e,t,i)},u.to_html=function(e,t,i,a){var n=u.render(e,t,i);return"function"!=typeof a?n:(a(n),void 0)},u});