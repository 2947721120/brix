KISSY.add("brix/gallery/mustache/index",function(){function t(t,e){return y.call(t,e)}function e(e){return!t(g,e)}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(t){return(t+"").replace(/[&<>"'\/]/g,function(t){return _[t]})}function i(t){this.string=t,this.tail=t,this.pos=0}function a(t,e){this.view=t,this.parent=e,this._cache={}}function o(){this.clearCache()}function u(t,e,n,r){for(var i,a,o,s="",c=0,l=t.length;l>c;++c)switch(i=t[c],a=i[1],i[0]){case"#":if(o=n.lookup(a),"object"==typeof o)if(x(o))for(var h=0,d=o.length;d>h;++h)s+=u(i[4],e,n.push(o[h]),r);else o&&(s+=u(i[4],e,n.push(o),r));else if("function"==typeof o){var g=null==r?null:r.slice(i[3],i[5]);o=o.call(n.view,g,function(t){return e.render(t,n)}),null!=o&&(s+=o)}else o&&(s+=u(i[4],e,n,r));break;case"^":o=n.lookup(a),(!o||x(o)&&0===o.length)&&(s+=u(i[4],e,n,r));break;case">":o=e.getPartial(a),"function"==typeof o&&(s+=o(n));break;case"&":o=n.lookup(a),null!=o&&(s+=o);break;case"name":o=n.lookup(a),null!=o&&(s+=f.escape(o));break;case"text":s+=a}return s}function s(t){for(var e,n=[],r=n,i=[],a=0,o=t.length;o>a;++a)switch(e=t[a],e[0]){case"#":case"^":i.push(e),r.push(e),r=e[4]=[];break;case"/":var u=i.pop();u[5]=e[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(e)}return n}function c(t){for(var e,n,r=[],i=0,a=t.length;a>i;++i)e=t[i],e&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(n=e,r.push(e)));return r}function l(t){return[RegExp(n(t[0])+"\\s*"),RegExp("\\s*"+n(t[1]))]}var f={};f.name="mustache.js",f.version="0.7.2",f.tags=["{{","}}"],f.Scanner=i,f.Context=a,f.Writer=o;var h=/\s*/,d=/\s+/,g=/\S/,p=/\s*=/,v=/\s*\}/,m=/#|\^|\/|>|\{|&|=|!/,y=RegExp.prototype.test,b=Object.prototype.toString,x=Array.isArray||function(t){return"[object Array]"===b.call(t)},_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};f.escape=r,i.prototype.eos=function(){return""===this.tail},i.prototype.scan=function(t){var e=this.tail.match(t);return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},i.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return e},a.make=function(t){return t instanceof a?t:new a(t)},a.prototype.push=function(t){return new a(t,this)},a.prototype.lookup=function(t){var e=this._cache[t];if(!e){if("."==t)e=this.view;else for(var n=this;n;){if(t.indexOf(".")>0){e=n.view;for(var r=t.split("."),i=0;e&&r.length>i;)e=e[r[i++]]}else e=n.view[t];if(null!=e)break;n=n.parent}this._cache[t]=e}return"function"==typeof e&&(e=e.call(this.view)),e},o.prototype.clearCache=function(){this._cache={},this._partialCache={}},o.prototype.compile=function(t,e){var n=this._cache[t];if(!n){var r=f.parse(t,e);n=this._cache[t]=this.compileTokens(r,t)}return n},o.prototype.compilePartial=function(t,e,n){var r=this.compile(e,n);return this._partialCache[t]=r,r},o.prototype.getPartial=function(t){return t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t)),this._partialCache[t]},o.prototype.compileTokens=function(t,e){var n=this;return function(r,i){if(i)if("function"==typeof i)n._loadPartial=i;else for(var o in i)n.compilePartial(o,i[o]);return u(t,n,a.make(r),e)}},o.prototype.render=function(t,e,n){return this.compile(t)(e,n)},f.parse=function(t,r){function a(){if(S&&!E)for(;M.length;)delete k[M.pop()];else M=[];S=!1,E=!1}if(t=t||"",r=r||f.tags,"string"==typeof r&&(r=r.split(d)),2!==r.length)throw Error("Invalid tags: "+r.join(", "));for(var o,u,g,y,b,x=l(r),_=new i(t),w=[],k=[],M=[],S=!1,E=!1;!_.eos();){if(o=_.pos,g=_.scanUntil(x[0]))for(var T=0,D=g.length;D>T;++T)y=g.charAt(T),e(y)?M.push(k.length):E=!0,k.push(["text",y,o,o+1]),o+=1,"\n"==y&&a();if(!_.scan(x[0]))break;if(S=!0,u=_.scan(m)||"name",_.scan(h),"="===u?(g=_.scanUntil(p),_.scan(p),_.scanUntil(x[1])):"{"===u?(g=_.scanUntil(RegExp("\\s*"+n("}"+r[1]))),_.scan(v),_.scanUntil(x[1]),u="&"):g=_.scanUntil(x[1]),!_.scan(x[1]))throw Error("Unclosed tag at "+_.pos);if(b=[u,g,o,_.pos],k.push(b),"#"===u||"^"===u)w.push(b);else if("/"===u){if(0===w.length)throw Error('Unopened section "'+g+'" at '+o);var C=w.pop();if(C[1]!==g)throw Error('Unclosed section "'+C[1]+'" at '+o)}else if("name"===u||"{"===u||"&"===u)E=!0;else if("="===u){if(r=g.split(d),2!==r.length)throw Error("Invalid tags at "+o+": "+r.join(", "));x=l(r)}}var C=w.pop();if(C)throw Error('Unclosed section "'+C[1]+'" at '+_.pos);return k=c(k),s(k)};var w=new o;return f.clearCache=function(){return w.clearCache()},f.compile=function(t,e){return w.compile(t,e)},f.compilePartial=function(t,e,n){return w.compilePartial(t,e,n)},f.compileTokens=function(t,e){return w.compileTokens(t,e)},f.render=function(t,e,n){return w.render(t,e,n)},f.to_html=function(t,e,n,r){var i=f.render(t,e,n);return"function"!=typeof r?i:(r(i),void 0)},f});