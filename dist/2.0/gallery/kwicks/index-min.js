KISSY.add("brix/gallery/kwicks/index",function(a,b){function c(){c.superclass.constructor.apply(this,arguments)}return c.ATTRS={isVertical:{value:!1},sticky:{value:!1},activeIndex:{value:0},trigger:{value:"li"},triggerType:{value:"mouseenter"},activeCls:{value:"active"},spacing:{value:0},duration:{value:.3},easing:{value:"easeNone"},max:{value:!1},min:{value:!1},autoplay:{value:!1},interval:{value:3e3}},c.EVENTS={"":{mouseenter:function(){var a=this,b=a.get("autoplay");b&&a.stop()},mouseleave:function(){var a=this,b=a.get("autoplay"),c=a.get("sticky");if(b)a.start();else if(!c){var d=a.kwicks,e=d.length,f=a.get("activeCls"),g=a.get("spacing"),h=a.get("duration"),i=a.get("easing"),j=a.LoT,k=a.WoH,l=a.normWoH;d.stop().removeClass(f),d.each(function(a,b){var c={};c[k]=l,b<e&&(c[j]=b*l+b*g),a.animate(c,h,i)})}}}},c.FIRES={beforeSwitchTo:"beforeSwitch","switch":"switch"},c.METHODS={switchTo:function(b){if(this.fire(c.FIRES.beforeSwitch,{toIndex:b})===!1)return;var d=this,e=d.kwicks,f=e.length,g=d.preCalcLoTs,h=d.get("activeCls"),i=d.get("duration"),j=d.get("easing"),k=d.LoT,l=d.WoH,m=d.max,n=d.min;b>=f||b<0?(b=0,d.set("activeIndex",0)):d.set("activeIndex",b);var o=e.item(b);e.stop().removeClass(h),o.addClass(h);var p=0;e.each(function(e,h){var q={};o[0]==e[0]?q[l]=m:q[l]=n,q[k]=g[b][h],e.animate(q,i,j,function(){p++,p==f&&(a.log("fire switch"),d.fire(c.FIRES["switch"],{currentIndex:b}))})})},start:function(){var b=this,c=b.get("autoplay"),d=b.get("interval");c&&(b.stop(),b.timer=a.later(function(){var a=b.get("activeIndex");b.switchTo(a+1)},d,!0,b))},stop:function(){var a=this;a.timer&&(a.timer.cancel(),a.timer=null)}},a.extend(c,b,{initialize:function(){var a=this,b=a.get("isVertical"),c=a.get("sticky"),d=a.get("activeIndex"),e=a.get("triggerType"),f=a.get("activeCls"),g=a.get("spacing"),h=a.get("duration"),i=a.get("easing"),j=a.max=a.get("max"),k=a.min=a.get("min"),l=a.get("autoplay"),m=a.WoH=b?"height":"width",n=a.LoT=b?"top":"left",o=a.get("el"),p=a.kwicks=o.all(a.get("trigger")),q=p.length,r=a.normWoH=p.item(0).css(m).replace(/px/,"");j?k=a.min=(r*q-j)/(q-1):j=a.max=r*q-k*(q-1),b?o.css({width:p.item(0).css("width"),height:r*q+g*(q-1)+"px"}):o.css({width:r*q+g*(q-1)+"px",height:p.item(0).css("height")});var s=a.preCalcLoTs=[];for(var t=0;t<q;t++){s[t]=[];for(var u=0;u<q;u++)t==u?s[t][u]=b?u*k+u*g:u*k+u*g:s[t][u]=(u<t?u*k:(u-1)*k+j)+u*g}p.each(function(b,h){c?b.css(n,s[d][h]):b.css(n,h*r+h*g),c&&(d==h?(b.css(m,j+"px"),b.addClass(f)):b.css(m,k+"px")),b.css({margin:0,position:"absolute"}),b.on(e,function(){a.switchTo(h)})}),a.start()},destructor:function(){self.timer&&(self.timer.cancel(),self.timer=null,self.kwicks=null)}}),a.augment(c,c.METHODS),c},{requires:["brix/core/brick"]});