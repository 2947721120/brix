KISSY.add("brix/gallery/slider/index",function(e,t,i,a,n){function r(){r.superclass.constructor.apply(this,arguments)}r.FIRES={drag:"drag",dragstart:"dragstart",dragend:"dragend",resize:"resize"};var o={horizontal:"horizontal",vertical:"vertical"};return r.ATTRS={range:{value:!1},mode:{value:"horizontal"},startStep:{value:0},endStep:{value:100},integerStep:{value:1},current:{},knobOffset:{value:-7}},r.METHODS={resize:function(){this.fire(r.FIRES.resize)},destructor:function(){this.knob.destroy(),this.knob_start&&this.knob_start.destroy(),this.knobNode=null,this.knobNode_start=null,self.detach()}},e.extend(r,t,{initialize:function(){this._render_range(),this._render_knob()},_render_knob:function(){function t(){var t=u.value,a=w?d.height():d.width();e.isArray(t)?(t[0]=i(t[0],f,h),t[1]=i(t[1],f,h),x=a*(t[1]-f)/(h-f),y=a*(t[0]-f)/(h-f),m.css(S,x),b.css(S,y),v.css(S,y),v.css(T,Math.abs(x-y)),y==a?b.css("zIndex",2):b.css("zIndex","auto")):(t=i(t,f,h),x=a*(t-f)/(h-f),v.css(T,Math.abs(x)),m.css(S,x))}function i(t,i,a){return e.isUndefined(t)&&(t=i),i>t&&a>t&&(t=i),t>a&&t>i&&(t=a),t}function a(){var t=w?d.height():d.width(),i=(h-f)*x/t+f,a=null===y?null:(h-f)*y/t+f;g&&(i=Math.round(i/g)*g,a=null===a?null:Math.round(a/g)*g),e.log("("+h+"-"+f+")*"+x+"/"+t+"+"+f),u.value=b?[a,i]:i,s(u.value),u.fire(r.FIRES.drag,{data:u.value,current:u.get("current")}),e.log("Slider: change="+u.value+","+u.get("current"))}function s(t){var i,a=u.get("range");e.isArray(t)&&(h>f&&t[0]>t[1]&&(t=[t[1],t[0]]),f>h&&t[0]<t[1]&&(t=[t[1],t[0]])),i=t,e.isArray(u.get("range"))&&(i=e.isArray(t)?[a[t[0]],a[t[1]]]:a[t]),u.set("current",i)}function l(){u.fire(r.FIRES.dragstart,{data:u.value,current:u.get("current")})}function c(){t(),u.fire(r.FIRES.dragend,{data:u.value,current:u.get("current")})}var u=this,d=u.get("el"),p=u.get("mode"),f=u.get("startStep"),h=u.get("endStep"),g=u.get("integerStep"),v=d.one(".slider-bar"),m=d.one(".slider-knob-end"),b=this.knobNode_start=d.one(".slider-knob-start"),x=0,y=null,k=u.get("knobOffset"),w=p===o.horizontal?!1:!0,_=w?"top":"left",S=w?"bottom":"left",T=w?"height":"width";m=m||d.one(".slider-knob"),this.knobNode=m;var E=u.knob=new n.Draggable({node:m,cursor:"move"});if(E.on("drag",function(e){var t=d.offset(),n=w?d.height():d.width(),r=x=e[_]-t[_]-k;w&&(x=n-r),x=i(x,y||0,n),v.css(T,Math.abs(x-(y||0))),v.css(S,y||0),m.css(S,x),a({target:m})}),E.on("dragstart",l),E.on("dragend",c),b){var C=u.knob_start=new n.Draggable({node:b,cursor:"move"});C.on("drag",function(e){var t=d.offset(),n=w?d.height():d.width(),r=y=e[_]-t[_]-k;w&&(y=n-r),y=i(y,0,x),v.css(S,y),v.css(T,Math.abs(x-y)),b.css(S,y),a({target:b})}),C.on("dragstart",l),C.on("dragend",c)}e.isUndefined(u.get("current"))||(u.value=u.value||u.get("current"),t()),u.on(r.FIRES.resize,t)},_render_range:function(){e.isArray(this.get("range"))&&(this.set("endStep",this.get("range").length-1),e.log("slider: range "+this.get("range")),e.isString(this.get("current"))&&(this.value=e.indexOf(this.get("current"),this.get("range"))))}}),e.augment(r,r.METHODS),r},{requires:["brix/core/brick","ua","node","dd"]});