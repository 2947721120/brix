KISSY.add("brix/gallery/slider/index",function(e,t,i,a,n){function r(){r.superclass.constructor.apply(this,arguments)}r.FIRES={drag:"drag",dragstart:"dragstart",dragend:"dragend",resize:"resize"};var s={horizontal:"horizontal",vertical:"vertical"};return r.ATTRS={range:{value:!1},mode:{value:"horizontal"},startStep:{value:0},endStep:{value:100},integerStep:{value:1},current:{},knobOffset:{value:-7}},r.METHODS={resize:function(){this.fire(r.FIRES.resize)},destructor:function(){this.knob.destroy(),this.knob_start&&this.knob_start.destroy(),this.knobNode=null,this.knobNode_start=null,self.detach()}},e.extend(r,t,{initialize:function(){this._render_range(),this._render_knob()},_render_knob:function(){function t(){var t=d.value,a=k?u.height():u.width();e.isArray(t)?(t[0]=i(t[0],p,h),t[1]=i(t[1],p,h),y=a*(t[1]-p)/(h-p),x=a*(t[0]-p)/(h-p),m.css(T,y),b.css(T,x),v.css(T,x),v.css(_,Math.abs(y-x)),x==a?b.css("zIndex",2):b.css("zIndex","auto")):(t=i(t,p,h),y=a*(t-p)/(h-p),v.css(_,Math.abs(y)),m.css(T,y))}function i(t,i,a){return e.isUndefined(t)&&(t=i),i>t&&a>t&&(t=i),t>a&&t>i&&(t=a),t}function a(){var t=k?u.height():u.width(),i=(h-p)*y/t+p,a=null===x?null:(h-p)*x/t+p;g&&(i=Math.round(i/g)*g,a=null===a?null:Math.round(a/g)*g),e.log("("+h+"-"+p+")*"+y+"/"+t+"+"+p),d.value=b?[a,i]:i,o(d.value),d.fire(r.FIRES.drag,{data:d.value,current:d.get("current")}),e.log("Slider: change="+d.value+","+d.get("current"))}function o(t){var i,a=d.get("range");e.isArray(t)&&(h>p&&t[0]>t[1]&&(t=[t[1],t[0]]),p>h&&t[0]<t[1]&&(t=[t[1],t[0]])),i=t,e.isArray(d.get("range"))&&(i=e.isArray(t)?[a[t[0]],a[t[1]]]:a[t]),d.set("current",i)}function l(){d.fire(r.FIRES.dragstart,{data:d.value,current:d.get("current")})}function c(){t(),d.fire(r.FIRES.dragend,{data:d.value,current:d.get("current")})}var d=this,u=d.get("el"),f=d.get("mode"),p=d.get("startStep"),h=d.get("endStep"),g=d.get("integerStep"),v=u.one(".slider-bar"),m=u.one(".slider-knob-end"),b=this.knobNode_start=u.one(".slider-knob-start"),y=0,x=null,w=d.get("knobOffset"),k=f===s.horizontal?!1:!0,S=k?"top":"left",T=k?"bottom":"left",_=k?"height":"width";m=m||u.one(".slider-knob"),this.knobNode=m;var C=d.knob=new n.Draggable({node:m,cursor:"move"});if(C.on("drag",function(e){var t=u.offset(),n=k?u.height():u.width(),r=y=e[S]-t[S]-w;k&&(y=n-r),y=i(y,x||0,n),v.css(_,Math.abs(y-(x||0))),v.css(T,x||0),m.css(T,y),a({target:m})}),C.on("dragstart",l),C.on("dragend",c),b){var E=d.knob_start=new n.Draggable({node:b,cursor:"move"});E.on("drag",function(e){var t=u.offset(),n=k?u.height():u.width(),r=x=e[S]-t[S]-w;k&&(x=n-r),x=i(x,0,y),v.css(T,x),v.css(_,Math.abs(y-x)),b.css(T,x),a({target:b})}),E.on("dragstart",l),E.on("dragend",c)}e.isUndefined(d.get("current"))||(d.value=d.value||d.get("current"),t()),d.on(r.FIRES.resize,t)},_render_range:function(){e.isArray(this.get("range"))&&(this.set("endStep",this.get("range").length-1),e.log("slider: range "+this.get("range")),e.isString(this.get("current"))&&(this.value=e.indexOf(this.get("current"),this.get("range"))))}}),e.augment(r,r.METHODS),r},{requires:["brix/core/brick","ua","node","dd"]});