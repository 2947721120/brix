KISSY.add("brix/gallery/colorpicker/index",function(e,t,i,n){function r(e,t,i){e=document.createElementNS("http://www.w3.org/2000/svg",e);for(var n in t)e.setAttribute(n,t[n]);"[object Array]"!=Object.prototype.toString.call(i)&&(i=[i]);for(var r=0,a=i[0]&&i.length||0;a>r;r++)e.appendChild(i[r]);return e}function a(){a.superclass.constructor.apply(this,arguments);var t=this,i=e.one(t.get("trigger"));if(i){var n=t.get("triggerType");e.each(n,function(e){i.on(e,t.toggle,t)})}}var o=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";return a.ATTRS={min:{value:!1},trigger:{value:!1},triggerType:{value:["click"]},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},colorList:{value:["#d81e06","#f4ea2a","#1afa29","#1296db","#13227a","#d4237a","#ffffff","#e6e6e6","#dbdbdb","#cdcdcd","#bfbfbf","#8a8a8a","#707070","#515151","#2c2c2c","#000000","#ea986c","#eeb174","#f3ca7e","#f9f28b","#c8db8c","#aad08f","#87c38f","#83c6c2","#7dc5eb","#87a7d6","#8992c8","#a686ba","#bd8cbb","#be8dbd","#e89abe","#e8989a","#e16632","#e98f36","#efb336","#f6ef37","#afcd51","#7cba59","#36ab60","#1baba8","#17ace3","#3f81c1","#4f68b0","#594d9c","#82529d","#a4579d","#db649b","#dd6572","#d81e06","#e0620d","#ea9518","#f4ea2a","#8cbb1a","#2ba515","#0e932e","#0c9890","#1295db","#0061b2","#0061b0","#004198","#122179","#88147f","#d3227b","#d6204b"]},data:{valueFn:function(){return{colorList:this.get("colorList"),color:this.get("color"),min:this.get("min")}}},tmpl:{value:'<div class="colorpicker"><div class="colorpicker-hd"><ul>{{#colorList}}<li val="{{.}}" style="background-color:{{.}};"></li>{{/colorList}}</ul></div><div class="colorpicker-md"><i class="iconfont icon-arrow {{^min}}icon-arrow-up{{/min}}">{{#min}}&#405{{/min}}{{^min}}&#404{{/min}}</i></div><div class="colorpicker-bd {{#min}}colorpicker-bd-min{{/min}}"><div class="picker-wrapper"><div class="picker"></div><i class="iconfont icon-picker-indicator">&#470</i></div><div class="slide-wrapper"><div class="slide"></div><i class="iconfont icon-slide-indicator">&#461</i></div></div><div class="colorpicker-fd"><span class="bg" style="background-color:{{color}}"></span><input class="input" value="{{color}}"><a class="btn btn-size25 btn-confirm">\u786e\u5b9a</a></div></div>'},color:{value:"#ffffff"},autoRender:{value:!1}},a.DOCEVENTS={"":{click:function(t){var i=this,n=i.get("el"),r=e.one(t.target),a=e.one(i.get("trigger"));n.equals(r)||n.contains(r)||!a||a.contains(r)||r[0]==a[0]||i.hide()}}},a.EVENTS={".picker":{click:function(e){var t=this,i=t.pickerNode.offset(),n=e.pageX-i.left,r=e.pageY-i.top,a=t.pickerNode.width(),o=t.pickerNode.height(),s=n/a,l=(o-r)/o;t.setHsv({h:t.h,s:s,v:l})}},".slide":{click:function(e){var t=this,i=t.slideNode.offset(),n=t.slideNode.height(),r=e.pageY-i.top>=n?n-1:e.pageY-i.top,a=360*(r/n);t.setHsv({h:a,s:t.s,v:t.v})}},".btn-confirm":{click:function(){this._fireSelected()}},li:{click:function(t){var i=e.one(t.currentTarget).attr("val");this.setHex(i),e.one(t.currentTarget).addClass("selected")}},".icon-arrow":{click:function(t){var i=this,n=i.get("el").one(".colorpicker-bd"),r=e.one(t.currentTarget);n.stop(),r.hasClass("icon-arrow-up")?(r.removeClass("icon-arrow-up"),n.css("overflow","hidden"),n.animate({height:0,marginBottom:0},.3,"easyNone",function(){r.html("&#405")})):(r.addClass("icon-arrow-up"),n.animate({height:196,marginBottom:10},.3,"easyNone",function(){r.html("&#404"),n.css("overflow","visible")}))}},input:{blur:function(t){var i=this,n=e.one(t.currentTarget).val();i.get("color")!=n&&this.setHex(n)}}},a.FIRES={selected:"selected",show:"show",hide:"hide"},a.METHODS={show:function(){var t=this;if(t.get("rendered")||t.render(),t.overlay){var i=e.clone(t.get("align"));i.node||(i.node=t.get("trigger")),t.overlay.set("align",i),t.overlay.show(),t.fire(a.FIRES.show)}},hide:function(){var e=this;e.overlay&&(e.overlay.hide(),e.fire(a.FIRES.hide))},toggle:function(e){var t=this;e&&e.preventDefault(),t.overlay?"hidden"==t.overlay.get("el").css("visibility")?t.show():t.hide():t.show()},hsv2rgb:function(e,t,i){var n,r,a,o,s;e=e%360/60,s=i*t,o=s*(1-Math.abs(e%2-1)),n=r=a=i-s,e=~~e,n+=[s,o,0,0,o,s][e],r+=[o,s,s,o,0,0][e],a+=[0,0,o,s,s,o][e];var l=255*n,c=255*r,u=255*a;return{r:l,g:c,b:u,hex:"#"+(16777216|u|c<<8|l<<16).toString(16).slice(1)}},rgb2hsv:function(e,t,i){(e>1||t>1||i>1)&&(e/=255,t/=255,i/=255);var n,r,a,o;return a=Math.max(e,t,i),o=a-Math.min(e,t,i),n=0==o?null:a==e?(t-i)/o+(i>t?6:0):a==t?(i-e)/o+2:(e-t)/o+4,n=60*(n%6),r=0==o?0:o/a,{h:n,s:r,v:a}},setColor:function(e){var t=this,i=t.get("el");t.h=e.h%360,t.s=e.s,t.v=e.v;var n=t.hsv2rgb(t.h,t.s,t.v);t.slideDragNode.css({top:Math.round(t.h*t.slideNode.height()/360-5)});var r=Math.round(t.s*t.pickerNode.width()-5),a=Math.round((1-t.v)*t.pickerNode.height()-5);t.pickerDragNode.css({left:r,top:a,color:a>98?"#fff":"#000"}),t.pickerNode.css({"background-color":t.hsv2rgb(t.h,1,1).hex}),i.one(".bg").css({"background-color":n.hex}),t.set("color",n.hex),i.all("li").removeClass("selected"),i.one("input").val(n.hex)},setHsv:function(e){this.setColor(e)},setRgb:function(e){this.setColor(this.rgb2hsv(e.r,e.g,e.b),e)},setHex:function(e){this.setColor(this.rgb2hsv(parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16)),void 0,e)}},e.extend(a,t,{initialize:function(){var e=this;this.h=0,this.s=this.v=1;var t=e.get("align");e.overlay=new i({srcNode:e.get("el"),align:t}),e.overlay.render();var a=e.get("el"),s=e.slideNode=a.one(".slide"),l=e.pickerNode=a.one(".picker");"SVG"==o?(s.append(r("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[r("defs",{},r("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[r("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),r("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),r("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),r("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),r("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),r("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),r("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),r("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),r("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),r("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})])),l.append(r("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[r("defs",{},[r("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[r("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),r("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),r("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[r("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),r("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),r("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),r("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})]))):(document.namespaces.v||document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),s.html(['<div style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></v:fill>',"</v:rect>","</div>"].join("")),l.html(['<div style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; left: -1px; top: -1px; width: 101%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>",'<v:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>","</div>"].join("")));var c=e.pickerDragNode=a.one(".icon-picker-indicator"),u=e.slideDragNode=a.one(".icon-slide-indicator"),d=new n.Draggable({node:c,cursor:"move"});d.on("drag",function(t){var i=l.offset(),n=l.width(),r=l.height(),a=t.left-i.left,o=t.top-i.top;a+5>n?a=n:0>a?a=0:a+=5,o+5>r?o=r:0>o?o=0:o+=5;var s=a/n,c=(r-o)/r;e.setHsv({h:e.h,s:s,v:c})});var f=new n.Draggable({node:u,cursor:"move"});f.on("drag",function(t){var i=s.offset(),n=s.height(),r=t.top-i.top;r+5>n?r=n-1:0>r?r=0:r+=5,h=360*(r/e.slideNode.height()),e.setHsv({h:h,s:e.s,v:e.v})}),e.setHex(e.get("color"))},_fireSelected:function(){var e=this,t=e.hsv2rgb(e.h,e.s,e.v);e.overlay.hide(),e.fire(a.FIRES.selected,{hex:t.hex,hsv:{h:e.h,s:e.s,v:e.v},rgb:{r:t.r,g:t.g,b:t.b}})},destructor:function(){var t=this,i=e.one(t.get("trigger"));if(i){var n=t.get("triggerType");e.each(n,function(e){i.detach(e,t.toggle,t)})}t.overlay&&(t.overlay.destroy(),t.overlay=null)}}),e.augment(a,a.METHODS),a},{requires:["brix/core/brick","overlay","dd"]});