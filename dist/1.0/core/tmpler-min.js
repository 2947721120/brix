KISSY.add("brix/core/tmpler",function(a,b,c){function e(a,b){a&&b!==!1?(this.tmpls=[],this._praseTmpl(a)):this.tmpl=a}var d=c.all;return a.extend(e,Object,{_praseTmpl:function(a){var b=this,c=!1,e,f;if(typeof a=="string"){if(a.charAt(0)==="."||a.charAt(0)==="#"||a==="body")e=d(a)}else e=a;e&&(e.item(0)[0].nodeName.toUpperCase()=="SCRIPT"?a=e.item(0).html():c=!0),c||(b._buildTmpls(a),b.tmpl=b._replaceTmpl(a)),b.inDom=c},_buildTmpls:function(a){var b=this,c=/<!--bx-tmpl="(.*)?".*?bx-datakey="(.+)?"-->(\s*([\s\S]*)?\s*)<!--bx-tmpl="\1"-->/g,d;while((d=c.exec(a))!==null)b.tmpls.push({name:d[1],datakey:d[2],tmpler:new e(b._replaceTmpl(d[3]),!1)}),b._buildTmpls(d[3])},_replaceTmpl:function(a){var b=/<!--bx-tmpl="(.*)?".*?bx-datakey="(.+)?"-->(\s*([\s\S]*)?\s*)<!--bx-tmpl="\1"-->/g,c;while(b.test(a))a=a.replace(b,function(a,b,c,d){return d}),b.lastIndex=0;return a},addTmpl:function(a,b,c){var d=this;d.tmpls.push({id:a,datakey:b,tmpler:new e(c,!1)})},getTmpl:function(){return this.tmpl},to_html:function(a){return b.to_html(this.getTmpl(),a)}}),e},{requires:["./mu","node","sizzle"]});