KISSY.add("brix/core/chunk",function(a,b,c,d,e,f){function h(){h.superclass.constructor.apply(this,arguments),this._buildTmpler(),this.get("id")||this.set("id","brix_"+a.guid())}var g=b.all;return h.ATTRS={id:{value:!1},el:{getter:function(b){return a.isString(b)&&(b=g(b)),b}},isRemoveEl:{value:!0},container:{value:"body",getter:function(b){return a.isString(b)&&(b=g(b)),b}},tmpl:{value:!1},tmpler:{value:!1},rendered:{value:!1},autoRender:{value:!0},data:{value:!1},dataset:{value:!1}},a.extend(h,d,{_buildTmpler:function(){var a=this,b=a.get("tmpler");if(!b){var c=a.get("tmpl");c&&(b=new f(c),a.set("tmpler",b),b.inDom&&a.set("el",c))}b&&!b.inDom&&a._buildDataset()},_buildDataset:function(){var b=this,c=b.get("dataset");if(!c){var d=b.get("data")||{};d=a.clone(d),c=new e({data:d}),b.set("dataset",c)}c.on("afterDataChange",function(a){b._render(a.subAttrName,a.newVal)})},addTmpl:function(a,b,c){var d=this,e=d.get("tmpler");e&&e.addTmpl(a,b,c)},setChunkData:function(b,c){var d=this,e=d.get("dataset");e&&(c=a.clone(c),e.set("data."+b,c))},render:function(){var a=this;if(!a.get("rendered")){var b=a.get("dataset");b&&a._render("data",b.get("data")),a.set("rendered",!0),a.fire("rendered")}},_render:function(a,d){var e=this,f=e.get("tmpler");if(f)if(a.split(".").length>1)e.get("rendered")&&(a=a.replace(/^data\./,""),e._renderTmpl(f.tmpls,a,d));else if(!f.inDom){var h=e.get("container"),i=e.get("el"),j=f.to_html(d);if(!i||i.length==0){var k=e.get("id");if(c.ie<=8){var l=new b("<div />");h.append(l),l.html(j);var m=l[0].childNodes;if(m.length>1)l.attr("id",k);else{k=m[0].id||k,m[0].id=k;while(m.length>0)h[0].appendChild(m[0]);l.remove()}}else{var l=new b(j);l.length>1?l=g('<div id="'+k+'"></div>').append(l):(k=l.attr("id")||k,l.attr("id",k)),h.append(l)}e.set("el","#"+k)}else if(c.ie<=8){var l=new b("<div />");h.append(l),l.html(j);while(l[0].childNodes.length>0)h[0].appendChild(l[0].childNodes[0]);l.remove()}else h.append(j)}},_renderTmpl:function(b,c,d){var e=this,f=e.get("el");c=","+c+",";var g=f.all("[bx-tmpl]");g.each(function(e){var f=","+e.attr("bx-datakey")+",";f.indexOf(c)>=0&&a.each(b,function(b){if(e.attr("bx-tmpl")==b.name&&e.attr("bx-datakey")==b.datakey){var c=f.split(","),g={};a.each(c,function(a){var b=d,c=a.split("."),e=c.length,f=0;while(f!==e)b=b[c[f]],f++;g[c[e-1]]=b,b=null}),e.html(b.tmpler.to_html(g)),g=null}})})}}),h},{requires:["node","ua","base","./dataset","./tmpler"]});