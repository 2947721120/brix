KISSY.add("brix/core/pagelet",function(e,t){function r(t,r){return r=r||"brick_",t.attr("id")||t.attr("id",e.guid("brix_"+r)),t.attr("id")}function n(){n.superclass.constructor.apply(this,arguments);var e=this;e.isReady=!1,e.readyList=[],e.bricks=[],e.isAddBehavior=!1,(e.get("autoRender")||e.get("tmpler").inDom)&&(e.on("rendered",function(){var t=e.get("callback");t&&"function"==typeof t&&e.ready(t),e.get("behavior")&&e.addBehavior()}),e.render())}return n.ATTRS={behavior:{value:!0},callback:{value:null},config:{value:{}}},e.extend(n,t,{getBrick:function(t){var r,n=this;return e.each(n.bricks,function(e){return e.id===t?(r=e.brick,!1):void 0}),r||null},addBehavior:function(){var e=this;if(e.get("rendered")&&!e.isAddBehavior){e.isAddBehavior=!0;var t=e.get("el"),r=t.all("[bx-name]");t.hasAttr("bx-name")&&(r=t.add(r)),e._addBehavior(r,function(t){e.bricks=t,e._fireReady(),e.on("beforeRefreshTmpl",function(t){"html"===t.renderType&&t.node.all("[bx-name]").each(function(t){e.destroy(t.attr("id"))})}),e.on("afterRefreshTmpl",function(t){e._addBehavior(t.node.all("[bx-name]"),function(t){t.length>0&&(e.bricks=e.bricks.concat(t))})})})}},_addBehavior:function(t,n){var a=this,i=a.get("config"),o=[];if(t.each(function(t){if("true"!=t.attr("bx-behavior")){var n=r(t),a=t.attr("bx-name"),l=t.attr("bx-path"),s=t.attr("bx-config");s=s?Function("return "+s)():{},i&&i[n]&&e.mix(s,i[n]),t.attr("bx-behavior","true"),o.push({id:n,name:a,path:l,config:s})}}),o.length>0){var l=[];e.each(o,function(t){t.path||(t.path="brix/gallery/"+t.name+"/"),e.inArray(l,t.path)||l.push(t.path)}),a.fire("beforeAddBehavior",{useList:l}),e.use(l.join(","),function(e){var t=arguments;e.each(o,function(r){var n=r.id,i=e.merge({container:"#"+n,el:"#"+n,pagelet:a},r.config),o=t[e.indexOf(r.path,l)+1],s=new o(i);r.brick=s}),t=null,n(o)})}else n(o)},ready:function(e){this.isReady?e.call(window,this):this.readyList.push(e)},_fireReady:function(){var e=this;if(!e.isReady&&(e.isReady=!0,e.readyList)){for(var t,r=0;t=e.readyList[r++];)t.call(e);e.readyList=null}},destroy:function(t){var r=this;if(t)for(var n=0;r.bricks.length>n;n++){var a=r.bricks[n];if(t===a.id)return r._destroyBrick(a),r.bricks.splice(n,1),!1}else{if(r._destroy(),e.each(r.bricks,function(e){r._destroyBrick(e)}),r.bricks=null,r.get("rendered")&&r.get("isRemoveHTML")){var i=r.get("el");r.get("isRemoveEl")?i.remove():i.empty(),i=null}r.detach()}},_destroyBrick:function(e){e.brick&&(e.brick.destroy&&e.brick.destroy(),e.brick=null)}}),n},{requires:["./chunk"]});