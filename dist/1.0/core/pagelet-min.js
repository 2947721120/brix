KISSY.add("brix/core/pagelet",function(a,b){function c(b,c){return c=c||"brick_",b.attr("id")||b.attr("id",a.guid("brix_"+c)),b.attr("id")}function d(){d.superclass.constructor.apply(this,arguments);var a=this;a.isReady=!1,a.readyList=[],a.bricks=[],a.isAddBehavior=!1;if(a.get("autoRender")||a.get("tmpler").inDom)a.on("rendered",function(){var b=a.get("callback");b&&typeof b=="function"&&a.ready(b),a.get("behavior")&&a.addBehavior()}),a.render()}return d.ATTRS={behavior:{value:!0},callback:{value:null}},a.extend(d,b,{getBrick:function(b){var c=this,d;return a.each(c.bricks,function(a){if(a.id===b)return d=a.brick,!1}),d||null},addBehavior:function(){var a=this;if(a.get("rendered")&&!a.isAddBehavior){a.isAddBehavior=!0;var b=a.get("el"),c=b.all("[bx-name]");b.hasAttr("bx-name")&&(c=b.add(c)),a._addBehavior(c,function(b){a.bricks=b,a._fireReady(),a.on("beforeRefreshTmpl",function(b){b.node.all("[bx-name]").each(function(b){a.destroy(b.attr("id"))})}),a.on("afterRefreshTmpl",function(b){a._addBehavior(b.node.all("[bx-name]"),function(b){b.length>0&&(a.bricks=a.bricks.concat(b))})})})}},_addBehavior:function(b,d){var e=this,f=[];b.each(function(a){var b=c(a),d=a.attr("bx-name"),e=a.attr("bx-path"),g=a.attr("bx-config");g=g?(new Function("return "+g))():{},f.push({id:b,name:d,path:e,config:g})});if(f.length>0){var g=[];a.each(f,function(b){b.path||(b.path="brix/gallery/"+b.name+"/"),a.inArray(g,b.path)||g.push(b.path)}),e.fire("beforeAddBehavior",{useList:g}),a.use(g.join(","),function(a){var b=arguments;a.each(f,function(c){var d=c.id,f=a.merge({container:"#"+d,el:"#"+d,pagelet:e},c.config),h=b[a.indexOf(c.path,g)+1],i=new h(f);c.brick=i}),b=null,d(f)})}else d(f)},ready:function(a){this.isReady?a.call(window,this):this.readyList.push(a)},_fireReady:function(){var a=this;if(a.isReady)return;a.isReady=!0;if(a.readyList){var b,c=0;while(b=a.readyList[c++])b.call(a);a.readyList=null}},destroy:function(b){var c=this;if(b)for(var d=0;d<c.bricks.length;d++){var e=c.bricks[d];if(b===e.id)return c._destroyBrick(e),c.bricks.splice(d,1),!1}else{c._destroy(),a.each(c.bricks,function(a,b){c._destroyBrick(a)}),c.bricks=null;if(c.get("rendered")&&c.get("isRemoveHTML")){var f=c.get("el");c.get("isRemoveEl")?f.remove():f.empty(),f=null}c.detach()}},_destroyBrick:function(a){a.brick&&(a.brick.destroy&&a.brick.destroy(),a.brick=null)}}),d},{requires:["./chunk"]});