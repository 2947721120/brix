KISSY.add("brix/core/demolet",function(e,t,r,n){function a(e){return l[e]?!1:(l[e]=!0,r({url:e,dataType:"text",async:!1,complete:function(e,t){"success"==t&&s("<style>"+e+"</style>").appendTo("head")}}),void 0)}function i(e,t,n){n=n||"@",t=t||{};var a=RegExp("\\{\\{"+n+"(.+)?\\}\\}","ig");return e=e.replace(a,function(e,n){var a="",i=n.replace(/\//gi,"_").replace(/\./gi,"_");return t[i]=t[i]||{},r({url:n+"template.html",dataType:"html",async:!1,success:function(e){a="{{#"+i+"}}"+e+"{{/"+i+"}}"}}),r({url:n+"data.json",async:!1,dataType:"json",success:function(e){for(var r in e)t[i][r]=e[r]}}),a}),{tmpl:e,data:t}}function o(){var t=this;t.on("beforeAddBehavior",function(r){e.each(t.get("projectCss"),function(e){a(e)});var n=r.useList;e.each(n,function(t){var r=t.split("/");if(e.startsWith(t,"brix/"))e.use(t+r[r.length-2]+".css");else{var n=3;e.startsWith(t,"imports/")&&(n=4),r.length>n&&(r.splice(r.length-2),a(r.join("/")+"/index.css")),a(t+"index.css")}})}),o.superclass.constructor.apply(this,arguments)}var s=n.all,l={};return o.ATTRS={projectCss:{value:["styles/style.css"],setter:function(t){return e.isArray(t)?t:[t]}},s:{value:"@"},tmpl:{setter:function(e){var t=this,r=t.get("data")||{},n=i(e,r,t.get("s"));return t.set("data",n.data),n.tmpl}}},e.extend(o,t,{}),o},{requires:["./pagelet","ajax","node"]});