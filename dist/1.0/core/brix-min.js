(function(a,b){function i(b){b=a.trim(b),b&&b.charAt(b.length-1)!="/"&&(b+="/"),!b.match(/^(http(s)?)|(file):/i)&&!g(b,"/")&&(b=h+b);if(g(b,"/")){var c=e.location;b=c.protocol+"//"+c.host+b}var d=b.split("/"),f=[],i;for(var j=0;j<d.length;j++)i=d[j],i!="."&&(i==".."?f.pop():f.push(i));return b=f.join("/"),b.substring(0,b.length-1)}function j(){var b=/^(.*)brix(-min)?\.js[^\/]*/i,c=/brix(-min)?\.js/i,d=e.document.getElementsByTagName("script"),f=d[d.length-1],g=i(f.src),h=f.getAttribute("bx-config");h?h=(new Function("return "+h))():h={},h.comboPrefix=h.comboPrefix||"??",h.comboSep=h.comboSep||",";var j=h.comboPrefix,k=h.comboSep,l=g.split(k),m,n=l[0],o,p=n.indexOf(j);return p==-1?m=g.replace(b,"$1"):(m=n.substring(0,p),o=n.substring(p+2,n.length),o.match(c)?m+=o.replace(b,"$1"):a.each(l,function(a){if(a.match(c))return m+=a.replace(b,"$1"),!1})),m=m.substring(0,m.lastIndexOf("brix")),a.mix({autoConfig:!0,path:m,componentsPath:"./",importsPath:"./"},h)}var c=!1,d=[],e=window,f=e.location,g=a.startsWith,h=f.href.replace(f.hash,"").replace(/[^\/]*$/i,"");b=e[b]=e[b]||{};var k=j(),l="",m="20121111",n="1.0",o=!1;a.mix(b,{config:function(c){if(o)return;o=!0,c=a.merge({debug:l=="@DEBUG@"?!0:!1,tag:m=="@TAG@"?"":m,fixed:n=="@VERSION@"?"":n+"/",gallery:{}},k,c),c.fixed=="@VERSION@"&&(c.fixed=""),b.basePath=c.path,b.fixed=c.fixed,a.config({packages:[{name:"brix",path:c.path,tag:c.tag,charset:"utf-8"},{name:"components",path:c.componentsPath,tag:c.componentsTag||c.tag,charset:"utf-8"},{name:"imports",path:c.importsPath,tag:c.importsTag||c.tag,charset:"utf-8"}]}),a.config({map:[[/(.+brix\/)(gallery\/)(.+?)(\/.+?(?:-min)?\.(?:js|css))(\?[^?]+)?$/,function(a,b,d,e,f,g){var h=b+c.fixed+d+e;return c.gallery[e]&&(h+="/"+c.gallery[e]),c.debug&&(f=f.replace("-min","")),h+=f+(g?g:""),h}],[/(.+brix\/)(core.+?)((?:-min)?\.js)(\?[^?]+)?$/,function(a,b,d,e,f){var g=b+c.fixed;return c.debug&&(e=e.replace("-min","")),g+=d+e+(f?f:""),g}]]})},ready:function(a){c?a.call(b):d.push(a)},_fireReady:function(){if(c)return;c=!0;if(d){var a,e=0;while(a=d[e++])a.call(b);d=null}},getPageletTmplData:function(b,c,d){d=d||"@",c=c||{};var e=new RegExp("\\{\\{"+d+"(.+)?\\}\\}","ig");return b=b.replace(e,function(b,d){a.log(d);var e="",f=d.replace(/\//ig,"_").replace(/\./ig,"_");return c[f]=c[f]||{},a.io({url:d+"template.html",async:!1,success:function(a,b,c){e="{{#"+f+"}}"+a+"{{/"+f+"}}"}}),a.io({url:d+"data.json",async:!1,dataType:"json",success:function(a,b,d){for(var e in a)c[f][e]=a[e]}}),e}),{tmpl:b,data:c}}});if(k.autoConfig){b.config({});if(k.autoPagelet){a.use("brix/core/pagelet",function(a,c){a.ready(function(){b.pagelet=new c({tmpl:"body"}),b._fireReady()})});return}}a.ready(function(){b._fireReady()})})(KISSY,"Brix");