KISSY.add("brix/gallery/tips/index",function(e,t,a,i){function n(){n.superclass.constructor.apply(this,arguments)}var r=a.all,s=e.DOM,o=e.Event,l=0;return n.ATTRS={dataAttrName:{value:"data-tips"},closeable:{value:!0},length:{},"tmpl-tip":{value:'<div id="{{id}}" class="bx-tips-show {{hide}}" style="display: none;position: absolute;top:0;left:0"><p class="bx-tips-msg">{{tips}}</p><a href="javascript:void(0);" class="bx-tips-iknow">\u6211\u77e5\u9053\u4e86</a><span class="tri"><i class="outer"></i><i class="inner"></i></span><span class="bx-tips-close">\u5173\u95ed</span></div>'},tips:{value:{}},timers:{value:{}},prex:{value:"bx-tip-"},dis:{value:10},el:{value:"body"},order:{value:["RB","BR","LB","LT","TL","TR","RT","BL"]},timeout:{value:3}},n.DOCEVENTS={".bx-tips":{mouseenter:function(e){var t=e.currentTarget;this.showTips(t)},mouseleave:function(e){var t=e.currentTarget;this.hideTips(t)}},".bx-tips-close":{click:function(e){var t=e.currentTarget,a=this,i=s.parent(t,".bx-tips-show");a.closeTips(i)}},".bx-tips-iknow":{click:function(e){e.halt();var t=e.currentTarget,a=this,i=s.parent(t,".bx-tips-show");a.closeTips(i)}}},n.METHODS={showTips:function(e){var t=this,a=t._getTipId(e),n=!s.hasClass(e,"bx-uncloseable")&&t.get("closeable");if(console.log(n),!a||!t.get("tips")[a]){a=t._createTipId();var o=i(t.get("tmpl-tip")).render({id:a,tips:s.attr(e,t.get("dataAttrName")),hide:n?"":"bx-tips-uncloseable"});t.get("tips")[a]=a,s.attr(e,"data-tipid",a),r(o).appendTo("body")}t._posTip(e,s.get("#"+a))},hideTips:function(e){var t=this,a=t._getTipId(e),i=s.get("#"+a),n=setTimeout(function(){s.hide(i),s.css(i,{left:"-9999px",top:"-9999px"})},1e3*t.get("timeout"));t.get("timers")[a]=n},closeTips:function(e){this._clearTimer(e.id),s.hide(e),s.css(e,{left:"-9999px",top:"-9999px"})},_clearTimer:function(e){var t=this.get("timers")[e];t&&(clearTimeout(t),delete this.get("timers")[e])},_createTipId:function(){return this.get("prex")+ ++l},_posTip:function(e,t){var a=this,i=s.offset(e),n=i.left,r=i.top,o={x1:n,y1:r,x2:n+s.innerWidth(e),y2:r+s.innerHeight(e)},l=s.viewportWidth(),c=s.viewportHeight(),u=s.scrollLeft(window),d=s.scrollTop(window),p={x1:u,y1:d,x2:u+l,y2:d+c};a._clearTimer(a._getTipId(e)),s.show(t);for(var h,f={tip:t,w:s.outerWidth(t),h:s.outerHeight(t)},g=a.get("order"),v=g.length,m=0;v>m&&!(h=a["_test"+g[m]](o,f,p));m++);s.get(".bx-tips-tri",t);var b=!s.hasClass(e,"bx-uncloseable")&&a.get("closeable");s.attr(t,"class",b?"bx-tips-show":"bx-tips-show bx-tips-uncloseable"),s.addClass(t,h.cls),s.css(t,{position:"absolute",left:h.left+"px",top:h.top+"px"})},_testBR:function(e,t,a){var i=this.get("dis"),n=e.x2-i,r=e.y2+i,s=n+t.w,o=r+t.h;return s>a.x2||o>a.y2||a.y1>r?!1:{left:n,top:r,cls:"bx-tips-br"}},_testTL:function(e,t,a){var i=this.get("dis"),n=e.x1-t.w+i,r=e.y1-t.h-i,s=r+t.h;return a.x1>n||a.y1>r||s>a.y2?!1:{left:n,top:r,cls:"bx-tips-tl"}},_testBL:function(e,t,a){var i=this.get("dis"),n=e.x1-t.w+i,r=e.y2+i,s=r+t.h;return a.x1>n||s>a.y2||a.y1>r?!1:{left:n,top:r,cls:"bx-tips-bl"}},_testTR:function(e,t,a){var i=this.get("dis"),n=e.x2-i,r=e.y1-t.h-i,s=n+t.w,o=r+t.h;return s>a.x2||a.y1>r||o>a.y2?!1:{left:n,top:r,cls:"bx-tips-tr"}},_testLT:function(e,t,a){var i=this.get("dis"),n=e.x1-t.w-i,r=e.y1-t.h+i,s=r+t.h;return a.x1>n||a.y1>r||s>a.y2?!1:{left:n,top:r,cls:"bx-tips-lt"}},_testLB:function(e,t,a){var i=this.get("dis"),n=e.x1-t.w-i,r=e.y2-i,s=r+t.h;return a.x1>n||s>a.y2||a.y1>r?!1:{left:n,top:r,cls:"bx-tips-lb"}},_testRT:function(e,t,a){var i=this.get("dis"),n=e.x2+i,r=e.y1-t.h+i,s=n+t.w,o=r+t.h;return s>a.x2||a.y1>r||o>a.y2?!1:{left:n,top:r,cls:"bx-tips-rt"}},_testRB:function(e,t,a){var i=this.get("dis"),n=e.x2+i,r=e.y2-i,s=n+t.w,o=r+t.h;return s>a.x2||o>a.y2||a.y1>r?!1:{left:n,top:r,cls:"bx-tips-rb"}},_getTipId:function(e){return s.attr(e,"data-tipid")}},e.extend(n,t,{initialize:function(){var t=this;window.onresize=function(){var a=t.get("tips");e.each(a,function(e){t.closeTips(s.get("#"+e))})},e.UA.ie&&6==e.UA.ie&&o.delegate("html","mouseenter mouseleave",".bx-tips-close",function(e){"mouseenter"===e.type?s.addClass(e.currentTarget,"hover"):s.removeClass(e.currentTarget,"hover")})},destructor:function(){}}),e.augment(n,n.METHODS),n},{requires:["brix/core/brick","node","template"]});