KISSY.add("brix/gallery/tips/index",function(t,e,n,r){function i(){i.superclass.constructor.apply(this,arguments)}var a=n.all,o=t.DOM,s=t.Event,u=0;return i.ATTRS={dataAttrName:{value:"data-tips"},closeable:{value:!0},length:{},"tmpl-tip":{value:'<div id="{{id}}" class="bx-tips-show {{hide}}" style="display: none;position: absolute;top:0;left:0"><p class="bx-tips-msg">{{tips}}</p><a href="javascript:void(0);" class="bx-tips-iknow">\u6211\u77e5\u9053\u4e86</a><span class="tri"><i class="outer"></i><i class="inner"></i></span><span class="bx-tips-close">\u5173\u95ed</span></div>'},tips:{value:{}},timers:{value:{}},prex:{value:"bx-tip-"},dis:{value:10},el:{value:"body"},order:{value:["RB","BR","LB","LT","TL","TR","RT","BL"]},timeout:{value:3}},i.DOCEVENTS={".bx-tips":{mouseenter:function(t){var e=t.currentTarget;this.showTips(e)},mouseleave:function(t){var e=t.currentTarget;this.hideTips(e)}},".bx-tips-close":{click:function(t){var e=t.currentTarget,n=this,r=o.parent(e,".bx-tips-show");n.closeTips(r)}},".bx-tips-iknow":{click:function(t){t.halt();var e=t.currentTarget,n=this,r=o.parent(e,".bx-tips-show");n.closeTips(r)}}},i.METHODS={showTips:function(t){var e=this,n=e._getTipId(t),i=!o.hasClass(t,"bx-uncloseable")&&e.get("closeable");if(console.log(i),!n||!e.get("tips")[n]){n=e._createTipId();var s=r(e.get("tmpl-tip")).render({id:n,tips:o.attr(t,e.get("dataAttrName")),hide:i?"":"bx-tips-uncloseable"});e.get("tips")[n]=n,o.attr(t,"data-tipid",n),a(s).appendTo("body")}e._posTip(t,o.get("#"+n))},hideTips:function(t){var e=this,n=e._getTipId(t),r=o.get("#"+n),i=setTimeout(function(){o.hide(r),o.css(r,{left:"-9999px",top:"-9999px"})},1e3*e.get("timeout"));e.get("timers")[n]=i},closeTips:function(t){this._clearTimer(t.id),o.hide(t),o.css(t,{left:"-9999px",top:"-9999px"})},_clearTimer:function(t){var e=this.get("timers")[t];e&&(clearTimeout(e),delete this.get("timers")[t])},_createTipId:function(){return this.get("prex")+ ++u},_posTip:function(t,e){var n=this,r=o.offset(t),i=r.left,a=r.top,s={x1:i,y1:a,x2:i+o.innerWidth(t),y2:a+o.innerHeight(t)},u=o.viewportWidth(),l=o.viewportHeight(),c=o.scrollLeft(window),f=o.scrollTop(window),h={x1:c,y1:f,x2:c+u,y2:f+l};n._clearTimer(n._getTipId(t)),o.show(e);for(var d,p={tip:e,w:o.outerWidth(e),h:o.outerHeight(e)},g=n.get("order"),v=g.length,m=0;v>m&&!(d=n["_test"+g[m]](s,p,h));m++);o.get(".bx-tips-tri",e);var y=!o.hasClass(t,"bx-uncloseable")&&n.get("closeable");o.attr(e,"class",y?"bx-tips-show":"bx-tips-show bx-tips-uncloseable"),o.addClass(e,d.cls),o.css(e,{position:"absolute",left:d.left+"px",top:d.top+"px"})},_testBR:function(t,e,n){var r=this.get("dis"),i=t.x2-r,a=t.y2+r,o=i+e.w,s=a+e.h;return o>n.x2||s>n.y2||n.y1>a?!1:{left:i,top:a,cls:"bx-tips-br"}},_testTL:function(t,e,n){var r=this.get("dis"),i=t.x1-e.w+r,a=t.y1-e.h-r,o=a+e.h;return n.x1>i||n.y1>a||o>n.y2?!1:{left:i,top:a,cls:"bx-tips-tl"}},_testBL:function(t,e,n){var r=this.get("dis"),i=t.x1-e.w+r,a=t.y2+r,o=a+e.h;return n.x1>i||o>n.y2||n.y1>a?!1:{left:i,top:a,cls:"bx-tips-bl"}},_testTR:function(t,e,n){var r=this.get("dis"),i=t.x2-r,a=t.y1-e.h-r,o=i+e.w,s=a+e.h;return o>n.x2||n.y1>a||s>n.y2?!1:{left:i,top:a,cls:"bx-tips-tr"}},_testLT:function(t,e,n){var r=this.get("dis"),i=t.x1-e.w-r,a=t.y1-e.h+r,o=a+e.h;return n.x1>i||n.y1>a||o>n.y2?!1:{left:i,top:a,cls:"bx-tips-lt"}},_testLB:function(t,e,n){var r=this.get("dis"),i=t.x1-e.w-r,a=t.y2-r,o=a+e.h;return n.x1>i||o>n.y2||n.y1>a?!1:{left:i,top:a,cls:"bx-tips-lb"}},_testRT:function(t,e,n){var r=this.get("dis"),i=t.x2+r,a=t.y1-e.h+r,o=i+e.w,s=a+e.h;return o>n.x2||n.y1>a||s>n.y2?!1:{left:i,top:a,cls:"bx-tips-rt"}},_testRB:function(t,e,n){var r=this.get("dis"),i=t.x2+r,a=t.y2-r,o=i+e.w,s=a+e.h;return o>n.x2||s>n.y2||n.y1>a?!1:{left:i,top:a,cls:"bx-tips-rb"}},_getTipId:function(t){return o.attr(t,"data-tipid")}},t.extend(i,e,{initialize:function(){var e=this;window.onresize=function(){var n=e.get("tips");t.each(n,function(t){e.closeTips(o.get("#"+t))})},t.UA.ie&&6==t.UA.ie&&s.delegate("html","mouseenter mouseleave",".bx-tips-close",function(t){"mouseenter"===t.type?o.addClass(t.currentTarget,"hover"):o.removeClass(t.currentTarget,"hover")})},destructor:function(){}}),t.augment(i,i.METHODS),i},{requires:["brix/core/brick","node","template"]});