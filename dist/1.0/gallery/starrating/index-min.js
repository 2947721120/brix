KISSY.add("brix/gallery/starrating/index",function(e,t,a,i){function n(){n.superclass.constructor.apply(this,arguments)}var r=a.all;if(6==i.ie)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(s){}return n.ATTRS={split:{value:2},maxValue:{value:5},length:{value:10},defaultValue:{value:!1},readOnly:{value:!1},starWidth:{value:18},inputs:{},current:{},mode:{value:!0}},n.EVENTS={".starrating-star":{mouseenter:function(t){if(!this.get("readOnly")){var a,i=e.one(t.currentTarget);this._fill(i),a=this.get("mode")?i.data("input").val():i.data("input"),this.fire("focus",{value:a})}},mouseleave:function(t){if(!this.get("readOnly")){var a,i=e.one(t.currentTarget);this._draw(),a=this.get("mode")?i.data("input").val():i.data("input"),this.fire("blur",{value:a})}},click:function(t){if(!this.get("readOnly")){var a=e.one(t.currentTarget);this.select(a)}}}},n.METHODS={select:function(t){var a=this;if("number"==typeof t){if(t=a.get("el").all(".starrating-star").item(t))return a.select(t);throw"\u6ca1\u6709\u627e\u5230\u8282\u70b9"}if("string"==typeof t){if(a.get("mode"))a.get("inputs").each(function(e,i){return e.val()==t?(t=a.get("el").all(".starrating-star").item(i),!1):void 0});else{var i=e.indexOf(t,a.get("inputs"));t=a.get("el").all(".starrating-star").item(i)}return a.select(t)}a.set("current",t),a._draw();var n;n=a.get("mode")?t.data("input").val():t.data("input"),a.fire("selected",{value:n})},readOnly:function(e,t){var a=this;a.set("readOnly",e||void 0==e?!0:!1);var i=a.get("readOnly");i?a.get("el").all(".starrating-star").addClass("starrating-star-readonly"):a.get("el").all(".starrating-star").removeClass("starrating-star-readonly"),a.get("mode")&&(t?a.get("inputs").attr("disabled","disabled"):a.get("inputs").removeAttr("disabled")),a._draw()},disable:function(){this.readOnly(!0,!0)},enable:function(){this.readOnly(!1,!1)}},e.extend(n,t,{initialize:function(){var t=this,a=t.get("inputs");if(a||(a=t.get("el").all("input[type=radio].star")),0==a.length){t.set("mode",!1);var i=t.get("length"),n=t.get("maxValue");a=[],flg=n/i;for(var r=1;i>=r;r++){var s=r*n/i;flg>=1?a.push(""+Math.round(s)):flg>.1?a.push(""+s.toFixed(1)):a.push(""+s.toFixed(2))}}t.set("inputs",a),t.get("mode")?a.each(function(e,a){var i=e.val(),n=e.attr("title")||i;t._creat(i,n,e,a)}):e.each(a,function(e,a){t._creat(e,e,e,a)}),rater=null;var o=t.get("defaultValue");o&&t.select(o)},_creat:function(e,t,a,i){var n=this,s=n.get("el"),o=n.get("split"),l=n.get("readOnly"),c=n.get("starWidth"),u=r('<div class="starrating-star"><a title="'+t+'">'+e+"</a></div>");if(s.append(u),o>1){var d=u.width()||c,p=i%o,h=Math.floor(d/o);u.css({width:h}).one("a").css({"margin-left":"-"+p*h+"px"}),0!=i&&0!=i%o&&u.css({"margin-right":"1px"})}else u.css({"margin-right":"1px"});u.data("input",a),l&&u.addClass("starrating-star-readonly"),n.get("mode")&&a.hide()},_fill:function(e){this._drain(),e.addClass("starrating-star-hover");for(var t=e;t.prev();)t.prev().addClass("starrating-star-hover"),t=t.prev()},_drain:function(){this.get("el").all(".starrating-star").removeClass("starrating-star-hover").removeClass("starrating-star-on")},_draw:function(){this._drain(),this.get("mode")&&this.get("inputs").removeAttr("checked");var e=this.get("current");if(e){this.get("mode")&&e.data("input").attr("checked","checked"),e.addClass("starrating-star-on");for(var t=e;t.prev();)t.prev().addClass("starrating-star-on"),t=t.prev()}},destructor:function(){}}),e.augment(n,n.METHODS),n},{requires:["brix/core/brick","node","ua"]});