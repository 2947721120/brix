KISSY.add("brix/gallery/starrating/index",function(t,e,n,r){function i(){i.superclass.constructor.apply(this,arguments)}var a=n.all;if(6==r.ie)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(o){}return i.ATTRS={split:{value:2},maxValue:{value:5},length:{value:10},defaultValue:{value:!1},readOnly:{value:!1},starWidth:{value:18},inputs:{},current:{},mode:{value:!0}},i.EVENTS={".starrating-star":{mouseenter:function(e){if(!this.get("readOnly")){var n,r=t.one(e.currentTarget);this._fill(r),n=this.get("mode")?r.data("input").val():r.data("input"),this.fire("focus",{value:n})}},mouseleave:function(e){if(!this.get("readOnly")){var n,r=t.one(e.currentTarget);this._draw(),n=this.get("mode")?r.data("input").val():r.data("input"),this.fire("blur",{value:n})}},click:function(e){if(!this.get("readOnly")){var n=t.one(e.currentTarget);this.select(n)}}}},i.METHODS={select:function(e){var n=this;if("number"==typeof e){if(e=n.get("el").all(".starrating-star").item(e))return n.select(e);throw"\u6ca1\u6709\u627e\u5230\u8282\u70b9"}if("string"==typeof e){if(n.get("mode"))n.get("inputs").each(function(t,r){return t.val()==e?(e=n.get("el").all(".starrating-star").item(r),!1):void 0});else{var r=t.indexOf(e,n.get("inputs"));e=n.get("el").all(".starrating-star").item(r)}return n.select(e)}n.set("current",e),n._draw();var i;i=n.get("mode")?e.data("input").val():e.data("input"),n.fire("selected",{value:i})},readOnly:function(t,e){var n=this;n.set("readOnly",t||void 0==t?!0:!1);var r=n.get("readOnly");r?n.get("el").all(".starrating-star").addClass("starrating-star-readonly"):n.get("el").all(".starrating-star").removeClass("starrating-star-readonly"),n.get("mode")&&(e?n.get("inputs").attr("disabled","disabled"):n.get("inputs").removeAttr("disabled")),n._draw()},disable:function(){this.readOnly(!0,!0)},enable:function(){this.readOnly(!1,!1)}},t.extend(i,e,{initialize:function(){var e=this,n=e.get("inputs");if(n||(n=e.get("el").all("input[type=radio].star")),0==n.length){e.set("mode",!1);var r=e.get("length"),i=e.get("maxValue");n=[],flg=i/r;for(var a=1;r>=a;a++){var o=a*i/r;flg>=1?n.push(""+Math.round(o)):flg>.1?n.push(""+o.toFixed(1)):n.push(""+o.toFixed(2))}}e.set("inputs",n),e.get("mode")?n.each(function(t,n){var r=t.val(),i=t.attr("title")||r;e._creat(r,i,t,n)}):t.each(n,function(t,n){e._creat(t,t,t,n)}),rater=null;var u=e.get("defaultValue");u&&e.select(u)},_creat:function(t,e,n,r){var i=this,o=i.get("el"),u=i.get("split"),s=i.get("readOnly"),l=i.get("starWidth"),c=a('<div class="starrating-star"><a title="'+e+'">'+t+"</a></div>");if(o.append(c),u>1){var f=c.width()||l,h=r%u,d=Math.floor(f/u);c.css({width:d}).one("a").css({"margin-left":"-"+h*d+"px"}),0!=r&&0!=r%u&&c.css({"margin-right":"1px"})}else c.css({"margin-right":"1px"});c.data("input",n),s&&c.addClass("starrating-star-readonly"),i.get("mode")&&n.hide()},_fill:function(t){this._drain(),t.addClass("starrating-star-hover");for(var e=t;e.prev();)e.prev().addClass("starrating-star-hover"),e=e.prev()},_drain:function(){this.get("el").all(".starrating-star").removeClass("starrating-star-hover").removeClass("starrating-star-on")},_draw:function(){this._drain(),this.get("mode")&&this.get("inputs").removeAttr("checked");var t=this.get("current");if(t){this.get("mode")&&t.data("input").attr("checked","checked"),t.addClass("starrating-star-on");for(var e=t;e.prev();)e.prev().addClass("starrating-star-on"),e=e.prev()}},destructor:function(){}}),t.augment(i,i.METHODS),i},{requires:["brix/core/brick","node","ua"]});