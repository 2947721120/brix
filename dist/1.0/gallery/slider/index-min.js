KISSY.add("brix/gallery/slider/index",function(t,e,n,r,i){function a(){a.superclass.constructor.apply(this,arguments)}a.FIRES={drag:"drag",dragstart:"dragstart",dragend:"dragend",resize:"resize"};var o={horizontal:"horizontal",vertical:"vertical"};return a.ATTRS={range:{value:!1},mode:{value:"horizontal"},startStep:{value:0},endStep:{value:100},integerStep:{value:1},current:{},knobOffset:{value:-7}},a.METHODS={resize:function(){this.fire(a.FIRES.resize)},destructor:function(){this.knob.destroy(),this.knob_start&&this.knob_start.destroy(),this.knobNode=null,this.knobNode_start=null,self.detach()}},t.extend(a,e,{initialize:function(){this._render_range(),this._render_knob()},_render_knob:function(){function e(){var e=c.value,r=_?f.height():f.width();t.isArray(e)?(e[0]=n(e[0],d,p),e[1]=n(e[1],d,p),b=r*(e[1]-d)/(p-d),x=r*(e[0]-d)/(p-d),m.css(k,b),y.css(k,x),v.css(k,x),v.css(S,Math.abs(b-x)),x==r?y.css("zIndex",2):y.css("zIndex","auto")):(e=n(e,d,p),b=r*(e-d)/(p-d),v.css(S,Math.abs(b)),m.css(k,b))}function n(e,n,r){return t.isUndefined(e)&&(e=n),n>e&&r>e&&(e=n),e>r&&e>n&&(e=r),e}function r(){var e=_?f.height():f.width(),n=(p-d)*b/e+d,r=null===x?null:(p-d)*x/e+d;g&&(n=Math.round(n/g)*g,r=null===r?null:Math.round(r/g)*g),t.log("("+p+"-"+d+")*"+b+"/"+e+"+"+d),c.value=y?[r,n]:n,u(c.value),c.fire(a.FIRES.drag,{data:c.value,current:c.get("current")}),t.log("Slider: change="+c.value+","+c.get("current"))}function u(e){var n,r=c.get("range");t.isArray(e)&&(p>d&&e[0]>e[1]&&(e=[e[1],e[0]]),d>p&&e[0]<e[1]&&(e=[e[1],e[0]])),n=e,t.isArray(c.get("range"))&&(n=t.isArray(e)?[r[e[0]],r[e[1]]]:r[e]),c.set("current",n)}function s(){c.fire(a.FIRES.dragstart,{data:c.value,current:c.get("current")})}function l(){e(),c.fire(a.FIRES.dragend,{data:c.value,current:c.get("current")})}var c=this,f=c.get("el"),h=c.get("mode"),d=c.get("startStep"),p=c.get("endStep"),g=c.get("integerStep"),v=f.one(".slider-bar"),m=f.one(".slider-knob-end"),y=this.knobNode_start=f.one(".slider-knob-start"),b=0,x=null,w=c.get("knobOffset"),_=h===o.horizontal?!1:!0,M=_?"top":"left",k=_?"bottom":"left",S=_?"height":"width";m=m||f.one(".slider-knob"),this.knobNode=m;var T=c.knob=new i.Draggable({node:m,cursor:"move"});if(T.on("drag",function(t){var e=f.offset(),i=_?f.height():f.width(),a=b=t[M]-e[M]-w;_&&(b=i-a),b=n(b,x||0,i),v.css(S,Math.abs(b-(x||0))),v.css(k,x||0),m.css(k,b),r({target:m})}),T.on("dragstart",s),T.on("dragend",l),y){var E=c.knob_start=new i.Draggable({node:y,cursor:"move"});E.on("drag",function(t){var e=f.offset(),i=_?f.height():f.width(),a=x=t[M]-e[M]-w;_&&(x=i-a),x=n(x,0,b),v.css(k,x),v.css(S,Math.abs(b-x)),y.css(k,x),r({target:y})}),E.on("dragstart",s),E.on("dragend",l)}t.isUndefined(c.get("current"))||(c.value=c.value||c.get("current"),e()),c.on(a.FIRES.resize,e)},_render_range:function(){t.isArray(this.get("range"))&&(this.set("endStep",this.get("range").length-1),t.log("slider: range "+this.get("range")),t.isString(this.get("current"))&&(this.value=t.indexOf(this.get("current"),this.get("range"))))}}),t.augment(a,a.METHODS),a},{requires:["brix/core/brick","ua","node","dd"]});