KISSY.add("brix/gallery/slider/index",function(e,t,a,i,n){function r(){r.superclass.constructor.apply(this,arguments)}r.FIRES={drag:"drag",dragstart:"dragstart",dragend:"dragend",resize:"resize"};var s={horizontal:"horizontal",vertical:"vertical"};return r.ATTRS={range:{value:!1},mode:{value:"horizontal"},startStep:{value:0},endStep:{value:100},integerStep:{value:1},current:{},knobOffset:{value:-7}},r.METHODS={resize:function(){this.fire(r.FIRES.resize)},destructor:function(){this.knob.destroy(),this.knob_start&&this.knob_start.destroy(),this.knobNode=null,this.knobNode_start=null,self.detach()}},e.extend(r,t,{initialize:function(){this._render_range(),this._render_knob()},_render_knob:function(){function t(){var t=u.value,i=w?d.height():d.width();e.isArray(t)?(t[0]=a(t[0],h,f),t[1]=a(t[1],h,f),y=i*(t[1]-h)/(f-h),x=i*(t[0]-h)/(f-h),m.css(S,y),b.css(S,x),v.css(S,x),v.css(T,Math.abs(y-x)),x==i?b.css("zIndex",2):b.css("zIndex","auto")):(t=a(t,h,f),y=i*(t-h)/(f-h),v.css(T,Math.abs(y)),m.css(S,y))}function a(t,a,i){return e.isUndefined(t)&&(t=a),a>t&&i>t&&(t=a),t>i&&t>a&&(t=i),t}function i(){var t=w?d.height():d.width(),a=(f-h)*y/t+h,i=null===x?null:(f-h)*x/t+h;g&&(a=Math.round(a/g)*g,i=null===i?null:Math.round(i/g)*g),e.log("("+f+"-"+h+")*"+y+"/"+t+"+"+h),u.value=b?[i,a]:a,o(u.value),u.fire(r.FIRES.drag,{data:u.value,current:u.get("current")}),e.log("Slider: change="+u.value+","+u.get("current"))}function o(t){var a,i=u.get("range");e.isArray(t)&&(f>h&&t[0]>t[1]&&(t=[t[1],t[0]]),h>f&&t[0]<t[1]&&(t=[t[1],t[0]])),a=t,e.isArray(u.get("range"))&&(a=e.isArray(t)?[i[t[0]],i[t[1]]]:i[t]),u.set("current",a)}function l(){u.fire(r.FIRES.dragstart,{data:u.value,current:u.get("current")})}function c(){t(),u.fire(r.FIRES.dragend,{data:u.value,current:u.get("current")})}var u=this,d=u.get("el"),p=u.get("mode"),h=u.get("startStep"),f=u.get("endStep"),g=u.get("integerStep"),v=d.one(".slider-bar"),m=d.one(".slider-knob-end"),b=this.knobNode_start=d.one(".slider-knob-start"),y=0,x=null,k=u.get("knobOffset"),w=p===s.horizontal?!1:!0,_=w?"top":"left",S=w?"bottom":"left",T=w?"height":"width";m=m||d.one(".slider-knob"),this.knobNode=m;var D=u.knob=new n.Draggable({node:m,cursor:"move"});if(D.on("drag",function(e){var t=d.offset(),n=w?d.height():d.width(),r=y=e[_]-t[_]-k;w&&(y=n-r),y=a(y,x||0,n),v.css(T,Math.abs(y-(x||0))),v.css(S,x||0),m.css(S,y),i({target:m})}),D.on("dragstart",l),D.on("dragend",c),b){var E=u.knob_start=new n.Draggable({node:b,cursor:"move"});E.on("drag",function(e){var t=d.offset(),n=w?d.height():d.width(),r=x=e[_]-t[_]-k;w&&(x=n-r),x=a(x,0,y),v.css(S,x),v.css(T,Math.abs(y-x)),b.css(S,x),i({target:b})}),E.on("dragstart",l),E.on("dragend",c)}e.isUndefined(u.get("current"))||(u.value=u.value||u.get("current"),t()),u.on(r.FIRES.resize,t)},_render_range:function(){e.isArray(this.get("range"))&&(this.set("endStep",this.get("range").length-1),e.log("slider: range "+this.get("range")),e.isString(this.get("current"))&&(this.value=e.indexOf(this.get("current"),this.get("range"))))}}),e.augment(r,r.METHODS),r},{requires:["brix/core/brick","ua","node","dd"]});