KISSY.add("brix/gallery/timer/index",function(e,t,a){function i(){i.superclass.constructor.apply(this,arguments)}return i.ATTRS={mode:{value:"down"},updateTime:{value:1e4},units:{value:"s"},isServer:{value:!1},ajusted:{value:!1},ajustInterval:{value:5e3},interval:{value:100},data:{valueFn:function(){return this._getUnitsData(0)}}},i.FIRES={notify:"notify"},i.getServerTime=function(t,i){if(i){var n=window.location.protocol+"//"+window.location.host+"?t="+ +new Date;a({type:"head",url:n,success:function(e,a,i){var n=new Date(i.getResponseHeader("Date")).getTime();t(n)}})}else t(e.now())},e.extend(i,t,{initialize:function(){var e=this;i.getServerTime(function(t){e._start(t)},e.get("isServer"))},_start:function(t){var a,i=this,n=i.get("mode"),r=i.get("interval"),s=i.get("ajustInterval"),o=i.get("updateTime");switch(n){case"up":a=t-o;break;case"down":a=o}i._currentTime=a,i._startCurrentTime=a,i._startBaseTime=t,i._diffTime=0,i._timerHandler=e.later(i._timerInterval,r,!1,i,[r,n]),i.get("ajusted")&&(i._ajustHandler=e.later(i._ajustInterval,s,!1,i,[s,n]))},_ajustInterval:function(t,a){var n=this;i.getServerTime(function(i){switch(n._diffTime=i-n._startBaseTime,a){case"up":n._diffTime-=n._currentTime-n._startCurrentTime;break;case"down":n._diffTime-=n._startCurrentTime-n._currentTime}if(n._diffTime>500){switch(a){case"up":n._currentTime+=n._diffTime;break;case"down":n._currentTime-=n._diffTime,0>=n._currentTime&&(n._currentTime=interval)}n._diffTime=0}n._ajustHandler=e.later(n._ajustInterval,t,!1,n,[t,a])},n.get("isServer"))},_timerInterval:function(t,a){var n=this,r=n._currentTime;switch(a){case"up":r+=t;break;case"down":r-=t}n._currentTime=r;var s=n._getUnitsData(r);return e.each(s,function(e,t){n.setChunkData(t,e)}),0>=r?(n._ajustHandler&&n._ajustHandler.cancel(),n.fire(i.FIRES.notify),void 0):(n._timerHandler=e.later(n._timerInterval,t,!1,n,[t,a]),void 0)},_getUnitsData:function(t){var a=this,i={};switch(a.get("units")){case"y":i={y:Math.floor(t/31536e6),M:Math.floor(t/2592e6)%12,d:Math.floor(t/864e5)%30,h:Math.floor(t/36e5)%24,m:Math.floor(t/6e4)%60,s:Math.floor(t/1e3)%60,hs:Math.floor(t/100)%10};break;case"M":i={M:Math.floor(t/2592e6),d:Math.floor(t/864e5)%30,h:Math.floor(t/36e5)%24,m:Math.floor(t/6e4)%60,s:Math.floor(t/1e3)%60,hs:Math.floor(t/100)%10};break;case"d":i={d:Math.floor(t/864e5),h:Math.floor(t/36e5)%24,m:Math.floor(t/6e4)%60,s:Math.floor(t/1e3)%60,hs:Math.floor(t/100)%10};break;case"h":i={h:Math.floor(t/36e5),m:Math.floor(t/6e4)%60,s:Math.floor(t/1e3)%60,hs:Math.floor(t/100)%10};break;case"m":var i={m:Math.floor(t/6e4),s:Math.floor(t/1e3)%60,hs:Math.floor(t/100)%10};break;case"s":i={s:Math.floor(t/1e3),hs:Math.floor(t/100)%10};break;case"hs":i={hs:Math.floor(t/100)}}return e.each(i,function(t,a){e.inArray(a,["h","m","s"])&&10>t&&(i[a]=""+("0"+t)),i[a]=""+i[a]}),a.get("interval")>=1e3&&delete i.hs,i},destructor:function(){this._ajustHandler&&(this._ajustHandler.cancel(),this._ajustHandler=null),this._timerHandler&&(this._timerHandler.cancel(),this._timerHandler=null)}}),i},{requires:["brix/core/brick","ajax"]});