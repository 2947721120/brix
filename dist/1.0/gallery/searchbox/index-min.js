KISSY.add("brix/gallery/searchbox/index",function(t,e){function n(){n.superclass.constructor.apply(this,arguments)}return n.ATTRS={el:{value:"#J_searchbox"},currentCls:{value:"selected"},suggestApi:{value:"data-suggest-api"},curItem:{value:{},getter:function(){return t.one(this.get("el")).one("."+this.get("currentCls"))}},menu:{value:{}},form:{value:{}},suggest:{value:{}}},n.DOCEVENTS={"":{click:function(e){var n=this,r=t.one(e.target);n.get("el").contains(r)||(n.hideTabs(),n.fire("afterBlur"))}}},n.EVENTS={".s-menu":{mouseenter:function(e){e.preventDefault();var n=t.one(e.currentTarget);n.one(".s-menu-list"),n.addClass("expand")},mouseleave:function(e){e.preventDefault();var n=t.one(e.currentTarget);n.one(".s-menu-list"),n.removeClass("expand")}},".s-menu-list li":{click:function(e){var n=this,r=t.one(e.currentTarget),i=n.get("currentCls");if(n.fire("beforeTabChange",{eventData:e.currentTarget}),!r.hasClass(i)){var a=n.get("el").all("li"),o=n.get("el").one(".s-menu-selected span");a.removeClass(i),r.addClass(i),o.html(r.one("a").html()),n.menu.removeClass("expand"),""!==n.ipt.getDOMNode().value&&n._fireEvent(n.form.getDOMNode(),"submit")}}},".searchbox-input":{focus:function(e){var n=this,r=e.currentTarget,i=n.get("curItem").attr(n.get("suggestApi"));n.suggestApi&&n.suggestApi!==i&&(n.detach(e.type,arguments.callee),n.suggest.on("beforeStart",function(){return!1}),n.suggest=void 0),!i||n.suggestApi&&n.suggestApi===i||t.use("suggest",function(){n._initSuggest(r,i)}),n.suggestApi=i,n.showTabs(),n.fire("afterFocus",{eventData:r})}},form:{submit:function(t){var e=this;e.fire("beforeSubmit",{eventData:t.target});var n=e.get("curItem").one("a");if(""===e.ipt.getDOMNode().value)t.halt(!0),e.focusInput();else{var r=n.attr("href"),i=t.target;i.action=r,e._parseAction(i,r)}}}},n.METHODS={showTabs:function(){var t=this;t.form.addClass("s-focus")},hideTabs:function(){var t=this;t.form.removeClass("s-focus")},focusInput:function(){var t=this;t.ipt.getDOMNode().focus()}},n.FIRES={afterLoad:"afterLoad",beforeTabChange:"beforeTabChange",beforeSubmit:"beforeSubmit",afterFocus:"aferFocus",afterBlur:"afterBlur"},t.extend(n,e,{initialize:function(){var t=this;t.menu=t.get("el").one(".s-menu"),t.form=t.get("el").one("form"),t.ipt=t.get("el").one(".searchbox-input"),t.fire("afterLoad")},destructor:function(){},_parseAction:function(e,n){if(-1!==n.indexOf("?"))for(var r=n.substring(n.indexOf("?")+1,n.length).split("&"),i=0,a=r.length;a>i;i++)if(""!==t.trim(r[i])){var o=r[i].split("=");this._writeHiddenInput(e,o[0],o[1])}},_writeHiddenInput:function(e,n,r){var i=e[n];return i?i.value=r:(i=t.DOM.create('<input type="hidden" name="'+n+'" value="'+r+'" />'),e.appendChild(i)),i},_initSuggest:function(e,n){var r=this;r.suggest=new t.Suggest(e,n,{resultFormat:"%result%",offset:0}),r.suggest.on("beforeShow",function(){r._keyword()}),r.suggest.on("itemSelect",function(){var e=t.DOM,n=this.selectedItem,i=e.query("li",this.containers),a=t.get("form",r.get("el"));r._writeHiddenInput(a,"wq",e.attr(n,"key")),r._writeHiddenInput(a,"suggest","0_"+t.indexOf(n,i))}),r.suggest.on("beforeSubmit",function(){return""===e.value?!1:void 0})},_keyword:function(){var e=t.DOM,n=this,r=n.suggest,i=r.query,a=i.length;t.each(e.query("li",r.content),function(t){var n=e.get(".ks-suggest-key",t),r=e.html(n);0===r.indexOf(i)&&e.html(n,r.substring(0,a)+"<b>"+r.substring(a,r.length)+"</b>")})},_fireEvent:function(t,e){if(document.createEvent){var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0),t.dispatchEvent(n)}else if(document.createEventObject){var n=document.createEventObject();t.fireEvent("on"+e,n)}}}),t.augment(n,n.METHODS),n},{requires:["brix/core/brick"]});