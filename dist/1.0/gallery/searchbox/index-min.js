KISSY.add("placeholder",function(a,b){var c=a.DOM,d=a.Event,e=function(a,b){if(!a)return;if("placeholder"in document.createElement("input"))return;var e=c.attr(a,"placeholder"),b=b?b:"labelshow",f=c.create('<label for="'+a.id+'">'+e+"</label>");c.insertBefore(f,a),a.value===""&&c.addClass(f,b),d.on(a,"keyup",function(){this.value===""?c.addClass(f,b):c.removeClass(f,b)})};a.placeholder=e}),KISSY.add("brix/gallery/searchbox/index",function(a,b,c){function h(){h.superclass.constructor.apply(this,arguments)}var d=c.all,e=a.DOM,f=a.Event,g=0;return h.ATTRS={el:{value:"#J_searchbox"},currentCls:{value:"selected"},redirect:{value:"data-redirect"},emptyAction:{value:"data-empty-action"},curItem:{value:{}},isSuggest:{value:!0},suggestApi:{value:"data-suggest-api"}},h.EVENTS={".searchbox-menu":{mouseenter:function(a){a.preventDefault();var b=this,c=b.searchObj,d=a.currentTarget;e.addClass(d,"expand"),e.height(c.menuContainer,24*c.menuItemCount+13),e.height(c.menuList,24*c.menuItemCount+10),e.addClass(c.searchboxInner,"expandmenu");var f=c.searchboxOuter;e.hasClass(f,"focus")||e.addClass(f,"focus")},mouseleave:function(a){a.preventDefault();var b=this,c=a.currentTarget;b._collapse(),b._focusInput()}},li:{click:function(a){this.tabChange(a)}},".searchbox-input":{focus:function(b){var c=this,d=b.currentTarget,f=this.searchObj.searchboxOuter;e.hasClass(f,"focus")||e.addClass(f,"focus"),e.addClass(e.prev(d),"hide");if(c.get("isSuggest")){if(c.suggest){c.detach(b.type,arguments.callee);return}var g=e.attr(c.curItem,c.get("autosuggest"));console.log(g),g&&g.indexOf("area=etao")>0&&a.use("suggest",function(){c._initSuggest(g)})}},blur:function(a){var b=a.currentTarget;b.value===""&&e.removeClass(e.prev(b),"hide");var c=this.searchObj.searchboxOuter,d=this.searchObj.menu;e.hasClass(c,"focus")&&!e.hasClass(d,"expand")&&e.removeClass(c,"focus")},keyup:function(a){var b=this;b._dealClearBtn()},keydown:function(a){a.keyCode==13&&(a.halt(!0),self.submit())}},".search-label":{click:function(a){var b=a.currentTarget;f.fire(e.next(b),"focus")}},".s-btn-clear":{click:function(a){var b=this,c=b.searchObj,d=c.input;e.val(d,""),b._hideBtn(),b._focusInput()}},".search-form":{submit:function(a){var b=this;b.submit(a)}}},h.METHODS={_focusInput:function(){var a=this,b=a.searchObj,c=b.input;c.focus()},_collapse:function(){var a=this.searchObj;e.removeClass(a.menu,"expand"),e.height(a.menuContainer,0),e.height(a.menuList,0),e.removeClass(a.searchboxInner,"expandmenu")},_dealClearBtn:function(){var a=this.searchObj.input;a.value!==""?this._showBtn():this._hideBtn()},_dealLabel:function(){var a=this.searchObj.input,b=e.prev(a);a.value===""?e.removeClass(b,"hide"):e.addClass(b,"hide")},_hideBtn:function(){var a=this.searchObj.btnClear;e.removeClass(a,"btn-show"),e.addClass(a,"btn-hide")},_showBtn:function(){var a=this.searchObj.btnClear;e.removeClass(a,"btn-hide"),e.addClass(a,"btn-show")},tabChange:function(b){var c=this,d=c.searchObj,f=b.currentTarget,g=c.get("currentCls");if(e.hasClass(f,g)){b.halt(!0);return}a.each(d.menuItems,function(a){e.removeClass(a,g)}),e.addClass(f,g),c._collapse(),e.html(d.menuSelected,e.html(e.get("a",f))+"<i></i>"),d.input.focus(),c.suggest&&(c.suggest.on("beforeStart",function(){return!1}),c.suggest=undefined),c.curItem=f;var h=a.trim(e.attr(e.get(d.menuList),c.get("redirect")))!=="false";if(!h){b.halt(!0);return}var i=e.get("a",c.curItem),j=a.trim(e.attr(i,c.get("emptyAction")));d.input.value!==""?(b.halt(!0),c.submit()):j?e.get("a",c.curItem).href=j:b.halt(!0)},submit:function(b){var c=this,d=c.searchObj,f=e.get("a",c.curItem),g=a.trim(e.attr(f,c.get("emptyAction")));if(d.input.value==="")g?(d.input.value="",c.action=g,d.searchForm.submit()):(b.halt(!0),d.input.focus());else{c.action=e.attr(f,"href"),c._parseAction(c.action);var h=e.attr(f,c.get("stat"));!a.trim(h),d.searchForm.submit()}},_parseAction:function(b){if(b.indexOf("?")!==-1){var c=b.substring(b.indexOf("?")+1,b.length).split("&");for(var d=0,e=c.length;d<e;d++){if(a.trim(c[d])==="")continue;var f=c[d].split("=");this._writeHiddenInput(this.searchObj.searchForm,f[0],f[1])}}},_writeHiddenInput:function(a,b,c){var d=a[b];return d?d.value=c:(d=e.create('<input type="hidden" name="'+b+'" value="'+c+'" />'),a.appendChild(d)),d},_initSuggest:function(b){var c=this,d=c.searchObj,f=c.get("stat");c.suggest=new a.Suggest(d.input,b,{resultFormat:"%result%",offset:0}),c.suggest.on("dataReturn",function(a){c.suggest.etaobook=a.data.etaobook,c.suggest.results=a.data.result}),c.suggest.on("beforeShow",function(){var b=c.suggest.etaobook,d="";b&&b.length>0&&(a.each(b,function(a,c){d+='<li class="ks-suggest-extra" key="'+b[c][0]+'" data-epid="'+b[c][1]+'"><span class="ks-suggest-key">'+b[c][0]+'</span><span class="suggest-star">\u2605</span><span class="suggest-author">'+b[c][2]+'</span><span class="suggest-pub">'+b[c][3]+'</span><span class="suggest-time">'+b[c][4]+"</span></li>"}),c.suggest.results.length===0&&e.html(c.suggest.content,"<ol></ol>"),d&&e.append(e.create(d),c.suggest.content.firstChild)),c._keyword()}),c.suggest.on("itemSelect",function(){var b=this.selectedItem,g=e.query("li",this.containers),h={};h.q=this.query,h.wq=e.attr(b,"key"),h.n=a.indexOf(b,g);var i=e.get("a",c.curItem);e.attr(i,f,e.attr(i,f)+"&"+a.param(h));var j=e.attr(b,"data-epid");j&&(c._writeHiddenInput(d.searchForm,"epid",j),c._writeHiddenInput(d.searchForm,"v","product"),c._writeHiddenInput(d.searchForm,"p","detail"))})},_keyword:function(){var b=this,c=b.suggest,d=c.query,f=d.length;a.each(e.query("li",c.content),function(a){var b=e.get(".ks-suggest-key",a),c=e.html(b);c.indexOf(d)===0&&e.html(b,c.substring(0,f)+"<b>"+c.substring(f,c.length)+"</b>")})}},h.FIRES={loaded:"loaded",tabChange:"tabChange",beforeSubmit:"beforeSubmit"},a.extend(h,b,{initialize:function(){var a=this,b=e.get(a.get("el")),c=e.get(".searchbox-menu",b),d=e.get(".searchbox-input",b),f=e.query("li",c);a.searchObj={searchbox:b,searchForm:e.get("form",b),menu:c,menuSelected:e.get(".s-menu-selected",c),menuContainer:e.get(".s-menu-container",c),menuList:e.get(".s-menu-list",c),menuItems:f,searchboxOuter:e.get(".searchbox-outer",b),searchboxInner:e.get(".searchbox-inner",b),input:d,btnClear:e.get(".s-btn-clear",b),menuItemCount:e.query("li",c).length},a.curItem=e.filter(f,"."+a.get("currentCls"))[0],a._dealClearBtn();var g="autofocus"in document.createElement("input"),h=e.attr(d,"data-autofocus"),i=h=="autofocus"||h==!0;(!g||!i)&&a._dealLabel(),i&&d.focus()},destructor:function(){}}),a.augment(h,h.METHODS),h},{requires:["brix/core/brick","node"]}),KISSY.add("searchTabBox",function(a,b){var c=a.DOM,d=a.Event,e={searchForm:"#J_etaoForm",searchInput:"#J_searchIpt",autosuggest:"data-suggest-api",stat:"data-stat-submit",emptyAction:"data-empty-action",redirect:"data-redirect",labelshowCls:"labelshow",backgroundOuter:"#J_sBgOuter",menu:"#J_sMenu",menuSelectedItem:"#J_sMenuSelected",menuContainer:"#J_sMenuContainer",menuList:"#J_sMenuList",currentCls:"selected",btnClear:"#J_sBtnClear",btnSubmit:"#J_sBtnSubmit",isSuggest:!0},f=function(f){var g=this;c=KISSY.DOM,d=KISSY.Event,KISSY.mix(g,KISSY.EventTarget),g.config=f=a.merge(e,f),g.event={loaded:"loaded",submited:"submited",tabChange:"tabChange",tabChanged:"tabChanged",focused:"focused"};var h=function(){return g.searchInput.value===""};g.searchForm=c.get(g.config.searchForm),g.menu=c.get(f.menu),g.menuContainer=c.get(f.menuContainer),g.menuList=c.get(f.menuList),g.menuItems=c.query(f.menuList+" li"),g.curItem=c.filter(g.menuItems,"."+f.currentCls)[0],g.bgOuter=c.get(f.backgroundOuter),g.searchInput=c.get(f.searchInput),g.btnClear=c.get(f.btnClear),g.btnSubmit=c.get(f.btnSubmit),g.selItem=c.get(g.config.menuSelectedItem);if(!(g.searchForm&&g.bgOuter&&g.searchInput))return;var i=g.menuItems.length;d.on(g.menu,"mouseenter",function(a){a.preventDefault();var b=a.currentTarget;c.addClass(b,"expand"),c.height(g.menuContainer,26*i+12),c.height(g.menuList,26*i+9),c.addClass(c.parent(b),"expandmenu"),c.hasClass(g.bgOuter,"focus")||c.addClass(g.bgOuter,"focus")}),d.on(g.menu,"mouseleave",function(a){a.preventDefault(),j(),g.searchInput.focus()});var j=function(){c.removeClass(g.menu,"expand"),c.height(g.menuContainer,0),c.height(g.menuList,0),c.removeClass(c.parent(g.menu),"expandmenu")},k=function(a){c.removeClass(a,"btn-show"),c.addClass(a,"btn-hide")},l=function(a){c.removeClass(a,"btn-hide"),c.addClass(a,"btn-show")};d.on(g.btnClear,"click",function(a){var b=g.searchInput;c.val(b,""),k(g.btnClear),b.focus()}),d.on(g.searchInput,"keyup",function(a){g.searchInput.value!==""?l(g.btnClear):k(g.btnClear)}),g.fireEvent(g.searchInput,"keyup"),d.on(g,g.event.loaded,g.config.loaded),g.loaded(),d.on(g.menuItems,"click",function(a){g.tabChange({tar:a.currentTarget,clickE:a})});var m=navigator.userAgent.toLowerCase();m.match(/iPad/i)=="ipad"&&d.on(c.prev(g.searchInput,"label"),"click",function(a){g.searchInput.focus()}),d.on(g,g.event.tabChange,function(d){var e=h(),i=d.eventData.tar;if(c.hasClass(i,f.currentCls)){d.eventData.clickE.halt(!0);return}a.each(g.menuItems,function(a){c.removeClass(a,f.currentCls)}),c.addClass(i,f.currentCls),j(),c.html(g.selItem,c.html(c.get("a",i))+"<i></i>"),g.searchInput.focus(),g.suggest&&(g.suggest.on("beforeStart",function(){return!1}),g.suggest=b),g.curItem=i,g.fire(g.event.tabChanged,{eventData:i});var k=a.trim(c.attr(c.get(f.menuList),g.config.redirect))!=="false";if(!k){d.eventData.clickE.halt(!0);return}var l=c.get("a",g.curItem),m=a.trim(c.attr(l,g.config.emptyAction));e?m?c.get("a",g.curItem).href=m:d.eventData.clickE.halt(!0):(d.eventData.clickE.halt(!0),g.fireEvent(g.searchForm,"submit"))}),d.on(g.searchForm,"submit",function(b){var d=h(),e=c.get("a",g.curItem),f=a.trim(c.attr(e,g.config.emptyAction));if(d)if(f)g.searchInput.value="",this.action=f,c.addClass(g.btnSubmit,"loading"),g.searchForm.submit();else return b.halt(!0),!1;else{c.addClass(g.btnSubmit,"loading"),this.action=c.attr(e,"href"),g.parseAction(this.action);var i=c.attr(e,g.config.stat);g.searchForm.submit()}}),d.on(g.searchInput,"blur",function(a){c.hasClass(g.bgOuter,"focus")&&!c.hasClass(g.selItem,"expand")&&c.removeClass(g.bgOuter,"focus")}),d.on(g.searchInput,"focus",function(b){c.hasClass(g.bgOuter,"focus")||c.addClass(g.bgOuter,"focus");if(g.config.isSuggest){if(g.suggest){g.detach(b.type,arguments.callee);return}var d=c.attr(g.curItem,g.config.autosuggest);d&&d.indexOf("area=etao")>0&&a.use("suggest",function(){g._initSuggest(d)})}g.focused()});var n="autofocus"in document.createElement("input"),o=c.attr(g.searchInput,"data-autofocus"),p=o=="autofocus"||o==!0;p&&g.searchInput.focus(),a.placeholder(g.searchInput)};a.augment(f,{loaded:function(){this.fire(this.event.loaded)},submited:function(){return this.fire(this.event.submited)},tabChange:function(a){this.fire(this.event.tabChange,{eventData:a})},focused:function(){this.fire(this.event.focused)},_initSuggest:function(b){var d=this;d.suggest=new a.Suggest(this.searchInput,b,{resultFormat:"%result%",offset:0}),d.suggest.on("dataReturn",function(a){d.suggest.etaobook=a.data.etaobook,d.suggest.results=a.data.result}),d.suggest.on("beforeShow",function(){var b=d.suggest.etaobook,e="";b&&b.length>0&&(a.each(b,function(a,c){e+='<li class="ks-suggest-extra" key="'+b[c][0]+'" data-epid="'+b[c][1]+'"><span class="ks-suggest-key">'+b[c][0]+'</span><span class="suggest-star">\u2605</span><span class="suggest-author">'+b[c][2]+'</span><span class="suggest-pub">'+b[c][3]+'</span><span class="suggest-time">'+b[c][4]+"</span></li>"}),d.suggest.results.length===0&&c.html(d.suggest.content,"<ol></ol>"),e&&c.append(c.create(e),d.suggest.content.firstChild)),d._keyword()}),d.suggest.on("itemSelect",function(){var b=this.selectedItem,e=c.query("li",this.containers);d.writeHiddenInput(d.searchForm,"wq",c.attr(b,"key")),d.writeHiddenInput(d.searchForm,"suggest","0_"+a.indexOf(b,e));var f=c.attr(b,"data-epid");f&&(d.writeHiddenInput(d.searchForm,"epid",f),d.writeHiddenInput(d.searchForm,"v","product"),d.writeHiddenInput(d.searchForm,"p","detail"))}),d.suggest.on("beforeSubmit",function(){if(d.searchInput.value==="")return!1})},_keyword:function(){var b=this,d=this.suggest,e=d.query,f=e.length;a.each(c.query("li",d.content),function(a){var b=c.get(".ks-suggest-key",a),d=c.html(b);d.indexOf(e)===0&&c.html(b,d.substring(0,f)+"<b>"+d.substring(f,d.length)+"</b>")})},writeHiddenInput:function(a,b,d){var e=a[b];return e?e.value=d:(e=c.create('<input type="hidden" name="'+b+'" value="'+d+'" />'),a.appendChild(e)),e},parseAction:function(b){if(b.indexOf("?")!==-1){var c=b.substring(b.indexOf("?")+1,b.length).split("&");for(var d=0,e=c.length;d<e;d++){if(a.trim(c[d])==="")continue;var f=c[d].split("=");this.writeHiddenInput(this.searchForm,f[0],f[1])}}},fireEvent:function(a,b){if(document.createEvent){var c=document.createEvent("HTMLEvents");c.initEvent(b,!1,!0),a.dispatchEvent(c)}else if(document.createEventObject){var d=document.createEventObject(b);a.fireEvent("on"+b,d)}}}),a.mix(f.prototype,a.EventTarget),a.searchTabBox=f},{requires:["brix/core/brick","node"]});