KISSY.add("brix/gallery/sidenav/index",function(e,t){var a=e.all,i=function(){i.superclass.constructor.apply(this,arguments)};return i.ATTRS={index:{value:"#!/home/"},duration:{value:.25},pathMap:{value:{"#!/adzone/adzone_detail/":"#!/adzone/adzone/","#!/plan/handle/":"#!/plan/list/","#!/plan/price_handle/":"#!/plan/list/","#!/messages/list/":"","#!/messages/detail/":"","#!/components/":""}}},e.extend(i,t,{initialize:function(){this.sidebar=e.one("#sidebar"),this.main=e.one("#inmain"),this.allLinks=this.sidebar.all("a"),this.nav=e.one("#nav"),this.subNav=e.one("#subNav"),this.subNavWrap=e.one("#subNavWrap"),this.subNavHandle=e.one("#subNavHandle"),this.pathMap=this.get("pathMap"),this.subNavView=e.one('<div class="sub-nav-view"></div>').appendTo("body"),this.localStorage=window.localStorage,this.isFullSubNav=this.localStorage&&this.localStorage.isFullSubNav||"1","0"===this.isFullSubNav&&this.subNavHandle.replaceClass("icon-expand","icon-collapse"),this.index=this.get("index"),this.duration=this.get("duration"),this.isHandleClick=!1,this.navTop=this.nav.offset().top,this._bindUI(),this._pathname2sidebar()},clickSwitch:function(t){e.one(t).fire("click")},_getPathname:function(){var e,t=/^#!(\/.+)\/.*$/.exec(location.hash);return e=t&&t[1]||""},_pathname2sidebar:function(){var t=this._getPathname(),a=t&&"#!"+t+"/"||this.index;return e.each(this.pathMap,function(e,t){return a===t?(a=e,!1):void 0}),""===a?(this._setNoSelectedNav(),void 0):(this.sidebar.all("a").each(function(e){var t=e.attr("href"),i=t.match(/.*\//);if(!i)return!1;var n=i[0];return n.slice(n.indexOf("#"))===a?(e.fire("click"),!1):void 0}),this.isNavClick=!1,void 0)},_setNoSelectedNav:function(){this.sidebar.all("a").removeClass("on"),this._collapseNav()},_bindUI:function(){var t=this;a(window).on("scroll",function(){t._timer(function(){t._fixedStatic()},10)}).on("hashchange",function(){t.isNavClick||t._pathname2sidebar(),t.isNavClick=!1}),t.nav.delegate("click","a",function(i){var n=e.one(i.target);t.isHandleClick=!1,t._expandCollapseNav(n),t.nowNav=n,t.isNavClick=!0,a(window).scrollTop(0)}),t.subNav.delegate("click","a",function(i){var n=e.one(i.target).closest("a"),r=n.closest(".sub-nav-ul"),s=r.attr("data-sub");t.isHandleClick=!1,t.nowNav=t.nav.all("a[data-sub="+s+"]"),t.nowNav.fire("click"),t.currentSubNav=n.closest(".sub"),t._setSubNavOn(n),t.isNavClick=!0,a(window).scrollTop(0)}),t.subNav.delegate("click",".sub-title",function(e){var i=a(e.currentTarget),n=i.next(".sub-nav-third");if("0px"===n.css("height")){var r=n.css("height","auto").height();n.css("height",0),n.animate({height:r},t.duration,"easeOut")}else n.animate({height:0},t.duration,"easeOut")}),t.subNavHandle.on("click",function(){t.isHandleClick=!0,t._expandCollapseSubNav()}),t.subNav.delegate("mouseenter",".sub",function(a){if("0"===t.isFullSubNav){var i=e.one(a.target).closest(".sub"),n=i.offset();t.currentLi=i,t.subNavView.html(i.html()),t.subNavView.one(".sub-nav-third").css("height","auto"),t.subNavView.css(n)}}),t.subNavView.on("mouseleave",function(){t.subNavView.css("left","-10000px"),t.subNavView.one(".sub-nav-third").css("height",0),t.currentLi.html(t.subNavView.html())}),t.subNavView.delegate("click","a",function(a){var i=e.one(a.target).closest("a");t._setSubNavOn(i),t.currentSubNav=t.currentLi,t.isNavClick=!0})},_fixedStatic:function(){var t=this,a=Math.max(document.body.scrollTop,document.documentElement.scrollTop),i=a>t.navTop;i?(t.sidebar.addClass("sidebar-fixed"),6===e.UA.ie&&t.sidebar.css({position:"absolute",top:a+10})):(t.sidebar.removeClass("sidebar-fixed"),6===e.UA.ie&&t.sidebar.css({position:"static"}))},_timer:function(e,t){clearTimeout(this.itv),this.itv=setTimeout(e,t)},_setSubNavOn:function(e){var t=e.closest(".sub-nav-third");this.subNav.all("a, .icon-font").removeClass("on"),this.subNavView.all("a, .icon-font").removeClass("on"),e.addClass("on"),"0"===this.isFullSubNav&&t&&t.prev().addClass("on")},_expandCollapseNav:function(e){var t,a=this,i=e.attr("data-sub"),n=e.attr("href");if(n=n.slice(n.indexOf("#")),i){if(a.currentNav&&a.currentNav.hide(),a.currentNav=a.subNav.one('[data-sub="'+i+'"]'),a.currentNav.all("a").each(function(e){var a=e.attr("href");return a.slice(a.indexOf("#"))===n?(t=e,!1):void 0}),!t)return;a.currentSubNav=t,a._setSubNavOn(t),a.currentNav.show(),a._expandNav()}else a._collapseNav();a.nav.all("a").removeClass("on"),e.addClass("on")},_switchTrigger:function(){"1"===this.isFullSubNav?this.subNavHandle.replaceClass("icon-collapse","icon-expand"):"0"===this.isFullSubNav&&this.subNavHandle.replaceClass("icon-expand","icon-collapse")},_expandCollapseSubNav:function(){function e(){var e="1"===this.isFullSubNav;this.isFullSubNav=e?"0":"1",this.localStorage&&(this.localStorage.isFullSubNav=e?"0":"1")}var t=this,a=t.currentSubNav,i=a&&("LI"===a.prop("nodeName")?a.one("ul"):a.closest("ul")),n=i&&i.hasClass("sub-nav-third");"0"===t.isFullSubNav?(e.call(t),t._expandSubNav(),t._switchTrigger(),n&&i.prev()&&i.prev().removeClass("on")):"1"===t.isFullSubNav&&(t._collapseSubNav(function(){e.call(t),t._switchTrigger()}),n&&i.prev()&&i.prev().addClass("on"))},_collapseSubNav:function(e){this.subNav.animate({width:"16px","padding-top":"42px"},this.duration,"easeOut",e),this.main.animate({"margin-left":"116px"},this.duration,"easeOut"),this._collapseThirdNav()},_expandSubNav:function(e){this.subNav.animate({width:"140px","padding-top":"0px"},this.duration,"easeOut",e),this.main.animate({"margin-left":"240px"},this.duration,"easeOut"),this._expandThirdNav(),this.subNavView.css("left","-10000px")},_expandThirdNav:function(t){var a=this;a.nowNav&&(a.nowNav.attr("data-sub")!==a.currentNav.attr("data-sub")||a.isHandleClick?e.all(".sub-nav-third").each(function(e){var i=e.css("height","auto").height();e.css("height",0),e.animate({height:i},a.duration,"easeOut",t)}):e.all(".sub-nav-third").css("height","auto"))},_collapseThirdNav:function(t){e.all(".sub-nav-third").animate({height:0},this.duration,"easeOut",t)},_expandNav:function(e){this.subNav.show(),this.subNav.animate({width:"1"===this.isFullSubNav?"140px":"16px","padding-top":"1"===this.isFullSubNav?"0":"42px"},this.duration,"easeOut",e),this.subNavWrap.animate({"margin-left":"0"},this.duration,"easeOut",e),this.main.animate({"margin-left":"1"===this.isFullSubNav?"240px":"116px"},this.duration,"easeOut"),"1"===this.isFullSubNav?this._expandThirdNav():this._collapseThirdNav()},_collapseNav:function(e){var t=this;this.subNav.animate({width:"1px"},this.duration,"easeOut",function(){t.subNav.hide()}),this.subNavWrap.animate({"margin-left":"1"===this.isFullSubNav?"-140px":"-16px"},this.duration,"easeOut",e),this.main.animate({"margin-left":"100px"},this.duration,"easeOut")}}),i},{requires:["brix/core/brick"]});