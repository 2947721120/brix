KISSY.add("brix/gallery/pagination/index",function(t,e){function n(e){if(!t.isPlainObject(e))return"";var n,r,i="&",a="=",o=[];for(n in e)if(e.hasOwnProperty(n))if(r=e[n],t.isArray(r)){if(t.isArray(r)&&r.length)for(var u=0,s=r.length;s>u;++u)o.push(n,a,r[u],i)}else o.push(n,a,r,i);return o.pop(),o.join("")}function r(e){if("string"!=typeof e||0===(e=t.trim(e)).length)return{};for(var n,r,i,a="&",o="=",u={},s=e.split(a),l=0,c=s.length;c>l;++l)n=s[l].split(o),r=n[0],i=n[1]||"",Object.prototype.hasOwnProperty.call(u,r)?t.isArray(u[r])?u[r].push(i):u[r]=[u[r],i]:u[r]=i;return u}function i(){i.superclass.constructor.apply(this,arguments)}return i.ATTRS={mode:{value:"p"},offset:{value:0},simplify:{value:!1},step:{value:7},index:{value:1},size:{value:15},sizeChange:{value:!1},count:{value:350},hascount:{value:!0},max:{value:!1},hasmax:{value:!1},statistics:{value:!1},pageCount:{value:!0},jump:{value:!1},goTo:{value:!0},goToUrl:{value:null},pageName:{value:"page"},pageSizeName:{value:"pagesize"},params:{value:!1},defaultUI:{value:!0},sizes:{value:[10,15,20,25,30]},urlInfo:{value:{}},formatUrl:{value:!1},isText:{value:!1}},i.EVENTS={".page-num":{keydown:function(t){13===t.keyCode&&(t.preventDefault(),this._jumpPage())}},".btn-jump":{click:function(t){t.preventDefault(),this._jumpPage()}},a:{click:function(e){var n=this,r=t.one(e.currentTarget);if(r.hasClass("page"))e.preventDefault(),n.goToPage(parseInt(r.html(),10));else if(r.hasClass("page-prev")){e.preventDefault();var i=n.get("index");n.goToPage(i-1)}else if(r.hasClass("page-next")){e.preventDefault();var i=n.get("index");n.goToPage(i+1)}}}},i.FIRES={beforeGotoPage:"beforeGotoPage",goToPage:"goToPage",gotoPage:"gotoPage",sizeChange:"sizeChange"},i.METHODS={goToPage:function(t){var e,n=this;e=n.fire("beforeGotoPage",{newIndex:t,prevIndex:n.get("index")}),e!==!1&&(n.set("index",t),n.setConfig({index:t})||(n.fire("goToPage",{index:t}),n.fire("gotoPage",{index:t})))},setConfig:function(t){var e=this,n=e.get("size");for(var r in t)e.set(r,t[r]);if(t.goToUrl&&e._setUrlInfo(),e.get("goTo")){var i=e.doUrl();return location.href=i,!0}return t.size&&t.size!=n&&e.fire("sizeChange",{size:t.size}),e._destroyDropdown(),e._resizeConfig(),e.renderUI(),e._getDropDown(),!1},parseUrl:function(t){var e=document.createElement("a");return e.href=t,{source:t,protocol:e.protocol.replace(":",""),host:e.hostname,port:e.port,query:e.search,params:function(){return r(e.search.replace(/^\?/,""))}(),file:(e.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:e.hash.replace("#",""),path:e.pathname.replace(/^([^\/])/,"/$1"),relative:(e.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:e.pathname.replace(/^\//,"").split("/")}},doUrl:function(){var t=this,e=t.get("urlInfo"),r=t.get("index"),i=t.get("size"),a=t.get("pageName"),o=t.get("pageSizeName"),u="";return e.params[a]=t._offset(r),o?e.params[o]=i:e.params[o]&&delete e.params[o],e.protocol&&(u=e.protocol+"://"+e.host,0!=e.port&&80!=e.port&&(u+=":"+e.port)),u+=e.path+"?",u+=n(e.params),""!=e.hash&&(u+="#"+e.hash),u}},t.extend(i,e,{initialize:function(){var t=this;t._setUrlInfo();var e=t.get("urlInfo"),n=t.get("mode"),r=t.get("offset"),i=t.get("pageName"),a=t.get("pageSizeName");if(a&&e.params[a]&&t.set("size",parseInt(e.params[a],10)),e.params[i])switch(n){case"p":t.set("index",parseInt(e.params[i],10)-r);break;case"s":var o=t.get("size");t.set("index",(parseInt(e.params[i],10)-r*o)/o)}t._resizeConfig(),t.get("defaultUI")&&t.renderUI(),t._getDropDown()},destructor:function(){this._destroyDropdown()},renderUI:function(){var e=this,n=(e.get("mode"),e.get("formatUrl")),r=e.get("index"),i=e.get("max"),a=Math.min(e.get("step"),i),o=e.get("size"),u=e.get("count"),s=e.get("hascount"),l=e.get("pageCount"),c=e.get("isText"),f=[];if(e.get("statistics")){if(f.push('<div class="pagination-info"><span>\u5f53\u524d</span><span class="b">'+(0==u?0:(r-1)*o+1)+"-"+Math.min(r*o,u)+'</span><span>\u6761</span><span class="mr">\u5171</span><span class="b">'+u+'</span><span>\u6761</span><span class="mr">\u6bcf\u9875\u5c55\u73b0</span>'),e.get("sizeChange")){var h=e.get("sizes");f.push('<div class="dropdown"><span class="dropdown-hd"><span class="dropdown-text" value="'+t.indexOf(o,h)+'">'+o+"</span>"+"</span>"+'<ul class="dropdown-list dropdown-list-noicon">'),t.each(h,function(t,e){f.push('<li class="dropdown-item'+(t==o?" dropdown-itemselected":"")+'"><span value="'+e+'">'+t+"</span></li>")}),f.push("</ul></div>")}else f.push('<span class="b">'+o+"</span>");f.push("<span>\u6761</span></div>")}if(f.push('<div class="pagination-pages"><div class="pagination-page">'),r>1&&f.push('<a title="\u4e0a\u4e00\u9875" href="'+n.replace("{$p}",e._offset(r-1))+'" class="page-prev"><i class="iconfont">&#403</i>'+(c?"<span>\u4e0a\u4e00\u9875</span>":"")+"</a>"),e.get("simplify"))f.push('<span class="page-simply">'+r+"/"+i+"</span>");else{var d=Math.max(1,r-parseInt(a/2)),p=Math.min(i,d+a-1);d=Math.max(1,p-a+1),d>=3?(f.push('<a class="page" href="'+n.replace("{$p}",e._offset(1))+'" title="\u7b2c1\u9875">1</a>'),f.push('<a class="page" href="'+n.replace("{$p}",e._offset(2))+'" title="\u7b2c2\u9875">2</a>'),d>3&&f.push('<span class="page-split">...</span>')):2==d&&f.push('<a class="page" href="'+n.replace("{$p}",e._offset(1))+'" title="\u7b2c1\u9875">1</a>');for(var g=d;p>=g;g++)g===r?f.push('<span class="page-cur">'+g+"</span>"):f.push('<a class="page" href="'+n.replace("{$p}",e._offset(g))+'" title="\u7b2c'+g+'\u9875">'+g+"</a>");i>=p+2?(f.push('<span class="page-split">...</span>'),s&&f.push('<a class="page" href="'+n.replace("{$p}",e._offset(i))+'" title="\u7b2c'+i+'\u9875">'+i+"</a>")):i>p&&f.push('<a class="page" href="'+n.replace("{$p}",e._offset(i))+'" title="\u7b2c'+i+'\u9875">'+i+"</a>")}r!=i&&f.push('<a title="\u4e0b\u4e00\u9875" href="'+n.replace("{$p}",e._offset(r+1))+'" class="page-next">'+(c?"<span>\u4e0b\u4e00\u9875</span>":"")+'<i class="iconfont">&#402</i></a>'),f.push("</div>"),s&&l&&f.push('<div class="pagination-count"><span>\u5171</span><span class="b">'+i+"</span><span>\u9875</span></div>"),e.get("jump")&&f.push('<div class="pagination-form"><span>\u5411\u7b2c</span><input class="page-num" value="'+Math.min(i,r+1)+'" name="page" type="text"><span>\u9875</span><a class="btn-jump btn btn-size25">\u8df3\u8f6c</a></div>'),f.push("</div>"),e.get("el").html(f.join(""))},_offset:function(t){var e=this,n=e.get("mode"),r=e.get("offset");switch(n){case"p":return t+r;case"s":var i=e.get("size");return i*(t+r);default:return t+r}},_getDropDown:function(){var t=this;if(t.get("sizeChange")&&t.get("statistics")){var e=t.get("el").one(".dropdown");if(e){var n=e?e.attr("id"):!1;n&&t.pagelet?t.pagelet.ready(function(){t.dropdown=t.pagelet.getBrick(n),t.dropdown?t._bindDropdownSizeChange():t._createDropdown()}):t._createDropdown()}}},_createDropdown:function(){var e=this;t.use("brix/gallery/dropdown/",function(t,n){e.dropdown=new n({tmpl:e.get("el").one(".dropdown")}),e._bindDropdownSizeChange()})},_bindDropdownSizeChange:function(){var t=this;t.dropdown.on("selected",function(e){t.setConfig({index:1,size:e.text})})},_destroyDropdown:function(){var t=this;t.dropdown&&(t.dropdown.destroy(),t.dropdown=null)},_jumpPage:function(){var t=this,e=this.get("el").one(".page-num"),n=parseInt(e.val(),10),r=t.get("max"),i=t.get("index");return isNaN(n)||1>n||n>r||n==i?(e[0].select(),void 0):(this.goToPage(n),void 0)},_setUrlInfo:function(){var e=this,n=e.get("params");e.get("goToUrl")||e.set("goToUrl",location.href);var r=e.parseUrl(e.get("goToUrl"));n&&t.each(n,function(t,e){r.params[e]=t}),t.log(r.params.s),e.set("urlInfo",r),t.log(r.params.s)},_resizeConfig:function(){var t=this,e=t.get("index"),n=t.get("hascount"),r=t.get("size"),i=t.get("count"),a=t.get("max"),o=t.get("hasmax"),u=t.get("pageName");if(t.get("pageSizeName"),!n){var s=t.get("step");i=e>=s?r*(e+1):r*s,t.set("count",i)}a=o?Math.min(Math.ceil(i/r),a):Math.ceil(i/r),t.set("max",a),e=Math.min(e,a),t.set("index",e),0===i&&(t.set("max",1),t.set("index",1)),t.set("formatUrl",t.doUrl().replace(u+"="+t._offset(e),u+"={$p}"))}}),t.augment(i,i.METHODS),i},{requires:["brix/core/brick"]});