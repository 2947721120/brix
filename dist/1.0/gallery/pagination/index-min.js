KISSY.add("brix/gallery/pagination/index",function(a,b){function c(b){if(!a.isPlainObject(b))return"";var c="&",d="=",e=[],f,g;for(f in b)if(b.hasOwnProperty(f)){g=b[f]||"";if(!a.isArray(g))e.push(f,d,g,c);else if(a.isArray(g)&&g.length)for(var h=0,i=g.length;h<i;++h)e.push(f,d,g[h],c)}return e.pop(),e.join("")}function d(b){if(typeof b!="string"||(b=a.trim(b)).length===0)return{};var c="&",d="=",e={},f=b.split(c),g,h,i,j=0,k=f.length;for(;j<k;++j)g=f[j].split(d),h=g[0],i=g[1]||"",Object.prototype.hasOwnProperty.call(e,h)?a.isArray(e[h])?e[h].push(i):e[h]=[e[h],i]:e[h]=i;return e}function e(){e.superclass.constructor.apply(this,arguments)}return e.ATTRS={mode:{value:"p"},offset:{value:0},simplify:{value:!1},step:{value:7},index:{value:1},size:{value:15},sizeChange:{value:!1},count:{value:350},hascount:{value:!0},max:{value:!1},hasmax:{value:!1},statistics:{value:!1},pageCount:{value:!0},jump:{value:!1},goTo:{value:!0},goToUrl:{value:null},pageName:{value:"page"},pageSizeName:{value:"pagesize"},params:{value:!1},defaultUI:{value:!0},sizes:{value:[10,15,20,25,30]},urlInfo:{value:{}},formatUrl:{value:!1},isText:{value:!1}},e.EVENTS={".page-num":{keydown:function(a){a.keyCode===13&&(a.preventDefault(),this._jumpPage())}},".btn-jump":{click:function(a){a.preventDefault(),this._jumpPage()}},a:{click:function(b){var c=this,d=a.one(b.currentTarget);if(d.hasClass("page"))b.preventDefault(),c.goToPage(parseInt(d.html(),10));else if(d.hasClass("page-prev")){b.preventDefault();var e=c.get("index");c.goToPage(e-1)}else if(d.hasClass("page-next")){b.preventDefault();var e=c.get("index");c.goToPage(e+1)}}}},e.FIRES={beforeGotoPage:"beforeGotoPage",goToPage:"goToPage",gotoPage:"gotoPage",sizeChange:"sizeChange"},e.METHODS={goToPage:function(a){var b=this,c;c=b.fire("beforeGotoPage",{newIndex:a,prevIndex:b.get("index")});if(c===!1)return;b.set("index",a);if(b.setConfig({index:a}))return;b.fire("goToPage",{index:a}),b.fire("gotoPage",{index:a})},setConfig:function(a){var b=this,c=b.get("size");for(var d in a)b.set(d,a[d]);a.goToUrl&&b._setUrlInfo();if(b.get("goTo")){var e=b.doUrl();return location.href=e,!0}return a.size&&a.size!=c&&b.fire("sizeChange",{size:a.size}),b._destroyDropdown(),b._resizeConfig(),b.renderUI(),b._getDropDown(),!1},parseUrl:function(a){var b=document.createElement("a");return b.href=a,{source:a,protocol:b.protocol.replace(":",""),host:b.hostname,port:b.port,query:b.search,params:function(){return d(b.search.replace(/^\?/,""))}(),file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:b.hash.replace("#",""),path:b.pathname.replace(/^([^\/])/,"/$1"),relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:b.pathname.replace(/^\//,"").split("/")}},doUrl:function(){var a=this,b=a.get("urlInfo"),d=a.get("index"),e=a.get("size"),f=a.get("pageName"),g=a.get("pageSizeName"),h;return b.params[f]=a._offset(d),g?b.params[g]=e:b.params[g]&&delete b.params[g],h=b.protocol+"://"+b.host,b.port!=0&&b.port!=80&&(h+=":"+b.port),h+=b.path+"?",h+=c(b.params),b.hash!=""&&(h+="#"+b.hash),h}},a.extend(e,b,{initialize:function(){var a=this;a._setUrlInfo();var b=a.get("urlInfo"),c=a.get("mode"),d=a.get("offset"),e=a.get("pageName"),f=a.get("pageSizeName");f&&b.params[f]&&a.set("size",parseInt(b.params[f],10));if(b.params[e])switch(c){case"p":a.set("index",parseInt(b.params[e],10)-d);break;case"s":var g=a.get("size");a.set("index",(parseInt(b.params[e],10)-d*g)/g)}a._resizeConfig(),a.get("defaultUI")&&a.renderUI(),a._getDropDown()},destructor:function(){this._destroyDropdown()},renderUI:function(){var b=this,c=b.get("mode"),d=b.get("formatUrl"),e=b.get("step"),f=b.get("index"),g=b.get("max"),h=b.get("size"),i=b.get("count"),j=b.get("hascount"),k=b.get("pageCount"),l=b.get("isText"),m=[];if(b.get("statistics")){m.push('<div class="pagination-info"><span>\u5f53\u524d</span><span class="b">'+(i==0?0:(f-1)*h+1)+"-"+Math.min(f*h,i)+'</span><span>\u6761</span><span class="mr">\u5171</span><span class="b">'+i+'</span><span>\u6761</span><span class="mr">\u6bcf\u9875\u5c55\u73b0</span>');if(b.get("sizeChange")){var n=b.get("sizes");m.push('<div class="dropdown"><span class="dropdown-hd"><span class="dropdown-text" value="'+a.indexOf(h,n)+'">'+h+"</span>"+"</span>"+'<ul class="dropdown-list dropdown-list-noicon">'),a.each(n,function(a,b){m.push('<li class="dropdown-item'+(a==h?" dropdown-itemselected":"")+'"><span value="'+b+'">'+a+"</span></li>")}),m.push("</ul></div>")}else m.push('<span class="b">'+h+"</span>");m.push("<span>\u6761</span></div>")}m.push('<div class="pagination-pages"><div class="pagination-page">'),f>1&&m.push('<a title="\u4e0a\u4e00\u9875" href="'+d.replace("{$p}",b._offset(f-1))+'" class="page-prev"><i class="iconfont">&#403</i>'+(l?"<span>\u4e0a\u4e00\u9875</span>":"")+"</a>");if(b.get("simplify"))m.push('<span class="page-simply">'+f+"/"+g+"</span>");else{var o=Math.max(1,f-parseInt(e/2)),p=Math.min(g,o+e-1);o=Math.max(1,p-e+1),o>=3?(m.push('<a class="page" href="'+d.replace("{$p}",b._offset(1))+'" title="\u7b2c1\u9875">1</a>'),m.push('<a class="page" href="'+d.replace("{$p}",b._offset(2))+'" title="\u7b2c2\u9875">2</a>'),o>3&&m.push('<span class="page-split">...</span>')):o==2&&m.push('<a class="page" href="'+d.replace("{$p}",b._offset(1))+'" title="\u7b2c1\u9875">1</a>');for(var q=o;q<=p;q++)q===f?m.push('<span class="page-cur">'+q+"</span>"):m.push('<a class="page" href="'+d.replace("{$p}",b._offset(q))+'" title="\u7b2c'+q+'\u9875">'+q+"</a>");p+2<=g?(m.push('<span class="page-split">...</span>'),j&&m.push('<a class="page" href="'+d.replace("{$p}",b._offset(g))+'" title="\u7b2c'+g+'\u9875">'+g+"</a>")):p<g&&m.push('<a class="page" href="'+d.replace("{$p}",b._offset(g))+'" title="\u7b2c'+g+'\u9875">'+g+"</a>")}f!=g&&m.push('<a title="\u4e0b\u4e00\u9875" href="'+d.replace("{$p}",b._offset(f+1))+'" class="page-next">'+(l?"<span>\u4e0b\u4e00\u9875</span>":"")+'<i class="iconfont">&#402</i></a>'),m.push("</div>"),j&&k&&m.push('<div class="pagination-count"><span>\u5171</span><span class="b">'+g+"</span><span>\u9875</span></div>"),b.get("jump")&&m.push('<div class="pagination-form"><span>\u5411\u7b2c</span><input class="page-num" value="'+Math.min(g,f+1)+'" name="page" type="text"><span>\u9875</span><a class="btn-jump btn btn-size25">\u8df3\u8f6c</a></div>'),m.push("</div>"),b.get("el").html(m.join(""))},_offset:function(a){var b=this,c=b.get("mode"),d=b.get("offset");switch(c){case"p":return a+d;case"s":var e=b.get("size");return e*(a+d);default:return a+d}},_getDropDown:function(){var a=this;if(a.get("sizeChange")&&a.get("statistics")){var b=a.get("el").one(".dropdown");if(b){var c=b?b.attr("id"):!1;c&&a.pagelet?a.pagelet.ready(function(){a.dropdown=a.pagelet.getBrick(c),a.dropdown?a._bindDropdownSizeChange():a._createDropdown()}):a._createDropdown()}}},_createDropdown:function(){var b=this;a.use("brix/gallery/dropdown/",function(a,c){b.dropdown=new c({tmpl:b.get("el").one(".dropdown")}),b._bindDropdownSizeChange()})},_bindDropdownSizeChange:function(){var a=this;a.dropdown.on("selected",function(b){a.setConfig({index:1,size:b.text})})},_destroyDropdown:function(){var a=this;a.dropdown&&(a.dropdown.destroy(),a.dropdown=null)},_jumpPage:function(){var a=this,b=this.get("el").one(".page-num"),c=parseInt(b.val(),10),d=a.get("max"),e=a.get("index");if(isNaN(c)||c<1||c>d||c==e){b[0].select();return}this.goToPage(c)},_setUrlInfo:function(){var b=this,c=b.get("params");b.get("goToUrl")||b.set("goToUrl",location.href);var d=b.parseUrl(b.get("goToUrl"));c&&a.each(c,function(a,b){d.params[b]=a}),b.set("urlInfo",d)},_resizeConfig:function(){var a=this,b=a.get("index"),c=a.get("hascount"),d=a.get("step"),e=a.get("size"),f=a.get("count"),g=a.get("max"),h=a.get("hasmax"),i=a.get("pageName"),j=a.get("pageSizeName");c||(b>=d?f=e*(b+1):f=e*d,a.set("count",f)),h?g=Math.min(Math.ceil(f/e),g):g=Math.ceil(f/e),a.set("max",g),b=Math.min(b,g),a.set("index",b),f===0&&(a.set("max",1),a.set("index",1)),d=Math.min(d,g),a.set("step",d),a.set("formatUrl",a.doUrl().replace(i+"="+a._offset(b),i+"={$p}"))}}),a.augment(e,e.METHODS),e},{requires:["brix/core/brick"]});