KISSY.add("brix/gallery/charts/index",function(e,t,n){function i(){var t=this;i.superclass.constructor.apply(t,arguments),t.resizeFn=function(){t.resize()},e.one(window).on("resize",t.resizeFn),t.init()}var a=n.all,r=0;return i.ATTRS={w:{value:100},h:{value:100},mainDiv:{value:null},url_svg:{value:"brix/gallery/charts/js/case"},url_swf:{value:"brix/gallery/charts/as/case"},path_swf:{value:Brix.basePath+"brix/"+Brix.fixed+"gallery/charts/as/case.swf"},mainDiv_id:{value:"J_Charts_"},swfDiv:{value:null},swfDiv_id:{value:"J_SWF_"},_case:{value:null},_resize_index:{value:0},_actionsObject:{value:{name:"",value:""}},_isDestroy:{value:!1}},e.extend(i,t,{init:function(){var t=this;r=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?0:1,("maxthon"==e.UA.shell||"ie"==e.UA.shell)&&(r=1,e.UA.ie>8&&(r=0)),r=t._isSWF(),t.set("w",a("#"+t.get("parent_id")).width()),t.set("h",a("#"+t.get("parent_id")).height()),t.set("mainDiv",a("<div></div>")),t.set("mainDiv_id",t.get("mainDiv_id")+t.get("parent_id")),t.get("mainDiv").attr("id",t.get("mainDiv_id"));var n={width:t.get("w"),height:t.get("h"),position:"relative"};if(t.get("mainDiv").css(n),a("#"+t.get("parent_id")).append(t.get("mainDiv")),r){t.set("swfDiv",a("<div></div>")),t.set("swfDiv_id",t.get("swfDiv_id")+t.get("parent_id")),t.get("swfDiv").attr("id",t.get("swfDiv_id"));var n={width:t.get("w"),height:t.get("h")};t.get("swfDiv").css(n),t.get("mainDiv").append(t.get("swfDiv")),e.use(t.get("url_swf"),function(e,n){t.get("_isDestroy")||t.set("_case",new n({path:t.get("path_swf"),parent_id:t.get("swfDiv_id"),config:t.get("config")}))})}else e.use(t.get("url_svg"),function(e,n){t.get("_isDestroy")||(t.set("_case",new n({parent_id:t.get("mainDiv_id"),configData:t.get("config").configData,chartData:t.get("config").chartData})),t.get("_case").on("elementClick",function(e){t.fire("elementClick",e)}))})},actions:function(t,n){var i=this;i.get("_actionsObject").name=t,i.get("_actionsObject").value=n,i._setDivStyle();var a=i._laterStatus;a&&(a.cancel(),i._laterStatus=null);var r;i.get("_case")&&(r=i.get("_case").actions(t,n)),r||(i._laterStatus=e.later(function(){i.get("_isDestroy")||i.actions(t,n)},250))},resize:function(){var e=this;if(e.set("_resize_index",e.get("_resize_index")+1),0==e.get("_resize_index")%2){if(e.get("w")==a("#"+e.get("parent_id")).width()&&e.get("h")==a("#"+e.get("parent_id")).height())return;e._setDivStyle(),r||e.get("_case")&&e.get("_case").actions("reset")}},destroy:function(){var t=this,n=t._laterStatus;n&&(n.cancel(),t._laterStatus=null),t.set("_isDestroy",!0),t.get("_case")&&t.get("_case").actions("destroy"),a("#"+t.get("parent_id")).empty(),e.one(window).detach("resize",t.resizeFn)},_setDivStyle:function(){var e=this;e.set("w",a("#"+e.get("parent_id")).width()),e.set("h",a("#"+e.get("parent_id")).height());var t={width:e.get("w"),height:e.get("h"),position:"relative"};if(e.get("mainDiv").css(t),r){var t={width:e.get("w"),height:e.get("h")};e.get("swfDiv").css(t)}},_isSWF:function(){for(var e=this,t=e._xml(e.get("config").configData),n=[],i=0,a=n.length;a>i;i++)if(t.type==n[i])return 1;return"flash"==e.get("appear_mode")?1:r},_xml:function(e){var t={type:""},n=KISSY.all(KISSY.parseXML(e)),i=n.all("chart").attr("type");return t.type=i?i:"",t}}),i},{requires:["base","node"]});