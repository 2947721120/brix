KISSY.add("brix/gallery/calendar/index",function(e,t,n,a,i){function r(){r.superclass.constructor.apply(this,arguments);var t=this,n=t.get("popup"),a=e.one(t.get("trigger"));if(n&&a){var i=t.get("triggerType");e.each(i,function(e){a.on(e,t.toggle,t)})}}return r.Date=i,r.ATTRS={date:{value:new Date},selected:{value:null},startDay:{value:0},pages:{value:1},closable:{value:!1},rangeSelect:{value:!1},minDate:{value:!1},maxDate:{value:!1},multiSelect:{value:!1},multi:{value:null,setter:function(e){for(var t=0;e.length>t;t++)e[t]instanceof Date&&(e[t]=i.format(e[t],"isoDate"));return e}},navigator:{value:!0},popup:{value:!0},showTime:{value:!1},trigger:{value:!1},triggerType:{value:["click"]},disabled:{value:!1},range:{value:!1},rangeLinkage:{value:!0},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},notLimited:{value:!1},tmpl:{getter:function(e){if(!e){var t=this;e='<div class="calendar-pages"></div><div bx-tmpl="calendar" bx-datakey="notLimited,multiSelect,showTime,op_html" class="calendar-operator">{{{op_html}}}</div>',t.get("el")||(e='<div class="calendar">'+e+"</div>"),this.__set("tmpl",e)}return e}},autoRender:{value:!1}},r.FIRES={select:"select",monthChange:"monthChange",timeSelect:"timeSelect",rangeSelect:"rangeSelect",multiSelect:"multiSelect",show:"show",hide:"hide"},r.RENDERERS={op:{html:function(e){var t=e,n=t.get("notLimited"),a=t.get("showTime"),i=t.get("multiSelect"),r="";return(a||i)&&(r+='<a class="btn btn-size25 btn-calendar-confirm">\u786e\u5b9a</a>'),n&&(r+='<a class="btn btn-size25 btn-calendar-notlimited">\u4e0d\u9650</a>'),r}}},r.DOCEVENTS={"":{click:function(t){var n=this,a=n.get("el"),i=e.one(t.target),r=e.one(n.get("trigger"));a.equals(i)||a.contains(i)||!r||r.contains(i)||i[0]==r[0]||n.hide()}}},r.EVENTS={".btn-calendar-confirm":{click:function(){var t=this,n=t.get("selected"),a=t.get("showTime"),o=t.get("multiSelect");if(o){var s=e.clone(t.get("multi"));s.sort(function(e,t){return e>t?1:-1});for(var l=0;s.length>l;l++)s[l]=i.parse(s[l]);e.log(s),t.fire(r.FIRES.multiSelect,{multi:s})}else if(a){var c=new Date;n&&(c=n);var u=t.pageBricks[0].timeBrick.get("time");c.setHours(u.getHours()),c.setMinutes(u.getMinutes()),c.setSeconds(u.getSeconds()),e.log(c),t.fire(r.FIRES.timeSelect,{date:c})}t.hide()}},".btn-calendar-notlimited":{click:function(){var e=this,t=e.get("notLimited");t&&(e.fire(r.FIRES.select,{date:null}),e.hide())}}},r.METHODS={show:function(){var t=this;if(t.get("rendered")||t.render(),t.overlay){var n=e.clone(t.get("align"));n.node||(n.node=t.get("trigger")),t.overlay.set("align",n),t.overlay.show(),t.fire(r.FIRES.show)}},hide:function(){var e=this;e.overlay&&(e.overlay.hide(),e.fire(r.FIRES.hide))},toggle:function(e){var t=this;e&&e.preventDefault();var t=this;t.overlay?"hidden"==t.overlay.get("el").css("visibility")?t.show():t.hide():t.show()}},e.extend(r,t,{initialize:function(){var t=this,i=t.get("popup"),o=t.get("closable"),s=t.get("pages"),l=t.get("rangeLinkage"),c=t.get("el"),u=t.get("date"),d=u.getMonth(),p=u.getFullYear(),f=t.get("trigger");if(i){var h=e.clone(t.get("align"));h.node||(h.node=f),t.overlay=new n({srcNode:t.get("el"),align:h}),t.overlay.render()}else c.css({position:"static",visibility:"visible"});var g=c.one(".calendar-pages");t.pageBricks=[],c.addClass(".calendar-"+s);for(var m,v,b=0;s>b;b++)l?(m=0==b,v=b==s-1):(m=!0,v=!0),function(e){var n=new a({index:e,prev:m,next:v,year:p,month:d,father:t,isRemoveHTML:t.get("isRemoveHTML"),isRemoveEl:t.get("isRemoveEl"),container:g});t.pageBricks.push(n),n.on("itemClick",function(e){var n=t.get("rangeSelect");n?t._handleRange(e.date):e.date&&(t.set("selected",e.date),t.fire(r.FIRES.select,{date:e.date}),i&&o&&!t.get("showTime")&&t.hide())}),n.on("itemMouseDown",function(e){var n=t.get("multiSelect");n&&t._handleMultiSelectStart(e.date)}),n.on("itemMouseUp",function(e){var n=t.get("multiSelect");n&&t._handleMultiSelectEnd(e.date)}),n.on("monthChange",function(e){t._bindDateValueChange(e.date,e.index)})}(b),11==d?(p++,d=0):d++;t._bindDataChange("range"),t._bindDataChange("multi"),t._bindDataChange("disabled"),t._bindDataChange("minDate"),t._bindDataChange("maxDate"),t._bindDataChange("selected"),t._bindDataChange("startDay"),t.on("afterDateChange",function(){t._bindDateValueChange(t.get("date"))})},destructor:function(){var t=this;if(trigger=e.one(t.get("trigger")),t.get("popup")&&trigger){var n=t.get("triggerType");e.each(n,function(e){trigger.detach(e,t.toggle,t)})}t.pageBricks&&(e.each(t.pageBricks,function(e){e.destroy()}),t.pageBricks=null),t.overlay&&t.overlay.destroy()},_bindDataChange:function(e,t){var n=this,t=e.replace(/\b(\w)|\s(\w)/g,function(e){return e.toUpperCase()});n.on("after"+t+"Change",function(){for(var t=n.get(e),a=0;n.pageBricks.length>a;a++)n.pageBricks[a].setChunkData(e,t)})},_bindDateValueChange:function(e,t){t=t||0;var n=this,a=n.get("rangeLinkage"),i=e.getFullYear(),o=e.getMonth();if(a){for(var s=0;n.pageBricks.length>s;s++){var l=o-t+s,c=i;0>l?(c--,l+=12):l>11&&(c++,l-=12),n.pageBricks[s].set("year",c),n.pageBricks[s].set("month",l)}var u=i,d=o-t;0>d&&(u--,d+=12),n.fire(r.FIRES.monthChange,{date:new Date(u,d,1)})}else n.pageBricks[t].set("year",i),n.pageBricks[t].set("month",o),n.fire(r.FIRES.monthChange,{date:new Date(i,o,1)})},_handleRange:function(t){var n,a=this,i=e.clone(a.get("range"))||{};if(!i.start&&!i.end||i.start&&i.end)i.start=t,i.end=null,a.set("range",i);else{i.end=t,i.start.getTime()>i.end.getTime()&&(n=i.start,i.start=i.end,i.end=n),a.set("range",i),a.fire(r.FIRES.rangeSelect,i);var o=a.get("popup"),s=a.get("closable");o&&s&&a.hide()}},_handleMultiSelectStart:function(e){this.multiStartDate=e},_handleMultiSelectEnd:function(t){if(this.multiStartDate){var n,a=this,r=e.clone(a.get("multi"))||[],o=a.multiStartDate,s=(a.get("minDate"),a.get("maxDate"),a.get("disabled"));for(o>t?(n=o,o=t):n=t;n>=o;)if(!i.isDisabled(s,o)){var l=i.format(o,"isoDate");e.inArray(l,r)?r.splice(e.indexOf(l,r),1):r.push(l),o.setDate(o.getDate()+1)}delete a.multiStartDate,a.set("multi",r)}}}),e.augment(r,r.METHODS),r},{requires:["brix/core/brick","overlay","./page","./date"]}),KISSY.add("brix/gallery/calendar/date",function(){function e(e,t){var n=null;if(t=t||"-",e instanceof Date)return e;if(n=new Date(e),n instanceof Date&&"Invalid Date"!=n&&!isNaN(n))return n;var a=(""+e).split(t);return 3==a.length&&(n=new Date(a[0],parseInt(a[1],10)-1,a[2]),n instanceof Date&&"Invalid Date"!=n&&!isNaN(n))?n:null}var t=function(){var t=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,i=function(e,t){for(e+="",t=t||2;t>e.length;)e="0"+e;return e},r={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},o={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(s,l,c){if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(s)||/\d/.test(s)||(l=s,s=void 0),s=s?e(s):new Date,isNaN(s))throw SyntaxError("invalid date");l=(r[l]||l||r["default"])+"","UTC:"==l.slice(0,4)&&(l=l.slice(4),c=!0);var u=c?"getUTC":"get",d=s[u+"Date"](),p=s[u+"Day"](),f=s[u+"Month"](),h=s[u+"FullYear"](),g=s[u+"Hours"](),m=s[u+"Minutes"](),v=s[u+"Seconds"](),b=s[u+"Milliseconds"](),y=c?0:s.getTimezoneOffset(),x={d:d,dd:i(d,void 0),ddd:o.dayNames[p],dddd:o.dayNames[p+7],w:o.dayNames[p+14],m:f+1,mm:i(f+1,void 0),mmm:o.monthNames[f],mmmm:o.monthNames[f+12],yy:(h+"").slice(2),yyyy:h,h:g%12||12,hh:i(g%12||12,void 0),H:g,HH:i(g,void 0),M:m,MM:i(m,void 0),s:v,ss:i(v,void 0),l:i(b,3),L:i(b>99?Math.round(b/10):b,void 0),t:12>g?"a":"p",tt:12>g?"am":"pm",T:12>g?"A":"P",TT:12>g?"AM":"PM",Z:c?"UTC":((s+"").match(n)||[""]).pop().replace(a,""),o:(y>0?"-":"+")+i(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][d%10>3?0:(10!=d%100-d%10)*d%10]};return l.replace(t,function(e){return e in x?x[e]:e.slice(1,e.length-1)})}}();return{format:function(e,n,a){return t(e,n,a)},parse:function(t,n){return e(t,n)},isMinMax:function(e,n,a){return a=t(a,"isoDate"),e&&(e=Brix_Date.format(e,"isoDate"),e>a)?!1:n&&(n=Brix_Date.format(n,"isoDate"),a>n)?!1:!0},isDisabled:function(e,n){if(n=t(n,"isoDate"),e)for(var a=0;e.length>a;a++)if(t(e[a],"isoDate")==n)return!0;return!1},isInMulit:function(e,n){if(n=t(n,"isoDate"),e)for(var a=0;e.length>a;a++)if(t(e[a],"isoDate")==n)return!0;return!1},isInRang:function(e,n){if(n=t(n,"isoDate"),e)if(e.start&&e.end){if(n>=t(e.start,"isoDate")&&t(e.end,"isoDate")>=n)return!0}else if(e.start&&n==t(e.start,"isoDate"))return!0;return!1},isYear:function(e){return/^\d+$/i.test(e)?(e=Number(e),!(100>e||e>1e4)):!1}}}),KISSY.add("brix/gallery/calendar/page",function(e,t,n,a){function i(e){for(var t=[],n=0;7>n;n++)t[n]=s[(n+e)%7];return t}function r(e,t){return 32-new Date(e,t,32).getDate()}function o(){o.superclass.constructor.apply(this,arguments)}var s=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];return o.ATTRS={father:{value:!1},index:{value:0},year:{value:2012},month:{value:7},prev:{value:!0},next:{value:!0},autoRender:{value:!0},tmpl:{valueFn:function(){return'<div  class="calendar-page"><div class="calendar-page-hd"><div bx-mpl="page" bx-datakey="prev">{{#prev}}<a href="javascript:void(0);" class="calendar-prev-year"><i class="iconfont">&#403</i><i class="iconfont icon-yp">&#403</i></a><a href="javascript:void(0);" class="calendar-prev-month"><i class="iconfont">&#403</i></a>{{/prev}}</div><a bx-tmpl="yearmonth" bx-datakey="year,month" href="javascript:void(0);" class="calendar-year-month">{{year}}\u5e74{{month}}\u6708</a><div bx-tmpl="next" bx-datakey="next">{{#next}}<a href="javascript:void(0);" class="calendar-next-month "><i class="iconfont">&#402</i></a><a href="javascript:void(0);" class="calendar-next-year "><i class="iconfont icon-yn">&#402</i><i class="iconfont">&#402</i></a>{{/next}}</div><div class="calendar-year-month-pupop" ><p bx-tmpl="select" bx-datakey="month,select_html">{{{select_html}}}</p><p bx-tmpl="year" bx-datakey="year">\u5e74:<input type="text" value="{{year}}" onfocus="this.select()"></p><p><a class="btn btn-size25 btn-pupop-confirm">\u786e\u5b9a</a><a class="btn-pupop-cancel" href="#">\u53d6\u6d88</a></p></div></div><div bx-tmpl="pagewbd" bx-datakey="startDay,days_html" class="calendar-page-wbd">{{{days_html}}}</div><div bx-tmpl="pagedbd" bx-datakey="startDay,year,month,selected,range,multi,disabled,minDate,maxDate,da_html" class="calendar-page-dbd">{{{da_html}}}</div><div class="calendar-page-fd"></div></div>'}},data:{valueFn:function(){var e=this,t=(e.get("father"),e.get("year")),n=e.get("month"),a=e.get("prev"),i=e.get("next");return{prev:a,next:i,month:n+1,year:t}}}},o.RENDERERS={da:{html:function(e){var t=e,n=t.get("father"),i=t.get("year"),o=t.get("month"),s=n.get("selected"),l=n.get("minDate"),c=n.get("maxDate"),u=n.get("disabled"),d=n.get("multi"),p=n.get("range"),f=(7-n.get("startDay")+new Date(i,o,1).getDay())%7,h=r(i,o),g=a.format(new Date,"isoDate"),m="";s&&(s=a.format(s,"isoDate")),l&&(l=a.format(l,"isoDate")),c&&(c=a.format(c,"isoDate"));for(var v=0;f>v;v++)m+='<a href="javascript:void(0);" class="calendar-hidden">0</a>';for(var v=1;h>=v;v++){var b='class="calendar-item',y=a.format(new Date(i,o,v),"isoDate");l>y||y>c||a.isDisabled(u,y)?b+=" calendar-disabled":a.isInRang(p,y)?b+=" calendar-range":s==y?b+=" calendar-selected":a.isInMulit(d,y)&&(b+=" calendar-multi"),g==y&&(b+=" calendar-today"),m+="<a "+b+'" href="javascript:void(0);">'+v+"</a>"}return m}},select:{html:function(){for(var e="\u6708:<select>",t=1;12>=t;t++)e+="<option"+(t==this.month?" selected":"")+' value="'+(t-1)+'">'+(10>t?"0"+t:t)+"</option>";return e+="</select>"}},days:{html:function(t){var n=t.get("father"),a=i(n.get("startDay")),r="";return e.each(a,function(e){r+="<span>"+e+"</span>"}),r}}},o.EVENTS={".calendar-prev-year":{click:function(){var e=this,t=e.get("year"),n=e.get("month"),a=e.get("index");t--,date=new Date(t,n,1),e.fire(o.FIRES.monthChange,{date:date,index:a})}},".calendar-prev-month":{click:function(){var e=this,t=e.get("year"),n=e.get("month"),a=e.get("index");n--,0>n&&(t--,n+=12),date=new Date(t,n,1),e.fire(o.FIRES.monthChange,{date:date,index:a})}},".calendar-next-year":{click:function(){var e=this,t=e.get("year"),n=e.get("month"),a=e.get("index");t++,date=new Date(t,n,1),e.fire(o.FIRES.monthChange,{date:date,index:a})}},".calendar-next-month":{click:function(){var e=this,t=e.get("year"),n=e.get("month"),a=e.get("index");n++,n>11&&(t++,n-=12),date=new Date(t,n,1),e.fire(o.FIRES.monthChange,{date:date,index:a})}},".calendar-year-month":{click:function(){var e=this,t=e.get("father").get("navigator");t&&(popupNode=e.get("el").one(".calendar-year-month-pupop").show())}},".btn-pupop-confirm":{click:function(e){e.preventDefault();var t=this,n=t.get("index");if(popupNode=t.get("el").one(".calendar-year-month-pupop"),year=popupNode.one("input").val(),month=popupNode.one("select").val(),a.isYear(year)){year=Number(year),month=Number(month);var i=new Date(year,month,1);popupNode.hide(),t.fire(o.FIRES.monthChange,{date:i,index:n})}}},".btn-pupop-cancel":{click:function(e){e.preventDefault();var t=this,n=t.get("el").one(".calendar-year-month-pupop");n.hide()}},".calendar-item":{click:function(t){t.preventDefault();var n=this,a=e.one(t.currentTarget);if(!a.hasClass("calendar-disabled")){var i=!1;if(!a.hasClass("calendar-selected")){var r=n.get("year"),s=n.get("month");if(i=new Date(r,s,Number(a.html())),n.timeBrick){var l=n.timeBrick.get("time");i.setHours(l.getHours()),i.setMinutes(l.getMinutes()),i.setSeconds(l.getSeconds())}}e.later(function(){n.fire(o.FIRES.itemClick,{date:i})},0)}},mousedown:function(t){t.preventDefault();var n=this,a=e.one(t.currentTarget);if(!a.hasClass("calendar-disabled")){var i=n.get("year"),r=n.get("month"),s=new Date(i,r,Number(a.html()));n.fire(o.FIRES.itemMouseDown,{date:s})}},mouseup:function(t){t.preventDefault();var n=this,a=e.one(t.currentTarget);if(!a.hasClass("calendar-disabled")){var i=n.get("year"),r=n.get("month"),s=new Date(i,r,Number(a.html()));n.fire(o.FIRES.itemMouseUp,{date:s})}}}},o.METHODS={},o.FIRES={itemClick:"itemClick",itemMouseDown:"itemMouseDown",itemMouseUp:"itemMouseUp",monthChange:"monthChange"},e.extend(o,t,{initialize:function(){var e=this,t=e.get("el"),a=e.get("father"),i=a.get("showTime");i&&(e.timeBrick=new n({isRemoveHTML:e.get("isRemoveHTML"),isRemoveEl:e.get("isRemoveEl"),container:t.one(".calendar-page-fd")})),e.on("afterYearChange",function(){e.setChunkData("year",e.get("year"))}),e.on("afterMonthChange",function(){e.setChunkData("month",e.get("month")+1)})},destructor:function(){var e=this;e.timeBrick&&e.timeBrick.destroy()}}),e.augment(o,o.METHODS),o},{requires:["brix/core/brick","./time","./date"]}),KISSY.add("brix/gallery/calendar/time",function(e,t){function n(){n.superclass.constructor.apply(this,arguments)}var a={h:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],m:["00","10","20","30","40","50"],s:["00","10","20","30","40","50"]};return n.ATTRS={time:{value:new Date},status:{value:"s"},autoRender:{value:!0},tmpl:{value:'<div><div class="calendar-time">\u65f6\u95f4\uff1a<span class="h">{{h}}</span>:<span class="m">{{m}}</span>:<span class="s">{{s}}</span><div class="calendar-time-updown"><i class="iconfont u">&#456</i><i class="iconfont d">&#459</i></div></div><div class="calendar-time-popup"><div bx-tmpl="time" bx-datakey="list" class="calendar-time-popup-bd"><!--bx-tmpl="time" bx-datakey="list"-->{{#list}}<a class="item">{{.}}</a>{{/list}}<!--bx-tmpl="time"--></div><i class="iconfont icon-close">&#223</i></div></div>'},data:{valueFn:function(){var e=this,t=e.get("time");return{h:t.getHours(),m:t.getMinutes(),s:t.getSeconds()}}}},n.EVENTS={span:{click:function(t){var n=this,i=e.one(t.currentTarget);i.parent().all("span").removeClass("on"),i.addClass("on"),i.hasClass("h")?n.set("status","h"):i.hasClass("m")?n.set("status","m"):n.set("status","s");var r=n.get("status");n.setChunkData("list",a[r]),n.get("el").one(".calendar-time-popup").css({display:"block"})}},".icon-close":{click:function(){var e=this;e._hideTimePopup()}},".item":{click:function(t){var n=this,a=e.one(t.currentTarget),i=n.get("status");n._setTime(i,a.html()),n._hideTimePopup()}},".u":{click:function(){var e=this,t=e.get("status"),n=e._getTime(t);n++,e._setTime(t,n)}},".d":{click:function(){var e=this,t=e.get("status"),n=e._getTime(t);n--,e._setTime(t,n)}},"":{keyup:function(e){var t=this,n=t.get("status"),a=t._getTime(n);(38==e.keyCode||37==e.keyCode)&&(e.preventDefault(),a++,t._setTime(n,a)),(40==e.keyCode||39==e.keyCode)&&(e.preventDefault(),a--,t._setTime(n,a))}}},n.METHODS={},n.FIRES={timeSelect:"timeSelect"},e.extend(n,t,{initialize:function(){},_setTime:function(e,t){var n=this,a=n.get("time"),i=n.get("el");switch(t=Number(t),e){case"h":a.setHours(t);break;case"m":a.setMinutes(t);break;case"s":a.setSeconds(t)}i.one(".h").html(a.getHours()),i.one(".m").html(a.getMinutes()),i.one(".s").html(a.getSeconds())},_getTime:function(e){var t=this,n=t.get("time");switch(e){case"h":return n.getHours();case"m":return n.getMinutes();case"s":return n.getSeconds()}},_hideTimePopup:function(){var e=this,t=e.get("el");t.one(".calendar-time-popup").css({display:"none"})},destructor:function(){}}),e.augment(n,n.METHODS),n},{requires:["brix/core/brick"]});