KISSY.add("brix/gallery/dropdown/index",function(t,e){function n(){n.superclass.constructor.apply(this,arguments)}return n.ATTRS={mode:{value:1},autoResize:{value:!0},setDefault:{value:!1}},n.FIRES={beforeFocus:"beforeFocus",focus:"focus",beforeBlur:"beforeBlur",blur:"blur",selected:"selected"},n.METHODS={focus:function(){var t=this.get("mode"),e=this.get("el"),r=e.one(".dropdown-list");if("none"===r.css("display")){if(this.fire(n.FIRES.beforeFocus),1==t&&e.one(".dropdown-hd").addClass("dropdown-hd-active"),r.css({display:"block"}),this.get("autoResize")){var i=e.one(".dropdown-hd").outerWidth();e.one(".dropdown-list").css({width:i+"px"})}this.fire(n.FIRES.focus)}},blur:function(){var t=this.get("mode"),e=this.get("el"),r=e.one(".dropdown-list");"none"!==r.css("display")&&(e.all(".dropdown-item").removeClass(".dropdown-itemover"),this.fire(n.FIRES.beforeBlur),1==t&&e.one(".dropdown-hd").removeClass("dropdown-hd-active"),r.css("display","none"),this.fire(n.FIRES.blur))},select:function(t){var e,n=this,r=this.get("el"),i=r.all(".dropdown-item");i.each(function(n){var r=n.one("span"),i=r.attr("value")||"";return i==t?(e=n,!1):void 0}),e&&n._select(e)}},n.DOCEVENTS={"":{click:function(t){var e=this,n=e.get("el");e.__show||n.contains(t.target)||(n.all(".dropdown-list").css("display","none"),n.all(".dropdown-hd").removeClass("dropdown-hd-active")),e.__show=!1}}},n.EVENTS={"":{mouseleave:function(){var t=this.get("mode");1!=t&&this.blur()},keydown:function(t){var e=this,n=e.get("el");switch(t.keyCode){case 9:case 27:e.blur();break;case 13:e.__show=!0;var r=n.one(".dropdown-itemover");if(e.blur(),!r||r.hasClass("dropdown-itemselected"))return;e._select(r);break;case 38:t.preventDefault(),e.focus();var i,a=n.one(".dropdown-itemover")||n.one(".dropdown-itemselected")||n.one(".dropdown-item");if(a.prev())i=a.prev();else{var o=n.all(".dropdown-item");i=o.item(o.length-1)}e._hover(i,!0);break;case 40:t.preventDefault(),e.focus();var i,a=n.one(".dropdown-itemover")||n.one(".dropdown-itemselected")||n.one(".dropdown-item");i=a.next()?a.next():n.one(".dropdown-item"),e._hover(i,!0);break;default:var u=t.keyCode;if(u>=48&&57>=u||u>=65&&90>=u){var s=String.fromCharCode(u).toLowerCase();t.preventDefault(),e.focus();var i,a=n.one(".dropdown-itemover")||n.one(".dropdown-itemselected");a&&a.one("span").text().charAt(0).toLowerCase()==s&&(a=a.next(),a&&a.one("span").text().charAt(0).toLowerCase()==s&&(i=a)),i||n.all(".dropdown-item").each(function(t){return!t||t.hasClass(".dropdown-itemover")||t.hasClass(".dropdown-itemselected")||t.one("span").text().charAt(0).toLowerCase()!=s?void 0:(i=t,!1)}),i&&e._hover(i,!0)}}}},".dropdown-hd":{click:function(){var t=this.get("mode");if(1==t){var e=this.get("el").one(".dropdown-list");this.__show=!0,"block"==e.css("display")?this.blur():this.focus()}},mouseenter:function(){var t=this.get("mode");1!=t&&this.focus()}},".dropdown-item":{click:function(e){var n=this;n.__show=!0,n.get("el");var r=t.one(e.currentTarget);n.blur(),r.hasClass("dropdown-itemselected")||n._select(r)},mouseenter:function(e){var n=t.one(e.currentTarget);this._hover(n)},mouseleave:function(e){var n=t.one(e.currentTarget);n.removeClass("dropdown-itemover")}}},t.extend(n,e,{initialize:function(){var t=this,e=this.get("el");if(e.attr("tabindex",0),t.get("setDefault")){var n=e.one(".dropdown-itemselected")||e.one(".dropdown-item");t._select(n,!0)}},_select:function(t,e){var r=this,i=this.get("el");i.all(".dropdown-item").removeClass(".dropdown-itemover").removeClass("dropdown-itemselected"),t.addClass("dropdown-itemselected");var a=i.one(".dropdown-text"),o=t.one("span"),u={value:o.attr("value")||"",text:o.text()},s=i.one("input");s&&s.val(u.value);var l=a.attr("value")||"";l!=u.value&&(a.attr("value",u.value),a.text(u.text),e||r.fire(n.FIRES.selected,u))},_hover:function(t,e){var n=this.get("el");n.all(".dropdown-item").removeClass(".dropdown-itemover"),t.addClass(".dropdown-itemover"),e&&t.scrollIntoView(n.one(".dropdown-list"))}}),t.augment(n,n.METHODS),n},{requires:["brix/core/brick"]});