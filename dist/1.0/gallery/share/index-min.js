KISSY.add("brix/gallery/share/index",function(e,t){function i(){i.superclass.constructor.apply(this,arguments)}return i.ATTRS={name:{value:"Share"},isFord:{value:!1},hastips:{value:""},duration:{value:.3}},i.METHODS={clearTimer:function(e){e.timer&&(clearTimeout(e.timer),e.timer=0)},turn:function(e,t,i,n,a,r,o){"Function"==typeof r&&r(),"animate"==t?e.animate(o,i,n,a):e[t](i,a,n)},unfold:function(e){var t=this;"popup"==t.get("type")?t.show(e):t.expand(e)},fold:function(e){var t=this;"popup"==t.get("type")?t.hide(e):t.shrink(e)},expand:function(t){var i=e.all,n=this,a=n.get("el"),r=i(".ext",a),o=i(".icon-arrow",a),s=n.get("duration");r.css(n.initProp),n.turn(r,"animate",s,"easeOut",function(){t(),o.filter(".icon-arrow-l").html("&#402;"),o.filter(".icon-arrow-r").html("&#403;"),o.filter(".icon-arrow-d").html("&#404;"),r.css({overflow:"visible"})},void 0,n.expendProp)},shrink:function(t){var i=e.all,n=this,a=n.get("el"),r=i(".ext",a),o=i(".icon-arrow",a),s=n.get("duration");r.css({overflow:"hidden"}),n.turn(r,"animate",s,"easeIn",function(){t(),o.filter(".icon-arrow-l").html("&#403;"),o.filter(".icon-arrow-r").html("&#402;"),o.filter(".icon-arrow-d").html("&#405;"),r.css(n.initProp)},void 0,n.shrinkProp)},show:function(t){var i=e.all,n=this,a=n.get("el"),r=" popup-share-active",o=e.one(".panel-popup",a),s=n.get("duration");i(a).addClass(r),n.turn(o,"fadeIn",s,"easeOut",t)},hide:function(t){var i=e.all,n=this,a=n.get("el"),r="popup-share-active",o=e.one(".panel-popup",a),s=n.get("duration");n.turn(o,"fadeOut",s,"easeIn",function(){t(),i(a).removeClass(r)})},showTips:function(t,i){var n=this,a=e.one(".tips",t),r=e.one(".angle",a),o=t.offset().left+Math.round(t.width()/2),s=Math.round(a.width()/2)+Math.round(t.width()/2),l={"margin-left":0-s+"px"},c=3;a&&(a.hasClass("tips-up")&&(c>o-s&&(l={"margin-left":0-(o-c)+"px"},0==t.offset().left?a.hasClass(".tips-up-left")||a.addClass(".tips-up-left"):r.css({"margin-left":o-s-c-5+"px"})),o+s+c>=e.DOM.viewportWidth()&&(l={"margin-left":0-(s+o+s+c-e.DOM.viewportWidth())+"px"},t.offset().left+t.outerWidth()+c>=e.DOM.viewportWidth()?(a.hasClass(".tips-up-right")||a.addClass(".tips-up-right"),r.css({left:s+Math.floor(a.width()/2)-3+"px"})):r.css({"margin-left":o+s+c-e.DOM.viewportWidth()-5+"px"})),a.css(l)),n.turn(a,"fadeIn",.3,"easeNone",i))},hideTips:function(t,i){var n=this,a=e.one(".tips",t);a&&n.turn(a,"fadeOut",.3,"easeNone",i)}},i.EVENTS={"":{mouseenter:function(){e.all;var t=this,i=t.get("isFord"),n=t.dispatcher,a=300;n&&t.clearTimer(n),i||(n.timer=setTimeout(function(){t.unfold(function(){t.set("isFord",!0)})},a))},mouseleave:function(){e.all;var t=this,i=t.get("isFord"),n=t.dispatcher,a=300;n&&t.clearTimer(n),i&&(n.timer=setTimeout(function(){t.fold(function(){t.set("isFord",!1)})},a))}},".btn-share":{mouseenter:function(t){var i=e.all,n=this,a=300,r=t.currentTarget.dispatcher,o=i(t.currentTarget);n.clearTimer(r),r.isTipsShow&&(r.timer=setTimeout(function(){n.get("hastips")&&(i(".btn-share",n.get("el")).each(function(e){e.children(".tips").hide(),e[0].dispatcher.isTipsShow=!0}),n.showTips(o,function(){r.isTipsShow=!1}))},a))},mouseleave:function(t){var i=e.all,n=this,a=300,r=t.currentTarget.dispatcher,o=i(t.currentTarget);n.clearTimer(r),r.isTipsShow||(r.timer=setTimeout(function(){n.get("hastips")&&n.hideTips(o,function(){r.isTipsShow=!0})},a))}}},e.extend(i,t,{initialize:function(){var t=e.all,i=this,n=i.get("el"),a=e.one(".ext",n);if(i.dispatcher={timer:0},a){i.initProp={opacity:0,overflow:"hidden"},i.expendProp={opacity:1},i.shrinkProp={opacity:0};var r="width";t(n).hasClass("share-vertical")&&(r="height"),i.initProp[r]=0,i.expendProp[r]=a[r]()+"px",i.shrinkProp[r]=0,a.css({display:""}),a.css(i.initProp)}t(".btn-share",i.get("el")).each(function(e){e[0].dispatcher={isTipsShow:!0,timer:0}})}}),e.augment(i,i.METHODS),i},{requires:["brix/core/brick"]});