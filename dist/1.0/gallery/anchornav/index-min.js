KISSY.add("brix/gallery/anchornav/index",function(e,t){function r(){r.superclass.constructor.apply(this,arguments)}var n=e.one;return r.ATTRS={styleKind:{value:1},hoverClass:{value:"hover"},currentClass:{value:"cur"},sectionContainer:{value:"body",getter:function(e){return n(e)}},rightPosition:{value:20},alwaysShow:{value:!1},autoFold:{value:!1},data:{value:!1,getter:function(t){if(t.list){var t=e.clone(t),r=document.createElement("div");e.each(t.list,function(e){r.innerHTML=e.iconfont,e.iconfont=r.innerHTML})}return t}}},r.METHODS={addBackground:function(e){var t=e.one(".anchor-text"),r=e.attr("bgColor");r&&(e.css({background:r}),t.css({background:r}))},removeBackground:function(e){var t=this;e.each(function(e){var r=e.attr("bgColor"),n=e.one(".anchor-text");r&&!e.hasClass(t.get("currentClass"))&&(e.css({background:""}),t.hasIcon||n.css({background:""}))})},setCurrent:function(e){this.anchors.removeClass(this.get("currentClass")),e.addClass(this.get("currentClass")),this.removeBackground(this.anchors),this.addBackground(e)},scrollTo:function(t){var r=this,n=t.attr("rel"),a=this.sections[n].section,i=a.offset();r.lockScroll=!0,e.Anim(window,{scrollTop:i.top},.3,"easeIn",function(){e.later(function(){r.lockScroll=!1},50)}).run()},show:function(){var t=this.get("el");"6"==e.UA.ie?t.show():e.Anim(t,{right:this.get("rightPosition")},.2,"easeOut",function(){}).run(),this.isShow=!0},hide:function(){var t=this.get("el"),r=this;"6"==e.UA.ie?(t.hide(),r.isShow=!1):e.Anim(t,{right:-150},.2,"easeIn",function(){r.isShow=!1}).run()},showTxt:function(t){if(this.hasIcon){var r=t.one(".anchor-text");e.Anim(r,{width:80},.2,"easeOut",function(){}).run()}},hideTxt:function(t,r){if(!this.hasIcon)return r(),void 0;var n=t.one(".anchor-text");e.Anim(n,{width:0},.2,"easeIn",function(){r()}).run()},_addFoldButton:function(){var e=this.get("el"),t=n('<div class="anchor-foldBtn iconfont">&#410;</div>');this.foldBtn=t,e.one("ul").hide(),e.append(t),e.addClass(".navbar-folded")}},r.FIRES={reach:"reach"},r.EVENTS={".anchor-item":{mouseenter:function(e){var t=this,r=n(e.currentTarget);r.addClass(this.get("hoverClass")),this.addBackground(r),t.mouseDelay=setTimeout(function(){t.showTxt(r)},200)},mouseleave:function(e){var t=this,r=n(e.currentTarget);clearTimeout(t.mouseDelay),t.hideTxt(r,function(){r.removeClass(t.get("hoverClass")),t.removeBackground(r)})},click:function(e){var t=n(e.currentTarget);this.setCurrent(t),this.scrollTo(t),e.preventDefault()}},".anchor-foldBtn":{mouseenter:function(){if(3==this.get("styleKind")&&this.get("autoFold")){var e=this.get("el");this.foldBtn.hide(),e.removeClass("navbar-folded"),e.one("ul").slideDown(.2,function(){},"easeOut")}}},".anchor-list":{mouseleave:function(){var e=this;if(3==this.get("styleKind")&&this.get("autoFold")){var t=e.get("el");t.one(".anchor-list").slideUp(.2,function(){t.addClass("navbar-folded"),e.foldBtn.show()},"easeIn")}}}},e.extend(r,t,{initialize:function(){var t=this,a=t.get("el"),i=t.get("styleKind");t.anchors=a.all(".anchor-item"),a.addClass("navbar-style-"+i),1==i&&(t.hasIcon=!0),3==i&&t.get("autoFold")&&t._addFoldButton(),n(window).on("scroll",e.buffer(t._onscroll,20,t));var o={};t.anchors.each(function(e){var r=e.attr("rel"),n=t.get("sectionContainer").one("[rel="+r+"]");o[r]={section:n,anchor:e}}),t.sections=o,t._onscroll(),r.instance=t},_onscroll:function(){if(!this.lockScroll){var e=this,t=n(window).scrollTop(),r=e.sections[n(e.anchors[0]).attr("rel")],a=r.top;if(!e.get("alwaysShow"))if(t+50>a)!e.isShow&&e.show();else if(e.isShow&&e.hide(),a)return!1;e.anchors.each(function(n){var a=e.sections[n.attr("rel")],i=a.section;return a.top=a.top||i.offset().top,a.height=a.height||i.height(),r=a,r.top+r.height>t?!1:void 0}),e.setCurrent(r.anchor),e.fire("reach",r)}}}),e.augment(r,r.METHODS),r},{requires:["brix/core/brick"]});