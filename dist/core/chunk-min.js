KISSY.add("brix/core/chunk",function(a,b,c,d,e){function g(){g.superclass.constructor.apply(this,arguments),this._buildTmpler()}var f=b.all;return g.ATTRS={id:{value:!1},el:{getter:function(b){return a.isString(b)&&(b=f(b)),b}},container:{value:"body",getter:function(b){return a.isString(b)&&(b=f(b)),b}},tmpl:{value:!1},tmpler:{value:!1},rendered:{value:!1},autoRender:{value:!0},data:{value:!1},dataset:{value:!1}},a.extend(g,c,{_buildTmpler:function(){var a=this,b=a.get("tmpler");if(!b){var c=a.get("tmpl");if(c){b=new e(c),a.set("tmpler",b);var d=a.get("id");d||(a.set("id",b.id),a.set("el","#"+b.id))}}b&&a._buildDataset()},_buildDataset:function(){var b=this,c=b.get("dataset");if(!c){var e=b.get("data")||{};e=a.clone(e),c=new d({data:e}),b.set("dataset",c)}c.on("afterDataChange",function(a){b._render(a.subAttrName,a.newVal)})},addTmpl:function(a,b){var c=this,d=c.get("tmpler");return d?d.addTmpl(b):!1},setChunkData:function(b,c){var d=this,e=d.get("dataset");e&&(c=a.clone(c),e.set("data."+b,c))},render:function(){var a=this;if(!a.get("rendered")){var b=a.get("dataset");b&&a._render("data",b.get("data")),a.set("rendered",!0),a.fire("rendered")}},_render:function(a,c){var d=this,e=d.get("tmpler");if(e)if(a.split(".").length>1)d.get("rendered")&&(a=a.replace(/^data\./,""),d._renderTmpl(e.tmpls,a,c));else if(!e.inDom){var g=d.get("container"),h=d.get("el"),i=new b(e.to_html(c));(!h||h.length==0)&&i.length>1&&(i=f('<div id="'+e.id+'"></div>').append(i)),g.append(i)}},_renderTmpl:function(b,c,d){a.each(b,function(b){var e=a.one("#"+b.id);if(e&&a.inArray(c,b.datakey)){var f={};a.each(b.datakey,function(a){var b=d,c=a.split("."),e=c.length,g=0;while(g!==e)b=b[c[g]],g++;f[c[e-1]]=b,b=null}),e.html(b.tmpler.to_html(f)),f=null}})}}),g},{requires:["node","base","./dataset","./tmpler"]});