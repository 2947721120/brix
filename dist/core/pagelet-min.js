KISSY.add("brix/core/pagelet",function(a,b){function c(){c.superclass.constructor.apply(this,arguments);var a=this;a.isReady=!1,a.readyList=[],a.brickList=[],a.isAddBehavior=!1,(a.get("autoRender")||a.get("tmpler").inDom)&&a.ready(function(){a.render()})}return a.extend(c,b,{getBrick:function(a){return this._getBrick(a,this.get("tmpler").bricks)},_getBrick:function(b,c){var d=this,e;return a.each(c,function(a,c){if(c===b)return e=a.brick,!1;e=d._getBrick(b,a.bricks)}),e||null},addBehavior:function(){var b=this,c=b.get("tmpler");if(!b.isAddBehavior){b.isAddBehavior=!0;if(c){b._buildBricks(c.bricks);if(b.brickList.length>0){a.use(b.brickList.join(","),function(a){b._addBehavior(c.bricks,arguments),b._fireReady()});return}}b._fireReady()}},_addBehavior:function(b,c){var d=this;a.each(b,function(b,e){var f=a.merge({container:"#"+e,id:e,el:"#"+e,pagelet:d},b.config),g=c[a.indexOf(b.path,d.brickList)+1],h=new g(f);b.brick=h,d._addBehavior(b.bricks,c)})},_buildBricks:function(b){var c=this;a.each(b,function(b,d){b.path||(b.path="brix/gallery/"+b.name+"/"),a.inArray(c.brickList,b.path)||c.brickList.push(b.path),c._buildBricks(b.bricks)})},ready:function(a){return this.isReady?a.call(window,this):this.readyList.push(a),this},_fireReady:function(){var a=this;if(a.isReady)return;a.isReady=!0;if(a.readyList){var b,c=0;while(b=a.readyList[c++])b.call(a);a.readyList=null}},destroy:function(b){var c=this,d=c.get("el"),e=c.get("tmpler");e&&!a.isEmptyObject(e.bricks)&&c._destroyBricks(e.bricks,b),b||d.remove()},_destroyBricks:function(b,c){var d=this;a.each(b,function(a,e){if(c){if(c===e)return d._destroyBrick(a),delete b[e],!1;d._destroyBricks(a.bricks)}else d._destroyBrick(a),delete b[e]})},_destroyBrick:function(a){var b=this;a.brick&&(a.brick._detachEvent(),b._destroyBricks(a.bricks),a.brick.get("el").remove(),a.brick.pagelet=null,a.brick=null,delete a)}}),c},{requires:["./chunk"]});