KISSY.add("brix/gallery/starrating/index",function(e,t,n,r){function o(){o.superclass.constructor.apply(this,arguments)}var i=n.all;if(r.ie==6)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(s){}return o.ATTRS={split:{value:2},maxValue:{value:5},length:{value:10},defaultValue:{value:!1},readOnly:{value:!1},starWidth:{value:18},inputs:{},current:{},mode:{value:!0}},o.ATTACH={".starrating-star":{mouseenter:function(t){if(!this.get("readOnly")){var n,r=e.one(t.currentTarget);this._fill(r),this.get("mode")?n=r.data("input").val():n=r.data("input"),this.fire("focus",{value:n})}},mouseleave:function(t){if(!this.get("readOnly")){var n,r=e.one(t.currentTarget);this._draw(),this.get("mode")?n=r.data("input").val():n=r.data("input"),this.fire("blur",{value:n})}},click:function(t){if(!this.get("readOnly")){var n=e.one(t.currentTarget);this.select(n)}}}},o.METHOD={select:function(t){var n=this;if(typeof t=="number"){t=n.get("el").all(".starrating-star").item(t);if(t)return n.select(t);throw"\u6ca1\u6709\u627e\u5230\u8282\u70b9"}if(typeof t=="string"){if(n.get("mode"))n.get("inputs").each(function(e,r){if(e.val()==t)return t=n.get("el").all(".starrating-star").item(r),!1});else{var r=e.indexOf(t,n.get("inputs"));t=n.get("el").all(".starrating-star").item(r)}return n.select(t)}n.set("current",t),n._draw();var i;n.get("mode")?i=t.data("input").val():i=t.data("input"),n.fire("selected",{value:i})},readOnly:function(e,t){var n=this;n.set("readOnly",e||e==undefined?!0:!1);var r=n.get("readOnly");r?n.get("el").all(".starrating-star").addClass("starrating-star-readonly"):n.get("el").all(".starrating-star").removeClass("starrating-star-readonly"),n.get("mode")&&(t?n.get("inputs").attr("disabled","disabled"):n.get("inputs").removeAttr("disabled")),n._draw()},disable:function(){this.readOnly(!0,!0)},enable:function(){this.readOnly(!1,!1)}},e.extend(o,t,{initialize:function(){var t=this,n=t.get("inputs");n||(n=t.get("el").all("input[type=radio].star"));if(n.length==0){t.set("mode",!1);var r=t.get("length"),i=t.get("maxValue");n=[],flg=i/r;for(var s=1;s<=r;s++){var o=s*i/r;flg>=1?n.push(Math.round(o).toString()):flg>.1?n.push(o.toFixed(1).toString()):n.push(o.toFixed(2).toString())}}t.set("inputs",n),t.get("mode")?n.each(function(e,n){var r=e.val(),i=e.attr("title")||r;t._creat(r,i,e,n)}):e.each(n,function(e,n){t._creat(e,e,e,n)}),rater=null;var u=t.get("defaultValue");u&&t.select(u)},_creat:function(e,t,n,r){var s=this,o=s.get("el"),u=s.get("split"),a=s.get("readOnly"),f=s.get("starWidth"),l=i('<div class="starrating-star"><a title="'+t+'">'+e+"</a></div>");o.append(l);if(u>1){var c=l.width()||f,h=r%u,p=Math.floor(c/u);l.css({width:p}).one("a").css({"margin-left":"-"+h*p+"px"}),r!=0&&r%u!=0&&l.css({"margin-right":"1px"})}else l.css({"margin-right":"1px"});l.data("input",n),a&&l.addClass("starrating-star-readonly"),s.get("mode")&&n.hide()},_fill:function(e){this._drain(),e.addClass("starrating-star-hover");var t=e;while(t.prev())t.prev().addClass("starrating-star-hover"),t=t.prev()},_drain:function(){this.get("el").all(".starrating-star").removeClass("starrating-star-hover").removeClass("starrating-star-on")},_draw:function(){this._drain(),this.get("mode")&&this.get("inputs").removeAttr("checked");var e=this.get("current");if(e){this.get("mode")&&e.data("input").attr("checked","checked"),e.addClass("starrating-star-on");var t=e;while(t.prev())t.prev().addClass("starrating-star-on"),t=t.prev()}},destructor:function(){}}),e.augment(o,o.METHOD),o},{requires:["brix/core/brick","node","ua"]});