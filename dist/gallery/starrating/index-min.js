KISSY.add("brix/gallery/starrating/index",function(a,b,c,d){function g(){g.superclass.constructor.apply(this,arguments)}var e=c.all;if(d.ie==6)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(f){}return g.ATTRS={split:{value:2},maxValue:{value:5},length:{value:10},defaultValue:{value:!1},readOnly:{value:!1},starWidth:{value:18},inputs:{},current:{},mode:{value:!0}},g.ATTACH={".starrating-star":{mouseenter:function(b){if(!this.get("readOnly")){var c,d=a.one(b.currentTarget);this._fill(d),this.get("mode")?c=d.data("input").val():c=d.data("input"),this.fire("focus",{value:c})}},mouseleave:function(b){if(!this.get("readOnly")){var c,d=a.one(b.currentTarget);this._draw(),this.get("mode")?c=d.data("input").val():c=d.data("input"),this.fire("blur",{value:c})}},click:function(b){if(!this.get("readOnly")){var c=a.one(b.currentTarget);this.select(c)}}}},g.METHOD={select:function(b){var c=this;if(typeof b=="number"){b=c.get("el").all(".starrating-star").item(b);if(b)return c.select(b);throw"\u6ca1\u6709\u627e\u5230\u8282\u70b9"}if(typeof b=="string"){if(c.get("mode"))c.get("inputs").each(function(a,d){if(a.val()==b)return b=c.get("el").all(".starrating-star").item(d),!1});else{var d=a.indexOf(b,c.get("inputs"));b=c.get("el").all(".starrating-star").item(d)}return c.select(b)}c.set("current",b),c._draw();var e;c.get("mode")?e=b.data("input").val():e=b.data("input"),c.fire("selected",{value:e})},readOnly:function(a,b){var c=this;c.set("readOnly",a||a==undefined?!0:!1);var d=c.get("readOnly");d?c.get("el").all(".starrating-star").addClass("starrating-star-readonly"):c.get("el").all(".starrating-star").removeClass("starrating-star-readonly"),c.get("mode")&&(b?c.get("inputs").attr("disabled","disabled"):c.get("inputs").removeAttr("disabled")),c._draw()},disable:function(){this.readOnly(!0,!0)},enable:function(){this.readOnly(!1,!1)}},a.extend(g,b,{initialize:function(){var b=this,c=b.get("inputs");c||(c=b.get("el").all("input[type=radio].star"));if(c.length==0){b.set("mode",!1);var d=b.get("length"),e=b.get("maxValue");c=[],flg=e/d;for(var f=1;f<=d;f++){var g=f*e/d;flg>=1?c.push(Math.round(g).toString()):flg>.1?c.push(g.toFixed(1).toString()):c.push(g.toFixed(2).toString())}}b.set("inputs",c),b.get("mode")?c.each(function(a,c){var d=a.val(),e=a.attr("title")||d;b._creat(d,e,a,c)}):a.each(c,function(a,c){b._creat(a,a,a,c)}),rater=null;var h=b.get("defaultValue");h&&b.select(h)},_creat:function(a,b,c,d){var f=this,g=f.get("el"),h=f.get("split"),i=f.get("readOnly"),j=f.get("starWidth"),k=e('<div class="starrating-star"><a title="'+b+'">'+a+"</a></div>");g.append(k);if(h>1){var l=k.width()||j,m=d%h,n=Math.floor(l/h);k.css({width:n}).one("a").css({"margin-left":"-"+m*n+"px"})}k.data("input",c),i&&k.addClass("starrating-star-readonly"),f.get("mode")&&c.hide()},_fill:function(a){this._drain(),a.addClass("starrating-star-hover");var b=a;while(b.prev())b.prev().addClass("starrating-star-hover"),b=b.prev()},_drain:function(){this.get("el").all(".starrating-star").removeClass("starrating-star-hover").removeClass("starrating-star-on")},_draw:function(){this._drain(),this.get("mode")&&this.get("inputs").removeAttr("checked");var a=this.get("current");if(a){this.get("mode")&&a.data("input").attr("checked","checked"),a.addClass("starrating-star-on");var b=a;while(b.prev())b.prev().addClass("starrating-star-on"),b=b.prev()}},destructor:function(){}}),a.augment(g,g.METHOD),g},{requires:["brix/core/brick","node","ua"]});