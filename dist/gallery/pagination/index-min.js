KISSY.add("brix/gallery/pagination/index",function(a,b){function c(){c.superclass.constructor.apply(this,arguments)}return c.ATTRS={mode:{value:"p"},simplify:{value:!1},step:{value:7},index:{value:1},size:{value:15},sizeChange:{value:!1},count:{value:350},hascount:{value:!0},max:{value:!1},hasmax:{value:!1},statistics:{value:!1},pageCount:{value:!0},jump:{value:!1},goTo:{value:!0},goToUrl:{value:null},pageName:{value:"page"},pageSizeName:{value:"pagesize"},params:{value:!1},defaultUI:{value:!0},sizes:{value:[10,15,20,25,30]},urlInfo:{value:{}},formatUrl:{value:!1}},c.EVENTS={".page-num":{keydown:function(a){a.keyCode===13&&(a.halt(),this._jumpPage())}},".btn-jump":{click:function(a){a.halt(),this._jumpPage()}},a:{click:function(b){var c=this,d=a.one(b.currentTarget);if(d.hasClass("page"))b.halt(),c.goToPage(parseInt(d.html(),10));else if(d.hasClass("page-prev")){b.halt();var e=c.get("index");c.goToPage(e-1)}else if(d.hasClass("page-next")){b.halt();var e=c.get("index");c.goToPage(e+1)}}}},c.METHODS={goToPage:function(a){var b=this,c;c=b.fire("beforeGotoPage",{newIndex:a,prevIndex:b.get("index")});if(c===!1)return;b.set("index",a);if(b.get("goTo")){var d=b.doUrl();location.href=d;return}b._destroyDropdown(),b._resizeConfig(),b.renderUI(),b._getDropDown(),b.fire("goToPage",{index:a})},setConfig:function(a){var b=this,c=b.get("size");for(var d in a)b.set(d,a[d]);a.goToUrl&&b._setUrlInfo();if(a.index||a.size||a.max||a.hascount||a.step||a.mode)a.size&&a.size!=c&&b.fire("sizeChange",{size:a.size}),b._destroyDropdown(),b._resizeConfig(),b.renderUI(),b._getDropDown()},parseUrl:function(a){var b=document.createElement("a");return b.href=a.toLowerCase(),{source:a,protocol:b.protocol.replace(":",""),host:b.hostname,port:b.port,query:b.search,params:function(){var a={},c=b.search.replace(/^\?/,"").split("&"),d=c.length,e=0,f;for(;e<d;e++){if(!c[e])continue;f=c[e].split("="),a[f[0]]=f[1]}return a}(),file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:b.hash.replace("#",""),path:b.pathname.replace(/^([^\/])/,"/$1"),relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:b.pathname.replace(/^\//,"").split("/")}},doUrl:function(){var a=this,b=a.get("urlInfo"),c=a.get("index"),d=a.get("size"),e=a.get("pageName"),f=a.get("pageSizeName"),g=a.get("mode"),h;switch(g){case"p":b.params[e]=c;break;case"s":b.params[e]=c*d}f?b.params[f]=d:b.params[f]&&delete b.params[f],h=b.protocol+"://"+b.host,b.port!=0&&b.port!=80&&(h+=":"+b.port),h+=b.path+"?";var i=[];for(var j in b.params)i[i.length]=j+"="+b.params[j];return h+=i.join("&"),b.hash!=""&&(h+="#"+b.hash),h}},a.extend(c,b,{initialize:function(){var a=this;a._setUrlInfo();var b=a.get("urlInfo"),c=a.get("mode"),d=a.get("pageName"),e=a.get("pageSizeName");e&&b.params[e]&&a.set("size",parseInt(b.params[e],10));if(b.params[d])switch(c){case"p":a.set("index",parseInt(b.params[d],10));break;case"s":var f=a.get("size");a.set("index",parseInt(b.params[d],10)/f)}a._resizeConfig(),a.get("defaultUI")&&a.renderUI(),a._getDropDown()},destructor:function(){this._destroyDropdown()},renderUI:function(){var b=this,c=b.get("mode"),d=b.get("formatUrl"),e=b.get("step"),f=b.get("index"),g=b.get("max"),h=b.get("size"),i=b.get("count"),j=b.get("hascount"),k=b.get("pageCount"),l=[],m=1;switch(c){case"p":m=1;break;case"s":m=h}if(b.get("statistics")){l.push('<div class="pagination-info"><span>\u5f53\u524d</span><span class="b">'+(i==0?0:(f-1)*h+1)+"-"+Math.min(f*h,i)+'</span><span>\u6761</span><span class="mr">\u5171</span><span class="b">'+i+'</span><span>\u6761</span><span class="mr">\u6bcf\u9875\u5c55\u73b0</span>');if(b.get("sizeChange")){var n=b.get("sizes");l.push('<div class="dropdown"><span class="dropdown-hd"><span class="dropdown-text" value="'+a.indexOf(h,n)+'">'+h+"</span>"+"</span>"+'<ul class="dropdown-list dropdown-list-noicon">'),a.each(n,function(a,b){l.push('<li class="dropdown-item'+(a==h?" dropdown-itemselected":"")+'"><span value="'+b+'">'+a+"</span></li>")}),l.push("</ul></div>")}else l.push('<span class="b">'+h+"</span>");l.push("<span>\u6761</span></div>")}l.push('<div class="pagination-pages"><div class="pagination-page">'),f>1&&l.push('<a title="\u4e0a\u4e00\u9875" href="'+d.replace("{$p}",m*(f-1))+'" class="page-prev"><i class="iconfont">&#403</i></a>');if(b.get("simplify"))l.push('<span class="page-simply">'+f+"/"+g+"</span>");else{var o=Math.max(1,f-parseInt(e/2)),p=Math.min(g,o+e-1);o=Math.max(1,p-e+1),o>=3?(l.push('<a class="page" href="'+d.replace("{$p}",m*1)+'" title="\u7b2c1\u9875">1</a>'),l.push('<a class="page" href="'+d.replace("{$p}",m*2)+'" title="\u7b2c2\u9875">2</a>'),o>3&&l.push('<span class="page-split">...</span>')):o==2&&l.push('<a class="page" href="'+d.replace("{$p}",m*1)+'" title="\u7b2c1\u9875">1</a>');for(var q=o;q<=p;q++)q===f?l.push('<span class="page-cur">'+q+"</span>"):l.push('<a class="page" href="'+d.replace("{$p}",m*q)+'" title="\u7b2c'+q+'\u9875">'+q+"</a>");p+2<=g?(l.push('<span class="page-split">...</span>'),j&&l.push('<a class="page" href="'+d.replace("{$p}",m*g)+'" title="\u7b2c'+g+'\u9875">'+g+"</a>")):p<g&&l.push('<a class="page" href="'+d.replace("{$p}",m*g)+'" title="\u7b2c'+g+'\u9875">'+g+"</a>")}f!=g&&l.push('<a title="\u4e0b\u4e00\u9875" href="'+d.replace("{$p}",m*(f+1))+'" class="page-next"><i class="iconfont">&#402</i></a>'),l.push("</div>"),j&&k&&l.push('<div class="pagination-count"><span>\u5171</span><span class="b">'+g+"</span><span>\u9875</span></div>"),b.get("jump")&&l.push('<div class="pagination-form"><span>\u5411\u7b2c</span><input class="page-num" value="'+Math.min(g,f+1)+'" name="page" type="text"><span>\u9875</span><a class="btn-jump btn btn-size25">\u8df3\u8f6c</a></div>'),l.push("</div>"),b.get("el").html(l.join(""))},_getDropDown:function(){var a=this;if(a.get("sizeChange")&&a.get("statistics")){var b=a.get("el").one(".dropdown");if(b){var c=b?b.attr("id"):!1;c&&a.pagelet?a.pagelet.ready(function(){a.dropdown=a.pagelet.getBrick(c),a.dropdown?a.dropdown.on("selected",function(b){a.setConfig({size:b.text})}):a._createDropdown()}):a._createDropdown()}}},_createDropdown:function(){var b=this;a.use("brix/gallery/dropdown/",function(a,c){b.dropdown=new c({tmpl:b.get("el").one(".dropdown")}),b.dropdown.on("selected",function(a){b.setConfig({size:a.text})})})},_destroyDropdown:function(){var a=this;a.dropdown&&(a.dropdown.destroy(),a.dropdown=null)},_jumpPage:function(){var a=this,b=this.get("el").one(".page-num"),c=parseInt(b.val(),10),d=a.get("max"),e=a.get("index");if(isNaN(c)||c<1||c>d||c==e){b[0].select();return}this.goToPage(c)},_setUrlInfo:function(){var b=this,c=b.get("params");b.get("goToUrl")||b.set("goToUrl",location.href);var d=b.parseUrl(b.get("goToUrl"));c&&a.each(c,function(a,b){d.params[b]=a}),b.set("urlInfo",d)},_resizeConfig:function(){var a=this,b=a.get("index"),c=a.get("hascount"),d=a.get("step"),e=a.get("size"),f=a.get("count"),g=a.get("max"),h=a.get("hasmax"),i=a.get("mode"),j=a.get("pageName"),k=a.get("pageSizeName");c||(b>=d?f=e*(b+1):f=e*d,a.set("count",f)),h?g=Math.min(Math.ceil(f/e),g):g=Math.ceil(f/e),a.set("max",g),b=Math.min(b,g),a.set("index",b),f===0&&(a.set("max",1),a.set("index",1)),d=Math.min(d,g),a.set("step",d);var l=a.doUrl();switch(i){case"p":l=l.replace(j+"="+b,j+"={$p}");break;case"s":l=l.replace(j+"="+b*e,j+"={$p}")}a.set("formatUrl",l)}}),a.augment(c,c.METHODS),c},{requires:["brix/core/brick"]});