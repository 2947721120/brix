KISSY.add("brix/gallery/pagination/index",function(e,t){function n(){n.superclass.constructor.apply(this,arguments)}return n.ATTRS={mode:{value:"p"},simplify:{value:!1},step:{value:7},index:{value:1},size:{value:15},sizeChange:{value:!1},count:{value:350},hascount:{value:!0},max:{value:!1},hasmax:{value:!1},statistics:{value:!1},pageCount:{value:!0},jump:{value:!1},goTo:{value:!0},goToUrl:{value:null},pageName:{value:"page"},pageSizeName:{value:"pagesize"},params:{value:!1},defaultUI:{value:!0},sizes:{value:[10,15,20,25,30]},urlInfo:{value:{}},formatUrl:{value:!1}},n.ATTACH={".page-num":{keydown:function(e){e.keyCode===13&&(e.halt(),this._jumpPage())}},".btn-jump":{click:function(e){e.halt(),this._jumpPage()}},a:{click:function(t){var n=this,r=e.one(t.currentTarget);if(r.hasClass("page"))t.halt(),n.goToPage(parseInt(r.html(),10));else if(r.hasClass("page-prev")){t.halt();var i=n.get("index");n.goToPage(i-1)}else if(r.hasClass("page-next")){t.halt();var i=n.get("index");n.goToPage(i+1)}}}},n.METHOD={goToPage:function(e){var t=this,n;n=t.fire("beforeGotoPage",{newIndex:e,prevIndex:t.get("index")});if(n===!1)return;t.set("index",e);if(t.get("goTo")){var r=t.doUrl();location.href=r;return}t._destroyDropdown(),t._resizeConfig(),t.renderUI(),t._getDropDown(),t.fire("goToPage",{index:e})},setConfig:function(e){var t=this,n=t.get("size");for(var r in e)t.set(r,e[r]);e.goToUrl&&t._setUrlInfo();if(e.index||e.size||e.max||e.hascount||e.step||e.mode)e.size&&e.size!=n&&t.fire("sizeChange",{size:n}),t._destroyDropdown(),t._resizeConfig(),t.renderUI(),t._getDropDown()},parseUrl:function(e){var t=document.createElement("a");return t.href=e.toLowerCase(),{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){var e={},n=t.search.replace(/^\?/,"").split("&"),r=n.length,i=0,s;for(;i<r;i++){if(!n[i])continue;s=n[i].split("="),e[s[0]]=s[1]}return e}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}},doUrl:function(){var e=this,t=e.get("urlInfo"),n=e.get("index"),r=e.get("size"),i=e.get("pageName"),s=e.get("pageSizeName"),o=e.get("mode"),u;switch(o){case"p":t.params[i]=n;break;case"s":t.params[i]=n*r}s?t.params[s]=r:t.params[s]&&delete t.params[s],u=t.protocol+"://"+t.host,t.port!=0&&t.port!=80&&(u+=":"+t.port),u+=t.path+"?";var a=[];for(var f in t.params)a[a.length]=f+"="+t.params[f];return u+=a.join("&"),t.hash!=""&&(u+="#"+t.hash),u}},e.extend(n,t,{initialize:function(){var e=this;e._setUrlInfo();var t=e.get("urlInfo"),n=e.get("mode"),r=e.get("pageName"),i=e.get("pageSizeName");i&&t.params[i]&&e.set("size",parseInt(t.params[i],10));if(t.params[r])switch(n){case"p":e.set("index",parseInt(t.params[r],10));break;case"s":var s=e.get("size");e.set("index",parseInt(t.params[r],10)/s)}e._resizeConfig(),e.get("defaultUI")&&e.renderUI(),e._getDropDown()},destructor:function(){this._destroyDropdown()},renderUI:function(){var t=this,n=t.get("mode"),r=t.get("formatUrl"),i=t.get("step"),s=t.get("index"),o=t.get("max"),u=t.get("size"),a=t.get("count"),f=t.get("hascount"),l=t.get("pageCount"),c=[],h=1;switch(n){case"p":h=1;break;case"s":h=u}if(t.get("statistics")){c.push('<div class="pagination-info"><span>\u5f53\u524d</span><span class="b">'+(a==0?0:(s-1)*u+1)+"-"+Math.min(s*u,a)+'</span><span>\u6761</span><span class="mr">\u5171</span><span class="b">'+a+'</span><span>\u6761</span><span class="mr">\u6bcf\u9875\u5c55\u73b0</span>');if(t.get("sizeChange")){var p=t.get("sizes");c.push('<div class="dropdown"><span class="dropdown-hd"><span class="dropdown-text" value="'+e.indexOf(u,p)+'">'+u+"</span>"+"</span>"+'<ul class="dropdown-list dropdown-list-noicon">'),e.each(p,function(e,t){c.push('<li class="dropdown-item'+(e==u?" dropdown-itemselected":"")+'"><span value="'+t+'">'+e+"</span></li>")}),c.push("</ul></div>")}else c.push('<span class="b">'+u+"</span>");c.push("<span>\u6761</span></div>")}c.push('<div class="pagination-pages"><div class="pagination-page">'),s>1&&c.push('<a title="\u4e0a\u4e00\u9875" href="'+r.replace("{$p}",h*(s-1))+'" class="page-prev"><i class="iconfont">&#403</i></a>');if(t.get("simplify"))c.push('<span class="page-simply">'+s+"/"+o+"</span>");else{var d=Math.max(1,s-parseInt(i/2)),v=Math.min(o,d+i-1);d=Math.max(1,v-i+1),d>=3?(c.push('<a class="page" href="'+r.replace("{$p}",h*1)+'" title="\u7b2c1\u9875">1</a>'),c.push('<a class="page" href="'+r.replace("{$p}",h*2)+'" title="\u7b2c2\u9875">2</a>'),d>3&&c.push('<span class="page-split">...</span>')):d==2&&c.push('<a class="page" href="'+r.replace("{$p}",h*1)+'" title="\u7b2c1\u9875">1</a>');for(var m=d;m<=v;m++)m===s?c.push('<span class="page-cur">'+m+"</span>"):c.push('<a class="page" href="'+r.replace("{$p}",h*m)+'" title="\u7b2c'+m+'\u9875">'+m+"</a>");v+2<=o?(c.push('<span class="page-split">...</span>'),f&&c.push('<a class="page" href="'+r.replace("{$p}",h*o)+'" title="\u7b2c'+o+'\u9875">'+o+"</a>")):v<o&&c.push('<a class="page" href="'+r.replace("{$p}",h*o)+'" title="\u7b2c'+o+'\u9875">'+o+"</a>")}s!=o&&c.push('<a title="\u4e0b\u4e00\u9875" href="'+r.replace("{$p}",h*(s+1))+'" class="page-next"><i class="iconfont">&#402</i></a>'),c.push("</div>"),f&&l&&c.push('<div class="pagination-count"><span>\u5171</span><span class="b">'+o+"</span><span>\u9875</span></div>"),t.get("jump")&&c.push('<div class="pagination-form"><span>\u5411\u7b2c</span><input class="page-num" value="'+Math.min(o,s+1)+'" name="page" type="text"><span>\u9875</span><a class="btn-jump btn btn-size25">\u8df3\u8f6c</a></div>'),c.push("</div>"),t.get("el").html(c.join(""))},_getDropDown:function(){var e=this;if(e.get("sizeChange")&&e.get("statistics")){var t=e.get("el").one(".dropdown");if(t){var n=t?t.attr("id"):!1;n&&e.pagelet?e.pagelet.ready(function(){e.dropdown=e.pagelet.getBrick(n),e.dropdown?e.dropdown.on("selected",function(t){e.setConfig({size:t.text})}):e._createDropdown()}):e._createDropdown()}}},_createDropdown:function(){var t=this;e.use("brix/gallery/dropdown/",function(e,n){t.dropdown=new n({tmpl:t.get("el").one(".dropdown")}),t.dropdown.on("selected",function(e){t.setConfig({size:e.text})})})},_destroyDropdown:function(){var e=this;e.dropdown&&(e.dropdown.destroy(),e.dropdown=null)},_jumpPage:function(){var e=this,t=this.get("el").one(".page-num"),n=parseInt(t.val(),10),r=e.get("max"),i=e.get("index");if(isNaN(n)||n<1||n>r||n==i){t[0].select();return}this.goToPage(n)},_setUrlInfo:function(){var t=this,n=t.get("params");t.get("goToUrl")||t.set("goToUrl",location.href);var r=t.parseUrl(t.get("goToUrl"));n&&e.each(n,function(e,t){r.params[t]=e}),t.set("urlInfo",r)},_resizeConfig:function(){var e=this,t=e.get("index"),n=e.get("hascount"),r=e.get("step"),i=e.get("size"),s=e.get("count"),o=e.get("max"),u=e.get("hasmax"),a=e.get("mode"),f=e.get("pageName"),l=e.get("pageSizeName");n||(t>=r?s=i*(t+1):s=i*r,e.set("count",s)),u?o=Math.min(Math.ceil(s/i),o):o=Math.ceil(s/i),e.set("max",o),t=Math.min(t,o),e.set("index",t),s===0&&(e.set("max",1),e.set("index",1)),r=Math.min(r,o),e.set("step",r);var c=e.doUrl();switch(a){case"p":c=c.replace(f+"="+t,f+"={$p}");break;case"s":c=c.replace(f+"="+t*i,f+"={$p}")}e.set("formatUrl",c)}}),e.augment(n,n.METHOD),n},{requires:["brix/core/brick"]});