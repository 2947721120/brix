KISSY.add("brix/gallery/slider/index",function(a,b,c,d,e){function f(){f.superclass.constructor.apply(this,arguments)}f.FIRES={drag:"drag",dragstart:"dragstart",dragend:"dragend",resize:"resize"};var g={horizontal:"horizontal",vertical:"vertical"};return f.ATTRS={range:{value:!1},mode:{value:"horizontal"},startStep:{value:0},endStep:{value:100},integerStep:{value:1},current:{},knobOffset:{value:-7}},f.METHOD={resize:function(){this.fire(f.FIRES.resize)},destructor:function(){this.knob.destroy(),this.knob_start&&this.knob_start.destroy(),this.knobNode=null,this.knobNode_start=null,self.detach()}},a.extend(f,b,{initialize:function(){this._render_range(),this._render_knob()},_render_knob:function(){function u(){var e=b.value,f,j=d===g.horizontal?c.width():c.height();a.isArray(e)?(e[0]=v(e[0],h,i),e[1]=v(e[1],h,i),n=j*(e[1]-h)/(i-h),o=j*(e[0]-h)/(i-h),l.css(q,n),m.css(q,o),k.css(q,n>o?o:n),k.css(r,Math.abs(n-o))):(e=v(e,h,i),n=j*(e-h)/(i-h),l.css(q,n),k.css(r,n))}function v(b,c,d){return a.isUndefined(b)&&(b=c),b<c&&b<d&&(b=c),b>d&&b>c&&(b=d),b}function w(a){var e=d===g.horizontal?c.width():c.height(),k=(i-h)*n/e+h,l=o===null?null:(i-h)*o/e+h;j&&(k=Math.round(k/j)*j,l=l===null?null:Math.round(l/j)*j),m?b.value=[l,k]:b.value=k,x(b.value),b.fire(f.FIRES.drag,{data:b.value,current:b.get("current")})}function x(c){var d=b.get("range"),e;a.isArray(c)&&(h<i&&c[0]>c[1]&&(c=[c[1],c[0]]),h>i&&c[0]<c[1]&&(c=[c[1],c[0]])),e=c,a.isArray(b.get("range"))&&(a.isArray(c)?e=[d[c[0]],d[c[1]]]:e=d[c]),b.set("current",e)}function y(){b.fire(f.FIRES.dragstart,{data:b.value,current:b.get("current")})}function z(){u(),b.fire(f.FIRES.dragend,{data:b.value,current:b.get("current")})}var b=this,c=b.get("el"),d=b.get("mode"),h=b.get("startStep"),i=b.get("endStep"),j=b.get("integerStep"),k=c.one(".slider-bar"),l=c.one(".slider-knob-end"),m=this.knobNode_start=c.one(".slider-knob-start"),n=0,o=null,p=b.get("knobOffset"),q=d===g.horizontal?"left":"top",r=d===g.horizontal?"width":"height";l=l||c.one(".slider-knob"),this.knobNode=l;var s=b.knob=new e.Draggable({node:l,cursor:"move"});s.on("drag",function(a){var b=c.offset(),e=d===g.horizontal?c.width():c.height(),f=a[q]-b[q]-p;f>e&&(f=e),f<0&&(f=0),n=f,m&&(f=f-o),k.css(r,Math.abs(f)),k.css(q,n>o?o:n),l.css(q,n),w({target:l})}),s.on("dragstart",y),s.on("dragend",z);if(m){var t=b.knob_start=new e.Draggable({node:m,cursor:"move"});t.on("drag",function(a){var b=c.offset(),e=d===g.horizontal?c.width():c.height(),f=a[q]-b[q]-p;f>e&&(f=e),f<0&&(f=0),o=f,k.css(q,n>o?o:n),k.css(r,Math.abs(n-o)),m.css(q,f),w({target:m})}),t.on("dragstart",y),t.on("dragend",z)}a.isUndefined(b.get("current"))||(b.value=b.value||b.get("current"),u()),b.on(f.FIRES.resize,u)},_render_range:function(){a.isArray(this.get("range"))&&(this.set("endStep",this.get("range").length-1),a.log("slider: range "+this.get("range")),a.isString(this.get("current"))&&(this.value=a.indexOf(this.get("current"),this.get("range"))))}}),a.augment(f,f.METHOD),f},{requires:["brix/core/brick","ua","node","dd"]});