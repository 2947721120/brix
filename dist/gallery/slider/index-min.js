KISSY.add("brix/gallery/slider/index",function(e,t,n,r,i){function s(){s.superclass.constructor.apply(this,arguments)}s.FIRES={drag:"drag",dragstart:"dragstart",dragend:"dragend",resize:"resize"};var o={horizontal:"horizontal",vertical:"vertical"};return s.ATTRS={range:{value:!1},mode:{value:"horizontal"},startStep:{value:0},endStep:{value:100},integerStep:{value:1},current:{},knobOffset:{value:-7}},s.METHOD={resize:function(){this.fire(s.FIRES.resize)},destructor:function(){this.knob.destroy(),this.knob_start&&this.knob_start.destroy(),this.knobNode=null,this.knobNode_start=null,self.detach()}},e.extend(s,t,{initialize:function(){this._render_range(),this._render_knob()},_render_knob:function(){function x(){var r=t.value,i,s,o,f=m?n.height():n.width();e.isArray(r)?(r[0]=T(r[0],u,a),r[1]=T(r[1],u,a),p=f*(r[1]-u)/(a-u),d=f*(r[0]-u)/(a-u),c.css(y,p),h.css(y,d),l.css(y,d),l.css(b,Math.abs(p-d)),d==f?h.css("zIndex",2):h.css("zIndex","auto")):(r=T(r,u,a),p=f*(r-u)/(a-u),l.css(b,Math.abs(p)),c.css(y,p))}function T(t,n,r){return e.isUndefined(t)&&(t=n),t<n&&t<r&&(t=n),t>r&&t>n&&(t=r),t}function N(r){var i=m?n.height():n.width(),o=(a-u)*p/i+u,l=d===null?null:(a-u)*d/i+u;f&&(o=Math.round(o/f)*f,l=l===null?null:Math.round(l/f)*f),e.log("("+a+"-"+u+")*"+p+"/"+i+"+"+u),h?t.value=[l,o]:t.value=o,C(t.value),t.fire(s.FIRES.drag,{data:t.value,current:t.get("current")}),e.log("Slider: change="+t.value+","+t.get("current"))}function C(n){var r=t.get("range"),i;e.isArray(n)&&(u<a&&n[0]>n[1]&&(n=[n[1],n[0]]),u>a&&n[0]<n[1]&&(n=[n[1],n[0]])),i=n,e.isArray(t.get("range"))&&(e.isArray(n)?i=[r[n[0]],r[n[1]]]:i=r[n]),t.set("current",i)}function k(){t.fire(s.FIRES.dragstart,{data:t.value,current:t.get("current")})}function L(){x(),t.fire(s.FIRES.dragend,{data:t.value,current:t.get("current")})}var t=this,n=t.get("el"),r=t.get("mode"),u=t.get("startStep"),a=t.get("endStep"),f=t.get("integerStep"),l=n.one(".slider-bar"),c=n.one(".slider-knob-end"),h=this.knobNode_start=n.one(".slider-knob-start"),p=0,d=null,v=t.get("knobOffset"),m=r===o.horizontal?!1:!0,g=m?"top":"left",y=m?"bottom":"left",b=m?"height":"width";c=c||n.one(".slider-knob"),this.knobNode=c;var w=t.knob=new i.Draggable({node:c,cursor:"move"});w.on("drag",function(e){var t=n.offset(),r=m?n.height():n.width(),i=p=e[g]-t[g]-v;m&&(p=r-i),p=T(p,d||0,r),l.css(b,Math.abs(p-(d||0))),l.css(y,d||0),c.css(y,p),N({target:c})}),w.on("dragstart",k),w.on("dragend",L);if(h){var E=t.knob_start=new i.Draggable({node:h,cursor:"move"});E.on("drag",function(e){var t=n.offset(),r=m?n.height():n.width(),i=d=e[g]-t[g]-v;m&&(d=r-i),d=T(d,0,p),l.css(y,d),l.css(b,Math.abs(p-d)),h.css(y,d),N({target:h})}),E.on("dragstart",k),E.on("dragend",L)}e.isUndefined(t.get("current"))||(t.value=t.value||t.get("current"),x()),t.on(s.FIRES.resize,x)},_render_range:function(){e.isArray(this.get("range"))&&(this.set("endStep",this.get("range").length-1),e.log("slider: range "+this.get("range")),e.isString(this.get("current"))&&(this.value=e.indexOf(this.get("current"),this.get("range"))))}}),e.augment(s,s.METHOD),s},{requires:["brix/core/brick","ua","node","dd"]});