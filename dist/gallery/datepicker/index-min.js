KISSY.add("brix/gallery/datepicker/index",function(a,b,c,d){function g(){g.superclass.constructor.apply(this,arguments);var b=this,c=a.one(b.get("trigger"));if(c){var d=b.get("triggerType");a.each(d,function(a){c.on(a,function(a){a.preventDefault(),b.toggle()})})}}var e='<div class="bd-right"><label>\u5feb\u6377\u65e5\u671f:</label><ul>{$QUICKHTML}</ul></div>',f="\u4e0d\u9650";return g.Date=d.Date,g.ATTRS={trigger:{value:!1},triggerType:{value:["click"]},quickDates:{value:null},dates:{value:{start:null,end:null}},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},notLimited:{value:!1},pages:{value:2},tmpl:{valueFn:function(){var b=this,c=b.get("id")||"brix_datepicker_"+a.guid();return'<div id="'+c+'" class="datepicker {{#quickDates}}datepicker-quick{{/quickDates}}">'+'<div class="datepicker-bd {{#changeLR}}datepicker-bd-change-lr{{/changeLR}}">'+'<div class="bd-left">'+"<label>\u65e5\u671f\u8303\u56f4\uff1a</label>"+'<div class="range">'+'<input value="{{start}}">'+'<span class="bd-left-split">-</span>'+'<input value="{{end}}">'+"</div>"+'<div class="operator">'+'<a class="btn btn-confirm" href="#">\u786e\u5b9a</a><a class="btn-cancel" href="#">\u53d6\u6d88</a>'+"</div>"+"</div>"+"{{{"+c+"_quick_html}}}"+"</div>"+"</div>"}},data:{valueFn:function(){var a=this,b=a.get("align"),c=a.get("quickDates"),e=a.get("dates"),g=e.start?d.Date.format(e.start,"isoDate"):f,h=e.end?d.Date.format(e.end,"isoDate"):f,i=!1;return b.points[0]=="br"&&b.points[1]=="tr"&&c&&(i=!0),{start:g,end:h,quickDates:c,changeLR:i}}}},g.RENDERER={quick:{html:function(a){var b=a,c=b.get("quickDates");if(!c)return"";var d="";for(var f in c)d+='<li><a class="quick-item" key="'+f+'" href="#">'+c[f].text+"</a></li>";return e.replace("{$QUICKHTML}",d)}}},g.DOCATTACH={"":{click:function(b){var c=this,d=c.get("el"),e=a.one(b.target),f=a.one(c.get("trigger"));!d.contains(e)&&f&&e[0]!=f[0]&&(!c.calendar||!c.calendar.get("el").contains(e))&&c.hide()}}},g.ATTACH={input:{click:function(b){var c=this,e=a.one(b.currentTarget),g=d.Date.parse(e.val())||new Date,h=d.Date.parse(e.val()),i=a.clone(c.get("align"));i.node=e[0],c.calendar||(c.calendar=new d({date:g,selected:h,popup:!0,closable:!0,notLimited:c.get("notLimited"),pages:c.get("pages"),align:i}),c.calendar.on("select",function(a){var b=c.calendar.get("trigger");a.date?b.val(d.Date.format(a.date,"isoDate")):b.val(f)})),c.calendar.set("date",g),c.calendar.set("selected",h),c.calendar.set("trigger",e),c.calendar.set("align",i),c.calendar.show()}},".btn-confirm":{click:function(b){b.preventDefault();var c=this,e={isQuick:!1},f=c.get("el").one(".range").all("input");e.start=d.Date.parse(f.item(0).val()),e.end=d.Date.parse(f.item(1).val()),a.log(e),c.fire(g.FIRES.selected,e),c.hide()}},".btn-cancel":{click:function(a){a.preventDefault(),this.hide()}},".quick-item":{click:function(b){b.preventDefault();var c=this,d=c.get("quickDates"),e=a.one(b.currentTarget).attr("key"),f=d[e],h={isQuick:!0};h.start=f.dateRange[0],h.end=f.dateRange[1],h.quickDate=f,a.log(h),c.fire(g.FIRES.select,h),c.hide()}}},g.METHOD={show:function(){var b=this;b.get("rendered")||b.render();if(b.overlay){var c=a.clone(b.get("align"));c.node||(c.node=b.get("trigger")),b.overlay.set("align",c),b.overlay.show(),b.fire(g.FIRES.show)}},hide:function(){var a=this;a.overlay&&(a.overlay.hide(),a.fire(g.FIRES.hide))},toggle:function(){var a=this;a.overlay?a.overlay.get("el").css("visibility")=="hidden"?a.show():a.hide():a.show()}},g.FIRES={selected:"selected",show:"show",hide:"hide"},a.extend(g,b,{initialize:function(){var a=this;a.overlay=new c({srcNode:"#"+a.get("id")}),a.overlay.render()},destructor:function(){var a=this;a.calender&&(a.calender.destroy(),a.calender=null),a.overlay&&(a.overlay.destroy(),a.overlay=null)}}),a.augment(g,g.METHOD),g},{requires:["brix/core/brick","overlay","../calendar/index"]});