KISSY.add("brix/gallery/datepicker/index",function(e,t,n,r){function i(e){var t=864e5,n=new Date,r=n.getTime();return n.setTime(r+t*e),n}function f(){f.superclass.constructor.apply(this,arguments);var t=this,n=e.one(t.get("trigger"));if(n){var r=t.get("triggerType");e.each(r,function(e){n.on(e,function(e){e.preventDefault(),t.toggle()})})}var i=t.get("isCompare");i&&t.on("afterCompareTextChange",function(e){t.setChunkData("compareText",t.get("compareText"))})}var s=new Date,o=i(-1),u={today:{text:"\u4eca\u5929",dateRange:[s,s]},yestoday:{text:"\u6628\u5929",dateRange:[o,o]},days7before:{text:"\u8fc7\u53bb7\u5929",dateRange:[i(-7),o]},days14before:{text:"\u8fc7\u53bb15\u5929",dateRange:[i(-15),o]}},a="\u4e0d\u9650";return f.Date=r.Date,f.ATTRS={trigger:{value:!1},triggerType:{value:["click"]},quickDates:{value:u},dates:{value:{start:null,end:null}},isQuick:{value:!0},isCompare:{value:!1},compareText:{value:"\u8fc7\u53bb7\u5929"},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},notLimited:{value:!1},pages:{value:2},tmpl:{valueFn:function(){var t=this,n=t.get("id")||"brix_datepicker_"+e.guid();return'<div id="'+n+'" bx-name="datepicker" class="datepicker">'+'<div class="datepicker-bd">'+"{{^isCompare}}"+"<label>\u65e5\u671f\u8303\u56f4\uff1a</label>"+'<div class="range">'+'<input value="{{start}}">'+'<span class="input-split">-</span>'+'<input value="{{end}}">'+"</div>"+"{{/isCompare}}"+"{{#isCompare}}"+"<label>\u5f53\u524d\u65e5\u671f\uff1a</label>"+'<div bx-tmpl="datepicker" bx-datakey="compareText" class="range">{{compareText}}'+"</div>"+"<label>\u4e0e\u5176\u4ed6\u65e5\u671f\u6bd4\u8f83\uff1a(\u987b\u540c\u6837\u5929\u6570)</label>"+'<div class="range">'+'<input value="{{start}}">'+'<span class="input-split">-</span>'+'<input value="{{end}}">'+"</div>"+"{{/isCompare}}"+"{{#isQuick}}"+"{{{"+n+"_quick_html}}}"+"{{/isQuick}}"+'<div class="operator">'+'<a class="btn btn-size25 btn-confirm" href="#">\u786e\u5b9a</a><a class="btn-cancel" href="#">\u53d6\u6d88</a>'+"</div>"+"</div>"+"</div>"}},data:{valueFn:function(){var e=this,t=e.get("isQuick"),n=e.get("isCompare"),i=e.get("compareText"),s=e.get("dates"),o=s.start?r.Date.format(s.start,"isoDate"):a,u=s.end?r.Date.format(s.end,"isoDate"):a;return{start:o,end:u,isQuick:t,isCompare:n,compareText:i}}}},f.RENDERER={quick:{html:function(e){var t=e.get("quickDates"),n='<label>\u5feb\u6377\u65e5\u671f:</label><ul class="quick-list">';for(var r in t)n+='<li><a class="quick-item" key="'+r+'" href="#">'+t[r].text+"</a></li>";return n+="</ul>",n}}},f.DOCATTACH={"":{click:function(t){var n=this,r=n.get("el"),i=e.one(t.target),s=e.one(n.get("trigger"));!r.contains(i)&&s&&i[0]!=s[0]&&(!n.calendar||!n.calendar.get("el").contains(i))&&n.hide()}}},f.ATTACH={input:{click:function(t){var n=this,i=e.one(t.currentTarget),s=r.Date.parse(i.val())||new Date,o=r.Date.parse(i.val()),u=e.clone(n.get("align"));u.node=i[0],n.calendar||(n.calendar=new r({date:s,selected:o,popup:!0,closable:!0,notLimited:n.get("notLimited"),pages:n.get("pages"),align:u}),n.calendar.on("select",function(e){var t=n.calendar.get("trigger");e.date?t.val(r.Date.format(e.date,"isoDate")):t.val(a)})),n.calendar.set("date",s),n.calendar.set("selected",o),n.calendar.set("trigger",i),n.calendar.set("align",u),n.calendar.show()}},".btn-confirm":{click:function(t){t.preventDefault();var n=this,i=n.get("el"),s=i.one(".quick-list");dates={isQuick:!1},inputs=i.all("input"),s&&s.all("a").removeClass("quick-current"),dates.start=r.Date.parse(inputs.item(0).val()),dates.end=r.Date.parse(inputs.item(1).val()),e.log(dates),n.fire(f.FIRES.selected,dates),n.hide()}},".btn-cancel":{click:function(e){e.preventDefault(),this.hide()}},".quick-item":{click:function(t){t.preventDefault();var n=this,r=e.one(t.currentTarget),i=n.get("el"),s=n.get("quickDates"),o=e.one(t.currentTarget).attr("key"),u=s[o],a={isQuick:!0};i.one(".quick-list").all("a").removeClass("quick-current"),r.addClass("quick-current"),a.start=u.dateRange[0],a.end=u.dateRange[1],a.quickDate=u,e.log(a),n.fire(f.FIRES.selected,a),n.hide()}}},f.METHOD={show:function(){var t=this;t.get("rendered")||t.render();if(t.overlay){var n=e.clone(t.get("align"));n.node||(n.node=t.get("trigger")),t.overlay.set("align",n),t.overlay.show(),t.fire(f.FIRES.show)}},hide:function(){var e=this;e.overlay&&(e.overlay.hide(),e.fire(f.FIRES.hide))},toggle:function(){var e=this;e.overlay?e.overlay.get("el").css("visibility")=="hidden"?e.show():e.hide():e.show()}},f.FIRES={selected:"selected",show:"show",hide:"hide"},e.extend(f,t,{initialize:function(){var e=this;e.overlay=new n({srcNode:"#"+e.get("id")}),e.overlay.render()},destructor:function(){var e=this;e.calender&&(e.calender.destroy(),e.calender=null),e.overlay&&(e.overlay.destroy(),e.overlay=null)}}),e.augment(f,f.METHOD),f},{requires:["brix/core/brick","overlay","../calendar/index"]});