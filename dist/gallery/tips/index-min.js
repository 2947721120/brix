KISSY.add("brix/gallery/tips/index",function(e,t,n,r){function a(){a.superclass.constructor.apply(this,arguments)}var i=n.all,s=e.DOM,o=e.Event,u=0;return a.ATTRS={dataAttrName:{value:"data-tips"},closeable:{value:!0},length:{},"tmpl-tip":{value:'<div id="{{id}}" class="bx-tips-show {{hide}}" style="display: none;position: absolute;top:0;left:0"><p class="bx-tips-msg">{{tips}}</p><i class="bx-tips-tri bx-tips-top"></i><span class="bx-tips-close">\u5173\u95ed</span></div>'},tips:{value:{}},timers:{value:{}},prex:{value:"bx-tip-"},trisize:{value:{width:16,height:9,paddingw:14,paddingh:12}},el:{value:"body"},order:{value:["RB","BR","LB","LT","TL","TR","RT","BL"]},timeout:{value:3}},a.DOCATTACH={".bx-tips":{mouseenter:function(e){var t=e.currentTarget;this.showTips(t)},mouseleave:function(e){var t=e.currentTarget;this.hideTips(t)}},".bx-tips-close":{click:function(e){var t=e.currentTarget,n=this,r=s.parent(t,".bx-tips-show");n.closeTips(r)}}},a.METHOD={showTips:function(e){var t=this,n=t._getTipId(e),o=!s.hasClass(e,"bx-uncloseable")&&t.get("closeable");console.log(o);if(!n||!t.get("tips")[n]){n=t._createTipId();var u=r(t.get("tmpl-tip")).render({id:n,tips:s.attr(e,t.get("dataAttrName")),hide:o?"":"bx-tips-uncloseable"});t.get("tips")[n]=n,s.attr(e,"data-tipid",n),i(u).appendTo("body")}t._posTip(e,s.get("#"+n))},hideTips:function(e){var t=this,n=t._getTipId(e),r=s.get("#"+n),i=setTimeout(function(){s.hide(r),s.css(r,{left:"-9999px",top:"-9999px"})},t.get("timeout")*1e3);t.get("timers")[n]=i},closeTips:function(e){this._clearTimer(e.id),s.hide(e),s.css(e,{left:"-9999px",top:"-9999px"})},_clearTimer:function(e){var t=this.get("timers")[e];t&&(clearTimeout(t),delete this.get("timers")[e])},_createTipId:function(){return this.get("prex")+ ++u},_posTip:function(e,t){var n=this,r=s.offset(e),i=r.left,o=r.top,u={x1:i,y1:o,x2:i+s.innerWidth(e),y2:o+s.innerHeight(e)},a=s.viewportWidth(),f=s.viewportHeight(),l=s.scrollLeft(window),c=s.scrollTop(window),h={x1:l,y1:c,x2:l+a,y2:c+f};n._clearTimer(n._getTipId(e)),s.show(t);var p={tip:t,w:s.outerWidth(t),h:s.outerHeight(t)},d,v=n.get("order"),m=v.length;for(var g=0;g<m;g++){d=n["_test"+v[g]](u,p,h);if(d)break}var y=s.get(".bx-tips-tri",t),b=!s.hasClass(e,"bx-uncloseable")&&n.get("closeable");s.attr(t,"class",b?"bx-tips-show":"bx-tips-show bx-tips-uncloseable"),s.addClass(t,d.cls),s.css(t,{position:"absolute",left:d.left+"px",top:d.top+"px"})},_testBR:function(e,t,n){var r=this.get("trisize"),i=r.width+r.paddingw*2,s=r.height,o=e.x2-i,u=e.y2+s,a=o+t.w,f=u+t.h;return a>n.x2||f>n.y2||u<n.y1?!1:{left:o,top:u,cls:"bx-tips-br"}},_testTL:function(e,t,n){var r=this.get("trisize"),i=r.width+r.paddingw*2,s=r.height,o=e.x1-t.w+i,u=e.y1-t.h-s,a=u+t.h;return o<n.x1||u<n.y1||a>n.y2?!1:{left:o,top:u,cls:"bx-tips-tl"}},_testBL:function(e,t,n){var r=this.get("trisize"),i=r.width+r.paddingw*2,s=r.height,o=e.x1-t.w+i,u=e.y2+s,a=u+t.h;return o<n.x1||a>n.y2||u<n.y1?!1:{left:o,top:u,cls:"bx-tips-bl"}},_testTR:function(e,t,n){var r=this.get("trisize"),i=r.width+r.paddingw*2,s=r.height,o=e.x2-i,u=e.y1-t.h-s,a=o+t.w,f=u+t.h;return a>n.x2||u<n.y1||f>n.y2?!1:{left:o,top:u,cls:"bx-tips-tr"}},_testLT:function(e,t,n){var r=this.get("trisize"),i=r.height,s=r.width+r.paddingh*2,o=e.x1-t.w-i,u=e.y1-t.h+s,a=u+t.h;return o<n.x1||u<n.y1||a>n.y2?!1:{left:o,top:u,cls:"bx-tips-lt"}},_testLB:function(e,t,n){var r=this.get("trisize"),i=r.height,s=r.width+r.paddingh*2,o=e.x1-t.w-i,u=e.y2-s,a=u+t.h;return o<n.x1||a>n.y2||u<n.y1?!1:{left:o,top:u,cls:"bx-tips-lb"}},_testRT:function(e,t,n){var r=this.get("trisize"),i=r.height,s=r.width+r.paddingh*2,o=e.x2+i,u=e.y1-t.h+s,a=o+t.w,f=u+t.h;return a>n.x2||u<n.y1||f>n.y2?!1:{left:o,top:u,cls:"bx-tips-rt"}},_testRB:function(e,t,n){var r=this.get("trisize"),i=r.height,s=r.width+r.paddingh*2,o=e.x2+i,u=e.y2-s,a=o+t.w,f=u+t.h;return a>n.x2||f>n.y2||u<n.y1?!1:{left:o,top:u,cls:"bx-tips-rb"}},_getTipId:function(e){return s.attr(e,"data-tipid")}},e.extend(a,t,{initialize:function(){var t=this;window.onresize=function(){var n=t.get("tips");e.each(n,function(e){t.closeTips(s.get("#"+e))})},e.UA.ie&&e.UA.ie==6&&o.delegate("html","mouseenter mouseleave",".bx-tips-close",function(e){e.type==="mouseenter"?s.addClass(e.currentTarget,"hover"):s.removeClass(e.currentTarget,"hover")})},destructor:function(){}}),e.augment(a,a.METHOD),a},{requires:["brix/core/brick","node","template"]});