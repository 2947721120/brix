KISSY.add("brix/gallery/tips/index",function(a,b,c,d){function i(){i.superclass.constructor.apply(this,arguments)}var e=c.all,f=a.DOM,g=a.Event,h=0;return i.ATTRS={dataAttrName:{value:"data-tips"},closeable:{value:!0},length:{},"tmpl-tip":{value:'<div id="{{id}}" class="bx-tips-show {{hide}}" style="display: none;position: absolute;top:0;left:0"><p class="bx-tips-msg">{{tips}}</p><a href="javascript:void(0);" class="bx-tips-iknow">\u6211\u77e5\u9053\u4e86</a><span class="tri"><i class="outer"></i><i class="inner"></i></span><span class="bx-tips-close">\u5173\u95ed</span></div>'},tips:{value:{}},timers:{value:{}},prex:{value:"bx-tip-"},dis:{value:10},el:{value:"body"},order:{value:["RB","BR","LB","LT","TL","TR","RT","BL"]},timeout:{value:3}},i.DOCEVENTS={".bx-tips":{mouseenter:function(a){var b=a.currentTarget;this.showTips(b)},mouseleave:function(a){var b=a.currentTarget;this.hideTips(b)}},".bx-tips-close":{click:function(a){var b=a.currentTarget,c=this,d=f.parent(b,".bx-tips-show");c.closeTips(d)}},".bx-tips-iknow":{click:function(a){a.halt();var b=a.currentTarget,c=this,d=f.parent(b,".bx-tips-show");c.closeTips(d)}}},i.METHODS={showTips:function(a){var b=this,c=b._getTipId(a),g=!f.hasClass(a,"bx-uncloseable")&&b.get("closeable");console.log(g);if(!c||!b.get("tips")[c]){c=b._createTipId();var h=d(b.get("tmpl-tip")).render({id:c,tips:f.attr(a,b.get("dataAttrName")),hide:g?"":"bx-tips-uncloseable"});b.get("tips")[c]=c,f.attr(a,"data-tipid",c),e(h).appendTo("body")}b._posTip(a,f.get("#"+c))},hideTips:function(a){var b=this,c=b._getTipId(a),d=f.get("#"+c),e=setTimeout(function(){f.hide(d),f.css(d,{left:"-9999px",top:"-9999px"})},b.get("timeout")*1e3);b.get("timers")[c]=e},closeTips:function(a){this._clearTimer(a.id),f.hide(a),f.css(a,{left:"-9999px",top:"-9999px"})},_clearTimer:function(a){var b=this.get("timers")[a];b&&(clearTimeout(b),delete this.get("timers")[a])},_createTipId:function(){return this.get("prex")+ ++h},_posTip:function(a,b){var c=this,d=f.offset(a),e=d.left,g=d.top,h={x1:e,y1:g,x2:e+f.innerWidth(a),y2:g+f.innerHeight(a)},i=f.viewportWidth(),j=f.viewportHeight(),k=f.scrollLeft(window),l=f.scrollTop(window),m={x1:k,y1:l,x2:k+i,y2:l+j};c._clearTimer(c._getTipId(a)),f.show(b);var n={tip:b,w:f.outerWidth(b),h:f.outerHeight(b)},o,p=c.get("order"),q=p.length;for(var r=0;r<q;r++){o=c["_test"+p[r]](h,n,m);if(o)break}var s=f.get(".bx-tips-tri",b),t=!f.hasClass(a,"bx-uncloseable")&&c.get("closeable");f.attr(b,"class",t?"bx-tips-show":"bx-tips-show bx-tips-uncloseable"),f.addClass(b,o.cls),f.css(b,{position:"absolute",left:o.left+"px",top:o.top+"px"})},_testBR:function(a,b,c){var d=this.get("dis"),e=a.x2-d,f=a.y2+d,g=e+b.w,h=f+b.h;return g>c.x2||h>c.y2||f<c.y1?!1:{left:e,top:f,cls:"bx-tips-br"}},_testTL:function(a,b,c){var d=this.get("dis"),e=a.x1-b.w+d,f=a.y1-b.h-d,g=f+b.h;return e<c.x1||f<c.y1||g>c.y2?!1:{left:e,top:f,cls:"bx-tips-tl"}},_testBL:function(a,b,c){var d=this.get("dis"),e=a.x1-b.w+d,f=a.y2+d,g=f+b.h;return e<c.x1||g>c.y2||f<c.y1?!1:{left:e,top:f,cls:"bx-tips-bl"}},_testTR:function(a,b,c){var d=this.get("dis"),e=a.x2-d,f=a.y1-b.h-d,g=e+b.w,h=f+b.h;return g>c.x2||f<c.y1||h>c.y2?!1:{left:e,top:f,cls:"bx-tips-tr"}},_testLT:function(a,b,c){var d=this.get("dis"),e=a.x1-b.w-d,f=a.y1-b.h+d,g=f+b.h;return e<c.x1||f<c.y1||g>c.y2?!1:{left:e,top:f,cls:"bx-tips-lt"}},_testLB:function(a,b,c){var d=this.get("dis"),e=a.x1-b.w-d,f=a.y2-d,g=f+b.h;return e<c.x1||g>c.y2||f<c.y1?!1:{left:e,top:f,cls:"bx-tips-lb"}},_testRT:function(a,b,c){var d=this.get("dis"),e=a.x2+d,f=a.y1-b.h+d,g=e+b.w,h=f+b.h;return g>c.x2||f<c.y1||h>c.y2?!1:{left:e,top:f,cls:"bx-tips-rt"}},_testRB:function(a,b,c){var d=this.get("dis"),e=a.x2+d,f=a.y2-d,g=e+b.w,h=f+b.h;return g>c.x2||h>c.y2||f<c.y1?!1:{left:e,top:f,cls:"bx-tips-rb"}},_getTipId:function(a){return f.attr(a,"data-tipid")}},a.extend(i,b,{initialize:function(){var b=this;window.onresize=function(){var c=b.get("tips");a.each(c,function(a){b.closeTips(f.get("#"+a))})},a.UA.ie&&a.UA.ie==6&&g.delegate("html","mouseenter mouseleave",".bx-tips-close",function(a){a.type==="mouseenter"?f.addClass(a.currentTarget,"hover"):f.removeClass(a.currentTarget,"hover")})},destructor:function(){}}),a.augment(i,i.METHODS),i},{requires:["brix/core/brick","node","template"]});