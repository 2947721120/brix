KISSY.add("brix/gallery/dropdown/index",function(a,b){function c(){c.superclass.constructor.apply(this,arguments)}return c.ATTRS={mode:{value:1},autoResize:{value:!0},setDefault:{value:!1}},c.FIRES={beforeFocus:"beforeFocus",focus:"focus",beforeBlur:"beforeBlur",blur:"blur",selected:"selected"},c.METHODS={focus:function(){var a=this.get("mode"),b=this.get("el"),d=b.one(".dropdown-list");if(d.css("display")!=="none")return;this.fire(c.FIRES.beforeFocus),a==1&&b.one(".dropdown-hd").addClass("dropdown-hd-active"),d.css({display:"block"});if(this.get("autoResize")){var e=b.one(".dropdown-hd").outerWidth();b.one(".dropdown-list").css({width:e+"px"})}this.fire(c.FIRES.focus)},blur:function(){var a=this.get("mode"),b=this.get("el"),d=b.one(".dropdown-list");if(d.css("display")==="none")return;b.all(".dropdown-item").removeClass(".dropdown-itemover"),this.fire(c.FIRES.beforeBlur),a==1&&b.one(".dropdown-hd").removeClass("dropdown-hd-active"),d.css("display","none"),this.fire(c.FIRES.blur)},select:function(a){var b=this,c=this.get("el"),d=c.all(".dropdown-item"),e;d.each(function(b){var c=b.one("span"),d=c.attr("value")||"";if(d==a)return e=b,!1}),e&&b._select(e)}},c.DOCEVENTS={"":{click:function(a){var b=this,c=b.get("el");!b.__show&&!c.contains(a.target)&&(c.all(".dropdown-list").css("display","none"),c.all(".dropdown-hd").removeClass("dropdown-hd-active")),b.__show=!1}}},c.EVENTS={"":{mouseleave:function(){var a=this.get("mode");a!=1&&this.blur()},keydown:function(a){var b=this,c=b.get("el");switch(a.keyCode){case 9:case 27:b.blur();break;case 13:b.__show=!0;var d=c.one(".dropdown-itemover");if(!d||d.hasClass("dropdown-itemselected"))return;b.blur(),b._select(d);break;case 38:a.halt(),b.focus();var e=c.one(".dropdown-itemover")||c.one(".dropdown-itemselected")||c.one(".dropdown-item"),f;if(e.prev())f=e.prev();else{var g=c.all(".dropdown-item");f=g.item(g.length-1)}b._hover(f,!0);break;case 40:a.halt(),b.focus();var e=c.one(".dropdown-itemover")||c.one(".dropdown-itemselected")||c.one(".dropdown-item"),f;e.next()?f=e.next():f=c.one(".dropdown-item"),b._hover(f,!0)}}},".dropdown-hd":{click:function(a){var b=this.get("mode");if(b==1){var c=this.get("el").one(".dropdown-list");this.__show=!0,c.css("display")=="block"?this.blur():this.focus()}},mouseenter:function(){var a=this.get("mode");a!=1&&this.focus()}},".dropdown-item":{click:function(b){var c=this;c.__show=!0;var d=c.get("el"),e=a.one(b.currentTarget);if(e.hasClass("dropdown-itemselected"))return;c.blur(),c._select(e)},mouseenter:function(b){var c=a.one(b.currentTarget);this._hover(c)},mouseleave:function(b){var c=a.one(b.currentTarget);c.removeClass("dropdown-itemover")}}},a.extend(c,b,{initialize:function(){var a=this,b=this.get("el");b.attr("tabindex",0);if(a.get("setDefault")){var c=b.one(".dropdown-itemselected")||b.one(".dropdown-item");a._select(c,!0)}},_select:function(a,b){var d=this,e=this.get("el");e.all(".dropdown-item").removeClass(".dropdown-itemover").removeClass("dropdown-itemselected"),a.addClass("dropdown-itemselected");var f=e.one(".dropdown-text"),g=a.one("span"),h={value:g.attr("value")||"",text:g.text()},i=e.one("input");i&&i.val(h.value);var j=f.attr("value")||"";if(j==h.value)return;f.attr("value",h.value),f.text(h.text),b||d.fire(c.FIRES.selected,h)},_hover:function(a,b){var c=this,d=this.get("el");d.all(".dropdown-item").removeClass(".dropdown-itemover"),a.addClass(".dropdown-itemover"),b&&a.scrollIntoView(d.one(".dropdown-list"))}}),a.augment(c,c.METHODS),c},{requires:["brix/core/brick"]});