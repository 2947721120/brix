KISSY.add("brix/gallery/calendar/index",function(a,b,c,d,e){function f(){f.superclass.constructor.apply(this,arguments);var b=this,c=b.get("popup"),d=a.one(b.get("trigger"));if(c&&d){var e=b.get("triggerType");a.each(e,function(a){d.on(a,function(a){a.preventDefault(),b.toggle()})})}}return f.Date=e,f.ATTRS={id:{getter:function(b){return b||(b="brix_calendar_"+a.guid(),this.__set("id",b)),b}},date:{value:new Date},selected:{value:null},startDay:{value:0},pages:{value:1},closable:{value:!1},rangeSelect:{value:!1},minDate:{value:!1},maxDate:{value:!1},multiSelect:{value:!1},multi:{value:null,setter:function(a){for(var b=0;b<a.length;b++)a[b]instanceof Date&&(a[b]=e.format(a[b],"isoDate"));return a}},navigator:{value:!0},popup:{value:!0},showTime:{value:!1},trigger:{value:!1},triggerType:{value:["click"]},disabled:{value:!1},range:{value:!1},rangeLinkage:{value:!0},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},notLimited:{value:!1},tmpl:{valueFn:function(){var a=this,b=a.get("id"),c='<div class="calendar-pages"></div><div bx-tmpl="calendar" bx-datakey="notLimited,multiSelect,showTime,'+b+'_op_html" class="calendar-operator">{{{'+b+"_op_html}}}</div>";return a.get("el")||(c='<div id="'+b+'" class="calendar">'+c+"</div>"),c}},autoRender:{value:!1}},f.FIRES={select:"select",monthChange:"monthChange",timeSelect:"timeSelect",rangeSelect:"rangeSelect",multiSelect:"multiSelect",show:"show",hide:"hide"},f.RENDERERS={op:{html:function(a){var b=a,c=b.get("notLimited"),d=b.get("showTime"),e=b.get("multiSelect"),f="";if(d||e)f+='<a class="btn btn-size25 btn-calendar-confirm">\u786e\u5b9a</a>';return c&&(f+='<a class="btn btn-size25 btn-calendar-notlimited">\u4e0d\u9650</a>'),f}}},f.DOCEVENTS={"":{click:function(b){var c=this,d=c.get("el"),e=a.one(b.target),f=a.one(c.get("trigger"));!d.equals(e)&&!d.contains(e)&&f&&e[0]!=f[0]&&c.hide()}}},f.EVENTS={".btn-calendar-confirm":{click:function(b){var c=this,d=c.get("selected"),g=c.get("showTime"),h=c.get("multiSelect");if(h){var i=a.clone(c.get("multi"));i.sort(function(a,b){return a>b?1:-1});for(var j=0;j<i.length;j++)i[j]=e.parse(i[j]);a.log(i),c.fire(f.FIRES.multiSelect,{multi:i})}else if(g){var k=new Date;d&&(k=d);var l=c.pageBricks[0].timeBrick.get("time");k.setHours(l.getHours()),k.setMinutes(l.getMinutes()),k.setSeconds(l.getSeconds()),a.log(k),c.fire(f.FIRES.timeSelect,{date:k})}c.hide()}},".btn-calendar-notlimited":{click:function(a){var b=this,c=b.get("notLimited");c&&(b.fire(f.FIRES.select,{date:null}),b.hide())}}},f.METHODS={show:function(){var b=this;b.get("rendered")||b.render();if(b.overlay){var c=a.clone(b.get("align"));c.node||(c.node=b.get("trigger")),b.overlay.set("align",c),b.overlay.show(),b.fire(f.FIRES.show)}},hide:function(){var a=this;a.overlay&&(a.overlay.hide(),a.fire(f.FIRES.hide))},toggle:function(){var a=this;a.overlay?a.overlay.get("el").css("visibility")=="hidden"?a.show():a.hide():a.show()}},a.extend(f,b,{initialize:function(){var b=this,e=b.get("popup"),g=b.get("closable"),h=b.get("pages"),i=b.get("rangeLinkage"),j=b.get("el"),k=b.get("date"),l=k.getMonth(),m=k.getFullYear(),n=b.get("trigger");if(e){var o=a.clone(b.get("align"));o.node||(o.node=n),b.overlay=new c({srcNode:b.get("el"),align:o}),b.overlay.render()}else j.css({position:"static",visibility:"visible"});var p=j.one(".calendar-pages");b.pageBricks=[],j.addClass(".calendar-"+h);var q,r;for(var s=0;s<h;s++)i?(q=s==0,r=s==h-1):(q=!0,r=!0),function(a){var c=new d({id:b.get("id")+"page"+a,el:"#"+b.get("id")+"page"+a,index:a,prev:q,next:r,year:m,month:l,father:b,container:p});b.pageBricks.push(c),c.on("itemClick",function(a){var c=b.get("rangeSelect");c?b._handleRange(a.date):a.date&&(b.set("selected",a.date),b.fire(f.FIRES.select,{date:a.date}),e&&g&&!b.get("showTime")&&b.hide())}),c.on("itemMouseDown",function(a){var c=b.get("multiSelect");c&&b._handleMultiSelectStart(a.date)}),c.on("itemMouseUp",function(a){var c=b.get("multiSelect");c&&b._handleMultiSelectEnd(a.date)}),c.on("monthChange",function(a){b._bindDateValueChange(a.date,a.index)})}(s),l==11?(m++,l=0):l++;b._bindDataChange("range"),b._bindDataChange("multi"),b._bindDataChange("disabled"),b._bindDataChange("minDate"),b._bindDataChange("maxDate"),b._bindDataChange("selected"),b._bindDataChange("startDay"),b.on("afterDateChange",function(){b._bindDateValueChange(b.get("date"))})},destructor:function(){var a=this;a.overlay&&a.overlay.destroy()},_bindDataChange:function(a,b){var c=this,b=a.replace(/\b(\w)|\s(\w)/g,function(a){return a.toUpperCase()});c.on("after"+b+"Change",function(){var b=c.get(a);for(var d=0;d<c.pageBricks.length;d++)c.pageBricks[d].setChunkData(a,b)})},_bindDateValueChange:function(a,b){b=b||0;var c=this,d=c.get("rangeLinkage"),e=a.getFullYear(),g=a.getMonth();if(d){for(var h=0;h<c.pageBricks.length;h++){var i=g-b+h,j=e;i<0?(j--,i+=12):i>11&&(j++,i-=12),c.pageBricks[h].set("year",j),c.pageBricks[h].set("month",i)}var k=e,l=g-b;l<0&&(k--,l+=12),c.fire(f.FIRES.monthChange,{date:new Date(k,l,1)})}else c.pageBricks[b].set("year",e),c.pageBricks[b].set("month",g),c.fire(f.FIRES.monthChange,{date:new Date(e,g,1)})},_handleRange:function(b){var c=this,d=a.clone(c.get("range"))||{},e;if(!d.start&&!d.end||d.start&&d.end)d.start=b,d.end=null,c.set("range",d);else{d.end=b,d.start.getTime()>d.end.getTime()&&(e=d.start,d.start=d.end,d.end=e),c.set("range",d),c.fire(f.FIRES.rangeSelect,d);var g=c.get("popup"),h=c.get("closable");g&&h&&c.hide()}},_handleMultiSelectStart:function(a){this.multiStartDate=a},_handleMultiSelectEnd:function(b){if(this.multiStartDate){var c=this,d=a.clone(c.get("multi"))||[],f=c.multiStartDate,g,h=c.get("minDate"),i=c.get("maxDate"),j=c.get("disabled");b<f?(g=f,f=b):g=b;while(f<=g){if(e.isDisabled(j,f))continue;var k=e.format(f,"isoDate");a.inArray(k,d)?d.splice(a.indexOf(k,d),1):d.push(k),f.setDate(f.getDate()+1)}delete c.multiStartDate,c.set("multi",d)}}}),a.augment(f,f.METHODS),f},{requires:["brix/core/brick","overlay","./page","./date"]}),KISSY.add("brix/gallery/calendar/date",function(a){function b(a,b){var c=null;b=b||"-";if(a instanceof Date)return a;c=new Date(a);if(c instanceof Date&&c!="Invalid Date"&&!isNaN(c))return c;var d=a.toString().split(b);if(d.length==3){c=new Date(d[0],parseInt(d[1],10)-1,d[2]);if(c instanceof Date&&c!="Invalid Date"&&!isNaN(c))return c}return null}var c=function(){var a=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,e=function(a,b){a=String(a),b=b||2;while(a.length<b)a="0"+a;return a},f={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},g={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(h,i,j){arguments.length==1&&Object.prototype.toString.call(h)=="[object String]"&&!/\d/.test(h)&&(i=h,h=undefined),h=h?b(h):new Date;if(isNaN(h))throw SyntaxError("invalid date");i=String(f[i]||i||f["default"]),i.slice(0,4)=="UTC:"&&(i=i.slice(4),j=!0);var k=j?"getUTC":"get",l=h[k+"Date"](),m=h[k+"Day"](),n=h[k+"Month"](),o=h[k+"FullYear"](),p=h[k+"Hours"](),q=h[k+"Minutes"](),r=h[k+"Seconds"](),s=h[k+"Milliseconds"](),t=j?0:h.getTimezoneOffset(),u={d:l,dd:e(l,undefined),ddd:g.dayNames[m],dddd:g.dayNames[m+7],w:g.dayNames[m+14],m:n+1,mm:e(n+1,undefined),mmm:g.monthNames[n],mmmm:g.monthNames[n+12],yy:String(o).slice(2),yyyy:o,h:p%12||12,hh:e(p%12||12,undefined),H:p,HH:e(p,undefined),M:q,MM:e(q,undefined),s:r,ss:e(r,undefined),l:e(s,3),L:e(s>99?Math.round(s/10):s,undefined),t:p<12?"a":"p",tt:p<12?"am":"pm",T:p<12?"A":"P",TT:p<12?"AM":"PM",Z:j?"UTC":(String(h).match(c)||[""]).pop().replace(d,""),o:(t>0?"-":"+")+e(Math.floor(Math.abs(t)/60)*100+Math.abs(t)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return i.replace(a,function(a){return a in u?u[a]:a.slice(1,a.length-1)})}}();return{format:function(a,b,d){return c(a,b,d)},parse:function(a,c){return b(a,c)},isMinMax:function(a,b,d){d=c(d,"isoDate");if(a){a=Brix_Date.format(a,"isoDate");if(a>d)return!1}if(b){b=Brix_Date.format(b,"isoDate");if(b<d)return!1}return!0},isDisabled:function(a,b){b=c(b,"isoDate");if(a)for(var d=0;d<a.length;d++)if(c(a[d],"isoDate")==b)return!0;return!1},isInMulit:function(a,b){b=c(b,"isoDate");if(a)for(var d=0;d<a.length;d++)if(c(a[d],"isoDate")==b)return!0;return!1},isInRang:function(a,b){b=c(b,"isoDate");if(a)if(a.start&&a.end){if(b>=c(a.start,"isoDate")&&b<=c(a.end,"isoDate"))return!0}else if(a.start&&b==c(a.start,"isoDate"))return!0;return!1},isYear:function(a){return/^\d+$/i.test(a)?(a=Number(a),!(a<100||a>1e4)):!1}}}),KISSY.add("brix/gallery/calendar/page",function(a,b,c,d){function f(a){var b=[];for(var c=0;c<7;c++)b[c]=e[(c+a)%7];return b}function g(a,b){return 32-(new Date(a,b,32)).getDate()}function h(){h.superclass.constructor.apply(this,arguments)}var e=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];return h.ATTRS={father:{value:!1},index:{value:0},year:{value:2012},month:{value:7},prev:{value:!0},next:{value:!0},autoRender:{value:!0},tmpl:{valueFn:function(){var a=this,b=a.get("id");return'<div id="'+b+'" bx-name="page" class="calendar-page">'+'<div class="calendar-page-hd">'+'<div bx-tmpl="page" bx-datakey="prev">'+"{{#prev}}"+'<a href="javascript:void(0);" class="calendar-prev-year"><i class="iconfont">&#403</i><i class="iconfont icon-yp">&#403</i></a>'+'<a href="javascript:void(0);" class="calendar-prev-month"><i class="iconfont">&#403</i></a>'+"{{/prev}}"+"</div>"+'<a bx-tmpl="page" bx-datakey="year,month" href="javascript:void(0);" class="calendar-year-month">{{year}}\u5e74{{month}}\u6708</a>'+'<div bx-tmpl="page" bx-datakey="next">'+"{{#next}}"+'<a href="javascript:void(0);" class="calendar-next-month "><i class="iconfont">&#402</i></a>'+'<a href="javascript:void(0);" class="calendar-next-year "><i class="iconfont icon-yn">&#402</i><i class="iconfont">&#402</i></a>'+"{{/next}}"+"</div>"+'<div class="calendar-year-month-pupop" >'+'<p bx-tmpl="page" bx-datakey="month,'+b+'_select_html">{{{'+b+"_select_html}}}</p>"+'<p bx-tmpl="page" bx-datakey="year">\u5e74:<input type="text" value="{{year}}" onfocus="this.select()"></p>'+'<p><a class="btn btn-size25 btn-pupop-confirm">\u786e\u5b9a</a><a class="btn-pupop-cancel" href="#">\u53d6\u6d88</a></p>'+"</div>"+"</div>"+'<div bx-tmpl="page" bx-datakey="startDay,'+b+'_days_html" class="calendar-page-wbd">'+"{{{"+b+"_days_html}}}"+"</div>"+'<div class="calendar-page-dbd" bx-tmpl="page" bx-datakey="startDay,year,month,selected,range,multi,disabled,minDate,maxDate,'+b+'_da_html">'+"{{{"+b+"_da_html}}}"+"</div>"+'<div class="calendar-page-fd">'+"</div>"+"</div>"}},data:{valueFn:function(){var a=this,b=a.get("father"),c=a.get("year"),d=a.get("month"),e=a.get("prev"),f=a.get("next");return{prev:e,next:f,month:d+1,year:c}}}},h.RENDERERS={da:{html:function(a){var b=a,c=b.get("father"),e=b.get("year"),f=b.get("month"),h=c.get("selected"),i=c.get("minDate"),j=c.get("maxDate"),k=c.get("disabled"),l=c.get("multi"),m=c.get("range"),n=(7-c.get("startDay")+(new Date(e,f,1)).getDay())%7,o=g(e,f),p=d.format(new Date,"isoDate"),q="";h&&(h=d.format(h,"isoDate")),i&&(i=d.format(i,"isoDate")),j&&(j=d.format(j,"isoDate"));for(var r=0;r<n;r++)q+='<a href="javascript:void(0);" class="calendar-hidden">0</a>';for(var r=1;r<=o;r++){var s='class="calendar-item',t=d.format(new Date(e,f,r),"isoDate");t<i||t>j||d.isDisabled(k,t)?s+=" calendar-disabled":d.isInRang(m,t)?s+=" calendar-range":h==t?s+=" calendar-selected":d.isInMulit(l,t)&&(s+=" calendar-multi"),p==t&&(s+=" calendar-today"),q+="<a "+s+'" href="javascript:void(0);">'+r+"</a>"}return q}},select:{html:function(a){var b="\u6708:<select>";for(var c=1;c<=12;c++)b+="<option"+(c==this.month?" selected":"")+' value="'+(c-1)+'">'+(c<10?"0"+c:c)+"</option>";return b+="</select>",b}},days:{html:function(b){var c=b.get("father"),d=f(c.get("startDay")),e="";return a.each(d,function(a){e+="<span>"+a+"</span>"}),e}}},h.EVENTS={".calendar-prev-year":{click:function(a){var b=this,c=b.get("year"),d=b.get("month"),e=b.get("index");c--,date=new Date(c,d,1),b.fire(h.FIRES.monthChange,{date:date,index:e})}},".calendar-prev-month":{click:function(a){var b=this,c=b.get("year"),d=b.get("month"),e=b.get("index");d--,d<0&&(c--,d+=12),date=new Date(c,d,1),b.fire(h.FIRES.monthChange,{date:date,index:e})}},".calendar-next-year":{click:function(a){var b=this,c=b.get("year"),d=b.get("month"),e=b.get("index");c++,date=new Date(c,d,1),b.fire(h.FIRES.monthChange,{date:date,index:e})}},".calendar-next-month":{click:function(a){var b=this,c=b.get("year"),d=b.get("month"),e=b.get("index");d++,d>11&&(c++,d-=12),date=new Date(c,d,1),b.fire(h.FIRES.monthChange,{date:date,index:e})}},".calendar-year-month":{click:function(a){var b=this,c=b.get("father").get("navigator");c&&(popupNode=b.get("el").one(".calendar-year-month-pupop").show())}},".btn-pupop-confirm":{click:function(a){a.halt();var b=this,c=b.get("index");popupNode=b.get("el").one(".calendar-year-month-pupop"),year=popupNode.one("input").val(),month=popupNode.one("select").val();if(d.isYear(year)){year=Number(year),month=Number(month);var e=new Date(year,month,1);popupNode.hide(),b.fire(h.FIRES.monthChange,{date:e,index:c})}}},".btn-pupop-cancel":{click:function(a){a.halt();var b=this,c=b.get("el").one(".calendar-year-month-pupop");c.hide()}},".calendar-item":{click:function(b){b.halt();var c=this,d=a.one(b.currentTarget);if(!d.hasClass("calendar-disabled")){var e=!1;if(!d.hasClass("calendar-selected")){var f=c.get("year"),g=c.get("month");e=new Date(f,g,Number(d.html()));if(c.timeBrick){var i=c.timeBrick.get("time");e.setHours(i.getHours()),e.setMinutes(i.getMinutes()),e.setSeconds(i.getSeconds())}}c.fire(h.FIRES.itemClick,{date:e})}},mousedown:function(b){b.halt();var c=this,d=a.one(b.currentTarget);if(!d.hasClass("calendar-disabled")){var e=c.get("year"),f=c.get("month"),g=new Date(e,f,Number(d.html()));c.fire(h.FIRES.itemMouseDown,{date:g})}},mouseup:function(b){b.halt();var c=this,d=a.one(b.currentTarget);if(!d.hasClass("calendar-disabled")){var e=c.get("year"),f=c.get("month"),g=new Date(e,f,Number(d.html()));c.fire(h.FIRES.itemMouseUp,{date:g})}}}},h.METHODS={},h.FIRES={itemClick:"itemClick",itemMouseDown:"itemMouseDown",itemMouseUp:"itemMouseUp",monthChange:"monthChange"},a.extend(h,b,{initialize:function(){var a=this,b=a.get("el"),d=a.get("father"),e=d.get("showTime");e&&(a.timeBrick=new c({container:b.one(".calendar-page-fd")})),a.on("afterYearChange",function(){a.setChunkData("year",a.get("year"))}),a.on("afterMonthChange",function(){a.setChunkData("month",a.get("month")+1)})},destructor:function(){var a=this;a.timeBrick&&a.timeBrick.destroy()}}),a.augment(h,h.METHODS),h},{requires:["brix/core/brick","./time","./date"]}),KISSY.add("brix/gallery/calendar/time",function(a,b){function d(){d.superclass.constructor.apply(this,arguments)}var c={h:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],m:["00","10","20","30","40","50"],s:["00","10","20","30","40","50"]};return d.ATTRS={time:{value:new Date},status:{value:"s"},autoRender:{value:!0},tmpl:{value:'<div bx-name="time"><div class="calendar-time">\u65f6\u95f4\uff1a<span class="h">{{h}}</span>:<span class="m">{{m}}</span>:<span class="s">{{s}}</span><div class="calendar-time-updown"><i class="iconfont u">&#456</i><i class="iconfont d">&#459</i></div></div><div class="calendar-time-popup"><div bx-tmpl="time" bx-datakey="list" class="calendar-time-popup-bd">{{#list}}<a class="item">{{.}}</a>{{/list}}</div><i class="iconfont icon-close">&#223</i></div></div>'},data:{valueFn:function(){var a=this,b=a.get("time");return{h:b.getHours(),m:b.getMinutes(),s:b.getSeconds()}}}},d.EVENTS={span:{click:function(b){var d=this,e=a.one(b.currentTarget);e.parent().all("span").removeClass("on"),e.addClass("on"),e.hasClass("h")?d.set("status","h"):e.hasClass("m")?d.set("status","m"):d.set("status","s");var f=d.get("status");d.setChunkData("list",c[f]),d.get("el").one(".calendar-time-popup").css({display:"block"})}},".icon-close":{click:function(a){var b=this;b._hideTimePopup()}},".item":{click:function(b){var c=this,d=a.one(b.currentTarget),e=c.get("status");c._setTime(e,d.html()),c._hideTimePopup()}},".u":{click:function(a){var b=this,c=b.get("status"),d=b._getTime(c);d++,b._setTime(c,d)}},".d":{click:function(a){var b=this,c=b.get("status"),d=b._getTime(c);d--,b._setTime(c,d)}},"":{keyup:function(a){var b=this,c=b.get("status"),d=b._getTime(c);if(a.keyCode==38||a.keyCode==37)a.preventDefault(),d++,b._setTime(c,d);if(a.keyCode==40||a.keyCode==39)a.preventDefault(),d--,b._setTime(c,d)}}},d.METHODS={},d.FIRES={timeSelect:"timeSelect"},a.extend(d,b,{initialize:function(){var a=this},_setTime:function(a,b){var c=this,d=c.get("time"),e=c.get("el");b=Number(b);switch(a){case"h":d.setHours(b);break;case"m":d.setMinutes(b);break;case"s":d.setSeconds(b)}e.one(".h").html(d.getHours()),e.one(".m").html(d.getMinutes()),e.one(".s").html(d.getSeconds())},_getTime:function(a){var b=this,c=b.get("time");switch(a){case"h":return c.getHours();case"m":return c.getMinutes();case"s":return c.getSeconds()}},_hideTimePopup:function(){var a=this,b=a.get("el");b.one(".calendar-time-popup").css({display:"none"})},destructor:function(){var a=this;a.overlay.destroy()}}),a.augment(d,d.METHODS),d},{requires:["brix/core/brick"]});