KISSY.add("brix/gallery/calendar/index",function(e,t,n,r,i){function s(){s.superclass.constructor.apply(this,arguments);var t=this,n=t.get("popup"),r=e.one(t.get("trigger"));if(n&&r){var i=t.get("triggerType");e.each(i,function(e){r.on(e,function(e){e.preventDefault(),t.toggle()})})}}return s.Date=i,s.ATTRS={date:{value:new Date},selected:{value:null},startDay:{value:0},pages:{value:1},closable:{value:!1},rangeSelect:{value:!1},minDate:{value:!1},maxDate:{value:!1},multiSelect:{value:!1},multi:{value:null,setter:function(e){for(var t=0;t<e.length;t++)e[t]instanceof Date&&(e[t]=i.format(e[t],"isoDate"));return e}},navigator:{value:!0},popup:{value:!0},showTime:{value:!1},trigger:{value:!1},triggerType:{value:["click"]},disabled:{value:!1},range:{value:!1},rangeLinkage:{value:!0},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},notLimited:{value:!1},tmpl:{valueFn:function(){var t=this,n=t.get("id")||"brix_calendar_"+e.guid();return'<div id="'+n+'" bx-name="calendar" class="calendar">'+'<div class="calendar-pages"></div>'+'<div bx-tmpl="calendar" bx-datakey="notLimited,multiSelect,showTime,'+n+'_op_html" class="calendar-operator">{{{'+n+"_op_html}}}</div>"+"</div>"}}},s.FIRES={select:"select",monthChange:"monthChange",timeSelect:"timeSelect",rangeSelect:"rangeSelect",multiSelect:"multiSelect",show:"show",hide:"hide"},s.RENDERER={op:{html:function(e){var t=e,n=t.get("notLimited"),r=t.get("showTime"),i=t.get("multiSelect"),s="";if(r||i)s+='<a class="btn btn-size25 btn-calendar-confirm">\u786e\u5b9a</a>';return n&&(s+='<a class="btn btn-size25 btn-calendar-notlimited">\u4e0d\u9650</a>'),s}}},s.DOCATTACH={"":{click:function(t){var n=this,r=n.get("el"),i=e.one(t.target),s=e.one(n.get("trigger"));!r.contains(i)&&s&&i[0]!=s[0]&&n.hide()}}},s.ATTACH={".btn-calendar-confirm":{click:function(t){var n=this,r=n.get("selected"),o=n.get("showTime"),u=n.get("multiSelect");if(u){var a=e.clone(n.get("multi"));a.sort(function(e,t){return e>t?1:-1});for(var f=0;f<a.length;f++)a[f]=i.parse(a[f]);e.log(a),n.fire(s.FIRES.multiSelect,{multi:a})}else if(o){var l=new Date;r&&(l=r);var c=n.pageBricks[0].timeBrick.get("time");l.setHours(c.getHours()),l.setMinutes(c.getMinutes()),l.setSeconds(c.getSeconds()),e.log(l),n.fire(s.FIRES.timeSelect,{date:l})}n.hide()}},".btn-calendar-notlimited":{click:function(e){var t=this,n=t.get("notLimited");n&&(t.fire(s.FIRES.select,{date:null}),t.hide())}}},s.METHOD={show:function(){var t=this;t.get("rendered")||t.render();if(t.overlay){var n=e.clone(t.get("align"));n.node||(n.node=t.get("trigger")),t.overlay.set("align",n),t.overlay.show(),t.fire(s.FIRES.show)}},hide:function(){var e=this;e.overlay&&(e.overlay.hide(),e.fire(s.FIRES.hide))},toggle:function(){var e=this;e.overlay?e.overlay.get("el").css("visibility")=="hidden"?e.show():e.hide():e.show()}},e.extend(s,t,{initialize:function(){var t=this,i=t.get("popup"),o=t.get("closable"),u=t.get("pages"),a=t.get("rangeLinkage"),f=t.get("el"),l=t.get("date"),c=l.getMonth(),h=l.getFullYear(),p=t.get("trigger");if(i){var d=e.clone(t.get("align"));d.node||(d.node=p),t.overlay=new n({srcNode:"#"+t.get("id"),align:d}),t.overlay.render()}else f.css({position:"static",visibility:"visible"});var v=f.one(".calendar-pages");t.pageBricks=[],f.addClass(".calendar-"+u);var m,g;for(var y=0;y<u;y++)a?(m=y==0,g=y==u-1):(m=!0,g=!0),function(e){var n=new r({id:t.get("id")+"page"+e,index:e,prev:m,next:g,year:h,month:c,father:t,container:v});t.pageBricks.push(n),n.on("itemClick",function(e){var n=t.get("rangeSelect");n?t._handleRange(e.date):e.date&&(t.set("selected",e.date),t.fire(s.FIRES.select,{date:e.date}),i&&o&&!t.get("showTime")&&t.hide())}),n.on("itemMouseDown",function(e){var n=t.get("multiSelect");n&&t._handleMultiSelectStart(e.date)}),n.on("itemMouseUp",function(e){var n=t.get("multiSelect");n&&t._handleMultiSelectEnd(e.date)}),n.on("monthChange",function(e){t._bindDateValueChange(e.date,e.index)})}(y),c==11?(h++,c=0):c++;t._bindDataChange("range"),t._bindDataChange("multi"),t._bindDataChange("disabled"),t._bindDataChange("minDate"),t._bindDataChange("maxDate"),t._bindDataChange("selected"),t._bindDataChange("startDay"),t.on("afterDateChange",function(){t._bindDateValueChange(t.get("date"))})},destructor:function(){var t=this;t.overlay?t.overlay.destroy():e.one(t.get("trigger")).empty()},_bindDataChange:function(e,t){var n=this,t=e.replace(/\b(\w)|\s(\w)/g,function(e){return e.toUpperCase()});n.on("after"+t+"Change",function(){var t=n.get(e);for(var r=0;r<n.pageBricks.length;r++)n.pageBricks[r].setChunkData(e,t)})},_bindDateValueChange:function(e,t){t=t||0;var n=this,r=n.get("rangeLinkage"),i=e.getFullYear(),o=e.getMonth();if(r){for(var u=0;u<n.pageBricks.length;u++){var a=o-t+u,f=i;a<0?(f--,a+=12):a>11&&(f++,a-=12),n.pageBricks[u].set("year",f),n.pageBricks[u].set("month",a)}var l=i,c=o-t;c<0&&(l--,c+=12),n.fire(s.FIRES.monthChange,{date:new Date(l,c,1)})}else n.pageBricks[t].set("year",i),n.pageBricks[t].set("month",o),n.fire(s.FIRES.monthChange,{date:new Date(i,o,1)})},_handleRange:function(t){var n=this,r=e.clone(n.get("range"))||{},i;if(!r.start&&!r.end||r.start&&r.end)r.start=t,r.end=null,n.set("range",r);else{r.end=t,r.start.getTime()>r.end.getTime()&&(i=r.start,r.start=r.end,r.end=i),n.set("range",r),n.fire("rangeSelect",r);var s=n.get("popup"),o=n.get("closable");s&&o&&n.hide()}},_handleMultiSelectStart:function(e){this.multiStartDate=e},_handleMultiSelectEnd:function(t){if(this.multiStartDate){var n=this,r=e.clone(n.get("multi"))||[],s=n.multiStartDate,o,u=n.get("minDate"),a=n.get("maxDate"),f=n.get("disabled");t<s?(o=s,s=t):o=t;while(s<=o){if(i.isDisabled(f,s))continue;var l=i.format(s,"isoDate");e.inArray(l,r)?r.splice(e.indexOf(l,r),1):r.push(l),s.setDate(s.getDate()+1)}delete n.multiStartDate,n.set("multi",r)}}}),e.augment(s,s.METHOD),s},{requires:["brix/core/brick","overlay","./page","./date"]}),KISSY.add("brix/gallery/calendar/date",function(e){function t(e,t){var n=null;t=t||"-";if(e instanceof Date)return e;n=new Date(e);if(n instanceof Date&&n!="Invalid Date"&&!isNaN(n))return n;var r=e.toString().split(t);if(r.length==3){n=new Date(r[0],parseInt(r[1],10)-1,r[2]);if(n instanceof Date&&n!="Invalid Date"&&!isNaN(n))return n}return null}var n=function(){var e=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,r=/[^-+\dA-Z]/g,i=function(e,t){e=String(e),t=t||2;while(e.length<t)e="0"+e;return e},s={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},o={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(u,a,f){arguments.length==1&&Object.prototype.toString.call(u)=="[object String]"&&!/\d/.test(u)&&(a=u,u=undefined),u=u?t(u):new Date;if(isNaN(u))throw SyntaxError("invalid date");a=String(s[a]||a||s["default"]),a.slice(0,4)=="UTC:"&&(a=a.slice(4),f=!0);var l=f?"getUTC":"get",c=u[l+"Date"](),h=u[l+"Day"](),p=u[l+"Month"](),d=u[l+"FullYear"](),v=u[l+"Hours"](),m=u[l+"Minutes"](),g=u[l+"Seconds"](),y=u[l+"Milliseconds"](),b=f?0:u.getTimezoneOffset(),w={d:c,dd:i(c,undefined),ddd:o.dayNames[h],dddd:o.dayNames[h+7],w:o.dayNames[h+14],m:p+1,mm:i(p+1,undefined),mmm:o.monthNames[p],mmmm:o.monthNames[p+12],yy:String(d).slice(2),yyyy:d,h:v%12||12,hh:i(v%12||12,undefined),H:v,HH:i(v,undefined),M:m,MM:i(m,undefined),s:g,ss:i(g,undefined),l:i(y,3),L:i(y>99?Math.round(y/10):y,undefined),t:v<12?"a":"p",tt:v<12?"am":"pm",T:v<12?"A":"P",TT:v<12?"AM":"PM",Z:f?"UTC":(String(u).match(n)||[""]).pop().replace(r,""),o:(b>0?"-":"+")+i(Math.floor(Math.abs(b)/60)*100+Math.abs(b)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return a.replace(e,function(e){return e in w?w[e]:e.slice(1,e.length-1)})}}();return{format:function(e,t,r){return n(e,t,r)},parse:function(e,n){return t(e,n)},isMinMax:function(e,t,r){r=n(r,"isoDate");if(e){e=Brix_Date.format(e,"isoDate");if(e>r)return!1}if(t){t=Brix_Date.format(t,"isoDate");if(t<r)return!1}return!0},isDisabled:function(e,t){t=n(t,"isoDate");if(e)for(var r=0;r<e.length;r++)if(n(e[r],"isoDate")==t)return!0;return!1},isInMulit:function(e,t){t=n(t,"isoDate");if(e)for(var r=0;r<e.length;r++)if(n(e[r],"isoDate")==t)return!0;return!1},isInRang:function(e,t){t=n(t,"isoDate");if(e)if(e.start&&e.end){if(t>=n(e.start,"isoDate")&&t<=n(e.end,"isoDate"))return!0}else if(e.start&&t==n(e.start,"isoDate"))return!0;return!1},isYear:function(e){return/^\d+$/i.test(e)?(e=Number(e),!(e<100||e>1e4)):!1}}}),KISSY.add("brix/gallery/calendar/page",function(e,t,n,r){function s(e){var t=[];for(var n=0;n<7;n++)t[n]=i[(n+e)%7];return t}function o(e,t){return 32-(new Date(e,t,32)).getDate()}function u(){u.superclass.constructor.apply(this,arguments)}var i=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];return u.ATTRS={father:{value:!1},index:{value:0},year:{value:2012},month:{value:7},prev:{value:!0},next:{value:!0},autoRender:{value:!0},tmpl:{valueFn:function(){var e=this,t=e.get("id");return'<div id="'+t+'" bx-name="page" class="calendar-page">'+'<div class="calendar-page-hd">'+'<div bx-tmpl="page" bx-datakey="prev">'+"{{#prev}}"+'<a href="javascript:void(0);" class="calendar-prev-year"><i class="iconfont">&#403</i><i class="iconfont icon-yp">&#403</i></a>'+'<a href="javascript:void(0);" class="calendar-prev-month"><i class="iconfont">&#403</i></a>'+"{{/prev}}"+"</div>"+'<a bx-tmpl="page" bx-datakey="year,month" href="javascript:void(0);" class="calendar-year-month">{{year}}\u5e74{{month}}\u6708</a>'+'<div bx-tmpl="page" bx-datakey="next">'+"{{#next}}"+'<a href="javascript:void(0);" class="calendar-next-month "><i class="iconfont">&#402</i></a>'+'<a href="javascript:void(0);" class="calendar-next-year "><i class="iconfont icon-yn">&#402</i><i class="iconfont">&#402</i></a>'+"{{/next}}"+"</div>"+'<div class="calendar-year-month-pupop" >'+'<p bx-tmpl="page" bx-datakey="month,'+t+'_select_html">{{{'+t+"_select_html}}}</p>"+'<p bx-tmpl="page" bx-datakey="year">\u5e74:<input type="text" value="{{year}}" onfocus="this.select()"></p>'+'<p><a class="btn btn-size25 btn-pupop-confirm">\u786e\u5b9a</a><a class="btn-pupop-cancel" href="#">\u53d6\u6d88</a></p>'+"</div>"+"</div>"+'<div bx-tmpl="page" bx-datakey="startDay,'+t+'_days_html" class="calendar-page-wbd">'+"{{{"+t+"_days_html}}}"+"</div>"+'<div class="calendar-page-dbd" bx-tmpl="page" bx-datakey="startDay,year,month,selected,range,multi,disabled,minDate,maxDate,'+t+'_da_html">'+"{{{"+t+"_da_html}}}"+"</div>"+'<div class="calendar-page-fd">'+"</div>"+"</div>"}},data:{valueFn:function(){var e=this,t=e.get("father"),n=e.get("year"),r=e.get("month"),i=e.get("prev"),s=e.get("next");return{prev:i,next:s,month:r+1,year:n}}}},u.RENDERER={da:{html:function(e){var t=e,n=t.get("father"),i=t.get("year"),s=t.get("month"),u=n.get("selected"),a=n.get("minDate"),f=n.get("maxDate"),l=n.get("disabled"),c=n.get("multi"),h=n.get("range"),p=(7-n.get("startDay")+(new Date(i,s,1)).getDay())%7,d=o(i,s),v=r.format(new Date,"isoDate"),m="";u&&(u=r.format(u,"isoDate")),a&&(a=r.format(a,"isoDate")),f&&(f=r.format(f,"isoDate"));for(var g=0;g<p;g++)m+='<a href="javascript:void(0);" class="calendar-hidden">0</a>';for(var g=1;g<=d;g++){var y='class="calendar-item',b=r.format(new Date(i,s,g),"isoDate");b<a||b>f||r.isDisabled(l,b)?y+=" calendar-disabled":r.isInRang(h,b)?y+=" calendar-range":u==b?y+=" calendar-selected":r.isInMulit(c,b)&&(y+=" calendar-multi"),v==b&&(y+=" calendar-today"),m+="<a "+y+'" href="javascript:void(0);">'+g+"</a>"}return m}},select:{html:function(e){var t="\u6708:<select>";for(var n=1;n<=12;n++)t+="<option"+(n==this.month?" selected":"")+' value="'+(n-1)+'">'+(n<10?"0"+n:n)+"</option>";return t+="</select>",t}},days:{html:function(t){var n=t.get("father"),r=s(n.get("startDay")),i="";return e.each(r,function(e){i+="<span>"+e+"</span>"}),i}}},u.ATTACH={".calendar-prev-year":{click:function(e){var t=this,n=t.get("year"),r=t.get("month"),i=t.get("index");n--,date=new Date(n,r,1),t.fire(u.FIRES.monthChange,{date:date,index:i})}},".calendar-prev-month":{click:function(e){var t=this,n=t.get("year"),r=t.get("month"),i=t.get("index");r--,r<0&&(n--,r+=12),date=new Date(n,r,1),t.fire(u.FIRES.monthChange,{date:date,index:i})}},".calendar-next-year":{click:function(e){var t=this,n=t.get("year"),r=t.get("month"),i=t.get("index");n++,date=new Date(n,r,1),t.fire(u.FIRES.monthChange,{date:date,index:i})}},".calendar-next-month":{click:function(e){var t=this,n=t.get("year"),r=t.get("month"),i=t.get("index");r++,r>11&&(n++,r-=12),date=new Date(n,r,1),t.fire(u.FIRES.monthChange,{date:date,index:i})}},".calendar-year-month":{click:function(e){var t=this,n=t.get("father").get("navigator");n&&(popupNode=t.get("el").one(".calendar-year-month-pupop").show())}},".btn-pupop-confirm":{click:function(e){e.halt();var t=this,n=t.get("index");popupNode=t.get("el").one(".calendar-year-month-pupop"),year=popupNode.one("input").val(),month=popupNode.one("select").val();if(r.isYear(year)){year=Number(year),month=Number(month);var i=new Date(year,month,1);popupNode.hide(),t.fire(u.FIRES.monthChange,{date:i,index:n})}}},".btn-pupop-cancel":{click:function(e){e.halt();var t=this,n=t.get("el").one(".calendar-year-month-pupop");n.hide()}},".calendar-item":{click:function(t){t.halt();var n=this,r=e.one(t.currentTarget);if(!r.hasClass("calendar-disabled")){var i=!1;if(!r.hasClass("calendar-selected")){var s=n.get("year"),o=n.get("month");i=new Date(s,o,Number(r.html()));if(n.timeBrick){var a=n.timeBrick.get("time");i.setHours(a.getHours()),i.setMinutes(a.getMinutes()),i.setSeconds(a.getSeconds())}}n.fire(u.FIRES.itemClick,{date:i})}},mousedown:function(t){t.halt();var n=this,r=e.one(t.currentTarget);if(!r.hasClass("calendar-disabled")){var i=n.get("year"),s=n.get("month"),o=new Date(i,s,Number(r.html()));n.fire(u.FIRES.itemMouseDown,{date:o})}},mouseup:function(t){t.halt();var n=this,r=e.one(t.currentTarget);if(!r.hasClass("calendar-disabled")){var i=n.get("year"),s=n.get("month"),o=new Date(i,s,Number(r.html()));n.fire(u.FIRES.itemMouseUp,{date:o})}}}},u.METHOD={},u.FIRES={itemClick:"itemClick",itemMouseDown:"itemMouseDown",itemMouseUp:"itemMouseUp",monthChange:"monthChange"},e.extend(u,t,{initialize:function(){var e=this,t=e.get("el"),r=e.get("father"),i=r.get("showTime");i&&(e.timeBrick=new n({container:t.one(".calendar-page-fd")})),e.on("afterYearChange",function(){e.setChunkData("year",e.get("year"))}),e.on("afterMonthChange",function(){e.setChunkData("month",e.get("month")+1)})},destructor:function(){var e=this;e.timeBrick&&e.timeBrick.destroy()}}),e.augment(u,u.METHOD),u},{requires:["brix/core/brick","./time","./date"]}),KISSY.add("brix/gallery/calendar/time",function(e,t){function r(){r.superclass.constructor.apply(this,arguments)}var n={h:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],m:["00","10","20","30","40","50"],s:["00","10","20","30","40","50"]};return r.ATTRS={time:{value:new Date},status:{value:"s"},autoRender:{value:!0},tmpl:{value:'<div bx-name="time" class="calendar-time">\u65f6\u95f4\uff1a<span class="h">{{h}}</span>:<span class="m">{{m}}</span>:<span class="s">{{s}}</span><div class="calendar-time-updown"><i class="iconfont u">&#456</i><i class="iconfont d">&#459</i></div></div><div class="calendar-time-popup"><div bx-tmpl="time" bx-datakey="list" class="calendar-time-popup-bd">{{#list}}<a class="item">{{.}}</a>{{/list}}</div><i class="iconfont icon-close">&#223</i></div>'},data:{valueFn:function(){var e=this,t=e.get("time");return{h:t.getHours(),m:t.getMinutes(),s:t.getSeconds()}}}},r.ATTACH={span:{click:function(t){var r=this,i=e.one(t.currentTarget);i.parent().all("span").removeClass("on"),i.addClass("on"),i.hasClass("h")?r.set("status","h"):i.hasClass("m")?r.set("status","m"):r.set("status","s");var s=r.get("status");r.setChunkData("list",n[s]),r.get("el").one(".calendar-time-popup").css({display:"block"})}},".icon-close":{click:function(e){var t=this;t._hideTimePopup()}},".item":{click:function(t){var n=this,r=e.one(t.currentTarget),i=n.get("status");n._setTime(i,r.html()),n._hideTimePopup()}},".u":{click:function(e){var t=this,n=t.get("status"),r=t._getTime(n);r++,t._setTime(n,r)}},".d":{click:function(e){var t=this,n=t.get("status"),r=t._getTime(n);r--,t._setTime(n,r)}},"":{keyup:function(e){var t=this,n=t.get("status"),r=t._getTime(n);if(e.keyCode==38||e.keyCode==37)e.preventDefault(),r++,t._setTime(n,r);if(e.keyCode==40||e.keyCode==39)e.preventDefault(),r--,t._setTime(n,r)}}},r.METHOD={},r.FIRES={timeSelect:"timeSelect"},e.extend(r,t,{initialize:function(){var e=this},_setTime:function(e,t){var n=this,r=n.get("time"),i=n.get("el");t=Number(t);switch(e){case"h":r.setHours(t);break;case"m":r.setMinutes(t);break;case"s":r.setSeconds(t)}i.one(".h").html(r.getHours()),i.one(".m").html(r.getMinutes()),i.one(".s").html(r.getSeconds())},_getTime:function(e){var t=this,n=t.get("time");switch(e){case"h":return n.getHours();case"m":return n.getMinutes();case"s":return n.getSeconds()}},_hideTimePopup:function(){var e=this,t=e.get("el");t.one(".calendar-time-popup").css({display:"none"})},destructor:function(){var e=this;e.overlay.destroy()}}),e.augment(r,r.METHOD),r},{requires:["brix/core/brick"]});