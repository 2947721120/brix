KISSY.add("brix/gallery/sidenav/index",function(e,t,n){var r=e.all,i=function(){i.superclass.constructor.apply(this,arguments),this.init()};return i.ATTRS={el:{value:""},index:{value:"#!/home/"},duration:{value:.25},pathMap:{value:{"#!/adzone/adzone_detail/":"#!/adzone/adzone/","#!/plan/handle/":"#!/plan/list/","#!/plan/price_handle/":"#!/plan/list/","#!/messages/list/":"","#!/messages/detail/":"","#!/components/":""}}},e.extend(i,t,{init:function(){this.sidebar=e.one("#sidebar"),this.main=e.one("#inmain"),this.allLinks=this.sidebar.all("a"),this.nav=e.one("#nav"),this.subNav=e.one("#subNav"),this.subNavWrap=e.one("#subNavWrap"),this.subNavHandle=e.one("#subNavHandle"),this.pathMap=this.get("pathMap"),this.subNavView=e.one('<div class="sub-nav-view"></div>').appendTo("body"),this.localStorage=window.localStorage,this.isFullSubNav=this.localStorage&&this.localStorage.isFullSubNav||"1",this.index=this.get("index"),this.duration=this.get("duration"),this.isHandleClick=!1,this.navTop=this.nav.offset().top,this._bindUI(),this._pathname2sidebar()},clickSwitch:function(t){e.one(t).fire("click")},_pathname2sidebar:function(){var t,n;e.each(this.pathMap,function(e,n){if(t===n)return t=e,!1});if(t===""){this._setNoSelectedNav();return}this.sidebar.all("a").each(function(e){var r=e.attr("href");if(n){if(r.indexOf("board.archivestatus")>-1)return e.fire("click"),!1}else{var i=r.match(/.*\//);if(!i)return!1;var s=i[0];if(s.slice(s.indexOf("#"))===t)return e.fire("click"),!1}}),this.isNavClick=!1},_setNoSelectedNav:function(){this.sidebar.all("a").removeClass("on"),this._collapseNav()},_bindUI:function(){var t=this;r(window).on("scroll",function(e){t._timer(function(){t._fixedStatic()},10)}).on("hashchange",function(){t.isNavClick||t._pathname2sidebar(),t.isNavClick=!1}),t.nav.delegate("click","a",function(n){var i=e.one(n.target);t.isHandleClick=!1,t._expandCollapseNav(i),t.nowNav=i,t.isNavClick=!0,r(window).scrollTop(0)}),t.subNav.delegate("click","a",function(n){var i=e.one(n.target).closest("a"),s=i.closest(".sub-nav-ul"),o=s.attr("data-sub");t.isHandleClick=!1,t.nowNav=t.nav.all("a[data-sub="+o+"]"),t.nowNav.fire("click"),t.currentSubNav=i.closest(".sub"),t._setSubNavOn(i),t.isNavClick=!0,r(window).scrollTop(0)}),t.subNavHandle.on("click",function(){t.isHandleClick=!0,t._expandCollapseSubNav()}),t.subNav.delegate("mouseenter",".sub",function(n){if(t.isFullSubNav!=="0")return;var r=e.one(n.target).closest(".sub"),i=r.offset();t.currentLi=r,t.subNavView.html(r.html()),t.subNavView.one(".sub-nav-third").css("height","auto"),t.subNavView.css(i)}),t.subNavView.on("mouseleave",function(e){t.subNavView.css("left","-10000px"),t.subNavView.one(".sub-nav-third").css("height",0),t.currentLi.html(t.subNavView.html())}),t.subNavView.delegate("click","a",function(n){var r=e.one(n.target).closest("a");t._setSubNavOn(r),t.currentSubNav=t.currentLi,t.isNavClick=!0})},_fixedStatic:function(t){var n=this,r=Math.max(document.body.scrollTop,document.documentElement.scrollTop),i=r>n.navTop;i?(n.sidebar.addClass("sidebar-fixed"),e.UA.ie===6&&n.sidebar.css({position:"absolute",top:r+10})):(n.sidebar.removeClass("sidebar-fixed"),e.UA.ie===6&&n.sidebar.css({position:"static"}))},_timer:function(e,t){clearTimeout(this.itv),this.itv=setTimeout(e,t)},_setSubNavOn:function(e){var t=e.closest(".sub-nav-third");this.subNav.all("a, .icon-font").removeClass("on"),this.subNavView.all("a, .icon-font").removeClass("on"),e.addClass("on"),this.isFullSubNav==="0"&&t&&t.prev().addClass("on")},_expandCollapseNav:function(e){var t=this,n=e.attr("data-sub"),r=e.attr("href"),i;r=r.slice(r.indexOf("#"));if(n){t.currentNav&&t.currentNav.hide(),t.currentNav=t.subNav.one('[data-sub="'+n+'"]'),t.currentNav.all("a").each(function(e){var t=e.attr("href");if(t.slice(t.indexOf("#"))===r)return i=e,!1});if(!i)return;t.currentSubNav=i,t._setSubNavOn(i),t.currentNav.show(),t._expandNav()}else t._collapseNav();t.nav.all("a").removeClass("on"),e.addClass("on")},_switchTrigger:function(){this.isFullSubNav==="1"?this.subNavHandle.replaceClass("icon-collapse","icon-expand"):this.isFullSubNav==="0"&&this.subNavHandle.replaceClass("icon-expand","icon-collapse")},_expandCollapseSubNav:function(){function i(){var e=this.isFullSubNav==="1";this.isFullSubNav=e?"0":"1",this.localStorage&&(this.localStorage.isFullSubNav=e?"0":"1")}var e=this,t=e.currentSubNav,n=t&&(t.prop("nodeName")==="LI"?t.one("ul"):t.closest("ul")),r=n&&n.hasClass("sub-nav-third");e.isFullSubNav==="0"?(i.call(e),e._expandSubNav(),e._switchTrigger(),r&&n.prev()&&n.prev().removeClass("on")):e.isFullSubNav==="1"&&(e._collapseSubNav(function(){i.call(e),e._switchTrigger()}),r&&n.prev()&&n.prev().addClass("on"))},_collapseSubNav:function(e){this.subNav.animate({width:"16px","padding-top":"42px"},this.duration,"easeOut",e),this.main.animate({"margin-left":"116px"},this.duration,"easeOut"),this._collapseThirdNav()},_expandSubNav:function(e){this.subNav.animate({width:"140px","padding-top":"0px"},this.duration,"easeOut",e),this.main.animate({"margin-left":"240px"},this.duration,"easeOut"),this._expandThirdNav(),this.subNavView.css("left","-10000px")},_expandThirdNav:function(t){var n=this;if(!n.nowNav)return;n.nowNav.attr("data-sub")===n.currentNav.attr("data-sub")&&!n.isHandleClick?e.all(".sub-nav-third").css("height","auto"):e.all(".sub-nav-third").each(function(e,r){var i=e.css("height","auto").height();e.css("height",0),e.animate({height:i},n.duration,"easeOut",t)})},_collapseThirdNav:function(t){e.all(".sub-nav-third").animate({height:0},this.duration,"easeOut",t)},_expandNav:function(e,t){this.subNav.show(),this.subNav.animate({width:this.isFullSubNav==="1"?"140px":"16px","padding-top":this.isFullSubNav==="1"?"0":"42px"},this.duration,"easeOut",t),this.subNavWrap.animate({"margin-left":"0"},this.duration,"easeOut",t),this.main.animate({"margin-left":this.isFullSubNav==="1"?"240px":"116px"},this.duration,"easeOut"),this.isFullSubNav==="1"?this._expandThirdNav():this._collapseThirdNav()},_collapseNav:function(e,t){var n=this;this.subNav.animate({width:"1px"},this.duration,"easeOut",function(){n.subNav.hide()}),this.subNavWrap.animate({"margin-left":this.isFullSubNav==="1"?"-140px":"-16px"},this.duration,"easeOut",t),this.main.animate({"margin-left":"100px"},this.duration,"easeOut")}}),i},{requires:["brix/core/brick","base","sizzle"]});