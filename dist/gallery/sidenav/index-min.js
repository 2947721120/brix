KISSY.add("brix/gallery/sidenav/index",function(a){var b=a.all,c=function(){c.superclass.constructor.apply(this,arguments)},c={init:function(b){this.sidebar=a.one("#sidebar"),this.main=a.one("#inmain"),this.allLinks=this.sidebar.all("a"),this.nav=a.one("#nav"),this.subNav=a.one("#subNav"),this.subNavWrap=a.one("#subNavWrap"),this.subNavHandle=a.one("#subNavHandle"),this.pathMap={"#!/adzone/adzone_detail/":"#!/adzone/adzone/","#!/plan/handle/":"#!/plan/list/","#!/plan/price_handle/":"#!/plan/list/","#!/messages/list/":"","#!/messages/detail/":"","#!/components/":""},this.subNavView=a.one('<div class="sub-nav-view"></div>').appendTo("body"),this.localStorage=window.localStorage,this.isFullSubNav=this.localStorage&&this.localStorage.isFullSubNav||"1",this.index=b&&b.index||"#!/home/",this.duration=b&&b.duration||.25,this.isHandleClick=!1,this.navTop=this.nav.offset().top,this._bindUI(),this._pathname2sidebar()},clickSwitch:function(b){a.one(b).fire("click")},_pathname2sidebar:function(){var b,c;a.each(this.pathMap,function(a,c){if(b===c)return b=a,!1});if(b===""){this._setNoSelectedNav();return}this.sidebar.all("a").each(function(a){var d=a.attr("href");if(c){if(d.indexOf("board.archivestatus")>-1)return a.fire("click"),!1}else{var e=d.match(/.*\//);if(!e)return!1;var f=e[0];if(f.slice(f.indexOf("#"))===b)return a.fire("click"),!1}}),this.isNavClick=!1},_setNoSelectedNav:function(){this.sidebar.all("a").removeClass("on"),this._collapseNav()},_bindUI:function(){var c=this;b(window).on("scroll",function(a){c._timer(function(){c._fixedStatic()},10)}).on("hashchange",function(){c.isNavClick||c._pathname2sidebar(),c.isNavClick=!1}),c.nav.delegate("click","a",function(d){var e=a.one(d.target);c.isHandleClick=!1,c._expandCollapseNav(e),c.nowNav=e,c.isNavClick=!0,b(window).scrollTop(0)}),c.subNav.delegate("click","a",function(d){var e=a.one(d.target).closest("a"),f=e.closest(".sub-nav-ul"),g=f.attr("data-sub");c.isHandleClick=!1,c.nowNav=c.nav.all("a[data-sub="+g+"]"),c.nowNav.fire("click"),c.currentSubNav=e.closest(".sub"),c._setSubNavOn(e),c.isNavClick=!0,b(window).scrollTop(0)}),c.subNavHandle.on("click",function(){c.isHandleClick=!0,c._expandCollapseSubNav()}),c.subNav.delegate("mouseenter",".sub",function(b){if(c.isFullSubNav!=="0")return;var d=a.one(b.target).closest(".sub"),e=d.offset();c.currentLi=d,c.subNavView.html(d.html()),c.subNavView.one(".sub-nav-third").css("height","auto"),c.subNavView.css(e)}),c.subNavView.on("mouseleave",function(a){c.subNavView.css("left","-10000px"),c.subNavView.one(".sub-nav-third").css("height",0),c.currentLi.html(c.subNavView.html())}),c.subNavView.delegate("click","a",function(b){var d=a.one(b.target).closest("a");c._setSubNavOn(d),c.currentSubNav=c.currentLi,c.isNavClick=!0})},_fixedStatic:function(b){var c=this,d=Math.max(document.body.scrollTop,document.documentElement.scrollTop),e=d>c.navTop;e?(c.sidebar.addClass("sidebar-fixed"),a.UA.ie===6&&c.sidebar.css({position:"absolute",top:d+10})):(c.sidebar.removeClass("sidebar-fixed"),a.UA.ie===6&&c.sidebar.css({position:"static"}))},_timer:function(a,b){clearTimeout(this.itv),this.itv=setTimeout(a,b)},_setSubNavOn:function(a){var b=a.closest(".sub-nav-third");this.subNav.all("a, .icon-font").removeClass("on"),this.subNavView.all("a, .icon-font").removeClass("on"),a.addClass("on"),this.isFullSubNav==="0"&&b&&b.prev().addClass("on")},_expandCollapseNav:function(a){var b=this,c=a.attr("data-sub"),d=a.attr("href"),e;d=d.slice(d.indexOf("#"));if(c){b.currentNav&&b.currentNav.hide(),b.currentNav=b.subNav.one('[data-sub="'+c+'"]'),b.currentNav.all("a").each(function(a){var b=a.attr("href");if(b.slice(b.indexOf("#"))===d)return e=a,!1});if(!e)return;b.currentSubNav=e,b._setSubNavOn(e),b.currentNav.show(),b._expandNav()}else b._collapseNav();b.nav.all("a").removeClass("on"),a.addClass("on")},_switchTrigger:function(){this.isFullSubNav==="1"?this.subNavHandle.replaceClass("icon-collapse","icon-expand"):this.isFullSubNav==="0"&&this.subNavHandle.replaceClass("icon-expand","icon-collapse")},_expandCollapseSubNav:function(){function e(){var a=this.isFullSubNav==="1";this.isFullSubNav=a?"0":"1",this.localStorage&&(this.localStorage.isFullSubNav=a?"0":"1")}var a=this,b=a.currentSubNav,c=b&&(b.prop("nodeName")==="LI"?b.one("ul"):b.closest("ul")),d=c&&c.hasClass("sub-nav-third");a.isFullSubNav==="0"?(e.call(a),a._expandSubNav(),a._switchTrigger(),d&&c.prev()&&c.prev().removeClass("on")):a.isFullSubNav==="1"&&(a._collapseSubNav(function(){e.call(a),a._switchTrigger()}),d&&c.prev()&&c.prev().addClass("on"))},_collapseSubNav:function(a){this.subNav.animate({width:"16px","padding-top":"42px"},this.duration,"easeOut",a),this.main.animate({"margin-left":"116px"},this.duration,"easeOut"),this._collapseThirdNav()},_expandSubNav:function(a){this.subNav.animate({width:"140px","padding-top":"0px"},this.duration,"easeOut",a),this.main.animate({"margin-left":"240px"},this.duration,"easeOut"),this._expandThirdNav(),this.subNavView.css("left","-10000px")},_expandThirdNav:function(b){var c=this;if(!c.nowNav)return;c.nowNav.attr("data-sub")===c.currentNav.attr("data-sub")&&!c.isHandleClick?a.all(".sub-nav-third").css("height","auto"):a.all(".sub-nav-third").each(function(a,d){var e=a.css("height","auto").height();a.css("height",0),a.animate({height:e},c.duration,"easeOut",b)})},_collapseThirdNav:function(b){a.all(".sub-nav-third").animate({height:0},this.duration,"easeOut",b)},_expandNav:function(a,b){this.subNav.show(),this.subNav.animate({width:this.isFullSubNav==="1"?"140px":"16px","padding-top":this.isFullSubNav==="1"?"0":"42px"},this.duration,"easeOut",b),this.subNavWrap.animate({"margin-left":"0"},this.duration,"easeOut",b),this.main.animate({"margin-left":this.isFullSubNav==="1"?"240px":"116px"},this.duration,"easeOut"),this.isFullSubNav==="1"?this._expandThirdNav():this._collapseThirdNav()},_collapseNav:function(a,b){var c=this;this.subNav.animate({width:"1px"},this.duration,"easeOut",function(){c.subNav.hide()}),this.subNavWrap.animate({"margin-left":this.isFullSubNav==="1"?"-140px":"-16px"},this.duration,"easeOut",b),this.main.animate({"margin-left":"100px"},this.duration,"easeOut")}};return c},{requires:["sizzle","brix/core/brick","node","template","./sidenav.css"]});