KISSY.add("brix/gallery/colorpicker/index",function(e,t,n,r){function s(e,t,n){e=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)e.setAttribute(r,t[r]);Object.prototype.toString.call(n)!="[object Array]"&&(n=[n]);var i=0,s=n[0]&&n.length||0;for(;i<s;i++)e.appendChild(n[i]);return e}function o(){o.superclass.constructor.apply(this,arguments);var t=this,n=e.one(t.get("trigger"));if(n){var r=t.get("triggerType");e.each(r,function(e){n.on(e,function(e){e.preventDefault(),t.toggle()})})}}var i=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";return o.ATTRS={min:{value:!1},trigger:{value:!1},triggerType:{value:["click"]},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},colorList:{value:["#d81e06","#f4ea2a","#1afa29","#1296db","#13227a","#d4237a","#ffffff","#e6e6e6","#dbdbdb","#cdcdcd","#bfbfbf","#8a8a8a","#707070","#515151","#2c2c2c","#000000","#ea986c","#eeb174","#f3ca7e","#f9f28b","#c8db8c","#aad08f","#87c38f","#83c6c2","#7dc5eb","#87a7d6","#8992c8","#a686ba","#bd8cbb","#be8dbd","#e89abe","#e8989a","#e16632","#e98f36","#efb336","#f6ef37","#afcd51","#7cba59","#36ab60","#1baba8","#17ace3","#3f81c1","#4f68b0","#594d9c","#82529d","#a4579d","#db649b","#dd6572","#d81e06","#e0620d","#ea9518","#f4ea2a","#8cbb1a","#2ba515","#0e932e","#0c9890","#1295db","#0061b2","#0061b0","#004198","#122179","#88147f","#d3227b","#d6204b"]},data:{valueFn:function(){return{colorList:this.get("colorList"),color:this.get("color"),min:this.get("min")}}},tmpl:{value:'<div class="colorpicker"><div class="colorpicker-hd"><ul>{{#colorList}}<li val="{{.}}" style="background-color:{{.}};"></li>{{/colorList}}</ul></div><div class="colorpicker-md"><i class="iconfont icon-arrow {{^min}}icon-arrow-up{{/min}}">{{#min}}&#405{{/min}}{{^min}}&#404{{/min}}</i></div><div class="colorpicker-bd {{#min}}colorpicker-bd-min{{/min}}"><div class="picker-wrapper"><div class="picker"></div><i class="iconfont icon-picker-indicator">&#470</i></div><div class="slide-wrapper"><div class="slide"></div><i class="iconfont icon-slide-indicator">&#461</i></div></div><div class="colorpicker-fd"><span class="bg" style="background-color:{{color}}"></span><input type="text" value="{{color}}"><a class="btn btn-size25 btn-confirm">\u786e\u5b9a</a></div></div>'},color:{value:"#ffffff"}},o.DOCATTACH={"":{click:function(t){var n=this,r=n.get("el"),i=e.one(t.target),s=e.one(n.get("trigger"));!r.contains(i)&&s&&i[0]!=s[0]&&n.hide()}}},o.ATTACH={".picker":{click:function(e){var t=this,n=t.pickerNode.offset(),r=e.pageX-n.left,i=e.pageY-n.top,s=t.pickerNode.width(),o=t.pickerNode.height(),u=r/s,a=(o-i)/o;t.setHsv({h:t.h,s:u,v:a})}},".slide":{click:function(e){var t=this,n=t.slideNode.offset(),r=t.slideNode.height(),i=e.pageY-n.top>=r?r-1:e.pageY-n.top,s=i/r*360;t.setHsv({h:s,s:t.s,v:t.v})}},".btn-confirm":{click:function(e){this._fireSelected()}},li:{click:function(t){var n=e.one(t.currentTarget).attr("val");this.setHex(n),e.one(t.currentTarget).addClass("selected")}},".icon-arrow":{click:function(t){var n=this,r=n.get("el").one(".colorpicker-bd"),i=e.one(t.currentTarget);r.stop(),i.hasClass("icon-arrow-up")?(i.removeClass("icon-arrow-up"),r.css("overflow","hidden"),r.animate({height:0,marginBottom:0},.3,"easyNone",function(){i.html("&#405")})):(i.addClass("icon-arrow-up"),r.animate({height:196,marginBottom:10},.3,"easyNone",function(){i.html("&#404"),r.css("overflow","visible")}))}},input:{blur:function(t){var n=this,r=e.one(t.currentTarget).val();n.get("color")!=r&&this.setHex(r)}}},o.FIRES={selected:"selected",show:"show",hide:"hide"},o.METHOD={show:function(){var t=this;t.get("rendered")||t.render();if(t.overlay){var n=e.clone(t.get("align"));n.node||(n.node=t.get("trigger")),t.overlay.set("align",n),t.overlay.show(),t.fire(o.FIRES.show)}},hide:function(){var e=this;e.overlay&&(e.overlay.hide(),e.fire(o.FIRES.hide))},toggle:function(){var e=this;e.overlay?e.overlay.get("el").css("visibility")=="hidden"?e.show():e.hide():e.show()},hsv2rgb:function(e,t,n){var r,i,s,o,u;e=e%360/60,u=n*t,o=u*(1-Math.abs(e%2-1)),r=i=s=n-u,e=~~e,r+=[u,o,0,0,o,u][e],i+=[o,u,u,o,0,0][e],s+=[0,0,o,u,u,o][e];var a=r*255,f=i*255,l=s*255;return{r:a,g:f,b:l,hex:"#"+(16777216|l|f<<8|a<<16).toString(16).slice(1)}},rgb2hsv:function(e,t,n){if(e>1||t>1||n>1)e/=255,t/=255,n/=255;var r,i,s,o;return s=Math.max(e,t,n),o=s-Math.min(e,t,n),r=o==0?null:s==e?(t-n)/o+(t<n?6:0):s==t?(n-e)/o+2:(e-t)/o+4,r=r%6*60,i=o==0?0:o/s,{h:r,s:i,v:s}},setColor:function(e,t,n){var r=this,i=r.get("el");r.h=e.h%360,r.s=e.s,r.v=e.v;var s=r.hsv2rgb(r.h,r.s,r.v);r.slideDragNode.css({top:Math.round(r.h*r.slideNode.height()/360-5)});var o=Math.round(r.s*r.pickerNode.width()-5),u=Math.round((1-r.v)*r.pickerNode.height()-5);r.pickerDragNode.css({left:o,top:u,color:u>98?"#fff":"#000"}),r.pickerNode.css({"background-color":r.hsv2rgb(r.h,1,1).hex}),i.one(".bg").css({"background-color":s.hex}),r.set("color",s.hex),i.all("li").removeClass("selected"),i.one("input").val(s.hex)},setHsv:function(e){this.setColor(e)},setRgb:function(e){this.setColor(this.rgb2hsv(e.r,e.g,e.b),e)},setHex:function(e){this.setColor(this.rgb2hsv(parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16)),undefined,e)}},e.extend(o,t,{initialize:function(){var e=this;this.h=0,this.s=this.v=1;var t=e.get("align");e.overlay=new n({srcNode:"#"+e.get("id"),align:t}),e.overlay.render();var o=e.get("el"),u=e.slideNode=o.one(".slide"),a=e.pickerNode=o.one(".picker");i=="SVG"?(u.append(s("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[s("defs",{},s("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[s("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),s("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),s("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),s("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),s("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),s("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),s("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),s("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),s("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),s("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})])),a.append(s("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[s("defs",{},[s("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[s("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),s("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),s("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[s("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),s("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),s("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),s("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})]))):(document.namespaces.v||document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),u.html(['<div style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></v:fill>',"</v:rect>","</div>"].join("")),a.html(['<div style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; left: -1px; top: -1px; width: 101%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>",'<v:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>","</div>"].join("")));var f=e.pickerDragNode=o.one(".icon-picker-indicator"),l=e.slideDragNode=o.one(".icon-slide-indicator"),c=new r.Draggable({node:f,cursor:"move"});c.on("drag",function(t){var n=a.offset(),r=a.width(),i=a.height(),s=t.left-n.left,o=t.top-n.top;s>r?s=r:s<0?s=0:s+=5,o>i?o=i:o<0?o=0:o+=5;var u=s/r,f=(i-o)/i;e.setHsv({h:e.h,s:u,v:f})});var p=new r.Draggable({node:l,cursor:"move"});p.on("drag",function(t){var n=u.offset(),r=u.height(),i=t.top-n.top;i+5>r?i=r-1:i<0?i=0:i+=5,h=i/e.slideNode.height()*360,e.setHsv({h:h,s:e.s,v:e.v})}),e.setHex(e.get("color"))},_fireSelected:function(){var e=this,t=e.hsv2rgb(e.h,e.s,e.v);e.overlay.hide(),e.fire(o.FIRES.selected,{hex:t.hex,hsv:{h:e.h,s:e.s,v:e.v},rgb:{r:t.r,g:t.g,b:t.b}})},destructor:function(){var e=this;e.overlay.destroy()}}),e.augment(o,o.METHOD),o},{requires:["brix/core/brick","overlay","dd"]});