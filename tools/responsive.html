<!doctype html>
<meta charset="utf-8">
<title>Responsive Layout Generator - Brix Style</title>
<link rel="stylesheet" href="../dist/brix-min.css">
<style>
    #r-panel {
        position: fixed;
        top: 0;
        right: 50px;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 2px;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        width: 160px;
        background: #fff;
    }
    #r-panel .control-label {
        width: 70px;
    }
    #r-panel .controls {
        margin-left: 80px;
    }
    #r-panel input {
        width: 60px;
    }
    #r-div,
    #r-div-proxy {
        width: 160px;
        height: 30px;
        cursor: move;
        background: #bbb;
    }
    #r-div-proxy {
        z-index: 1000;
    }

    html, body,
    #r-content {
        height: 100%;
    }
    #r-content {
        border-left: 1px dashed #ccc;
        border-right: 1px dashed #ccc;
        margin: 0 auto;
        width: 990px;
        background: #f0f0f0;
    }
    #r-content div {
        height: 40px;
        line-height: 40px;
        text-align: center;
    }
    #r-div-new {
        box-sizing: border-box;
        border: 2px dashed #ccc;
    }
    .r-div-selected {
        box-sizing: border-box;
        border: 2px dashed #ff8400;
    }
</style>
<div id="r-content"></div>
<div id="r-panel">
    <form class="form-horizontal">
        <div class="control-group">
            <label class="control-label" for="r-page-width">页面宽度</label>
            <div class="controls">
                <input id="r-page-width" value="990" />
            </div>
        </div>
        <div id="r-div">
            <div id="r-div-proxy"></div>
        </div>
        <div class="control-group">
            <label class="control-label" for="r-page-width">Module Id</label>
            <div class="controls">
                <input id="r-page-width" value="new-div" />
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="r-page-width">Module Width</label>
            <div class="controls">
                <input id="r-page-width" value="990" />
            </div>
        </div>
    </form>
</div>

<script src="http://a.tbcdn.cn/s/kissy/1.2.0/kissy.js"></script>
<script>
    function color() {
        var index = Math.floor(color.AVALIABLE.length * Math.random());
        var ret = color.AVALIABLE[index];

        color.LAST.push(ret);
        color.AVALIABLE.splice(index, 1);

        if (color.LAST.length > 3) {
            color.AVALIABLE.push( color.LAST.shift() );
        }

        return ret;
    }
    color.AVALIABLE = ['#ccc', '#bbb', '#aaa', '#999', '#888', '#777'];
    color.LAST = [];

    var rBody = document.getElementById('r-content');
    var divs = rBody.getElementsByTagName('div');
    for (var i=0; i<divs.length; i++) {
        if (!divs[i].id) continue;
        divs[i].style.backgroundColor = color();
    }
</script>
<script>
(function(S) {
    var rDrag = S.one('#r-div-proxy');
    var rContent = S.one('#r-content');
    var drag = {
        offset: {},
        newDiv: null
    };

    function mouseDown(e) {
        var offset = rDrag.offset();
        drag.offset.x = e.clientX - offset.left;
        drag.offset.y = e.clientY - offset.top;

        rDrag.prependTo(S.one('body'))
            .css({
                position: 'absolute',
                top: offset.top,
                left: offset.left
            });

        // 注意要绑定到document才可以保证事件在整个窗口文档中都有效，
        // 如果只绑定到拖放对象就很容易出现拖太快脱节的现象.
        S.Event.on(document, 'mousemove', mouseMove);
        S.Event.on(document, 'mouseup', mouseUp);

        // 可以避免cursor变成text，user-select:none 不知何故会无效，
        // 据说这样会丢失焦点.
        e.preventDefault();
    }
    function mouseMove(e) {
        rDrag.css({
            top: e.clientY - drag.offset.y,
            left: e.clientX - drag.offset.x
        });

        var inContent = true;

        if (inContent && !drag.newDiv) {
            rContent.append('<div id="r-div-new">New Div</div>');
            drag.newDiv = S.one('#r-div-new');
        }
    }
    function mouseUp(e) {
        drag.newDiv.attr('id', 'new-div');
        drag.newDiv.css('background-color', color());
        drag.newDiv.addClass('r-div-selected');
        drag.newDiv = null;

        rDrag.prependTo(S.one('#r-div'))
            .css('position', 'static');

        S.Event.detach(document, 'mousemove', mouseMove);
        S.Event.detach(document, 'mouseup', mouseUp);
    }
    rDrag.on('mousedown', mouseDown);

    S.one('#r-page-width').on('change', function(e) {
        rContent.width(e.target.value);
    });
})(KISSY);
</script>
